module.exports=[19882,(a,b,c)=>{var d=a.r(874),e=d.Buffer;function f(a,b){for(var c in a)b[c]=a[c]}function g(a,b,c){return e(a,b,c)}e.from&&e.alloc&&e.allocUnsafe&&e.allocUnsafeSlow?b.exports=d:(f(d,c),c.Buffer=g),g.prototype=Object.create(e.prototype),f(e,g),g.from=function(a,b,c){if("number"==typeof a)throw TypeError("Argument must not be a number");return e(a,b,c)},g.alloc=function(a,b,c){if("number"!=typeof a)throw TypeError("Argument must be a number");var d=e(a);return void 0!==b?"string"==typeof c?d.fill(b,c):d.fill(b):d.fill(0),d},g.allocUnsafe=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return e(a)},g.allocUnsafeSlow=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return d.SlowBuffer(a)}},47374,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=function(a){this.readable=this.writable=!0,this._paused=!1,this._driver=a};e.inherits(f,d),f.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},f.prototype.resume=function(){this._paused=!1,this.emit("drain");var a=this._driver.messages;a._paused=!1,a.emit("drain")},f.prototype.write=function(a){return!!this.writable&&(this._driver.parse(a),!this._paused)},f.prototype.end=function(a){if(this.writable){void 0!==a&&this.write(a),this.writable=!1;var b=this._driver.messages;b.readable&&(b.readable=b.writable=!1,b.emit("end"))}},f.prototype.destroy=function(){this.end()};var g=function(a){this.readable=this.writable=!0,this._paused=!1,this._driver=a};e.inherits(g,d),g.prototype.pause=function(){this._driver.io._paused=!0},g.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},g.prototype.write=function(a){return!!this.writable&&("string"==typeof a?this._driver.text(a):this._driver.binary(a),!this._paused)},g.prototype.end=function(a){void 0!==a&&this.write(a)},g.prototype.destroy=function(){},c.IO=f,c.Messages=g},44150,(a,b,c)=>{"use strict";var d=function(){this.clear()};d.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],d.prototype.clear=function(){this._sent={},this._lines=[]},d.prototype.set=function(a,b){if(void 0!==b){a=this._strip(a),b=this._strip(b);var c=a.toLowerCase();(!this._sent.hasOwnProperty(c)||this.ALLOWED_DUPLICATES.indexOf(c)>=0)&&(this._sent[c]=!0,this._lines.push(a+": "+b+"\r\n"))}},d.prototype.toString=function(){return this._lines.join("")},d.prototype._strip=function(a){return a.toString().replace(/^ */,"").replace(/ *$/,"")},b.exports=d},3335,(a,b,c)=>{"use strict";var d=a.r(19882).Buffer,e=function(){this._queue=[],this._queueSize=0,this._offset=0};e.prototype.put=function(a){a&&0!==a.length&&(d.isBuffer(a)||(a=d.from(a)),this._queue.push(a),this._queueSize+=a.length)},e.prototype.read=function(a){if(a>this._queueSize)return null;if(0===a)return d.alloc(0);this._queueSize-=a;var b,c,e=this._queue,f=a,g=e[0];if(g.length>=a)if(g.length===a)return e.shift();else return c=g.slice(0,a),e[0]=g.slice(a),c;for(var h=0,i=e.length;h<i&&!(f<e[h].length);h++)f-=e[h].length;return b=e.splice(0,h),f>0&&e.length>0&&(b.push(e[0].slice(0,f)),e[0]=e[0].slice(f)),d.concat(b,a)},e.prototype.eachByte=function(a,b){for(var c,d,e;this._queue.length>0;){for(d=(c=this._queue[0]).length;this._offset<d;)e=this._offset,this._offset+=1,a.call(b,c[e]);this._offset=0,this._queue.shift()}},b.exports=e},70421,(a,b,c)=>{"use strict";var d=a.r(19882).Buffer,e=a.r(27699).EventEmitter,f=a.r(24361),g=a.r(47374),h=a.r(44150),i=a.r(3335),j=function(a,b,c){e.call(this),j.validateOptions(c||{},["maxLength","masking","requireMasking","protocols"]),this._request=a,this._reader=new i,this._options=c||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new h,this.__queue=[],this.readyState=0,this.url=b,this.io=new g.IO(this),this.messages=new g.Messages(this),this._bindEventListeners()};f.inherits(j,e),j.isWebSocket=function(a){var b=a.headers.connection||"",c=a.headers.upgrade||"";return"GET"===a.method&&b.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===c.toLowerCase()},j.validateOptions=function(a,b){for(var c in a)if(0>b.indexOf(c))throw Error("Unrecognized option: "+c)};var k={MAX_LENGTH:0x3ffffff,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var a=this;this.messages.on("error",function(){}),this.on("message",function(b){var c=a.messages;c.readable&&c.emit("data",b.data)}),this.on("error",function(b){var c=a.messages;c.readable&&c.emit("error",b)}),this.on("close",function(){var b=a.messages;b.readable&&(b.readable=b.writable=!1,b.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(a){return!1},setHeader:function(a,b){return!(this.readyState>0)&&(this._headers.set(a,b),!0)},start:function(){var a;if(0!==this.readyState)return!1;if(!j.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{a=this._handshakeResponse()}catch(a){return this._failHandshake(a)}return this._write(a),-1!==this._stage&&this._open(),!0},_failHandshake:function(a){var b=new h;return b.set("Content-Type","text/plain"),b.set("Content-Length",d.byteLength(a.message,"utf8")),b=["HTTP/1.1 400 Bad Request",b.toString(),a.message],this._write(d.from(b.join("\r\n"),"utf8")),this._fail("protocol_error",a.message),!1},text:function(a){return this.frame(a)},binary:function(a){return!1},ping:function(){return!1},pong:function(){return!1},close:function(a,b){return 1===this.readyState&&(this.readyState=3,this.emit("close",new j.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(a){this.frame.apply(this,a)},this),this.__queue=[],this.emit("open",new j.OpenEvent)},_queue:function(a){return this.__queue.push(a),!0},_write:function(a){var b=this.io;b.readable&&b.emit("data",a)},_fail:function(a,b){this.readyState=2,this.emit("error",Error(b)),this.close()}};for(var l in k)j.prototype[l]=k[l];j.ConnectEvent=function(){},j.OpenEvent=function(){},j.CloseEvent=function(a,b){this.code=a,this.reason=b},j.MessageEvent=function(a){this.data=a},j.PingEvent=function(a){this.data=a},j.PongEvent=function(a){this.data=a},b.exports=j},4321,(a,b,c)=>{function d(a){if(void 0!==a&&a!==d.REQUEST&&a!==d.RESPONSE)throw Error("type must be REQUEST or RESPONSE");void 0===a||this.initialize(a),this.maxHeaderSize=d.maxHeaderSize}c.HTTPParser=d,d.prototype.initialize=function(a,b){if(a!==d.REQUEST&&a!==d.RESPONSE)throw Error("type must be REQUEST or RESPONSE");this.type=a,this.state=a+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},d.encoding="ascii",d.maxHeaderSize=81920,d.REQUEST="REQUEST",d.RESPONSE="RESPONSE";var e=d.kOnHeaders=1,f=d.kOnHeadersComplete=2,g=d.kOnBody=3,h=d.kOnMessageComplete=4;d.prototype[e]=d.prototype[f]=d.prototype[g]=d.prototype[h]=function(){};var i=!0;Object.defineProperty(d,"kOnExecute",{get:function(){return i=!1,99}});var j=c.methods=d.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],k=j.indexOf("CONNECT");d.prototype.reinitialize=d,d.prototype.close=d.prototype.pause=d.prototype.resume=d.prototype.remove=d.prototype.free=function(){},d.prototype._compatMode0_11=!1,d.prototype.getAsyncId=function(){return 0};var l={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};d.prototype.execute=function(a,b,c){if(!(this instanceof d))throw TypeError("not a HTTPParser");b=b||0,c="number"==typeof c?c:a.length,this.chunk=a,this.offset=b;var e=this.end=b+c;try{for(;this.offset<e&&!this[this.state](););}catch(a){if(this.isUserCall)throw a;return this.hadError=!0,a}return(this.chunk=null,c=this.offset-b,l[this.state]&&(this.headerSize+=c,this.headerSize>(this.maxHeaderSize||d.maxHeaderSize)))?Error("max header size exceeded"):c};var m={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};d.prototype.finish=function(){if(!this.hadError){if(!m[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[h]())}},d.prototype.consume=d.prototype.unconsume=d.prototype.getCurrentBuffer=function(){},d.prototype.userCall=function(){this.isUserCall=!0;var a=this;return function(b){return a.isUserCall=!1,b}},d.prototype.nextRequest=function(){this.userCall()(this[h]()),this.reinitialize(this.type)},d.prototype.consumeLine=function(){for(var a=this.end,b=this.chunk,c=this.offset;c<a;c++)if(10===b[c]){var e=this.line+b.toString(d.encoding,this.offset,c);return"\r"===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),this.line="",this.offset=c+1,e}this.line+=b.toString(d.encoding,this.offset,this.end),this.offset=this.end};var n=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,o=/^[ \t]+(.*[^ \t])/;d.prototype.parseHeader=function(a,b){if(-1!==a.indexOf("\r"))throw r("HPE_LF_EXPECTED");var c=n.exec(a),d=c&&c[1];if(d)b.push(d),b.push(c[2]);else{var e=o.exec(a);e&&b.length&&(b[b.length-1]&&(b[b.length-1]+=" "),b[b.length-1]+=e[1])}};var p=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;d.prototype.REQUEST_LINE=function(){var a=this.consumeLine();if(a){var b=p.exec(a);if(null===b)throw r("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?b[1]:j.indexOf(b[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=b[2],this.info.versionMajor=+b[3],this.info.versionMinor=+b[4],this.body_bytes=0,this.state="HEADER"}};var q=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function r(a){var b=Error("Parse Error");return b.code=a,b}d.prototype.RESPONSE_LINE=function(){var a=this.consumeLine();if(a){var b=q.exec(a);if(null===b)throw r("HPE_INVALID_CONSTANT");this.info.versionMajor=+b[1],this.info.versionMinor=+b[2];var c=this.info.statusCode=+b[3];this.info.statusMessage=b[4],((c/100|0)==1||204===c||304===c)&&(this.body_bytes=0),this.state="HEADER"}},d.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},d.prototype.HEADER=function(){var a=this.consumeLine();if(void 0!==a){var b=this.info;if(a)this.parseHeader(a,b.headers);else{for(var c,e,g=b.headers,h=!1,j=!1,l=0;l<g.length;l+=2)switch(g[l].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===g[l+1].toLowerCase();break;case"content-length":if(c=+g[l+1],h){if(c!==this.body_bytes)throw r("HPE_UNEXPECTED_CONTENT_LENGTH")}else h=!0,this.body_bytes=c;break;case"connection":this.connection+=g[l+1].toLowerCase();break;case"upgrade":j=!0}if(this.isChunked&&h&&(h=!1,this.body_bytes=null),j&&-1!=this.connection.indexOf("upgrade")?b.upgrade=this.type===d.REQUEST||101===b.statusCode:b.upgrade=b.method===k,this.isChunked&&b.upgrade&&(this.isChunked=!1),b.shouldKeepAlive=this.shouldKeepAlive(),2===(e=i?this.userCall()(this[f](b)):this.userCall()(this[f](b.versionMajor,b.versionMinor,b.headers,b.method,b.url,b.statusCode,b.statusMessage,b.upgrade,b.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!e)this.state="BODY_CHUNKHEAD";else{if(e||0===this.body_bytes)return this.nextRequest(),b.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},d.prototype.BODY_CHUNKHEAD=function(){var a=this.consumeLine();void 0!==a&&(this.body_bytes=parseInt(a,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},d.prototype.BODY_CHUNK=function(){var a=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[g](this.chunk.slice(this.offset,this.offset+a),0,a)),this.offset+=a,this.body_bytes-=a,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},d.prototype.BODY_CHUNKEMPTYLINE=function(){var a=this.consumeLine();if(void 0!==a){if(""!==a)throw Error("Expected empty line");this.state="BODY_CHUNKHEAD"}},d.prototype.BODY_CHUNKTRAILERS=function(){var a=this.consumeLine();void 0!==a&&(a?this.parseHeader(a,this.trailers):(this.trailers.length&&this.userCall()(this[e](this.trailers,"")),this.nextRequest()))},d.prototype.BODY_RAW=function(){this.userCall()(this[g](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end},d.prototype.BODY_SIZED=function(){var a=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[g](this.chunk.slice(this.offset,this.offset+a),0,a)),this.offset+=a,this.body_bytes-=a,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(a){var b=d["kOn"+a];Object.defineProperty(d.prototype,"on"+a,{get:function(){return this[b]},set:function(a){return this._compatMode0_11=!0,k="CONNECT",this[b]=a}})})},68100,(a,b,c)=>{"use strict";var d=a.r(4321).HTTPParser,e=a.r(19882).Buffer,f={request:d.REQUEST||"request",response:d.RESPONSE||"response"},g=function(a){this._type=a,this._parser=new d(f[a]),this._complete=!1,this.headers={};var b=null,c=this;this._parser.onHeaderField=function(a,c,d){b=a.toString("utf8",c,c+d).toLowerCase()},this._parser.onHeaderValue=function(a,d,e){var f=a.toString("utf8",d,d+e);c.headers.hasOwnProperty(b)?c.headers[b]+=", "+f:c.headers[b]=f},this._parser.onHeadersComplete=this._parser[d.kOnHeadersComplete]=function(a,b,d,e,f,h){var i=arguments[0];if("object"==typeof i&&(e=i.method,f=i.url,h=i.statusCode,d=i.headers),c.method="number"==typeof e?g.METHODS[e]:e,c.statusCode=h,c.url=f,d){for(var j,k,l=0,m=d.length;l<m;l+=2)j=d[l].toLowerCase(),k=d[l+1],c.headers.hasOwnProperty(j)?c.headers[j]+=", "+k:c.headers[j]=k;c._complete=!0}}};g.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var h=process.version?process.version.match(/[0-9]+/g).map(function(a){return parseInt(a,10)}):[];0===h[0]&&12===h[1]&&(g.METHODS[16]="REPORT",g.METHODS[17]="MKACTIVITY",g.METHODS[18]="CHECKOUT",g.METHODS[19]="MERGE",g.METHODS[20]="M-SEARCH",g.METHODS[21]="NOTIFY",g.METHODS[22]="SUBSCRIBE",g.METHODS[23]="UNSUBSCRIBE",g.METHODS[24]="PATCH",g.METHODS[25]="PURGE"),g.prototype.isComplete=function(){return this._complete},g.prototype.parse=function(a){var b=this._parser.execute(a,0,a.length);if("number"!=typeof b){this.error=b,this._complete=!0;return}this._complete&&(this.body=b<a.length?a.slice(b):e.alloc(0))},b.exports=g},88126,(a,b,c)=>{"use strict";var d=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,e=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,f=RegExp(d.source+"(?:=(?:"+d.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),g=RegExp(d.source+"(?: *; *"+f.source+")*","g"),h=RegExp("^"+g.source+"(?: *, *"+g.source+")*$"),i=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,j=Object.prototype.hasOwnProperty,k={parseHeader:function(a){var b=new l;if(""===a||void 0===a)return b;if(!h.test(a))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+a);return a.match(g).forEach(function(a){var c=a.match(RegExp(f.source,"g")),d=c.shift(),e={};c.forEach(function(a){var b,c=a.match(f),d=c[1];b=void 0!==c[2]?c[2]:void 0===c[3]||c[3].replace(/\\/g,""),i.test(b)&&(b=parseFloat(b)),j.call(e,d)?(e[d]=[].concat(e[d]),e[d].push(b)):e[d]=b},this),b.push(d,e)},this),b},serializeParams:function(a,b){var c=[],d=function(a,b){b instanceof Array?b.forEach(function(b){d(a,b)}):!0===b?c.push(a):"number"==typeof b?c.push(a+"="+b):e.test(b)?c.push(a+'="'+b.replace(/"/g,'\\"')+'"'):c.push(a+"="+b)};for(var f in b)d(f,b[f]);return[a].concat(c).join("; ")}},l=function(){this._byName={},this._inOrder=[]};l.prototype.push=function(a,b){j.call(this._byName,a)||(this._byName[a]=[]),this._byName[a].push(b),this._inOrder.push({name:a,params:b})},l.prototype.eachOffer=function(a,b){for(var c=this._inOrder,d=0,e=c.length;d<e;d++)a.call(b,c[d].name,c[d].params)},l.prototype.byName=function(a){return this._byName[a]||[]},l.prototype.toArray=function(){return this._inOrder.slice()},b.exports=k},52988,(a,b,c)=>{"use strict";var d=function(a){this._bufferSize=a,this.clear()};d.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},d.prototype.push=function(a){var b=!1,c=!1;this._ringSize<this._bufferSize?b=0===this._tail:this._ringOffset===this._ringSize&&(b=!0,c=0===this._tail),b&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,c&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=a,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},d.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},d.prototype.shift=function(){if(0!==this.length){var a=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,a}},b.exports=d},8326,(a,b,c)=>{"use strict";var d=a.r(52988),e=function(a,b){this._session=a,this._method=b,this._queue=new d(e.QUEUE_SIZE),this._stopped=!1,this.pending=0};e.QUEUE_SIZE=8,e.prototype.call=function(a,b,c,d){if(!this._stopped){var e={error:a,message:b,callback:c,context:d,done:!1},f=!1,g=this;if(this._queue.push(e),e.error)return e.done=!0,this._stop(),this._flushQueue();var h=function(a,b){f^(f=!0)&&(a?(g._stop(),e.error=a,e.message=null):e.message=b,e.done=!0,g._flushQueue())};try{this._session[this._method](b,h)}catch(a){h(a)}}},e.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},e.prototype._flushQueue=function(){for(var a,b=this._queue;b.length>0&&b.peek().done;)(a=b.shift()).error?(this.pending=0,b.clear()):this.pending-=1,a.callback.call(a.context,a.error,a.message)},b.exports=e},81698,(a,b,c)=>{"use strict";var d=a.r(52988),e=function(){this._complete=!1,this._callbacks=new d(e.QUEUE_SIZE)};e.QUEUE_SIZE=4,e.all=function(a){var b=new e,c=a.length,d=c;for(0===c&&b.done();d--;)a[d].then(function(){0==(c-=1)&&b.done()});return b},e.prototype.then=function(a){this._complete?a():this._callbacks.push(a)},e.prototype.done=function(){this._complete=!0;for(var a,b=this._callbacks;a=b.shift();)a()},b.exports=e},10543,(a,b,c)=>{"use strict";var d=a.r(8326),e=a.r(81698),f=function(a){this._ext=a[0],this._session=a[1],this._functors={incoming:new d(this._session,"processIncomingMessage"),outgoing:new d(this._session,"processOutgoingMessage")}};f.prototype.pending=function(a){var b=this._functors[a];b._stopped||(b.pending+=1)},f.prototype.incoming=function(a,b,c,d){this._exec("incoming",a,b,c,d)},f.prototype.outgoing=function(a,b,c,d){this._exec("outgoing",a,b,c,d)},f.prototype.close=function(){return this._closed=this._closed||new e,this._doClose(),this._closed},f.prototype._exec=function(a,b,c,d,e){this._functors[a].call(b,c,function(a,b){a&&(a.message=this._ext.name+": "+a.message),d.call(e,a,b),this._doClose()},this)},f.prototype._doClose=function(){var a=this._functors.incoming,b=this._functors.outgoing;this._closed&&a.pending+b.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())},b.exports=f},72260,(a,b,c)=>{"use strict";var d=a.r(10543),e=a.r(81698),f=function(a){this._cells=a.map(function(a){return new d(a)}),this._stopped={incoming:!1,outgoing:!1}};f.prototype.processIncomingMessage=function(a,b,c){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,a,b,c)},f.prototype.processOutgoingMessage=function(a,b,c){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,a,b,c)},f.prototype.close=function(a,b){this._stopped={incoming:!0,outgoing:!0};var c=this._cells.map(function(a){return a.close()});a&&e.all(c).then(function(){a.call(b)})},f.prototype._loop=function(a,b,c,d,e,f,g){for(var h=this._cells,i=h.length,j=this;i--;)h[i].pending(a);var k=function(b,e,i){if(b===c)return f.call(g,e,i);h[b][a](e,i,function(c,e){c&&(j._stopped[a]=!0),k(b+d,c,e)})};k(b,null,e)},b.exports=f},89256,(a,b,c)=>{"use strict";var d=a.r(88126),e=a.r(72260),f=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};f.MESSAGE_OPCODES=[1,2];var g={add:function(a){if("string"!=typeof a.name)throw TypeError("extension.name must be a string");if("permessage"!==a.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof a.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof a.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof a.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(a.name))throw TypeError('An extension with name "'+a.name+'" is already registered');this._byName[a.name]=a,this._inOrder.push(a)},generateOffer:function(){var a=[],b=[],c={};return this._inOrder.forEach(function(e){var f=e.createClientSession();if(f){var g=[e,f];a.push(g),c[e.name]=g;var h=f.generateOffer();h=h?[].concat(h):[],h.forEach(function(a){b.push(d.serializeParams(e.name,a))},this)}},this),this._sessions=a,this._index=c,b.length>0?b.join(", "):null},activate:function(a){var b=d.parseHeader(a),c=[];b.eachOffer(function(a,b){var e=this._index[a];if(!e)throw Error('Server sent an extension response for unknown extension "'+a+'"');var f=e[0],g=e[1],h=this._reserved(f);if(h)throw Error("Server sent two extension responses that use the RSV"+h[0]+' bit: "'+h[1]+'" and "'+f.name+'"');if(!0!==g.activate(b))throw Error("Server sent unacceptable extension parameters: "+d.serializeParams(a,b));this._reserve(f),c.push(e)},this),this._sessions=c,this._pipeline=new e(c)},generateResponse:function(a){var b=[],c=[],f=d.parseHeader(a);return this._inOrder.forEach(function(a){var e=f.byName(a.name);if(!(0===e.length||this._reserved(a))){var g=a.createServerSession(e);g&&(this._reserve(a),b.push([a,g]),c.push(d.serializeParams(a.name,g.generateResponse())))}},this),this._sessions=b,this._pipeline=new e(b),c.length>0?c.join(", "):null},validFrameRsv:function(a){var b,c={rsv1:!1,rsv2:!1,rsv3:!1};if(f.MESSAGE_OPCODES.indexOf(a.opcode)>=0)for(var d=0,e=this._sessions.length;d<e;d++)b=this._sessions[d][0],c.rsv1=c.rsv1||b.rsv1,c.rsv2=c.rsv2||b.rsv2,c.rsv3=c.rsv3||b.rsv3;return(c.rsv1||!a.rsv1)&&(c.rsv2||!a.rsv2)&&(c.rsv3||!a.rsv3)},processIncomingMessage:function(a,b,c){this._pipeline.processIncomingMessage(a,b,c)},processOutgoingMessage:function(a,b,c){this._pipeline.processOutgoingMessage(a,b,c)},close:function(a,b){if(!this._pipeline)return a.call(b);this._pipeline.close(a,b)},_reserve:function(a){this._rsv1=this._rsv1||a.rsv1&&a.name,this._rsv2=this._rsv2||a.rsv2&&a.name,this._rsv3=this._rsv3||a.rsv3&&a.name},_reserved:function(a){return this._rsv1&&a.rsv1?[1,this._rsv1]:this._rsv2&&a.rsv2?[2,this._rsv2]:!!this._rsv3&&!!a.rsv3&&[3,this._rsv3]}};for(var h in g)f.prototype[h]=g[h];b.exports=f},80912,(a,b,c)=>{"use strict";var d=function(){},e={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var f in e)d.prototype[f]=e[f];b.exports=d},7845,(a,b,c)=>{"use strict";var d=a.r(19882).Buffer,e=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},f={read:function(){return this.data=this.data||d.concat(this._chunks,this.length)},pushFrame:function(a){this.rsv1=this.rsv1||a.rsv1,this.rsv2=this.rsv2||a.rsv2,this.rsv3=this.rsv3||a.rsv3,null===this.opcode&&(this.opcode=a.opcode),this._chunks.push(a.payload),this.length+=a.length}};for(var g in f)e.prototype[g]=f[g];b.exports=e},44842,(a,b,c)=>{"use strict";var d=a.r(19882).Buffer,e=a.r(54799),f=a.r(24361),g=a.r(89256),h=a.r(70421),i=a.r(80912),j=a.r(7845),k=function(a,b,c){if(h.apply(this,arguments),this._extensions=new g,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var d=this._request.headers["sec-websocket-protocol"],e=this._protocols;void 0!==d&&("string"==typeof d&&(d=d.split(/ *, */)),this.protocol=d.filter(function(a){return e.indexOf(a)>=0})[0]),this.version="hybi-"+k.VERSION}};f.inherits(k,h),k.VERSION="13",k.mask=function(a,b,c){if(!b||0===b.length)return a;c=c||0;for(var d=0,e=a.length-c;d<e;d++)a[c+d]=a[c+d]^b[d%4];return a},k.generateAccept=function(a){var b=e.createHash("sha1");return b.update(a+k.GUID),b.digest("base64")},k.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var l={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(a){return this._extensions.add(a),!0},parse:function(a){this._reader.put(a);for(var b=!0;b;)switch(this._stage){case 0:(b=this._reader.read(1))&&this._parseOpcode(b[0]);break;case 1:(b=this._reader.read(1))&&this._parseLength(b[0]);break;case 2:(b=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(b);break;case 3:(b=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=b);break;case 4:(b=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(b));break;default:b=null}},text:function(a){return!(this.readyState>1)&&this.frame(a,"text")},binary:function(a){return!(this.readyState>1)&&this.frame(a,"binary")},ping:function(a,b){return!(this.readyState>1)&&(a=a||"",b&&(this._pingCallbacks[a]=b),this.frame(a,"ping"))},pong:function(a){return!(this.readyState>1)&&(a=a||"",this.frame(a,"pong"))},close:function(a,b){return(a=a||"",b=b||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new h.CloseEvent(b,a)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(a,"close",b)},this),!0)},frame:function(a,b,c){if(this.readyState<=0)return this._queue([a,b,c]);if(this.readyState>2)return!1;a instanceof Array&&(a=d.from(a)),"number"==typeof a&&(a=a.toString());var f,g,h=new j,k="string"==typeof a;h.rsv1=h.rsv2=h.rsv3=!1,h.opcode=this.OPCODES[b||(k?"text":"binary")],f=k?d.from(a,"utf8"):a,c&&(g=f,(f=d.allocUnsafe(2+g.length)).writeUInt16BE(c,0),g.copy(f,2)),h.data=f;var l=function(a){var b=new i;b.final=!0,b.rsv1=a.rsv1,b.rsv2=a.rsv2,b.rsv3=a.rsv3,b.opcode=a.opcode,b.masked=!!this._masking,b.length=a.data.length,b.payload=a.data,b.masked&&(b.maskingKey=e.randomBytes(4)),this._sendFrame(b)};return this.MESSAGE_OPCODES.indexOf(h.opcode)>=0?this._extensions.processOutgoingMessage(h,function(a,b){if(a)return this._fail("extension_error",a.message);l.call(this,b)},this):l.call(this,h),!0},_sendFrame:function(a){var b=a.length,c=b<=125?2:b<=65535?4:10,e=c+4*!!a.masked,f=d.allocUnsafe(e+b),g=a.masked?this.MASK:0;f[0]=(a.final?this.FIN:0)|(a.rsv1?this.RSV1:0)|(a.rsv2?this.RSV2:0)|(a.rsv3?this.RSV3:0)|a.opcode,b<=125?f[1]=g|b:b<=65535?(f[1]=126|g,f.writeUInt16BE(b,2)):(f[1]=127|g,f.writeUInt32BE(Math.floor(b/0x100000000),2),f.writeUInt32BE(b%0x100000000,6)),a.payload.copy(f,e),a.masked&&(a.maskingKey.copy(f,c),k.mask(f,a.maskingKey,e)),this._write(f)},_handshakeResponse:function(){var a=this._request.headers["sec-websocket-key"],b=this._request.headers["sec-websocket-version"];if(b!==k.VERSION)throw Error("Unsupported WebSocket version: "+b);if("string"!=typeof a)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",k.generateAccept(a)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var c=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);c&&this._headers.set("Sec-WebSocket-Extensions",c);var e=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return d.from(e.join("\r\n"),"utf8")},_shutdown:function(a,b,c){delete this._frame,delete this._message,this._stage=5;var d=1===this.readyState;this.readyState=2,this._extensions.close(function(){d&&this.frame(b,"close",a),this.readyState=3,c&&this.emit("error",Error(b)),this.emit("close",new h.CloseEvent(a,b))},this)},_fail:function(a,b){this.readyState>1||this._shutdown(this.ERRORS[a],b,!0)},_parseOpcode:function(a){var b=[this.RSV1,this.RSV2,this.RSV3].map(function(b){return(a&b)===b}),c=this._frame=new i;return(c.final=(a&this.FIN)===this.FIN,c.rsv1=b[0],c.rsv2=b[1],c.rsv3=b[2],c.opcode=a&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(c))?0>this.OPCODE_CODES.indexOf(c.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+c.opcode):0>this.MESSAGE_OPCODES.indexOf(c.opcode)&&!c.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+c.opcode):this._message&&this.OPENING_OPCODES.indexOf(c.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+ +!!c.rsv1+", reserved2 = "+ +!!c.rsv2+", reserved3 = "+ +!!c.rsv3)},_parseLength:function(a){var b=this._frame;if(b.masked=(a&this.MASK)===this.MASK,b.length=a&this.LENGTH,b.length>=0&&b.length<=125){if(this._stage=b.masked?3:4,!this._checkFrameLength())return}else this._stage=2,b.lengthBytes=126===b.length?2:8;if(this._requireMasking&&!b.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(a){var b=this._frame;if(b.length=this._readUInt(a),this._stage=b.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(b.opcode)&&b.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+b.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(a){var b,c,d,e,f,g=this._frame,i=g.payload=k.mask(a,g.maskingKey),l=g.opcode;if(delete this._frame,l===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(g)}if((l===this.OPCODES.text||l===this.OPCODES.binary)&&(this._message=new j,this._message.pushFrame(g)),g.final&&this.MESSAGE_OPCODES.indexOf(l)>=0)return this._emitMessage(this._message);l===this.OPCODES.close&&(c=i.length>=2?i.readUInt16BE(0):null,d=i.length>2?this._encode(i.slice(2)):null,0!==i.length&&!(null!==c&&c>=this.MIN_RESERVED_ERROR&&c<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(c)&&(c=this.ERRORS.protocol_error),(i.length>125||i.length>2&&!d)&&(c=this.ERRORS.protocol_error),this._shutdown(c||this.DEFAULT_ERROR_CODE,d||"")),l===this.OPCODES.ping&&(this.frame(i,"pong"),this.emit("ping",new h.PingEvent(i.toString()))),l===this.OPCODES.pong&&(f=(e=this._pingCallbacks)[b=this._encode(i)],delete e[b],f&&f(),this.emit("pong",new h.PongEvent(i.toString())))},_emitMessage:function(a){var a=this._message;a.read(),delete this._message,this._extensions.processIncomingMessage(a,function(a,b){if(a)return this._fail("extension_error",a.message);var c=b.data;if(b.opcode===this.OPCODES.text&&(c=this._encode(c)),null===c)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new h.MessageEvent(c))},this)},_encode:function(a){try{var b=a.toString("binary",0,a.length);if(!this.UTF8_MATCH.test(b))return null}catch(a){}return a.toString("utf8",0,a.length)},_readUInt:function(a){return 2===a.length?a.readUInt16BE(0):0x100000000*a.readUInt32BE(0)+a.readUInt32BE(4)}};for(var m in l)k.prototype[m]=l[m];b.exports=k},28796,(a,b,c)=>{"use strict";var d=a.r(19882).Buffer,e=a.r(88947).Stream,f=a.r(92509),g=a.r(24361),h=a.r(70421),i=a.r(44150),j=a.r(68100),k={"ws:":80,"wss:":443},l=function(a,b,c){this._client=a,this._http=new j("response"),this._origin="object"==typeof a.url?a.url:f.parse(a.url),this._url="object"==typeof b?b:f.parse(b),this._options=c||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new i,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var e=this._url.auth&&d.from(this._url.auth,"utf8").toString("base64");e&&this._headers.set("Proxy-Authorization","Basic "+e)};g.inherits(l,e);var m={setHeader:function(a,b){return 0===this._state&&(this._headers.set(a,b),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var a=this._origin,b=a.port||k[a.protocol],c=["CONNECT "+a.hostname+":"+b+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",d.from(c.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(a){if(!this.writable)return!1;if(this._http.parse(a),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new h.ConnectEvent);else{var b="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(b))}return this.end(),!this._paused},end:function(a){this.writable&&(void 0!==a&&this.write(a),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var n in m)l.prototype[n]=m[n];b.exports=l},19093,(a,b,c)=>{"use strict";var d=a.r(19882).Buffer,e=a.r(54799),f=a.r(92509),g=a.r(24361),h=a.r(68100),i=a.r(70421),j=a.r(44842),k=a.r(28796),l=function(a,b){this.version="hybi-"+j.VERSION,j.call(this,null,a,b),this.readyState=-1,this._key=l.generateKey(),this._accept=j.generateAccept(this._key),this._http=new h("response");var c=f.parse(this.url),e=c.auth&&d.from(c.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(c.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(c.pathname||"/")+(c.search||""),this._headers.set("Host",c.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",j.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),e&&this._headers.set("Authorization","Basic "+e)};g.inherits(l,j),l.generateKey=function(){return e.randomBytes(16).toString("base64")};var m={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(a,b){return new k(this,a,b)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(a){return 3===this.readyState?void 0:this.readyState>0?j.prototype.parse.call(this,a):(this._http.parse(a),this._http.isComplete())?void(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body))):void 0},_handshakeRequest:function(){var a=this._extensions.generateOffer();a&&this._headers.set("Sec-WebSocket-Extensions",a);var b=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return d.from(b.join("\r\n"),"utf8")},_failHandshake:function(a){a="Error during WebSocket handshake: "+a,this.readyState=3,this.emit("error",Error(a)),this.emit("close",new i.CloseEvent(this.ERRORS.protocol_error,a))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var a=this._http.headers,b=a.upgrade||"",c=a.connection||"",d=a["sec-websocket-accept"]||"",e=a["sec-websocket-protocol"]||"";if(""===b)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==b.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===c)return this._failHandshake("'Connection' header is missing");if("upgrade"!==c.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(d!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==e)if(0>this._protocols.indexOf(e))return this._failHandshake("Sec-WebSocket-Protocol mismatch");else this.protocol=e;try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(a){return this._failHandshake(a.message)}}};for(var n in m)l.prototype[n]=m[n];b.exports=l},36609,(a,b,c)=>{"use strict";var d=a.r(19882).Buffer,e=a.r(70421),f=a.r(24361),g=function(a,b,c){e.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};f.inherits(g,e);var h={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new e.CloseEvent(null,null)),!0)},parse:function(a){this.readyState>1||(this._reader.put(a),this._reader.eachByte(function(a){var b;switch(this._stage){case -1:this._body.push(a),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(a);break;case 1:if(this._length=(127&a)+128*this._length,this._closing&&0===this._length)return this.close();(128&a)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===a)this._stage=0,b=d.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new e.MessageEvent(b));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(a),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(a){if(0===this.readyState)return this._queue([a]);if(this.readyState>1)return!1;"string"!=typeof a&&(a=a.toString());var b=d.byteLength(a),c=d.allocUnsafe(b+2);return c[0]=0,c.write(a,1),c[c.length-1]=255,this._write(c),!0},_handshakeResponse:function(){var a=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return d.from(a.join("\r\n"),"utf8")},_parseLeadingByte:function(a){(128&a)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var i in h)g.prototype[i]=h[i];b.exports=g},2271,(a,b,c)=>{"use strict";var d=a.r(19882).Buffer,e=a.r(70421),f=a.r(36609),g=a.r(54799),h=a.r(24361),i=function(a){return parseInt((a.match(/[0-9]/g)||[]).join(""),10)},j=function(a){return(a.match(/ /g)||[]).length},k=function(a,b,c){f.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};h.inherits(k,f);var l={BODY_SIZE:8,start:function(){return!!f.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(d.from([255,0])),this.readyState=3,this.emit("close",new e.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var a=this._request.headers,b=a["sec-websocket-key1"],c=a["sec-websocket-key2"];if(!b)throw Error("Missing required header: Sec-WebSocket-Key1");if(!c)throw Error("Missing required header: Sec-WebSocket-Key2");var e=i(b),f=j(b),g=i(c),h=j(c);if(e%f!=0||g%h!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[e/f,g/h];var a=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return d.from(a.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var a=g.createHash("md5"),b=d.allocUnsafe(8+this.BODY_SIZE);return b.writeUInt32BE(this._keyValues[0],0),b.writeUInt32BE(this._keyValues[1],4),d.from(this._body).copy(b,8,0,this.BODY_SIZE),a.update(b),d.from(a.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var a=this._handshakeSignature();a&&(this._write(a),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(a){if(255!==a)return f.prototype._parseLeadingByte.call(this,a);this._closing=!0,this._length=0,this._stage=1}};for(var m in l)k.prototype[m]=l[m];b.exports=k},80804,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(68100),f=a.r(70421),g=a.r(36609),h=a.r(2271),i=a.r(44842),j=function(a){f.call(this,null,null,a),this._http=new e("request")};d.inherits(j,f);var k={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(a){if(this._delegate)return this._delegate.parse(a);if(this._http.parse(a),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var b=this;this._delegate=j.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(a){this._delegate.on(a,function(c){b.emit(a,c)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new f.ConnectEvent)}},_open:function(){this.__queue.forEach(function(a){this._delegate[a[0]].apply(this._delegate,a[1])},this),this.__queue=[]}};for(var l in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(a){k[a]=function(){return this._delegate?this._delegate[a].apply(this._delegate,arguments):(this.__queue.push([a,arguments]),!0)}}),k)j.prototype[l]=k[l];j.isSecureRequest=function(a){if(a.connection&&void 0!==a.connection.authorized||a.socket&&a.socket.secure)return!0;var b=a.headers;return!!b&&("on"===b.https||"on"===b["x-forwarded-ssl"]||"https"===b["x-forwarded-scheme"]||"https"===b["x-forwarded-proto"])},j.determineUrl=function(a){return(this.isSecureRequest(a)?"wss:":"ws:")+"//"+a.headers.host+a.url},j.http=function(a,b){void 0===(b=b||{}).requireMasking&&(b.requireMasking=!0);var c=a.headers,d=c["sec-websocket-version"],e=c["sec-websocket-key"],f=c["sec-websocket-key1"],j=c["sec-websocket-key2"],k=this.determineUrl(a);return d||e?new i(a,k,b):f||j?new h(a,k,b):new g(a,k,b)},b.exports=j},31140,(a,b,c)=>{"use strict";var d=a.r(70421),e=a.r(19093),f=a.r(80804);b.exports={client:function(a,b){return void 0===(b=b||{}).masking&&(b.masking=!0),new e(a,b)},server:function(a){return void 0===(a=a||{}).requireMasking&&(a.requireMasking=!0),new f(a)},http:function(){return f.http.apply(f,arguments)},isSecureRequest:function(a){return f.isSecureRequest(a)},isWebSocket:function(a){return d.isWebSocket(a)},validateOptions:function(a,b){d.validateOptions(a,b)}}},40598,(a,b,c)=>{"use strict";var d=function(a,b){for(var c in this.type=a,b)this[c]=b[c]};d.prototype.initEvent=function(a,b,c){this.type=a,this.bubbles=b,this.cancelable=c},d.prototype.stopPropagation=function(){},d.prototype.preventDefault=function(){},d.CAPTURING_PHASE=1,d.AT_TARGET=2,d.BUBBLING_PHASE=3,b.exports=d},60603,(a,b,c)=>{"use strict";var d=a.r(40598);b.exports={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(a,b,c){this.on(a,b)},removeEventListener:function(a,b,c){this.removeListener(a,b)},dispatchEvent:function(a){a.target=a.currentTarget=this,a.eventPhase=d.AT_TARGET,this["on"+a.type]&&this["on"+a.type](a),this.emit(a.type,a)}}},8234,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=a.r(31140),g=a.r(60603),h=a.r(40598),i=function(a){a=a||{},f.validateOptions(a,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var b=a.headers;if(b)for(var c in b)this._driver.setHeader(c,b[c]);var d=a.extensions;d&&[].concat(d).forEach(this._driver.addExtension,this._driver),this._ping=a.ping,this._pingId=0,this.readyState=i.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var e=this;this._driver.on("open",function(a){e._open()}),this._driver.on("message",function(a){e._receiveMessage(a.data)}),this._driver.on("close",function(a){e._beginClose(a.reason,a.code)}),this._driver.on("error",function(a){e._emitError(a.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){e.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){e._pingId+=1,e.ping(e._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};e.inherits(i,d),i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i.CLOSE_TIMEOUT=3e4;var j={write:function(a){return this.send(a)},end:function(a){void 0!==a&&this.send(a),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(a){return!(this.readyState>i.OPEN)&&(a instanceof Buffer||(a=String(a)),this._driver.messages.write(a))},ping:function(a,b){return!(this.readyState>i.OPEN)&&this._driver.ping(a,b)},close:function(a,b){if(void 0===a&&(a=1e3),void 0===b&&(b=""),1e3!==a&&(a<3e3||a>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+a+" is neither.");if(this.readyState<i.CLOSING){var c=this;this._closeTimer=setTimeout(function(){c._beginClose("",1006)},i.CLOSE_TIMEOUT)}this.readyState!==i.CLOSED&&(this.readyState=i.CLOSING),this._driver.close(b,a)},_configureStream:function(){var a=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(b){this._stream.on(b,function(){a._finalizeClose()})},this),this._stream.on("error",function(b){a._emitError("Network error: "+a.url+": "+b.message),a._finalizeClose()})},_open:function(){if(this.readyState===i.CONNECTING){this.readyState=i.OPEN,this.protocol=this._driver.protocol||"";var a=new h("open");a.initEvent("open",!1,!1),this.dispatchEvent(a)}},_receiveMessage:function(a){if(this.readyState>i.OPEN)return!1;this.readable&&this.emit("data",a);var b=new h("message",{data:a});b.initEvent("message",!1,!1),this.dispatchEvent(b)},_emitError:function(a){if(!(this.readyState>=i.CLOSING)){var b=new h("error",{message:a});b.initEvent("error",!1,!1),this.dispatchEvent(b)}},_beginClose:function(a,b){this.readyState!==i.CLOSED&&(this.readyState=i.CLOSING,this._closeParams=[a,b],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==i.CLOSED){this.readyState=i.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var a=this._closeParams?this._closeParams[0]:"",b=this._closeParams?this._closeParams[1]:1006,c=new h("close",{code:b,reason:a});c.initEvent("close",!1,!1),this.dispatchEvent(c)}}};for(var k in j)i.prototype[k]=j[k];for(var l in g)i.prototype[l]=g[l];b.exports=i},36951,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(4446),f=a.r(55004),g=a.r(92509),h=a.r(31140),i=a.r(8234);a.r(40598);var j={"http:":80,"https:":443,"ws:":80,"wss:":443},k=["https:","wss:"],l=function(a,b,c){c=c||{},this.url=a,this._driver=h.client(this.url,{maxLength:c.maxLength,protocols:b}),["open","error"].forEach(function(a){this._driver.on(a,function(){s.headers=s._driver.headers,s.statusCode=s._driver.statusCode})},this);var d=c.proxy||{},l=g.parse(d.origin||this.url),m=l.port||j[l.protocol],n=k.indexOf(l.protocol)>=0,o=function(){s._onConnect()},p=c.net||{},q=c.tls||{},r=d.origin?d.tls||{}:q,s=this;p.host=r.host=l.hostname,p.port=r.port=m,q.ca=q.ca||c.ca,r.servername=r.servername||l.hostname,this._stream=n?f.connect(r,o):e.connect(p,o),d.origin&&this._configureProxy(d,q),i.call(this,c)};d.inherits(l,i),l.prototype._onConnect=function(){(this._proxy||this._driver).start()},l.prototype._configureProxy=function(a,b){var c,d=g.parse(this.url),e=k.indexOf(d.protocol)>=0,h=this;if(this._proxy=this._driver.proxy(a.origin),a.headers)for(c in a.headers)this._proxy.setHeader(c,a.headers[c]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(e){var a={socket:h._stream,servername:d.hostname};for(c in b)a[c]=b[c];h._stream=f.connect(a),h._configureStream()}h._driver.io.pipe(h._stream),h._stream.pipe(h._driver.io),h._driver.start()}),this._proxy.on("error",function(a){h._driver.emit("error",a)})},b.exports=l},90626,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=a.r(31140),g=a.r(44150),h=a.r(8234),i=a.r(60603),j=a.r(40598),k=function(a,b,c){this.writable=!0,c=c||{},this._stream=b.socket,this._ping=c.ping||this.DEFAULT_PING,this._retry=c.retry||this.DEFAULT_RETRY;var d=f.isSecureRequest(a)?"https:":"http:";this.url=d+"//"+a.headers.host+a.url,this.lastEventId=a.headers["last-event-id"]||"",this.readyState=h.CONNECTING;var e=new g,i=this;if(c.headers)for(var j in c.headers)e.set(j,c.headers[j]);if(this._stream&&this._stream.writable){process.nextTick(function(){i._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var k="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+e.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(k),this._stream.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i.ping()},1e3*this._ping)),["error","end"].forEach(function(a){i._stream.on(a,function(){i.close()})})}};e.inherits(k,d),k.isEventSource=function(a){return"GET"===a.method&&(a.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var l={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(a){if(!this.writable)return!1;try{return this._stream.write(a,"utf8")}catch(a){return!1}},_open:function(){if(this.readyState===h.CONNECTING){this.readyState=h.OPEN;var a=new j("open");a.initEvent("open",!1,!1),this.dispatchEvent(a)}},write:function(a){return this.send(a)},end:function(a){void 0!==a&&this.write(a),this.close()},send:function(a,b){if(this.readyState>h.OPEN)return!1;a=String(a).replace(/(\r\n|\r|\n)/g,"$1data: ");var c="";return(b=b||{}).event&&(c+="event: "+b.event+"\r\n"),b.id&&(c+="id: "+b.id+"\r\n"),c+="data: "+a+"\r\n\r\n",this._write(c)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>h.OPEN)return!1;this.readyState=h.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var a=new j("close");return a.initEvent("close",!1,!1),this.dispatchEvent(a),!0}};for(var m in l)k.prototype[m]=l[m];for(var n in i)k.prototype[n]=i[n];b.exports=k},45636,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(31140),f=a.r(8234),g=function(a,b,c,d,g){g=g||{},this._stream=b,this._driver=e.http(a,{maxLength:g.maxLength,protocols:d});var h=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var i=function(){h._stream.removeListener("data",i)};this._stream.on("data",i),f.call(this,g),process.nextTick(function(){h._driver.start(),h._driver.io.write(c)})}};d.inherits(g,f),g.isWebSocket=function(a){return e.isWebSocket(a)},g.validateOptions=function(a,b){e.validateOptions(a,b)},g.WebSocket=g,g.Client=a.r(36951),g.EventSource=a.r(90626),b.exports=g},78996,(a,b,c)=>{"use strict";var d,e,f;Object.defineProperty(c,"__esModule",{value:!0}),c.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=c.DEFAULT_MAX_SEND_MESSAGE_LENGTH=c.Propagate=c.LogVerbosity=c.Status=void 0,function(a){a[a.OK=0]="OK",a[a.CANCELLED=1]="CANCELLED",a[a.UNKNOWN=2]="UNKNOWN",a[a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",a[a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",a[a.NOT_FOUND=5]="NOT_FOUND",a[a.ALREADY_EXISTS=6]="ALREADY_EXISTS",a[a.PERMISSION_DENIED=7]="PERMISSION_DENIED",a[a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",a[a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",a[a.ABORTED=10]="ABORTED",a[a.OUT_OF_RANGE=11]="OUT_OF_RANGE",a[a.UNIMPLEMENTED=12]="UNIMPLEMENTED",a[a.INTERNAL=13]="INTERNAL",a[a.UNAVAILABLE=14]="UNAVAILABLE",a[a.DATA_LOSS=15]="DATA_LOSS",a[a.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(d||(c.Status=d={})),function(a){a[a.DEBUG=0]="DEBUG",a[a.INFO=1]="INFO",a[a.ERROR=2]="ERROR",a[a.NONE=3]="NONE"}(e||(c.LogVerbosity=e={})),function(a){a[a.DEADLINE=1]="DEADLINE",a[a.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",a[a.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",a[a.CANCELLATION=8]="CANCELLATION",a[a.DEFAULTS=65535]="DEFAULTS"}(f||(c.Propagate=f={})),c.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,c.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},70799,(a,b,c)=>{"use strict";var d,e,f,g;Object.defineProperty(c,"__esModule",{value:!0}),c.isTracerEnabled=c.trace=c.log=c.setLoggerVerbosity=c.setLogger=c.getLogger=void 0;let h=a.r(78996),i=a.r(5365),j=a.r(6235).version,k={error:(a,...b)=>{console.error("E "+a,...b)},info:(a,...b)=>{console.error("I "+a,...b)},debug:(a,...b)=>{console.error("D "+a,...b)}},l=h.LogVerbosity.ERROR;switch((null!=(e=null!=(d=process.env.GRPC_NODE_VERBOSITY)?d:process.env.GRPC_VERBOSITY)?e:"").toUpperCase()){case"DEBUG":l=h.LogVerbosity.DEBUG;break;case"INFO":l=h.LogVerbosity.INFO;break;case"ERROR":l=h.LogVerbosity.ERROR;break;case"NONE":l=h.LogVerbosity.NONE}c.getLogger=()=>k,c.setLogger=a=>{k=a},c.setLoggerVerbosity=a=>{l=a},c.log=(a,...b)=>{let c;if(a>=l){switch(a){case h.LogVerbosity.DEBUG:c=k.debug;break;case h.LogVerbosity.INFO:c=k.info;break;case h.LogVerbosity.ERROR:c=k.error}c||(c=k.error),c&&c.bind(k)(...b)}};let m=null!=(g=null!=(f=process.env.GRPC_NODE_TRACE)?f:process.env.GRPC_TRACE)?g:"",n=new Set,o=new Set;for(let a of m.split(","))a.startsWith("-")?o.add(a.substring(1)):n.add(a);let p=n.has("all");function q(a,b,d){r(b)&&(0,c.log)(a,new Date().toISOString()+" | v"+j+" "+i.pid+" | "+b+" | "+d)}function r(a){return!o.has(a)&&(p||n.has(a))}c.trace=q,c.isTracerEnabled=r},30246,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getErrorCode=c.getErrorMessage=void 0,c.getErrorMessage=function(a){return a instanceof Error?a.message:String(a)},c.getErrorCode=function(a){return"object"==typeof a&&null!==a&&"code"in a&&"number"==typeof a.code?a.code:null}},14694,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Metadata=void 0;let d=a.r(70799),e=a.r(78996),f=a.r(30246),g=/^[0-9a-z_.-]+$/,h=/^[ -~]*$/;function i(a){return g.test(a)}function j(a){return h.test(a)}function k(a){return a.endsWith("-bin")}function l(a){return!a.startsWith("grpc-")}function m(a){return a.toLowerCase()}function n(a,b){if(!i(a))throw Error('Metadata key "'+a+'" contains illegal characters');if(null!=b)if(k(a)){if(!Buffer.isBuffer(b))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(b))throw Error("keys that don't end with '-bin' must have String values");if(!j(b))throw Error('Metadata string value "'+b+'" contains illegal characters')}}class o{constructor(a={}){this.internalRepr=new Map,this.options=a}set(a,b){n(a=m(a),b),this.internalRepr.set(a,[b])}add(a,b){n(a=m(a),b);let c=this.internalRepr.get(a);void 0===c?this.internalRepr.set(a,[b]):c.push(b)}remove(a){a=m(a),this.internalRepr.delete(a)}get(a){return a=m(a),this.internalRepr.get(a)||[]}getMap(){let a={};for(let[b,c]of this.internalRepr)if(c.length>0){let d=c[0];a[b]=Buffer.isBuffer(d)?Buffer.from(d):d}return a}clone(){let a=new o(this.options),b=a.internalRepr;for(let[a,c]of this.internalRepr){let d=c.map(a=>Buffer.isBuffer(a)?Buffer.from(a):a);b.set(a,d)}return a}merge(a){for(let[b,c]of a.internalRepr){let a=(this.internalRepr.get(b)||[]).concat(c);this.internalRepr.set(b,a)}}setOptions(a){this.options=a}getOptions(){return this.options}toHttp2Headers(){let a={};for(let[b,c]of this.internalRepr)a[b]=c.map(p);return a}toJSON(){let a={};for(let[b,c]of this.internalRepr)a[b]=c;return a}static fromHttp2Headers(a){let b=new o;for(let c of Object.keys(a)){if(":"===c.charAt(0))continue;let g=a[c];try{k(c)?Array.isArray(g)?g.forEach(a=>{b.add(c,Buffer.from(a,"base64"))}):void 0!==g&&(l(c)?g.split(",").forEach(a=>{b.add(c,Buffer.from(a.trim(),"base64"))}):b.add(c,Buffer.from(g,"base64"))):Array.isArray(g)?g.forEach(a=>{b.add(c,a)}):void 0!==g&&b.add(c,g)}catch(b){let a=`Failed to add metadata entry ${c}: ${g}. ${(0,f.getErrorMessage)(b)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,d.log)(e.LogVerbosity.ERROR,a)}}return b}}c.Metadata=o;let p=a=>Buffer.isBuffer(a)?a.toString("base64"):a},80749,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CallCredentials=void 0;let d=a.r(14694);function e(a){return"getRequestHeaders"in a&&"function"==typeof a.getRequestHeaders}class f{static createFromMetadataGenerator(a){return new h(a)}static createFromGoogleCredential(a){return f.createFromMetadataGenerator((b,c)=>{let f;(f=e(a)?a.getRequestHeaders(b.service_url):new Promise((c,d)=>{a.getRequestMetadata(b.service_url,(a,b)=>{a?d(a):b?c(b):d(Error("Headers not set by metadata plugin"))})})).then(a=>{let b=new d.Metadata;for(let c of Object.keys(a))b.add(c,a[c]);c(null,b)},a=>{c(a)})})}static createEmpty(){return new i}}c.CallCredentials=f;class g extends f{constructor(a){super(),this.creds=a}async generateMetadata(a){let b=new d.Metadata;for(let c of(await Promise.all(this.creds.map(b=>b.generateMetadata(a)))))b.merge(c);return b}compose(a){return new g(this.creds.concat([a]))}_equals(a){return this===a||a instanceof g&&this.creds.every((b,c)=>b._equals(a.creds[c]))}}class h extends f{constructor(a){super(),this.metadataGenerator=a}generateMetadata(a){return new Promise((b,c)=>{this.metadataGenerator(a,(a,d)=>{void 0!==d?b(d):c(a)})})}compose(a){return new g([this,a])}_equals(a){return this===a||a instanceof h&&this.metadataGenerator===a.metadataGenerator}}class i extends f{generateMetadata(a){return Promise.resolve(new d.Metadata)}compose(a){return a}_equals(a){return a instanceof i}}},1280,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getDefaultRootsData=c.CIPHER_SUITES=void 0;let d=a.r(22734);c.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let e=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,f=null;c.getDefaultRootsData=function(){return e?(null===f&&(f=d.readFileSync(e)),f):null}},72859,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChannelCredentials=void 0;let d=a.r(55004),e=a.r(80749),f=a.r(1280);function g(a,b){if(a&&!(a instanceof Buffer))throw TypeError(`${b}, if provided, must be a Buffer.`)}class h{constructor(a){this.callCredentials=a||e.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(a,b,c,e){var h;if(g(a,"Root certificate"),g(b,"Private key"),g(c,"Certificate chain"),b&&!c)throw Error("Private key must be given with accompanying certificate chain");if(!b&&c)throw Error("Certificate chain must be given with accompanying private key");return new j((0,d.createSecureContext)({ca:null!=(h=null!=a?a:(0,f.getDefaultRootsData)())?h:void 0,key:null!=b?b:void 0,cert:null!=c?c:void 0,ciphers:f.CIPHER_SUITES}),null!=e?e:{})}static createFromSecureContext(a,b){return new j(a,null!=b?b:{})}static createInsecure(){return new i}}c.ChannelCredentials=h;class i extends h{constructor(a){super(a)}compose(a){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(a){return a instanceof i}}class j extends h{constructor(a,b){super(),this.secureContext=a,this.verifyOptions=b,this.connectionOptions={secureContext:a},(null==b?void 0:b.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=b.checkServerIdentity)}compose(a){return new k(this,this.callCredentials.compose(a))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(a){return this===a||a instanceof j&&this.secureContext===a.secureContext&&this.verifyOptions.checkServerIdentity===a.verifyOptions.checkServerIdentity}}class k extends h{constructor(a,b){super(b),this.channelCredentials=a}compose(a){let b=this.callCredentials.compose(a);return new k(this.channelCredentials,b)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(a){return this===a||a instanceof k&&this.channelCredentials._equals(a.channelCredentials)&&this.callCredentials._equals(a.callCredentials)}}},75424,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.validateLoadBalancingConfig=c.getFirstUsableConfig=c.isLoadBalancerNameRegistered=c.createLoadBalancer=c.registerDefaultLoadBalancerType=c.registerLoadBalancerType=c.createChildChannelControlHelper=void 0,c.createChildChannelControlHelper=function(a,b){var c,d,e,f,g,h,i,j,k,l;return{createSubchannel:null!=(d=null==(c=b.createSubchannel)?void 0:c.bind(b))?d:a.createSubchannel.bind(a),updateState:null!=(f=null==(e=b.updateState)?void 0:e.bind(b))?f:a.updateState.bind(a),requestReresolution:null!=(h=null==(g=b.requestReresolution)?void 0:g.bind(b))?h:a.requestReresolution.bind(a),addChannelzChild:null!=(j=null==(i=b.addChannelzChild)?void 0:i.bind(b))?j:a.addChannelzChild.bind(a),removeChannelzChild:null!=(l=null==(k=b.removeChannelzChild)?void 0:k.bind(b))?l:a.removeChannelzChild.bind(a)}};let d={},e=null;c.registerLoadBalancerType=function(a,b,c){d[a]={LoadBalancer:b,LoadBalancingConfig:c}},c.registerDefaultLoadBalancerType=function(a){e=a},c.createLoadBalancer=function(a,b){let c=a.getLoadBalancerName();return c in d?new d[c].LoadBalancer(b):null},c.isLoadBalancerNameRegistered=function(a){return a in d},c.getFirstUsableConfig=function(a,b=!1){for(let b of a)if(b.getLoadBalancerName()in d)return b;return b&&e?new d[e].LoadBalancingConfig:null},c.validateLoadBalancingConfig=function(a){if(null===a||"object"!=typeof a)throw Error("Load balancing config must be an object");let b=Object.keys(a);if(1!==b.length)throw Error("Provided load balancing config has multiple conflicting entries");let c=b[0];if(c in d)return d[c].LoadBalancingConfig.createFromJson(a[c]);throw Error(`Unrecognized load balancing config name ${c}`)}},24432,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.extractAndSelectServiceConfig=c.validateServiceConfig=c.validateRetryThrottling=void 0;let d=a.r(46786),e=a.r(78996),f=a.r(75424),g=/^\d+(\.\d{1,9})?s$/,h="node";function i(a){if("service"in a&&""!==a.service){if("string"!=typeof a.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof a.service}`);if(!("method"in a)||""===a.method)return{service:a.service};if("string"!=typeof a.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof a.service}`);return{service:a.service,method:a.method}}if("method"in a&&void 0!==a.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function j(a){if(!("maxAttempts"in a)||!Number.isInteger(a.maxAttempts)||a.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in a)||"string"!=typeof a.initialBackoff||!g.test(a.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in a)||"string"!=typeof a.maxBackoff||!g.test(a.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in a)||"number"!=typeof a.backoffMultiplier||a.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in a&&Array.isArray(a.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===a.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let b of a.retryableStatusCodes)if("number"==typeof b){if(!Object.values(e.Status).includes(b))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof b){if(!Object.values(e.Status).includes(b.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:a.maxAttempts,initialBackoff:a.initialBackoff,maxBackoff:a.maxBackoff,backoffMultiplier:a.backoffMultiplier,retryableStatusCodes:a.retryableStatusCodes}}function k(a){if(!("maxAttempts"in a)||!Number.isInteger(a.maxAttempts)||a.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in a&&("string"!=typeof a.hedgingDelay||!g.test(a.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in a&&Array.isArray(a.nonFatalStatusCodes))for(let b of a.nonFatalStatusCodes)if("number"==typeof b){if(!Object.values(e.Status).includes(b))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof b){if(!Object.values(e.Status).includes(b.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let b={maxAttempts:a.maxAttempts};return a.hedgingDelay&&(b.hedgingDelay=a.hedgingDelay),a.nonFatalStatusCodes&&(b.nonFatalStatusCodes=a.nonFatalStatusCodes),b}function l(a){var b;let c={name:[]};if(!("name"in a)||!Array.isArray(a.name))throw Error("Invalid method config: invalid name array");for(let b of a.name)c.name.push(i(b));if("waitForReady"in a){if("boolean"!=typeof a.waitForReady)throw Error("Invalid method config: invalid waitForReady");c.waitForReady=a.waitForReady}if("timeout"in a)if("object"==typeof a.timeout){if(!("seconds"in a.timeout)||"number"!=typeof a.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in a.timeout)||"number"!=typeof a.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");c.timeout=a.timeout}else if("string"==typeof a.timeout&&g.test(a.timeout)){let d=a.timeout.substring(0,a.timeout.length-1).split(".");c.timeout={seconds:0|d[0],nanos:(null!=(b=d[1])?b:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in a){if("number"!=typeof a.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");c.maxRequestBytes=a.maxRequestBytes}if("maxResponseBytes"in a){if("number"!=typeof a.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");c.maxResponseBytes=a.maxResponseBytes}if("retryPolicy"in a)if("hedgingPolicy"in a)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else c.retryPolicy=j(a.retryPolicy);else"hedgingPolicy"in a&&(c.hedgingPolicy=k(a.hedgingPolicy));return c}function m(a){if(!("maxTokens"in a)||"number"!=typeof a.maxTokens||a.maxTokens<=0||a.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in a)||"number"!=typeof a.tokenRatio||a.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+a.maxTokens.toFixed(3),tokenRatio:+a.tokenRatio.toFixed(3)}}function n(a){let b={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in a)if("string"==typeof a.loadBalancingPolicy)b.loadBalancingPolicy=a.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in a)if(Array.isArray(a.loadBalancingConfig))for(let c of a.loadBalancingConfig)b.loadBalancingConfig.push((0,f.validateLoadBalancingConfig)(c));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in a&&Array.isArray(a.methodConfig))for(let c of a.methodConfig)b.methodConfig.push(l(c));"retryThrottling"in a&&(b.retryThrottling=m(a.retryThrottling));let c=[];for(let a of b.methodConfig)for(let b of a.name){for(let a of c)if(b.service===a.service&&b.method===a.method)throw Error(`Invalid service config: duplicate name ${b.service}/${b.method}`);c.push(b)}return b}function o(a){if(!("serviceConfig"in a))throw Error("Invalid service config choice: missing service config");let b={serviceConfig:n(a.serviceConfig)};if("clientLanguage"in a)if(Array.isArray(a.clientLanguage))for(let c of(b.clientLanguage=[],a.clientLanguage))if("string"==typeof c)b.clientLanguage.push(c);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in a)if(Array.isArray(a.clientHostname))for(let c of(b.clientHostname=[],a.clientHostname))if("string"==typeof c)b.clientHostname.push(c);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in a)if("number"==typeof a.percentage&&0<=a.percentage&&a.percentage<=100)b.percentage=a.percentage;else throw Error("Invalid service config choice: invalid percentage");let c=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let b in a)if(!c.includes(b))throw Error(`Invalid service config choice: unexpected field ${b}`);return b}function p(a,b){if(!Array.isArray(a))throw Error("Invalid service config list");for(let c of a){let a=o(c);if("number"!=typeof a.percentage||!(b>a.percentage)){if(Array.isArray(a.clientHostname)){let b=!1;for(let c of a.clientHostname)c===d.hostname()&&(b=!0);if(!b)continue}if(Array.isArray(a.clientLanguage)){let b=!1;for(let c of a.clientLanguage)c===h&&(b=!0);if(!b)continue}return a.serviceConfig}}throw Error("No matching service config found")}c.validateRetryThrottling=m,c.validateServiceConfig=n,c.extractAndSelectServiceConfig=function(a,b){for(let c of a)if(c.length>0&&c[0].startsWith("grpc_config="))return p(JSON.parse(c.join("").substring(12)),b);return null}},33706,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.ConnectivityState=void 0,function(a){a[a.IDLE=0]="IDLE",a[a.CONNECTING=1]="CONNECTING",a[a.READY=2]="READY",a[a.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",a[a.SHUTDOWN=4]="SHUTDOWN"}(d||(c.ConnectivityState=d={}))},1617,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.uriToString=c.splitHostPort=c.parseUri=void 0;let d=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;c.parseUri=function(a){let b=d.exec(a);return null===b?null:{scheme:b[1],authority:b[2],path:b[3]}};let e=/^\d+$/;c.splitHostPort=function(a){if(a.startsWith("[")){let b=a.indexOf("]");if(-1===b)return null;let c=a.substring(1,b);if(-1===c.indexOf(":"))return null;if(!(a.length>b+1))return{host:c};if(":"!==a[b+1])return null;{let d=a.substring(b+2);return e.test(d)?{host:c,port:+d}:null}}{let b=a.split(":");return 2!==b.length?{host:a}:e.test(b[1])?{host:b[0],port:+b[1]}:null}},c.uriToString=function(a){let b="";return void 0!==a.scheme&&(b+=a.scheme+":"),void 0!==a.authority&&(b+="//"+a.authority+"/"),b+=a.path}},40142,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.mapUriDefaultScheme=c.getDefaultAuthority=c.createResolver=c.registerDefaultScheme=c.registerResolver=void 0;let d=a.r(1617),e={},f=null;c.registerResolver=function(a,b){e[a]=b},c.registerDefaultScheme=function(a){f=a},c.createResolver=function(a,b,c){if(void 0!==a.scheme&&a.scheme in e)return new e[a.scheme](a,b,c);throw Error(`No resolver could be created for target ${(0,d.uriToString)(a)}`)},c.getDefaultAuthority=function(a){if(void 0!==a.scheme&&a.scheme in e)return e[a.scheme].getDefaultAuthority(a);throw Error(`Invalid target ${(0,d.uriToString)(a)}`)},c.mapUriDefaultScheme=function(a){if(void 0===a.scheme||!(a.scheme in e))if(null!==f)return{scheme:f,authority:void 0,path:(0,d.uriToString)(a)};else return null;return a}},50324,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.QueuePicker=c.UnavailablePicker=c.PickResultType=void 0;let e=a.r(14694),f=a.r(78996);!function(a){a[a.COMPLETE=0]="COMPLETE",a[a.QUEUE=1]="QUEUE",a[a.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",a[a.DROP=3]="DROP"}(d||(c.PickResultType=d={}));class g{constructor(a){this.status=Object.assign({code:f.Status.UNAVAILABLE,details:"No connection established",metadata:new e.Metadata},a)}pick(a){return{pickResultType:d.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}c.UnavailablePicker=g;class h{constructor(a){this.loadBalancer=a,this.calledExitIdle=!1}pick(a){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:d.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}c.QueuePicker=h},51982,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BackoffTimeout=void 0;let d=1e3,e=1.6,f=12e4,g=.2;function h(a,b){return Math.random()*(b-a)+a}class i{constructor(a,b){this.callback=a,this.initialDelay=d,this.multiplier=e,this.maxDelay=f,this.jitter=g,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,b&&(b.initialDelay&&(this.initialDelay=b.initialDelay),b.multiplier&&(this.multiplier=b.multiplier),b.jitter&&(this.jitter=b.jitter),b.maxDelay&&(this.maxDelay=b.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(a){var b,c;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},a),this.hasRef||null==(c=(b=this.timerId).unref)||c.call(b)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let a=Math.min(this.nextDelay*this.multiplier,this.maxDelay),b=a*this.jitter;this.nextDelay=a+h(-b,b)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let a=new Date,b=this.startTime;b.setMilliseconds(b.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),a<b?this.runTimer(b.getTime()-a.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var a,b;this.hasRef=!0,null==(b=(a=this.timerId).ref)||b.call(a)}unref(){var a,b;this.hasRef=!1,null==(b=(a=this.timerId).unref)||b.call(a)}getEndTime(){return this.endTime}}c.BackoffTimeout=i},39355,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChildLoadBalancerHandler=void 0;let d=a.r(75424),e=a.r(33706),f="child_load_balancer_helper";class g{constructor(a){this.channelControlHelper=a,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(a){this.parent=a,this.child=null}createSubchannel(a,b){return this.parent.channelControlHelper.createSubchannel(a,b)}updateState(a,b){var c;if(this.calledByPendingChild()){if(a===e.ConnectivityState.CONNECTING)return;null==(c=this.parent.currentChild)||c.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(a,b)}requestReresolution(){var a;let b=null!=(a=this.parent.pendingChild)?a:this.parent.currentChild;this.child===b&&this.parent.channelControlHelper.requestReresolution()}setChild(a){this.child=a}addChannelzChild(a){this.parent.channelControlHelper.addChannelzChild(a)}removeChannelzChild(a){this.parent.channelControlHelper.removeChannelzChild(a)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(a,b){return a.getLoadBalancerName()!==b.getLoadBalancerName()}updateAddressList(a,b,c){let e;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,b)){let a=new this.ChildPolicyHelper(this),c=(0,d.createLoadBalancer)(b,a);a.setChild(c),null===this.currentChild?(this.currentChild=c,e=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=c,e=this.pendingChild)}else e=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=b,e.updateAddressList(a,b,c)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return f}}c.ChildLoadBalancerHandler=g},85697,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ResolvingLoadBalancer=void 0;let d=a.r(75424),e=a.r(24432),f=a.r(33706),g=a.r(40142),h=a.r(50324),i=a.r(51982),j=a.r(78996),k=a.r(14694),l=a.r(70799),m=a.r(78996),n=a.r(1617),o=a.r(39355),p="resolving_load_balancer";function q(a){l.trace(m.LogVerbosity.DEBUG,p,a)}let r=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function s(a,b,c,d){for(let e of c.name)switch(d){case"EMPTY":if(!e.service&&!e.method)return!0;break;case"SERVICE":if(e.service===a&&!e.method)return!0;break;case"SERVICE_AND_METHOD":if(e.service===a&&e.method===b)return!0}return!1}function t(a,b,c,d){for(let e of c)if(s(a,b,e,d))return e;return null}function u(a){return function(b,c){var d,e;let f=b.split("/").filter(a=>a.length>0),g=null!=(d=f[0])?d:"",h=null!=(e=f[1])?e:"";if(a&&a.methodConfig)for(let b of r){let c=t(g,h,a.methodConfig,b);if(c)return{methodConfig:c,pickInformation:{},status:j.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:j.Status.OK,dynamicFilterFactories:[]}}}class v{constructor(a,b,c,l,m){this.target=a,this.channelControlHelper=b,this.onSuccessfulResolution=l,this.onFailedResolution=m,this.latestChildState=f.ConnectivityState.IDLE,this.latestChildPicker=new h.QueuePicker(this),this.currentState=f.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,c["grpc.service_config"]?this.defaultServiceConfig=(0,e.validateServiceConfig)(JSON.parse(c["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(f.ConnectivityState.IDLE,new h.QueuePicker(this)),this.childLoadBalancer=new o.ChildLoadBalancerHandler({createSubchannel:b.createSubchannel.bind(b),requestReresolution:()=>{this.backoffTimeout.isRunning()?(q("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,b)=>{this.latestChildState=a,this.latestChildPicker=b,this.updateState(a,b)},addChannelzChild:b.addChannelzChild.bind(b),removeChannelzChild:b.removeChannelzChild.bind(b)}),this.innerResolver=(0,g.createResolver)(a,{onSuccessfulResolution:(a,b,c,e,f)=>{var g;this.backoffTimeout.stop(),this.backoffTimeout.reset();let h=null;null===b?null===c?(this.previousServiceConfig=null,h=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(c):h=this.previousServiceConfig:(h=b,this.previousServiceConfig=b);let i=null!=(g=null==h?void 0:h.loadBalancingConfig)?g:[],l=(0,d.getFirstUsableConfig)(i,!0);if(null===l)return void this.handleResolutionFailure({code:j.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new k.Metadata});this.childLoadBalancer.updateAddressList(a,l,f);let m=null!=h?h:this.defaultServiceConfig;this.onSuccessfulResolution(m,null!=e?e:u(m))},onError:a=>{this.handleResolutionFailure(a)}},c);const n={initialDelay:c["grpc.initial_reconnect_backoff_ms"],maxDelay:c["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},n),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===f.ConnectivityState.IDLE&&this.updateState(f.ConnectivityState.CONNECTING,new h.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(a,b){q((0,n.uriToString)(this.target)+" "+f.ConnectivityState[this.currentState]+" -> "+f.ConnectivityState[a]),a===f.ConnectivityState.IDLE&&(b=new h.QueuePicker(this)),this.currentState=a,this.channelControlHelper.updateState(a,b)}handleResolutionFailure(a){this.latestChildState===f.ConnectivityState.IDLE&&(this.updateState(f.ConnectivityState.TRANSIENT_FAILURE,new h.UnavailablePicker(a)),this.onFailedResolution(a))}exitIdle(){(this.currentState===f.ConnectivityState.IDLE||this.currentState===f.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(a,b){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=f.ConnectivityState.IDLE,this.latestChildPicker=new h.QueuePicker(this),this.currentState=f.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}c.ResolvingLoadBalancer=v},42547,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.channelOptionsEqual=c.recognizedOptions=void 0,c.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},c.channelOptionsEqual=function(a,b){let c=Object.keys(a).sort(),d=Object.keys(b).sort();if(c.length!==d.length)return!1;for(let e=0;e<c.length;e+=1)if(c[e]!==d[e]||a[c[e]]!==b[d[e]])return!1;return!0}},5367,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.stringToSubchannelAddress=c.subchannelAddressToString=c.subchannelAddressEqual=c.isTcpSubchannelAddress=void 0;let d=a.r(4446);function e(a){return"port"in a}c.isTcpSubchannelAddress=e,c.subchannelAddressEqual=function(a,b){return!a&&!b||!!a&&!!b&&(e(a)?e(b)&&a.host===b.host&&a.port===b.port:!e(b)&&a.path===b.path)},c.subchannelAddressToString=function(a){return e(a)?a.host+":"+a.port:a.path};let f=443;c.stringToSubchannelAddress=function(a,b){return(0,d.isIP)(a)?{host:a,port:null!=b?b:f}:{path:a}}},15410,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.addAdminServicesToServer=c.registerAdminService=void 0;let d=[];c.registerAdminService=function(a,b){d.push({getServiceDefinition:a,getHandlers:b})},c.addAdminServicesToServer=function(a){for(let{getServiceDefinition:b,getHandlers:c}of d)a.addService(b(),c())}},64356,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ClientDuplexStreamImpl=c.ClientWritableStreamImpl=c.ClientReadableStreamImpl=c.ClientUnaryCallImpl=c.callErrorFromStatus=void 0;let d=a.r(27699),e=a.r(88947),f=a.r(78996);c.callErrorFromStatus=function(a,b){let c=`${a.code} ${f.Status[a.code]}: ${a.details}`,d=Error(c),e=`${d.stack}
for call at
${b}`;return Object.assign(Error(c),a,{stack:e})};class g extends d.EventEmitter{constructor(){super()}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}}c.ClientUnaryCallImpl=g;class h extends e.Readable{constructor(a){super({objectMode:!0}),this.deserialize=a}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_read(a){var b;null==(b=this.call)||b.startRead()}}c.ClientReadableStreamImpl=h;class i extends e.Writable{constructor(a){super({objectMode:!0}),this.serialize=a}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_write(a,b,c){var d;let e={callback:c},f=Number(b);Number.isNaN(f)||(e.flags=f),null==(d=this.call)||d.sendMessageWithContext(e,a)}_final(a){var b;null==(b=this.call)||b.halfClose(),a()}}c.ClientWritableStreamImpl=i;class j extends e.Duplex{constructor(a,b){super({objectMode:!0}),this.serialize=a,this.deserialize=b}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_read(a){var b;null==(b=this.call)||b.startRead()}_write(a,b,c){var d;let e={callback:c},f=Number(b);Number.isNaN(f)||(e.flags=f),null==(d=this.call)||d.sendMessageWithContext(e,a)}_final(a){var b;null==(b=this.call)||b.halfClose(),a()}}c.ClientDuplexStreamImpl=j},74933,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InterceptingListenerImpl=c.isInterceptingListener=void 0,c.isInterceptingListener=function(a){return void 0!==a.onReceiveMetadata&&1===a.onReceiveMetadata.length};class d{constructor(a,b){this.listener=a,this.nextListener=b,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(a){this.processingMetadata=!0,this.listener.onReceiveMetadata(a,a=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(a),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(a){this.processingMessage=!0,this.listener.onReceiveMessage(a,a=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=a,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(a),this.processPendingStatus())})}onReceiveStatus(a){this.listener.onReceiveStatus(a,a=>{this.processingMetadata||this.processingMessage?this.pendingStatus=a:this.nextListener.onReceiveStatus(a)})}}c.InterceptingListenerImpl=d},23924,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getInterceptingCall=c.InterceptingCall=c.RequesterBuilder=c.ListenerBuilder=c.InterceptorConfigurationError=void 0;let d=a.r(14694),e=a.r(74933),f=a.r(78996),g=a.r(30246);class h extends Error{constructor(a){super(a),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,h)}}c.InterceptorConfigurationError=h;class i{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(a){return this.metadata=a,this}withOnReceiveMessage(a){return this.message=a,this}withOnReceiveStatus(a){return this.status=a,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}c.ListenerBuilder=i;class j{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(a){return this.start=a,this}withSendMessage(a){return this.message=a,this}withHalfClose(a){return this.halfClose=a,this}withCancel(a){return this.cancel=a,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}c.RequesterBuilder=j;let k=(a,b)=>{b(a)},l=(a,b)=>{b(a)},m=(a,b)=>{b(a)},n={start:(a,b,c)=>{c(a,b)},sendMessage:(a,b)=>{b(a)},halfClose:a=>{a()},cancel:a=>{a()}};class o{constructor(a,b){var c,d,e,f;this.nextCall=a,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,b?this.requester={start:null!=(c=b.start)?c:n.start,sendMessage:null!=(d=b.sendMessage)?d:n.sendMessage,halfClose:null!=(e=b.halfClose)?e:n.halfClose,cancel:null!=(f=b.cancel)?f:n.cancel}:this.requester=n}cancelWithStatus(a,b){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(a,b)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(a,b){var c,d,f,g,h,i;let j={onReceiveMetadata:null!=(d=null==(c=null==b?void 0:b.onReceiveMetadata)?void 0:c.bind(b))?d:a=>{},onReceiveMessage:null!=(g=null==(f=null==b?void 0:b.onReceiveMessage)?void 0:f.bind(b))?g:a=>{},onReceiveStatus:null!=(i=null==(h=null==b?void 0:b.onReceiveStatus)?void 0:h.bind(b))?i:a=>{}};this.processingMetadata=!0,this.requester.start(a,j,(a,b)=>{var c,d,f;let g;if(this.processingMetadata=!1,(0,e.isInterceptingListener)(b))g=b;else{let a={onReceiveMetadata:null!=(c=b.onReceiveMetadata)?c:k,onReceiveMessage:null!=(d=b.onReceiveMessage)?d:l,onReceiveStatus:null!=(f=b.onReceiveStatus)?f:m};g=new e.InterceptingListenerImpl(a,j)}this.nextCall.start(a,g),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(a,b){this.processingMessage=!0,this.requester.sendMessage(b,c=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=a,this.pendingMessage=b):(this.nextCall.sendMessageWithContext(a,c),this.processPendingHalfClose())})}sendMessage(a){this.sendMessageWithContext({},a)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function p(a,b,c){var d,e;let f=null!=(d=c.deadline)?d:1/0,g=c.host,h=null!=(e=c.parent)?e:null,i=c.propagate_flags,j=c.credentials,k=a.createCall(b,f,g,h,i);return j&&k.setCredentials(j),k}c.InterceptingCall=o;class q{constructor(a,b){this.call=a,this.methodDefinition=b}cancelWithStatus(a,b){this.call.cancelWithStatus(a,b)}getPeer(){return this.call.getPeer()}sendMessageWithContext(a,b){let c;try{c=this.methodDefinition.requestSerialize(b)}catch(a){this.call.cancelWithStatus(f.Status.INTERNAL,`Request message serialization failure: ${(0,g.getErrorMessage)(a)}`);return}this.call.sendMessageWithContext(a,c)}sendMessage(a){this.sendMessageWithContext({},a)}start(a,b){let c=null;this.call.start(a,{onReceiveMetadata:a=>{var c;null==(c=null==b?void 0:b.onReceiveMetadata)||c.call(b,a)},onReceiveMessage:a=>{var e;let h;try{h=this.methodDefinition.responseDeserialize(a)}catch(a){c={code:f.Status.INTERNAL,details:`Response message parsing error: ${(0,g.getErrorMessage)(a)}`,metadata:new d.Metadata},this.call.cancelWithStatus(c.code,c.details);return}null==(e=null==b?void 0:b.onReceiveMessage)||e.call(b,h)},onReceiveStatus:a=>{var d,e;c?null==(d=null==b?void 0:b.onReceiveStatus)||d.call(b,c):null==(e=null==b?void 0:b.onReceiveStatus)||e.call(b,a)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class r extends q{constructor(a,b){super(a,b)}start(a,b){var c,d;let e=!1,f={onReceiveMetadata:null!=(d=null==(c=null==b?void 0:b.onReceiveMetadata)?void 0:c.bind(b))?d:a=>{},onReceiveMessage:a=>{var c;e=!0,null==(c=null==b?void 0:b.onReceiveMessage)||c.call(b,a)},onReceiveStatus:a=>{var c,d;e||null==(c=null==b?void 0:b.onReceiveMessage)||c.call(b,null),null==(d=null==b?void 0:b.onReceiveStatus)||d.call(b,a)}};super.start(a,f),this.call.startRead()}}class s extends q{}function t(a,b,c){let d=p(a,c.path,b);return c.responseStream?new s(d,c):new r(d,c)}c.getInterceptingCall=function(a,b,c,d){if(a.clientInterceptors.length>0&&a.clientInterceptorProviders.length>0)throw new h("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(a.callInterceptors.length>0&&a.callInterceptorProviders.length>0)throw new h("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let e=[];e=a.callInterceptors.length>0||a.callInterceptorProviders.length>0?[].concat(a.callInterceptors,a.callInterceptorProviders.map(a=>a(b))).filter(a=>a):[].concat(a.clientInterceptors,a.clientInterceptorProviders.map(a=>a(b))).filter(a=>a);let f=Object.assign({},c,{method_definition:b});return e.reduceRight((a,b)=>c=>b(c,a),a=>t(d,a,b))(f)}},40830,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Client=void 0;let d=a.r(64356),e=a.r(18400),f=a.r(33706),g=a.r(78996),h=a.r(14694),i=a.r(23924),j=Symbol(),k=Symbol(),l=Symbol(),m=Symbol();function n(a){return"function"==typeof a}function o(a){return a.stack.split("\n").slice(1).join("\n")}class p{constructor(a,b,c={}){var d,f;if(c=Object.assign({},c),this[k]=null!=(d=c.interceptors)?d:[],delete c.interceptors,this[l]=null!=(f=c.interceptor_providers)?f:[],delete c.interceptor_providers,this[k].length>0&&this[l].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[m]=c.callInvocationTransformer,delete c.callInvocationTransformer,c.channelOverride)this[j]=c.channelOverride;else if(c.channelFactoryOverride){const d=c.channelFactoryOverride;delete c.channelFactoryOverride,this[j]=d(a,b,c)}else this[j]=new e.ChannelImplementation(a,b,c)}close(){this[j].close()}getChannel(){return this[j]}waitForReady(a,b){let c=d=>{let e;if(d)return void b(Error("Failed to connect before the deadline"));try{e=this[j].getConnectivityState(!0)}catch(a){b(Error("The channel has been closed"));return}if(e===f.ConnectivityState.READY)b();else try{this[j].watchConnectivityState(e,a,c)}catch(a){b(Error("The channel has been closed"))}};setImmediate(c)}checkOptionalUnaryResponseArguments(a,b,c){if(n(a))return{metadata:new h.Metadata,options:{},callback:a};if(n(b))if(a instanceof h.Metadata)return{metadata:a,options:{},callback:b};else return{metadata:new h.Metadata,options:a,callback:b};if(!(a instanceof h.Metadata&&b instanceof Object&&n(c)))throw Error("Incorrect arguments passed");return{metadata:a,options:b,callback:c}}makeUnaryRequest(a,b,c,e,f,h,n){var p,q;let r=this.checkOptionalUnaryResponseArguments(f,h,n),s={path:a,requestStream:!1,responseStream:!1,requestSerialize:b,responseDeserialize:c},t={argument:e,metadata:r.metadata,call:new d.ClientUnaryCallImpl,channel:this[j],methodDefinition:s,callOptions:r.options,callback:r.callback};this[m]&&(t=this[m](t));let u=t.call,v={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(p=t.callOptions.interceptors)?p:[],callInterceptorProviders:null!=(q=t.callOptions.interceptor_providers)?q:[]},w=(0,i.getInterceptingCall)(v,t.methodDefinition,t.callOptions,t.channel);u.call=w;let x=null,y=!1,z=Error();return w.start(t.metadata,{onReceiveMetadata:a=>{u.emit("metadata",a)},onReceiveMessage(a){null!==x&&w.cancelWithStatus(g.Status.INTERNAL,"Too many responses received"),x=a},onReceiveStatus(a){if(!y){if(y=!0,a.code===g.Status.OK)if(null===x){let b=o(z);t.callback((0,d.callErrorFromStatus)({code:g.Status.INTERNAL,details:"No message received",metadata:a.metadata},b))}else t.callback(null,x);else{let b=o(z);t.callback((0,d.callErrorFromStatus)(a,b))}z=null,u.emit("status",a)}}}),w.sendMessage(e),w.halfClose(),u}makeClientStreamRequest(a,b,c,e,f,h){var n,p;let q=this.checkOptionalUnaryResponseArguments(e,f,h),r={path:a,requestStream:!0,responseStream:!1,requestSerialize:b,responseDeserialize:c},s={metadata:q.metadata,call:new d.ClientWritableStreamImpl(b),channel:this[j],methodDefinition:r,callOptions:q.options,callback:q.callback};this[m]&&(s=this[m](s));let t=s.call,u={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(n=s.callOptions.interceptors)?n:[],callInterceptorProviders:null!=(p=s.callOptions.interceptor_providers)?p:[]},v=(0,i.getInterceptingCall)(u,s.methodDefinition,s.callOptions,s.channel);t.call=v;let w=null,x=!1,y=Error();return v.start(s.metadata,{onReceiveMetadata:a=>{t.emit("metadata",a)},onReceiveMessage(a){null!==w&&v.cancelWithStatus(g.Status.INTERNAL,"Too many responses received"),w=a},onReceiveStatus(a){if(!x){if(x=!0,a.code===g.Status.OK)if(null===w){let b=o(y);s.callback((0,d.callErrorFromStatus)({code:g.Status.INTERNAL,details:"No message received",metadata:a.metadata},b))}else s.callback(null,w);else{let b=o(y);s.callback((0,d.callErrorFromStatus)(a,b))}y=null,t.emit("status",a)}}}),t}checkMetadataAndOptions(a,b){let c,d;return a instanceof h.Metadata?(c=a,d=b||{}):(d=a||{},c=new h.Metadata),{metadata:c,options:d}}makeServerStreamRequest(a,b,c,e,f,h){var n,p;let q=this.checkMetadataAndOptions(f,h),r={path:a,requestStream:!1,responseStream:!0,requestSerialize:b,responseDeserialize:c},s={argument:e,metadata:q.metadata,call:new d.ClientReadableStreamImpl(c),channel:this[j],methodDefinition:r,callOptions:q.options};this[m]&&(s=this[m](s));let t=s.call,u={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(n=s.callOptions.interceptors)?n:[],callInterceptorProviders:null!=(p=s.callOptions.interceptor_providers)?p:[]},v=(0,i.getInterceptingCall)(u,s.methodDefinition,s.callOptions,s.channel);t.call=v;let w=!1,x=Error();return v.start(s.metadata,{onReceiveMetadata(a){t.emit("metadata",a)},onReceiveMessage(a){t.push(a)},onReceiveStatus(a){if(!w){if(w=!0,t.push(null),a.code!==g.Status.OK){let b=o(x);t.emit("error",(0,d.callErrorFromStatus)(a,b))}x=null,t.emit("status",a)}}}),v.sendMessage(e),v.halfClose(),t}makeBidiStreamRequest(a,b,c,e,f){var h,n;let p=this.checkMetadataAndOptions(e,f),q={path:a,requestStream:!0,responseStream:!0,requestSerialize:b,responseDeserialize:c},r={metadata:p.metadata,call:new d.ClientDuplexStreamImpl(b,c),channel:this[j],methodDefinition:q,callOptions:p.options};this[m]&&(r=this[m](r));let s=r.call,t={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(h=r.callOptions.interceptors)?h:[],callInterceptorProviders:null!=(n=r.callOptions.interceptor_providers)?n:[]},u=(0,i.getInterceptingCall)(t,r.methodDefinition,r.callOptions,r.channel);s.call=u;let v=!1,w=Error();return u.start(r.metadata,{onReceiveMetadata(a){s.emit("metadata",a)},onReceiveMessage(a){s.push(a)},onReceiveStatus(a){if(!v){if(v=!0,s.push(null),a.code!==g.Status.OK){let b=o(w);s.emit("error",(0,d.callErrorFromStatus)(a,b))}w=null,s.emit("status",a)}}}),s}}c.Client=p},48988,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.loadPackageDefinition=c.makeClientConstructor=void 0;let d=a.r(40830),e={unary:d.Client.prototype.makeUnaryRequest,server_stream:d.Client.prototype.makeServerStreamRequest,client_stream:d.Client.prototype.makeClientStreamRequest,bidi:d.Client.prototype.makeBidiStreamRequest};function f(a){return["__proto__","prototype","constructor"].includes(a)}function g(a,b,c){c||(c={});class g extends d.Client{}return Object.keys(a).forEach(b=>{let c;if(f(b))return;let d=a[b];if("string"==typeof b&&"$"===b.charAt(0))throw Error("Method names cannot start with $");c=d.requestStream?d.responseStream?"bidi":"client_stream":d.responseStream?"server_stream":"unary";let i=d.requestSerialize,j=d.responseDeserialize,k=h(e[c],d.path,i,j);g.prototype[b]=k,Object.assign(g.prototype[b],d),d.originalName&&!f(d.originalName)&&(g.prototype[d.originalName]=g.prototype[b])}),g.service=a,g.serviceName=b,g}function h(a,b,c,d){return function(...e){return a.call(this,b,c,d,...e)}}function i(a){return"format"in a}c.makeClientConstructor=g,c.loadPackageDefinition=function(a){let b={};for(let c in a)if(Object.prototype.hasOwnProperty.call(a,c)){let d=a[c],e=c.split(".");if(e.some(a=>f(a)))continue;let h=e[e.length-1],j=b;for(let a of e.slice(0,-1))j[a]||(j[a]={}),j=j[a];i(d)?j[h]=d:j[h]=g(d,h,{})}return b}},80801,(a,b,c)=>{var d=1/0,e="[object Symbol]",f=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,g=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,h="\\ud800-\\udfff",i="\\u0300-\\u036f\\ufe20-\\ufe23",j="\\u20d0-\\u20f0",k="\\u2700-\\u27bf",l="a-z\\xdf-\\xf6\\xf8-\\xff",m="A-Z\\xc0-\\xd6\\xd8-\\xde",n="\\ufe0e\\ufe0f",o="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",p="[']",q="["+h+"]",r="["+o+"]",s="["+i+j+"]",t="\\d+",u="["+k+"]",v="["+l+"]",w="[^"+h+o+t+k+l+m+"]",x="\\ud83c[\\udffb-\\udfff]",y="[^"+h+"]",z="(?:\\ud83c[\\udde6-\\uddff]){2}",A="[\\ud800-\\udbff][\\udc00-\\udfff]",B="["+m+"]",C="\\u200d",D="(?:"+v+"|"+w+")",E="(?:"+B+"|"+w+")",F="(?:"+p+"(?:d|ll|m|re|s|t|ve))?",G="(?:"+p+"(?:D|LL|M|RE|S|T|VE))?",H="(?:"+s+"|"+x+")?",I="["+n+"]?",J="(?:"+C+"(?:"+[y,z,A].join("|")+")"+I+H+")*",K=I+H+J,L="(?:"+[u,z,A].join("|")+")"+K,M="(?:"+[y+s+"?",s,z,A,q].join("|")+")",N=RegExp(p,"g"),O=RegExp(s,"g"),P=RegExp(x+"(?="+x+")|"+M+K,"g"),Q=RegExp([B+"?"+v+"+"+F+"(?="+[r,B,"$"].join("|")+")",E+"+"+G+"(?="+[r,B+D,"$"].join("|")+")",B+"?"+D+"+"+F,B+"+"+G,t,L].join("|"),"g"),R=RegExp("["+C+h+i+j+n+"]"),S=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,T={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"ss"},U=a.g&&a.g.Object===Object&&a.g,V="object"==typeof self&&self&&self.Object===Object&&self,W=U||V||Function("return this")();function X(a,b,c,d){var e=-1,f=a?a.length:0;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function Y(a){return a.split("")}function Z(a){return a.match(f)||[]}var $=function(a){return function(b){return null==a?void 0:a[b]}}(T);function _(a){return R.test(a)}function aa(a){return S.test(a)}function ab(a){return _(a)?ac(a):Y(a)}function ac(a){return a.match(P)||[]}function ad(a){return a.match(Q)||[]}var ae=Object.prototype.toString,af=W.Symbol,ag=af?af.prototype:void 0,ah=ag?ag.toString:void 0;function ai(a,b,c){var d=-1,e=a.length;b<0&&(b=-b>e?0:e+b),(c=c>e?e:c)<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}function aj(a){if("string"==typeof a)return a;if(an(a))return ah?ah.call(a):"";var b=a+"";return"0"==b&&1/a==-d?"-0":b}function ak(a,b,c){var d=a.length;return c=void 0===c?d:c,!b&&c>=d?a:ai(a,b,c)}function al(a){return function(b){var c=_(b=ao(b))?ab(b):void 0,d=c?c[0]:b.charAt(0),e=c?ak(c,1).join(""):b.slice(1);return d[a]()+e}}function am(a){return!!a&&"object"==typeof a}function an(a){return"symbol"==typeof a||am(a)&&ae.call(a)==e}function ao(a){return null==a?"":aj(a)}var ap=function(a){return function(b){return X(at(ar(b).replace(N,"")),a,"")}}(function(a,b,c){return b=b.toLowerCase(),a+(c?aq(b):b)});function aq(a){return as(ao(a).toLowerCase())}function ar(a){return(a=ao(a))&&a.replace(g,$).replace(O,"")}var as=al("toUpperCase");function at(a,b,c){return(a=ao(a),void 0===(b=c?void 0:b))?aa(a)?ad(a):Z(a):a.match(b)||[]}b.exports=ap},15246,(a,b,c)=>{"use strict";b.exports=function a(a,b){for(var c=Array(arguments.length-1),d=0,e=2,f=!0;e<arguments.length;)c[d++]=arguments[e++];return new Promise(function(e,g){c[d]=function(a){if(f)if(f=!1,a)g(a);else{for(var b=Array(arguments.length-1),c=0;c<b.length;)b[c++]=arguments[c];e.apply(null,b)}};try{a.apply(b||null,c)}catch(a){f&&(f=!1,g(a))}})}},33702,(a,b,c)=>{"use strict";var d=c;d.length=function(a){var b=a.length;if(!b)return 0;for(var c=0;--b%4>1&&"="===a.charAt(b);)++c;return Math.ceil(3*a.length)/4-c};for(var e=Array(64),f=Array(123),g=0;g<64;)f[e[g]=g<26?g+65:g<52?g+71:g<62?g-4:g-59|43]=g++;d.encode=function(a,b,c){for(var d,f=null,g=[],h=0,i=0;b<c;){var j=a[b++];switch(i){case 0:g[h++]=e[j>>2],d=(3&j)<<4,i=1;break;case 1:g[h++]=e[d|j>>4],d=(15&j)<<2,i=2;break;case 2:g[h++]=e[d|j>>6],g[h++]=e[63&j],i=0}h>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,g)),h=0)}return(i&&(g[h++]=e[d],g[h++]=61,1===i&&(g[h++]=61)),f)?(h&&f.push(String.fromCharCode.apply(String,g.slice(0,h))),f.join("")):String.fromCharCode.apply(String,g.slice(0,h))};var h="invalid encoding";d.decode=function(a,b,c){for(var d,e=c,g=0,i=0;i<a.length;){var j=a.charCodeAt(i++);if(61===j&&g>1)break;if(void 0===(j=f[j]))throw Error(h);switch(g){case 0:d=j,g=1;break;case 1:b[c++]=d<<2|(48&j)>>4,d=j,g=2;break;case 2:b[c++]=(15&d)<<4|(60&j)>>2,d=j,g=3;break;case 3:b[c++]=(3&d)<<6|j,g=0}}if(1===g)throw Error(h);return c-e},d.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)}},13306,(a,b,c)=>{"use strict";function d(){this._listeners={}}b.exports=d,d.prototype.on=function(a,b,c){return(this._listeners[a]||(this._listeners[a]=[])).push({fn:b,ctx:c||this}),this},d.prototype.off=function(a,b){if(void 0===a)this._listeners={};else if(void 0===b)this._listeners[a]=[];else for(var c=this._listeners[a],d=0;d<c.length;)c[d].fn===b?c.splice(d,1):++d;return this},d.prototype.emit=function(a){var b=this._listeners[a];if(b){for(var c=[],d=1;d<arguments.length;)c.push(arguments[d++]);for(d=0;d<b.length;)b[d].fn.apply(b[d++].ctx,c)}return this}},43033,(a,b,c)=>{"use strict";function d(a){return"u">typeof Float32Array?!function(){var b=new Float32Array([-0]),c=new Uint8Array(b.buffer),d=128===c[3];function e(a,d,e){b[0]=a,d[e]=c[0],d[e+1]=c[1],d[e+2]=c[2],d[e+3]=c[3]}function f(a,d,e){b[0]=a,d[e]=c[3],d[e+1]=c[2],d[e+2]=c[1],d[e+3]=c[0]}function g(a,d){return c[0]=a[d],c[1]=a[d+1],c[2]=a[d+2],c[3]=a[d+3],b[0]}function h(a,d){return c[3]=a[d],c[2]=a[d+1],c[1]=a[d+2],c[0]=a[d+3],b[0]}a.writeFloatLE=d?e:f,a.writeFloatBE=d?f:e,a.readFloatLE=d?g:h,a.readFloatBE=d?h:g}():!function(){function b(a,b,c,d){var e=+(b<0);if(e&&(b=-b),0===b)a(1/b>0?0:0x80000000,c,d);else if(isNaN(b))a(0x7fc00000,c,d);else if(b>34028234663852886e22)a((e<<31|0x7f800000)>>>0,c,d);else if(b<11754943508222875e-54)a((e<<31|Math.round(b/1401298464324817e-60))>>>0,c,d);else{var f=Math.floor(Math.log(b)/Math.LN2),g=8388607&Math.round(b*Math.pow(2,-f)*8388608);a((e<<31|f+127<<23|g)>>>0,c,d)}}function c(a,b,c){var d=a(b,c),e=(d>>31)*2+1,f=d>>>23&255,g=8388607&d;return 255===f?g?NaN:1/0*e:0===f?1401298464324817e-60*e*g:e*Math.pow(2,f-150)*(g+8388608)}a.writeFloatLE=b.bind(null,e),a.writeFloatBE=b.bind(null,f),a.readFloatLE=c.bind(null,g),a.readFloatBE=c.bind(null,h)}(),"u">typeof Float64Array?!function(){var b=new Float64Array([-0]),c=new Uint8Array(b.buffer),d=128===c[7];function e(a,d,e){b[0]=a,d[e]=c[0],d[e+1]=c[1],d[e+2]=c[2],d[e+3]=c[3],d[e+4]=c[4],d[e+5]=c[5],d[e+6]=c[6],d[e+7]=c[7]}function f(a,d,e){b[0]=a,d[e]=c[7],d[e+1]=c[6],d[e+2]=c[5],d[e+3]=c[4],d[e+4]=c[3],d[e+5]=c[2],d[e+6]=c[1],d[e+7]=c[0]}function g(a,d){return c[0]=a[d],c[1]=a[d+1],c[2]=a[d+2],c[3]=a[d+3],c[4]=a[d+4],c[5]=a[d+5],c[6]=a[d+6],c[7]=a[d+7],b[0]}function h(a,d){return c[7]=a[d],c[6]=a[d+1],c[5]=a[d+2],c[4]=a[d+3],c[3]=a[d+4],c[2]=a[d+5],c[1]=a[d+6],c[0]=a[d+7],b[0]}a.writeDoubleLE=d?e:f,a.writeDoubleBE=d?f:e,a.readDoubleLE=d?g:h,a.readDoubleBE=d?h:g}():!function(){function b(a,b,c,d,e,f){var g,h=+(d<0);if(h&&(d=-d),0===d)a(0,e,f+b),a(1/d>0?0:0x80000000,e,f+c);else if(isNaN(d))a(0,e,f+b),a(0x7ff80000,e,f+c);else if(d>17976931348623157e292)a(0,e,f+b),a((h<<31|0x7ff00000)>>>0,e,f+c);else if(d<22250738585072014e-324)a((g=d/5e-324)>>>0,e,f+b),a((h<<31|g/0x100000000)>>>0,e,f+c);else{var i=Math.floor(Math.log(d)/Math.LN2);1024===i&&(i=1023),a(0x10000000000000*(g=d*Math.pow(2,-i))>>>0,e,f+b),a((h<<31|i+1023<<20|1048576*g&1048575)>>>0,e,f+c)}}function c(a,b,c,d,e){var f=a(d,e+b),g=a(d,e+c),h=(g>>31)*2+1,i=g>>>20&2047,j=0x100000000*(1048575&g)+f;return 2047===i?j?NaN:1/0*h:0===i?5e-324*h*j:h*Math.pow(2,i-1075)*(j+0x10000000000000)}a.writeDoubleLE=b.bind(null,e,0,4),a.writeDoubleBE=b.bind(null,f,4,0),a.readDoubleLE=c.bind(null,g,0,4),a.readDoubleBE=c.bind(null,h,4,0)}(),a}function e(a,b,c){b[c]=255&a,b[c+1]=a>>>8&255,b[c+2]=a>>>16&255,b[c+3]=a>>>24}function f(a,b,c){b[c]=a>>>24,b[c+1]=a>>>16&255,b[c+2]=a>>>8&255,b[c+3]=255&a}function g(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16|a[b+3]<<24)>>>0}function h(a,b){return(a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3])>>>0}b.exports=d(d)},91031,(__turbopack_context__,module,exports)=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},24836,(a,b,c)=>{"use strict";var d=c;d.length=function(a){for(var b=0,c=0,d=0;d<a.length;++d)(c=a.charCodeAt(d))<128?b+=1:c<2048?b+=2:(64512&c)==55296&&(64512&a.charCodeAt(d+1))==56320?(++d,b+=4):b+=3;return b},d.read=function(a,b,c){if(c-b<1)return"";for(var d,e=null,f=[],g=0;b<c;)(d=a[b++])<128?f[g++]=d:d>191&&d<224?f[g++]=(31&d)<<6|63&a[b++]:d>239&&d<365?(d=((7&d)<<18|(63&a[b++])<<12|(63&a[b++])<<6|63&a[b++])-65536,f[g++]=55296+(d>>10),f[g++]=56320+(1023&d)):f[g++]=(15&d)<<12|(63&a[b++])<<6|63&a[b++],g>8191&&((e||(e=[])).push(String.fromCharCode.apply(String,f)),g=0);return e?(g&&e.push(String.fromCharCode.apply(String,f.slice(0,g))),e.join("")):String.fromCharCode.apply(String,f.slice(0,g))},d.write=function(a,b,c){for(var d,e,f=c,g=0;g<a.length;++g)(d=a.charCodeAt(g))<128?b[c++]=d:(d<2048?b[c++]=d>>6|192:((64512&d)==55296&&(64512&(e=a.charCodeAt(g+1)))==56320?(d=65536+((1023&d)<<10)+(1023&e),++g,b[c++]=d>>18|240,b[c++]=d>>12&63|128):b[c++]=d>>12|224,b[c++]=d>>6&63|128),b[c++]=63&d|128);return c-f}},80844,(a,b,c)=>{"use strict";b.exports=function a(a,b,c){var d=c||8192,e=d>>>1,f=null,g=d;return function(c){if(c<1||c>e)return a(c);g+c>d&&(f=a(d),g=0);var h=b.call(f,g,g+=c);return 7&g&&(g=(7|g)+1),h}}},16096,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(7915);function e(a,b){this.lo=a>>>0,this.hi=b>>>0}var f=e.zero=new e(0,0);f.toNumber=function(){return 0},f.zzEncode=f.zzDecode=function(){return this},f.length=function(){return 1};var g=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(a){if(0===a)return f;var b=a<0;b&&(a=-a);var c=a>>>0,d=(a-c)/0x100000000>>>0;return b&&(d=~d>>>0,c=~c>>>0,++c>0xffffffff&&(c=0,++d>0xffffffff&&(d=0))),new e(c,d)},e.from=function(a){if("number"==typeof a)return e.fromNumber(a);if(d.isString(a))if(!d.Long)return e.fromNumber(parseInt(a,10));else a=d.Long.fromString(a);return a.low||a.high?new e(a.low>>>0,a.high>>>0):f},e.prototype.toNumber=function(a){if(!a&&this.hi>>>31){var b=~this.lo+1>>>0,c=~this.hi>>>0;return b||(c=c+1>>>0),-(b+0x100000000*c)}return this.lo+0x100000000*this.hi},e.prototype.toLong=function(a){return d.Long?new d.Long(0|this.lo,0|this.hi,!!a):{low:0|this.lo,high:0|this.hi,unsigned:!!a}};var h=String.prototype.charCodeAt;e.fromHash=function(a){return a===g?f:new e((h.call(a,0)|h.call(a,1)<<8|h.call(a,2)<<16|h.call(a,3)<<24)>>>0,(h.call(a,4)|h.call(a,5)<<8|h.call(a,6)<<16|h.call(a,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var a=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^a)>>>0,this.lo=(this.lo<<1^a)>>>0,this},e.prototype.zzDecode=function(){var a=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^a)>>>0,this.hi=(this.hi>>>1^a)>>>0,this},e.prototype.length=function(){var a=this.lo,b=(this.lo>>>28|this.hi<<4)>>>0,c=this.hi>>>24;return 0===c?0===b?a<16384?a<128?1:2:a<2097152?3:4:b<16384?b<128?5:6:b<2097152?7:8:c<128?9:10}},7915,(a,b,c)=>{"use strict";var d=c;function e(a,b,c){for(var d=Object.keys(b),e=0;e<d.length;++e)void 0!==a[d[e]]&&c||(a[d[e]]=b[d[e]]);return a}function f(a){function b(a,c){if(!(this instanceof b))return new b(a,c);Object.defineProperty(this,"message",{get:function(){return a}}),Error.captureStackTrace?Error.captureStackTrace(this,b):Object.defineProperty(this,"stack",{value:Error().stack||""}),c&&e(this,c)}return b.prototype=Object.create(Error.prototype,{constructor:{value:b,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return a},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),b}d.asPromise=a.r(15246),d.base64=a.r(33702),d.EventEmitter=a.r(13306),d.float=a.r(43033),d.inquire=a.r(91031),d.utf8=a.r(24836),d.pool=a.r(80844),d.LongBits=a.r(16096),d.isNode=!!(a.g&&a.g.process&&a.g.process.versions&&a.g.process.versions.node),d.global=d.isNode&&a.g||"u">typeof self&&self||a.e,d.emptyArray=Object.freeze?Object.freeze([]):[],d.emptyObject=Object.freeze?Object.freeze({}):{},d.isInteger=Number.isInteger||function(a){return"number"==typeof a&&isFinite(a)&&Math.floor(a)===a},d.isString=function(a){return"string"==typeof a||a instanceof String},d.isObject=function(a){return a&&"object"==typeof a},d.isset=d.isSet=function(a,b){var c=a[b];return!!(null!=c&&a.hasOwnProperty(b))&&("object"!=typeof c||(Array.isArray(c)?c.length:Object.keys(c).length)>0)},d.Buffer=function(){try{var a=d.inquire("buffer").Buffer;return a.prototype.utf8Write?a:null}catch(a){return null}}(),d._Buffer_from=null,d._Buffer_allocUnsafe=null,d.newBuffer=function(a){return"number"==typeof a?d.Buffer?d._Buffer_allocUnsafe(a):new d.Array(a):d.Buffer?d._Buffer_from(a):"u"<typeof Uint8Array?a:new Uint8Array(a)},d.Array="u">typeof Uint8Array?Uint8Array:Array,d.Long=d.global.dcodeIO&&d.global.dcodeIO.Long||d.global.Long||d.inquire("long"),d.key2Re=/^true|false|0|1$/,d.key32Re=/^-?(?:0|[1-9][0-9]*)$/,d.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,d.longToHash=function(a){return a?d.LongBits.from(a).toHash():d.LongBits.zeroHash},d.longFromHash=function(a,b){var c=d.LongBits.fromHash(a);return d.Long?d.Long.fromBits(c.lo,c.hi,b):c.toNumber(!!b)},d.merge=e,d.lcFirst=function(a){return a.charAt(0).toLowerCase()+a.substring(1)},d.newError=f,d.ProtocolError=f("ProtocolError"),d.oneOfGetter=function(a){for(var b={},c=0;c<a.length;++c)b[a[c]]=1;return function(){for(var a=Object.keys(this),c=a.length-1;c>-1;--c)if(1===b[a[c]]&&void 0!==this[a[c]]&&null!==this[a[c]])return a[c]}},d.oneOfSetter=function(a){return function(b){for(var c=0;c<a.length;++c)a[c]!==b&&delete this[a[c]]}},d.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},d._configure=function(){var a=d.Buffer;if(!a){d._Buffer_from=d._Buffer_allocUnsafe=null;return}d._Buffer_from=a.from!==Uint8Array.from&&a.from||function(b,c){return new a(b,c)},d._Buffer_allocUnsafe=a.allocUnsafe||function(b){return new a(b)}}},75701,(a,b,c)=>{"use strict";b.exports={}},7346,(a,b,c)=>{"use strict";function d(a,b){"string"==typeof a&&(b=a,a=void 0);var c=[];function e(a){if("string"!=typeof a){var b=f();if(d.verbose&&console.log("codegen: "+b),b="return "+b,a){for(var g=Object.keys(a),h=Array(g.length+1),i=Array(g.length),j=0;j<g.length;)h[j]=g[j],i[j]=a[g[j++]];return h[j]=b,Function.apply(null,h).apply(null,i)}return Function(b)()}for(var k=Array(arguments.length-1),l=0;l<k.length;)k[l]=arguments[++l];if(l=0,a=a.replace(/%([%dfijs])/g,function(a,b){var c=k[l++];switch(b){case"d":case"f":return String(Number(c));case"i":return String(Math.floor(c));case"j":return JSON.stringify(c);case"s":return String(c)}return"%"}),l!==k.length)throw Error("parameter count mismatch");return c.push(a),e}function f(d){return"function "+(d||b||"")+"("+(a&&a.join(",")||"")+"){\n  "+c.join("\n  ")+"\n}"}return e.toString=f,e}b.exports=d,d.verbose=!1},24834,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(15246),e=a.r(91031)("fs");function f(a,b,c){return("function"==typeof b?(c=b,b={}):b||(b={}),c)?!b.xhr&&e&&e.readFile?e.readFile(a,function(d,e){return d&&"u">typeof XMLHttpRequest?f.xhr(a,b,c):d?c(d):c(null,b.binary?e:e.toString("utf8"))}):f.xhr(a,b,c):d(f,this,a,b)}f.xhr=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState){if(0!==d.status&&200!==d.status)return c(Error("status "+d.status));if(b.binary){var a=d.response;if(!a){a=[];for(var e=0;e<d.responseText.length;++e)a.push(255&d.responseText.charCodeAt(e))}return c(null,"u">typeof Uint8Array?new Uint8Array(a):a)}return c(null,d.responseText)}},b.binary&&("overrideMimeType"in d&&d.overrideMimeType("text/plain; charset=x-user-defined"),d.responseType="arraybuffer"),d.open("GET",a),d.send()}},97139,(a,b,c)=>{"use strict";var d=c,e=d.isAbsolute=function(a){return/^(?:\/|\w+:)/.test(a)},f=d.normalize=function(a){var b=(a=a.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),c=e(a),d="";c&&(d=b.shift()+"/");for(var f=0;f<b.length;)".."===b[f]?f>0&&".."!==b[f-1]?b.splice(--f,2):c?b.splice(f,1):++f:"."===b[f]?b.splice(f,1):++f;return d+b.join("/")};d.resolve=function(a,b,c){return(c||(b=f(b)),e(b))?b:(c||(a=f(a)),(a=a.replace(/(?:\/|^)[^/]+$/,"")).length?f(a+"/"+b):b)}},14660,(a,b,c)=>{"use strict";b.exports=l;var d,e,f,g=a.r(90133);((l.prototype=Object.create(g.prototype)).constructor=l).className="Namespace";var h=a.r(51475),i=a.r(92022),j=a.r(22758);function k(a,b){if(a&&a.length){for(var c={},d=0;d<a.length;++d)c[a[d].name]=a[d].toJSON(b);return c}}function l(a,b){g.call(this,a,b),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function m(a){a._nestedArray=null,a._lookupCache={};for(var b=a;b=b.parent;)b._lookupCache={};return a}l.fromJSON=function(a,b){return new l(a,b.options).addJSON(b.nested)},l.arrayToJSON=k,l.isReservedId=function(a,b){if(a){for(var c=0;c<a.length;++c)if("string"!=typeof a[c]&&a[c][0]<=b&&a[c][1]>b)return!0}return!1},l.isReservedName=function(a,b){if(a){for(var c=0;c<a.length;++c)if(a[c]===b)return!0}return!1},Object.defineProperty(l.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=i.toArray(this.nested))}}),l.prototype.toJSON=function(a){return i.toObject(["options",this.options,"nested",k(this.nestedArray,a)])},l.prototype.addJSON=function(a){var b=this;if(a)for(var c,g=Object.keys(a),i=0;i<g.length;++i)c=a[g[i]],b.add((void 0!==c.fields?d.fromJSON:void 0!==c.values?f.fromJSON:void 0!==c.methods?e.fromJSON:void 0!==c.id?h.fromJSON:l.fromJSON)(g[i],c));return this},l.prototype.get=function(a){return this.nested&&this.nested[a]||null},l.prototype.getEnum=function(a){if(this.nested&&this.nested[a]instanceof f)return this.nested[a].values;throw Error("no such enum: "+a)},l.prototype.add=function(a){if(!(a instanceof h&&void 0!==a.extend||a instanceof d||a instanceof j||a instanceof f||a instanceof e||a instanceof l))throw TypeError("object must be a valid nested object");if(this.nested){var b=this.get(a.name);if(b)if(b instanceof l&&a instanceof l&&!(b instanceof d||b instanceof e)){for(var c=b.nestedArray,g=0;g<c.length;++g)a.add(c[g]);this.remove(b),this.nested||(this.nested={}),a.setOptions(b.options,!0)}else throw Error("duplicate name '"+a.name+"' in "+this)}else this.nested={};this.nested[a.name]=a,this instanceof d||this instanceof e||this instanceof f||this instanceof h||a._edition||(a._edition=a._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var i=this;i=i.parent;)i._needsRecursiveFeatureResolution=!0,i._needsRecursiveResolve=!0;return a.onAdd(this),m(this)},l.prototype.remove=function(a){if(!(a instanceof g))throw TypeError("object must be a ReflectionObject");if(a.parent!==this)throw Error(a+" is not a member of "+this);return delete this.nested[a.name],Object.keys(this.nested).length||(this.nested=void 0),a.onRemove(this),m(this)},l.prototype.define=function(a,b){if(i.isString(a))a=a.split(".");else if(!Array.isArray(a))throw TypeError("illegal path");if(a&&a.length&&""===a[0])throw Error("path must be relative");for(var c=this;a.length>0;){var d=a.shift();if(c.nested&&c.nested[d]){if(!((c=c.nested[d])instanceof l))throw Error("path conflicts with non-namespace objects")}else c.add(c=new l(d))}return b&&c.addJSON(b),c},l.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var a=this.nestedArray,b=0;for(this.resolve();b<a.length;)a[b]instanceof l?a[b++].resolveAll():a[b++].resolve();return this._needsRecursiveResolve=!1,this},l.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,a=this._edition||a,g.prototype._resolveFeaturesRecursive.call(this,a),this.nestedArray.forEach(b=>{b._resolveFeaturesRecursive(a)})),this},l.prototype.lookup=function(a,b,c){if("boolean"==typeof b?(c=b,b=void 0):b&&!Array.isArray(b)&&(b=[b]),i.isString(a)&&a.length){if("."===a)return this.root;a=a.split(".")}else if(!a.length)return this;var d=a.join(".");if(""===a[0])return this.root.lookup(a.slice(1),b);var e=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+d];if(e&&(!b||b.indexOf(e.constructor)>-1)||(e=this._lookupImpl(a,d))&&(!b||b.indexOf(e.constructor)>-1))return e;if(c)return null;for(var f=this;f.parent;){if((e=f.parent._lookupImpl(a,d))&&(!b||b.indexOf(e.constructor)>-1))return e;f=f.parent}return null},l.prototype._lookupImpl=function(a,b){if(Object.prototype.hasOwnProperty.call(this._lookupCache,b))return this._lookupCache[b];var c=this.get(a[0]),d=null;if(c)1===a.length?d=c:c instanceof l&&(a=a.slice(1),d=c._lookupImpl(a,a.join(".")));else for(var e=0;e<this.nestedArray.length;++e)this._nestedArray[e]instanceof l&&(c=this._nestedArray[e]._lookupImpl(a,b))&&(d=c);return this._lookupCache[b]=d,d},l.prototype.lookupType=function(a){var b=this.lookup(a,[d]);if(!b)throw Error("no such type: "+a);return b},l.prototype.lookupEnum=function(a){var b=this.lookup(a,[f]);if(!b)throw Error("no such Enum '"+a+"' in "+this);return b},l.prototype.lookupTypeOrEnum=function(a){var b=this.lookup(a,[d,f]);if(!b)throw Error("no such Type or Enum '"+a+"' in "+this);return b},l.prototype.lookupService=function(a){var b=this.lookup(a,[e]);if(!b)throw Error("no such Service '"+a+"' in "+this);return b},l._configure=function(a,b,c){d=a,e=b,f=c}},58767,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(51475);((g.prototype=Object.create(d.prototype)).constructor=g).className="MapField";var e=a.r(7544),f=a.r(92022);function g(a,b,c,e,g,h){if(d.call(this,a,b,e,void 0,void 0,g,h),!f.isString(c))throw TypeError("keyType must be a string");this.keyType=c,this.resolvedKeyType=null,this.map=!0}g.fromJSON=function(a,b){return new g(a,b.id,b.keyType,b.type,b.options,b.comment)},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",b?this.comment:void 0])},g.prototype.resolve=function(){if(this.resolved)return this;if(void 0===e.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return d.prototype.resolve.call(this)},g.d=function(a,b,c){return"function"==typeof c?c=f.decorateType(c).name:c&&"object"==typeof c&&(c=f.decorateEnum(c).name),function(d,e){f.decorateType(d.constructor).add(new g(e,a,b,c))}}},17553,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(90133);((f.prototype=Object.create(d.prototype)).constructor=f).className="Method";var e=a.r(92022);function f(a,b,c,f,g,h,i,j,k){if(e.isObject(g)?(i=g,g=h=void 0):e.isObject(h)&&(i=h,h=void 0),!(void 0===b||e.isString(b)))throw TypeError("type must be a string");if(!e.isString(c))throw TypeError("requestType must be a string");if(!e.isString(f))throw TypeError("responseType must be a string");d.call(this,a,i),this.type=b||"rpc",this.requestType=c,this.requestStream=!!g||void 0,this.responseType=f,this.responseStream=!!h||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=j,this.parsedOptions=k}f.fromJSON=function(a,b){return new f(a,b.type,b.requestType,b.responseType,b.requestStream,b.responseStream,b.options,b.comment,b.parsedOptions)},f.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return e.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",b?this.comment:void 0,"parsedOptions",this.parsedOptions])},f.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),d.prototype.resolve.call(this))}},3387,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(7915);function e(a,b,c){if("function"!=typeof a)throw TypeError("rpcImpl must be a function");d.EventEmitter.call(this),this.rpcImpl=a,this.requestDelimited=!!b,this.responseDelimited=!!c}(e.prototype=Object.create(d.EventEmitter.prototype)).constructor=e,e.prototype.rpcCall=function a(b,c,e,f,g){if(!f)throw TypeError("request must be specified");var h=this;if(!g)return d.asPromise(a,h,b,c,e,f);if(!h.rpcImpl)return void setTimeout(function(){g(Error("already ended"))},0);try{return h.rpcImpl(b,c[h.requestDelimited?"encodeDelimited":"encode"](f).finish(),function(a,c){if(a)return h.emit("error",a,b),g(a);if(null===c)return void h.end(!0);if(!(c instanceof e))try{c=e[h.responseDelimited?"decodeDelimited":"decode"](c)}catch(a){return h.emit("error",a,b),g(a)}return h.emit("data",c,b),g(null,c)})}catch(a){h.emit("error",a,b),setTimeout(function(){g(a)},0);return}},e.prototype.end=function(a){return this.rpcImpl&&(a||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},17435,(a,b,c)=>{"use strict";c.Service=a.r(3387)},87442,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(14660);((h.prototype=Object.create(d.prototype)).constructor=h).className="Service";var e=a.r(17553),f=a.r(92022),g=a.r(17435);function h(a,b){d.call(this,a,b),this.methods={},this._methodsArray=null}function i(a){return a._methodsArray=null,a}h.fromJSON=function(a,b){var c=new h(a,b.options);if(b.methods)for(var d=Object.keys(b.methods),f=0;f<d.length;++f)c.add(e.fromJSON(d[f],b.methods[d[f]]));return b.nested&&c.addJSON(b.nested),b.edition&&(c._edition=b.edition),c.comment=b.comment,c._defaultEdition="proto3",c},h.prototype.toJSON=function(a){var b=d.prototype.toJSON.call(this,a),c=!!a&&!!a.keepComments;return f.toObject(["edition",this._editionToJSON(),"options",b&&b.options||void 0,"methods",d.arrayToJSON(this.methodsArray,a)||{},"nested",b&&b.nested||void 0,"comment",c?this.comment:void 0])},Object.defineProperty(h.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=f.toArray(this.methods))}}),h.prototype.get=function(a){return this.methods[a]||d.prototype.get.call(this,a)},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;d.prototype.resolve.call(this);for(var a=this.methodsArray,b=0;b<a.length;++b)a[b].resolve();return this},h.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(a=this._edition||a,d.prototype._resolveFeaturesRecursive.call(this,a),this.methodsArray.forEach(b=>{b._resolveFeaturesRecursive(a)})),this},h.prototype.add=function(a){if(this.get(a.name))throw Error("duplicate name '"+a.name+"' in "+this);return a instanceof e?(this.methods[a.name]=a,a.parent=this,i(this)):d.prototype.add.call(this,a)},h.prototype.remove=function(a){if(a instanceof e){if(this.methods[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.methods[a.name],a.parent=null,i(this)}return d.prototype.remove.call(this,a)},h.prototype.create=function(a,b,c){for(var d,e=new g.Service(a,b,c),h=0;h<this.methodsArray.length;++h){var i=f.lcFirst((d=this._methodsArray[h]).resolve().name).replace(/[^$\w_]/g,"");e[i]=f.codegen(["r","c"],f.isReserved(i)?i+"_":i)("return this.rpcCall(m,q,s,r,c)")({m:d,q:d.resolvedRequestType.ctor,s:d.resolvedResponseType.ctor})}return e}},30783,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(7915);function e(a){if(a)for(var b=Object.keys(a),c=0;c<b.length;++c)this[b[c]]=a[b[c]]}e.create=function(a){return this.$type.create(a)},e.encode=function(a,b){return this.$type.encode(a,b)},e.encodeDelimited=function(a,b){return this.$type.encodeDelimited(a,b)},e.decode=function(a){return this.$type.decode(a)},e.decodeDelimited=function(a){return this.$type.decodeDelimited(a)},e.verify=function(a){return this.$type.verify(a)},e.fromObject=function(a){return this.$type.fromObject(a)},e.toObject=function(a,b){return this.$type.toObject(a,b)},e.prototype.toJSON=function(){return this.$type.toObject(this,d.toJSONOptions)}},20209,(a,b,c)=>{"use strict";b.exports=i;var d,e=a.r(7915),f=e.LongBits,g=e.utf8;function h(a,b){return RangeError("index out of range: "+a.pos+" + "+(b||1)+" > "+a.len)}function i(a){this.buf=a,this.pos=0,this.len=a.length}var j="u">typeof Uint8Array?function(a){if(a instanceof Uint8Array||Array.isArray(a))return new i(a);throw Error("illegal buffer")}:function(a){if(Array.isArray(a))return new i(a);throw Error("illegal buffer")},k=function(){return e.Buffer?function(a){return(i.create=function(a){return e.Buffer.isBuffer(a)?new d(a):j(a)})(a)}:j};function l(){var a=new f(0,0),b=0;if(this.len-this.pos>4){for(;b<4;++b)if(a.lo=(a.lo|(127&this.buf[this.pos])<<7*b)>>>0,this.buf[this.pos++]<128)return a;if(a.lo=(a.lo|(127&this.buf[this.pos])<<28)>>>0,a.hi=(a.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return a;b=0}else{for(;b<3;++b){if(this.pos>=this.len)throw h(this);if(a.lo=(a.lo|(127&this.buf[this.pos])<<7*b)>>>0,this.buf[this.pos++]<128)return a}return a.lo=(a.lo|(127&this.buf[this.pos++])<<7*b)>>>0,a}if(this.len-this.pos>4){for(;b<5;++b)if(a.hi=(a.hi|(127&this.buf[this.pos])<<7*b+3)>>>0,this.buf[this.pos++]<128)return a}else for(;b<5;++b){if(this.pos>=this.len)throw h(this);if(a.hi=(a.hi|(127&this.buf[this.pos])<<7*b+3)>>>0,this.buf[this.pos++]<128)return a}throw Error("invalid varint encoding")}function m(a,b){return(a[b-4]|a[b-3]<<8|a[b-2]<<16|a[b-1]<<24)>>>0}function n(){if(this.pos+8>this.len)throw h(this,8);return new f(m(this.buf,this.pos+=4),m(this.buf,this.pos+=4))}i.create=k(),i.prototype._slice=e.Array.prototype.subarray||e.Array.prototype.slice,i.prototype.uint32=function(){var a=0xffffffff;return function(){if(a=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(a=(a|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(a=(a|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(a=(a|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(a=(a|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return a;if((this.pos+=5)>this.len)throw this.pos=this.len,h(this,10);return a}}(),i.prototype.int32=function(){return 0|this.uint32()},i.prototype.sint32=function(){var a=this.uint32();return a>>>1^-(1&a)},i.prototype.bool=function(){return 0!==this.uint32()},i.prototype.fixed32=function(){if(this.pos+4>this.len)throw h(this,4);return m(this.buf,this.pos+=4)},i.prototype.sfixed32=function(){if(this.pos+4>this.len)throw h(this,4);return 0|m(this.buf,this.pos+=4)},i.prototype.float=function(){if(this.pos+4>this.len)throw h(this,4);var a=e.float.readFloatLE(this.buf,this.pos);return this.pos+=4,a},i.prototype.double=function(){if(this.pos+8>this.len)throw h(this,4);var a=e.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,a},i.prototype.bytes=function(){var a=this.uint32(),b=this.pos,c=this.pos+a;if(c>this.len)throw h(this,a);if(this.pos+=a,Array.isArray(this.buf))return this.buf.slice(b,c);if(b===c){var d=e.Buffer;return d?d.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,b,c)},i.prototype.string=function(){var a=this.bytes();return g.read(a,0,a.length)},i.prototype.skip=function(a){if("number"==typeof a){if(this.pos+a>this.len)throw h(this,a);this.pos+=a}else do if(this.pos>=this.len)throw h(this);while(128&this.buf[this.pos++])return this},i.prototype.skipType=function(a){switch(a){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(a=7&this.uint32());)this.skipType(a);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+a+" at offset "+this.pos)}return this},i._configure=function(a){d=a,i.create=k(),d._configure();var b=e.Long?"toLong":"toNumber";e.merge(i.prototype,{int64:function(){return l.call(this)[b](!1)},uint64:function(){return l.call(this)[b](!0)},sint64:function(){return l.call(this).zzDecode()[b](!1)},fixed64:function(){return n.call(this)[b](!0)},sfixed64:function(){return n.call(this)[b](!1)}})}},42213,(a,b,c)=>{"use strict";b.exports=l;var d,e=a.r(7915),f=e.LongBits,g=e.base64,h=e.utf8;function i(a,b,c){this.fn=a,this.len=b,this.next=void 0,this.val=c}function j(){}function k(a){this.head=a.head,this.tail=a.tail,this.len=a.len,this.next=a.states}function l(){this.len=0,this.head=new i(j,0,0),this.tail=this.head,this.states=null}var m=function(){return e.Buffer?function(){return(l.create=function(){return new d})()}:function(){return new l}};function n(a,b,c){b[c]=255&a}function o(a,b,c){for(;a>127;)b[c++]=127&a|128,a>>>=7;b[c]=a}function p(a,b){this.len=a,this.next=void 0,this.val=b}function q(a,b,c){for(;a.hi;)b[c++]=127&a.lo|128,a.lo=(a.lo>>>7|a.hi<<25)>>>0,a.hi>>>=7;for(;a.lo>127;)b[c++]=127&a.lo|128,a.lo=a.lo>>>7;b[c++]=a.lo}function r(a,b,c){b[c]=255&a,b[c+1]=a>>>8&255,b[c+2]=a>>>16&255,b[c+3]=a>>>24}l.create=m(),l.alloc=function(a){return new e.Array(a)},e.Array!==Array&&(l.alloc=e.pool(l.alloc,e.Array.prototype.subarray)),l.prototype._push=function(a,b,c){return this.tail=this.tail.next=new i(a,b,c),this.len+=b,this},p.prototype=Object.create(i.prototype),p.prototype.fn=o,l.prototype.uint32=function(a){return this.len+=(this.tail=this.tail.next=new p((a>>>=0)<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:5,a)).len,this},l.prototype.int32=function(a){return a<0?this._push(q,10,f.fromNumber(a)):this.uint32(a)},l.prototype.sint32=function(a){return this.uint32((a<<1^a>>31)>>>0)},l.prototype.uint64=function(a){var b=f.from(a);return this._push(q,b.length(),b)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(a){var b=f.from(a).zzEncode();return this._push(q,b.length(),b)},l.prototype.bool=function(a){return this._push(n,1,+!!a)},l.prototype.fixed32=function(a){return this._push(r,4,a>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(a){var b=f.from(a);return this._push(r,4,b.lo)._push(r,4,b.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(a){return this._push(e.float.writeFloatLE,4,a)},l.prototype.double=function(a){return this._push(e.float.writeDoubleLE,8,a)};var s=e.Array.prototype.set?function(a,b,c){b.set(a,c)}:function(a,b,c){for(var d=0;d<a.length;++d)b[c+d]=a[d]};l.prototype.bytes=function(a){var b=a.length>>>0;if(!b)return this._push(n,1,0);if(e.isString(a)){var c=l.alloc(b=g.length(a));g.decode(a,c,0),a=c}return this.uint32(b)._push(s,b,a)},l.prototype.string=function(a){var b=h.length(a);return b?this.uint32(b)._push(h.write,b,a):this._push(n,1,0)},l.prototype.fork=function(){return this.states=new k(this),this.head=this.tail=new i(j,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new i(j,0,0),this.len=0),this},l.prototype.ldelim=function(){var a=this.head,b=this.tail,c=this.len;return this.reset().uint32(c),c&&(this.tail.next=a.next,this.tail=b,this.len+=c),this},l.prototype.finish=function(){for(var a=this.head.next,b=this.constructor.alloc(this.len),c=0;a;)a.fn(a.val,b,c),c+=a.len,a=a.next;return b},l._configure=function(a){d=a,l.create=m(),d._configure()}},93742,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(22761),e=a.r(7544),f=a.r(92022);function g(a){return"missing required '"+a.name+"'"}function h(a){for(var b=f.codegen(["r","l","e"],a.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(a.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),c=0;c<a.fieldsArray.length;++c){var h=a._fieldsArray[c].resolve(),i=h.resolvedType instanceof d?"int32":h.type,j="m"+f.safeProp(h.name);b("case %i: {",h.id),h.map?(b("if(%s===util.emptyObject)",j)("%s={}",j)("var c2 = r.uint32()+r.pos"),void 0!==e.defaults[h.keyType]?b("k=%j",e.defaults[h.keyType]):b("k=null"),void 0!==e.defaults[i]?b("value=%j",e.defaults[i]):b("value=null"),b("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",h.keyType)("case 2:"),void 0===e.basic[i]?b("value=types[%i].decode(r,r.uint32())",c):b("value=r.%s()",i),b("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==e.long[h.keyType]?b('%s[typeof k==="object"?util.longToHash(k):k]=value',j):b("%s[k]=value",j)):h.repeated?(b("if(!(%s&&%s.length))",j,j)("%s=[]",j),void 0!==e.packed[i]&&b("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",j,i)("}else"),void 0===e.basic[i]?b(h.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",j,c):b("%s.push(r.%s())",j,i)):void 0===e.basic[i]?b(h.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",j,c):b("%s=r.%s()",j,i),b("break")("}")}for(b("default:")("r.skipType(t&7)")("break")("}")("}"),c=0;c<a._fieldsArray.length;++c){var k=a._fieldsArray[c];k.required&&b("if(!m.hasOwnProperty(%j))",k.name)("throw util.ProtocolError(%j,{instance:m})",g(k))}return b("return m")}},6307,(a,b,c)=>{"use strict";b.exports=i;var d=a.r(22761),e=a.r(92022);function f(a,b){return a.name+": "+b+(a.repeated&&"array"!==b?"[]":a.map&&"object"!==b?"{k:"+a.keyType+"}":"")+" expected"}function g(a,b,c,e){if(b.resolvedType)if(b.resolvedType instanceof d){a("switch(%s){",e)("default:")("return%j",f(b,"enum value"));for(var g=Object.keys(b.resolvedType.values),h=0;h<g.length;++h)a("case %i:",b.resolvedType.values[g[h]]);a("break")("}")}else a("{")("var e=types[%i].verify(%s);",c,e)("if(e)")("return%j+e",b.name+".")("}");else switch(b.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":a("if(!util.isInteger(%s))",e)("return%j",f(b,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":a("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",e,e,e,e)("return%j",f(b,"integer|Long"));break;case"float":case"double":a('if(typeof %s!=="number")',e)("return%j",f(b,"number"));break;case"bool":a('if(typeof %s!=="boolean")',e)("return%j",f(b,"boolean"));break;case"string":a("if(!util.isString(%s))",e)("return%j",f(b,"string"));break;case"bytes":a('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',e,e,e)("return%j",f(b,"buffer"))}return a}function h(a,b,c){switch(b.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":a("if(!util.key32Re.test(%s))",c)("return%j",f(b,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":a("if(!util.key64Re.test(%s))",c)("return%j",f(b,"integer|Long key"));break;case"bool":a("if(!util.key2Re.test(%s))",c)("return%j",f(b,"boolean key"))}return a}function i(a){var b=e.codegen(["m"],a.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),c=a.oneofsArray,d={};c.length&&b("var p={}");for(var i=0;i<a.fieldsArray.length;++i){var j=a._fieldsArray[i].resolve(),k="m"+e.safeProp(j.name);if(j.optional&&b("if(%s!=null&&m.hasOwnProperty(%j)){",k,j.name),j.map)b("if(!util.isObject(%s))",k)("return%j",f(j,"object"))("var k=Object.keys(%s)",k)("for(var i=0;i<k.length;++i){"),h(b,j,"k[i]"),g(b,j,i,k+"[k[i]]")("}");else if(j.repeated)b("if(!Array.isArray(%s))",k)("return%j",f(j,"array"))("for(var i=0;i<%s.length;++i){",k),g(b,j,i,k+"[i]")("}");else{if(j.partOf){var l=e.safeProp(j.partOf.name);1===d[j.partOf.name]&&b("if(p%s===1)",l)("return%j",j.partOf.name+": multiple values"),d[j.partOf.name]=1,b("p%s=1",l)}g(b,j,i,k)}j.optional&&b("}")}return b("return null")}},85230,(a,b,c)=>{"use strict";var d=c,e=a.r(22761),f=a.r(92022);function g(a,b,c,d){var f=!1;if(b.resolvedType)if(b.resolvedType instanceof e){a("switch(d%s){",d);for(var g=b.resolvedType.values,h=Object.keys(g),i=0;i<h.length;++i)g[h[i]]!==b.typeDefault||f||(a("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',d,d,d),b.repeated||a("break"),f=!0),a("case%j:",h[i])("case %i:",g[h[i]])("m%s=%j",d,g[h[i]])("break");a("}")}else a('if(typeof d%s!=="object")',d)("throw TypeError(%j)",b.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",d,c,d);else{var j=!1;switch(b.type){case"double":case"float":a("m%s=Number(d%s)",d,d);break;case"uint32":case"fixed32":a("m%s=d%s>>>0",d,d);break;case"int32":case"sint32":case"sfixed32":a("m%s=d%s|0",d,d);break;case"uint64":j=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":a("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",d,d,j)('else if(typeof d%s==="string")',d)("m%s=parseInt(d%s,10)",d,d)('else if(typeof d%s==="number")',d)("m%s=d%s",d,d)('else if(typeof d%s==="object")',d)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",d,d,d,j?"true":"");break;case"bytes":a('if(typeof d%s==="string")',d)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",d,d,d)("else if(d%s.length >= 0)",d)("m%s=d%s",d,d);break;case"string":a("m%s=String(d%s)",d,d);break;case"bool":a("m%s=Boolean(d%s)",d,d)}}return a}function h(a,b,c,d){if(b.resolvedType)b.resolvedType instanceof e?a("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",d,c,d,d,c,d,d):a("d%s=types[%i].toObject(m%s,o)",d,c,d);else{var f=!1;switch(b.type){case"double":case"float":a("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",d,d,d,d);break;case"uint64":f=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":a('if(typeof m%s==="number")',d)("d%s=o.longs===String?String(m%s):m%s",d,d,d)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",d,d,d,d,f?"true":"",d);break;case"bytes":a("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",d,d,d,d,d);break;default:a("d%s=m%s",d,d)}}return a}d.fromObject=function(a){var b=a.fieldsArray,c=f.codegen(["d"],a.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!b.length)return c("return new this.ctor");c("var m=new this.ctor");for(var d=0;d<b.length;++d){var h=b[d].resolve(),i=f.safeProp(h.name);h.map?(c("if(d%s){",i)('if(typeof d%s!=="object")',i)("throw TypeError(%j)",h.fullName+": object expected")("m%s={}",i)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",i),g(c,h,d,i+"[ks[i]]")("}")("}")):h.repeated?(c("if(d%s){",i)("if(!Array.isArray(d%s))",i)("throw TypeError(%j)",h.fullName+": array expected")("m%s=[]",i)("for(var i=0;i<d%s.length;++i){",i),g(c,h,d,i+"[i]")("}")("}")):(h.resolvedType instanceof e||c("if(d%s!=null){",i),g(c,h,d,i),h.resolvedType instanceof e||c("}"))}return c("return m")},d.toObject=function(a){var b=a.fieldsArray.slice().sort(f.compareFieldsById);if(!b.length)return f.codegen()("return {}");for(var c=f.codegen(["m","o"],a.name+"$toObject")("if(!o)")("o={}")("var d={}"),d=[],g=[],i=[],j=0;j<b.length;++j)b[j].partOf||(b[j].resolve().repeated?d:b[j].map?g:i).push(b[j]);if(d.length){for(c("if(o.arrays||o.defaults){"),j=0;j<d.length;++j)c("d%s=[]",f.safeProp(d[j].name));c("}")}if(g.length){for(c("if(o.objects||o.defaults){"),j=0;j<g.length;++j)c("d%s={}",f.safeProp(g[j].name));c("}")}if(i.length){for(c("if(o.defaults){"),j=0;j<i.length;++j){var k=i[j],l=f.safeProp(k.name);if(k.resolvedType instanceof e)c("d%s=o.enums===String?%j:%j",l,k.resolvedType.valuesById[k.typeDefault],k.typeDefault);else if(k.long)c("if(util.Long){")("var n=new util.Long(%i,%i,%j)",k.typeDefault.low,k.typeDefault.high,k.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",l)("}else")("d%s=o.longs===String?%j:%i",l,k.typeDefault.toString(),k.typeDefault.toNumber());else if(k.bytes){var m="["+Array.prototype.slice.call(k.typeDefault).join(",")+"]";c("if(o.bytes===String)d%s=%j",l,String.fromCharCode.apply(String,k.typeDefault))("else{")("d%s=%s",l,m)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",l,l)("}")}else c("d%s=%j",l,k.typeDefault)}c("}")}var n=!1;for(j=0;j<b.length;++j){var k=b[j],o=a._fieldsArray.indexOf(k),l=f.safeProp(k.name);k.map?(n||(n=!0,c("var ks2")),c("if(m%s&&(ks2=Object.keys(m%s)).length){",l,l)("d%s={}",l)("for(var j=0;j<ks2.length;++j){"),h(c,k,o,l+"[ks2[j]]")("}")):k.repeated?(c("if(m%s&&m%s.length){",l,l)("d%s=[]",l)("for(var j=0;j<m%s.length;++j){",l),h(c,k,o,l+"[j]")("}")):(c("if(m%s!=null&&m.hasOwnProperty(%j)){",l,k.name),h(c,k,o,l),k.partOf&&c("if(o.oneofs)")("d%s=%j",f.safeProp(k.partOf.name),k.name)),c("}")}return c("return d")}},70320,(a,b,c)=>{"use strict";var d=c,e=a.r(30783);d[".google.protobuf.Any"]={fromObject:function(a){if(a&&a["@type"]){var b=a["@type"].substring(a["@type"].lastIndexOf("/")+1),c=this.lookup(b);if(c){var d="."===a["@type"].charAt(0)?a["@type"].slice(1):a["@type"];return -1===d.indexOf("/")&&(d="/"+d),this.create({type_url:d,value:c.encode(c.fromObject(a)).finish()})}}return this.fromObject(a)},toObject:function(a,b){var c="type.googleapis.com/",d="",f="";if(b&&b.json&&a.type_url&&a.value){f=a.type_url.substring(a.type_url.lastIndexOf("/")+1),d=a.type_url.substring(0,a.type_url.lastIndexOf("/")+1);var g=this.lookup(f);g&&(a=g.decode(a.value))}if(!(a instanceof this.ctor)&&a instanceof e){var h=a.$type.toObject(a,b),i="."===a.$type.fullName[0]?a.$type.fullName.slice(1):a.$type.fullName;return""===d&&(d=c),f=d+i,h["@type"]=f,h}return this.toObject(a,b)}}},25876,(a,b,c)=>{"use strict";b.exports=s;var d=a.r(14660);((s.prototype=Object.create(d.prototype)).constructor=s).className="Type";var e=a.r(22761),f=a.r(22758),g=a.r(51475),h=a.r(58767),i=a.r(87442),j=a.r(30783),k=a.r(20209),l=a.r(42213),m=a.r(92022),n=a.r(87799),o=a.r(93742),p=a.r(6307),q=a.r(85230),r=a.r(70320);function s(a,b){d.call(this,a,b),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function t(a){return a._fieldsById=a._fieldsArray=a._oneofsArray=null,delete a.encode,delete a.decode,delete a.verify,a}Object.defineProperties(s.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var a=Object.keys(this.fields),b=0;b<a.length;++b){var c=this.fields[a[b]],d=c.id;if(this._fieldsById[d])throw Error("duplicate id "+d+" in "+this);this._fieldsById[d]=c}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=m.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=m.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=s.generateConstructor(this)())},set:function(a){var b=a.prototype;b instanceof j||((a.prototype=new j).constructor=a,m.merge(a.prototype,b)),a.$type=a.prototype.$type=this,m.merge(a,j,!0),this._ctor=a;for(var c=0;c<this.fieldsArray.length;++c)this._fieldsArray[c].resolve();var d={};for(c=0;c<this.oneofsArray.length;++c)d[this._oneofsArray[c].resolve().name]={get:m.oneOfGetter(this._oneofsArray[c].oneof),set:m.oneOfSetter(this._oneofsArray[c].oneof)};c&&Object.defineProperties(a.prototype,d)}}}),s.generateConstructor=function(a){for(var b,c=m.codegen(["p"],a.name),d=0;d<a.fieldsArray.length;++d)(b=a._fieldsArray[d]).map?c("this%s={}",m.safeProp(b.name)):b.repeated&&c("this%s=[]",m.safeProp(b.name));return c("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},s.fromJSON=function(a,b){var c=new s(a,b.options);c.extensions=b.extensions,c.reserved=b.reserved;for(var j=Object.keys(b.fields),k=0;k<j.length;++k)c.add((void 0!==b.fields[j[k]].keyType?h.fromJSON:g.fromJSON)(j[k],b.fields[j[k]]));if(b.oneofs)for(j=Object.keys(b.oneofs),k=0;k<j.length;++k)c.add(f.fromJSON(j[k],b.oneofs[j[k]]));if(b.nested)for(j=Object.keys(b.nested),k=0;k<j.length;++k){var l=b.nested[j[k]];c.add((void 0!==l.id?g.fromJSON:void 0!==l.fields?s.fromJSON:void 0!==l.values?e.fromJSON:void 0!==l.methods?i.fromJSON:d.fromJSON)(j[k],l))}return b.extensions&&b.extensions.length&&(c.extensions=b.extensions),b.reserved&&b.reserved.length&&(c.reserved=b.reserved),b.group&&(c.group=!0),b.comment&&(c.comment=b.comment),b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},s.prototype.toJSON=function(a){var b=d.prototype.toJSON.call(this,a),c=!!a&&!!a.keepComments;return m.toObject(["edition",this._editionToJSON(),"options",b&&b.options||void 0,"oneofs",d.arrayToJSON(this.oneofsArray,a),"fields",d.arrayToJSON(this.fieldsArray.filter(function(a){return!a.declaringField}),a)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",b&&b.nested||void 0,"comment",c?this.comment:void 0])},s.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;d.prototype.resolveAll.call(this);var a=this.oneofsArray;for(c=0;c<a.length;)a[c++].resolve();for(var b=this.fieldsArray,c=0;c<b.length;)b[c++].resolve();return this},s.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(a=this._edition||a,d.prototype._resolveFeaturesRecursive.call(this,a),this.oneofsArray.forEach(b=>{b._resolveFeatures(a)}),this.fieldsArray.forEach(b=>{b._resolveFeatures(a)})),this},s.prototype.get=function(a){return this.fields[a]||this.oneofs&&this.oneofs[a]||this.nested&&this.nested[a]||null},s.prototype.add=function(a){if(this.get(a.name))throw Error("duplicate name '"+a.name+"' in "+this);if(a instanceof g&&void 0===a.extend){if(this._fieldsById?this._fieldsById[a.id]:this.fieldsById[a.id])throw Error("duplicate id "+a.id+" in "+this);if(this.isReservedId(a.id))throw Error("id "+a.id+" is reserved in "+this);if(this.isReservedName(a.name))throw Error("name '"+a.name+"' is reserved in "+this);return a.parent&&a.parent.remove(a),this.fields[a.name]=a,a.message=this,a.onAdd(this),t(this)}return a instanceof f?(this.oneofs||(this.oneofs={}),this.oneofs[a.name]=a,a.onAdd(this),t(this)):d.prototype.add.call(this,a)},s.prototype.remove=function(a){if(a instanceof g&&void 0===a.extend){if(!this.fields||this.fields[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.fields[a.name],a.parent=null,a.onRemove(this),t(this)}if(a instanceof f){if(!this.oneofs||this.oneofs[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.oneofs[a.name],a.parent=null,a.onRemove(this),t(this)}return d.prototype.remove.call(this,a)},s.prototype.isReservedId=function(a){return d.isReservedId(this.reserved,a)},s.prototype.isReservedName=function(a){return d.isReservedName(this.reserved,a)},s.prototype.create=function(a){return new this.ctor(a)},s.prototype.setup=function(){for(var a=this.fullName,b=[],c=0;c<this.fieldsArray.length;++c)b.push(this._fieldsArray[c].resolve().resolvedType);this.encode=n(this)({Writer:l,types:b,util:m}),this.decode=o(this)({Reader:k,types:b,util:m}),this.verify=p(this)({types:b,util:m}),this.fromObject=q.fromObject(this)({types:b,util:m}),this.toObject=q.toObject(this)({types:b,util:m});var d=r[a];if(d){var e=Object.create(this);e.fromObject=this.fromObject,this.fromObject=d.fromObject.bind(e),e.toObject=this.toObject,this.toObject=d.toObject.bind(e)}return this},s.prototype.encode=function(a,b){return this.setup().encode(a,b)},s.prototype.encodeDelimited=function(a,b){return this.encode(a,b&&b.len?b.fork():b).ldelim()},s.prototype.decode=function(a,b){return this.setup().decode(a,b)},s.prototype.decodeDelimited=function(a){return a instanceof k||(a=k.create(a)),this.decode(a,a.uint32())},s.prototype.verify=function(a){return this.setup().verify(a)},s.prototype.fromObject=function(a){return this.setup().fromObject(a)},s.prototype.toObject=function(a,b){return this.setup().toObject(a,b)},s.d=function(a){return function(b){m.decorateType(b,a)}}},17407,(a,b,c)=>{"use strict";b.exports=l;var d,e,f,g=a.r(14660);((l.prototype=Object.create(g.prototype)).constructor=l).className="Root";var h=a.r(51475),i=a.r(22761),j=a.r(22758),k=a.r(92022);function l(a){g.call(this,"",a),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function m(){}l.fromJSON=function(a,b){return b||(b=new l),a.options&&b.setOptions(a.options),b.addJSON(a.nested).resolveAll()},l.prototype.resolvePath=k.path.resolve,l.prototype.fetch=k.fetch,l.prototype.load=function a(b,c,d){"function"==typeof c&&(d=c,c=void 0);var g=this;if(!d)return k.asPromise(a,g,b,c);var h=d===m;function i(a,b){if(d){if(h)throw a;b&&b.resolveAll();var c=d;d=null,c(a,b)}}function j(a){var b=a.lastIndexOf("google/protobuf/");if(b>-1){var c=a.substring(b);if(c in f)return c}return null}function l(a,b){try{if(k.isString(b)&&"{"===b.charAt(0)&&(b=JSON.parse(b)),k.isString(b)){e.filename=a;var d,f=e(b,g,c),l=0;if(f.imports)for(;l<f.imports.length;++l)(d=j(f.imports[l])||g.resolvePath(a,f.imports[l]))&&n(d);if(f.weakImports)for(l=0;l<f.weakImports.length;++l)(d=j(f.weakImports[l])||g.resolvePath(a,f.weakImports[l]))&&n(d,!0)}else g.setOptions(b.options).addJSON(b.nested)}catch(a){i(a)}h||o||i(null,g)}function n(a,b){if(a=j(a)||a,!(g.files.indexOf(a)>-1)){if(g.files.push(a),a in f)return void(h?l(a,f[a]):(++o,setTimeout(function(){--o,l(a,f[a])})));if(h){var c;try{c=k.fs.readFileSync(a).toString("utf8")}catch(a){b||i(a);return}l(a,c)}else++o,g.fetch(a,function(c,e){if(--o,d){if(c)return void(b?o||i(null,g):i(c));l(a,e)}})}}var o=0;k.isString(b)&&(b=[b]);for(var p,q=0;q<b.length;++q)(p=g.resolvePath("",b[q]))&&n(p);return h?g.resolveAll():o||i(null,g),g},l.prototype.loadSync=function(a,b){if(!k.isNode)throw Error("not supported");return this.load(a,b,m)},l.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(a){return"'extend "+a.extend+"' in "+a.parent.fullName}).join(", "));return g.prototype.resolveAll.call(this)};var n=/^[A-Z]/;function o(a,b){var c=b.parent.lookup(b.extend);if(c){var d=new h(b.fullName,b.id,b.type,b.rule,void 0,b.options);return!!c.get(d.name)||(d.declaringField=b,b.extensionField=d,c.add(d),!0)}return!1}l.prototype._handleAdd=function(a){if(a instanceof h)void 0===a.extend||a.extensionField||o(this,a)||this.deferred.push(a);else if(a instanceof i)n.test(a.name)&&(a.parent[a.name]=a.values);else if(!(a instanceof j)){if(a instanceof d)for(var b=0;b<this.deferred.length;)o(this,this.deferred[b])?this.deferred.splice(b,1):++b;for(var c=0;c<a.nestedArray.length;++c)this._handleAdd(a._nestedArray[c]);n.test(a.name)&&(a.parent[a.name]=a)}(a instanceof d||a instanceof i||a instanceof h)&&(this._fullyQualifiedObjects[a.fullName]=a)},l.prototype._handleRemove=function(a){if(a instanceof h){if(void 0!==a.extend)if(a.extensionField)a.extensionField.parent.remove(a.extensionField),a.extensionField=null;else{var b=this.deferred.indexOf(a);b>-1&&this.deferred.splice(b,1)}}else if(a instanceof i)n.test(a.name)&&delete a.parent[a.name];else if(a instanceof g){for(var c=0;c<a.nestedArray.length;++c)this._handleRemove(a._nestedArray[c]);n.test(a.name)&&delete a.parent[a.name]}delete this._fullyQualifiedObjects[a.fullName]},l._configure=function(a,b,c){d=a,e=b,f=c}},92022,(a,b,c)=>{"use strict";var d,e,f=b.exports=a.r(7915),g=a.r(75701);f.codegen=a.r(7346),f.fetch=a.r(24834),f.path=a.r(97139),f.fs=f.inquire("fs"),f.toArray=function(a){if(a){for(var b=Object.keys(a),c=Array(b.length),d=0;d<b.length;)c[d]=a[b[d++]];return c}return[]},f.toObject=function(a){for(var b={},c=0;c<a.length;){var d=a[c++],e=a[c++];void 0!==e&&(b[d]=e)}return b};var h=/\\/g,i=/"/g;f.isReserved=function(a){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(a)},f.safeProp=function(a){return!/^[$\w_]+$/.test(a)||f.isReserved(a)?'["'+a.replace(h,"\\\\").replace(i,'\\"')+'"]':"."+a},f.ucFirst=function(a){return a.charAt(0).toUpperCase()+a.substring(1)};var j=/_([a-z])/g;f.camelCase=function(a){return a.substring(0,1)+a.substring(1).replace(j,function(a,b){return b.toUpperCase()})},f.compareFieldsById=function(a,b){return a.id-b.id},f.decorateType=function(b,c){if(b.$type)return c&&b.$type.name!==c&&(f.decorateRoot.remove(b.$type),b.$type.name=c,f.decorateRoot.add(b.$type)),b.$type;d||(d=a.r(25876));var e=new d(c||b.name);return f.decorateRoot.add(e),e.ctor=b,Object.defineProperty(b,"$type",{value:e,enumerable:!1}),Object.defineProperty(b.prototype,"$type",{value:e,enumerable:!1}),e};var k=0;f.decorateEnum=function(b){if(b.$type)return b.$type;e||(e=a.r(22761));var c=new e("Enum"+k++,b);return f.decorateRoot.add(c),Object.defineProperty(b,"$type",{value:c,enumerable:!1}),c},f.setProperty=function(a,b,c,d){function e(a,b,c){var f=b.shift();if("__proto__"===f||"prototype"===f)return a;if(b.length>0)a[f]=e(a[f]||{},b,c);else{var g=a[f];if(g&&d)return a;g&&(c=[].concat(g).concat(c)),a[f]=c}return a}if("object"!=typeof a)throw TypeError("dst must be an object");if(!b)throw TypeError("path must be specified");return e(a,b=b.split("."),c)},Object.defineProperty(f,"decorateRoot",{get:function(){return g.decorated||(g.decorated=new(a.r(17407)))}})},7544,(a,b,c)=>{"use strict";var d=c,e=a.r(92022),f=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function g(a,b){var c=0,d={};for(b|=0;c<a.length;)d[f[c+b]]=a[c++];return d}d.basic=g([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),d.defaults=g([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",e.emptyArray,null]),d.long=g([0,0,0,1,1],7),d.mapKey=g([0,0,0,5,5,0,0,0,1,1,0,2],2),d.packed=g([1,5,0,0,0,5,5,0,0,0,1,1,0])},51475,(a,b,c)=>{"use strict";b.exports=j;var d,e=a.r(90133);((j.prototype=Object.create(e.prototype)).constructor=j).className="Field";var f=a.r(22761),g=a.r(7544),h=a.r(92022),i=/^required|optional|repeated$/;function j(a,b,c,d,f,j,k){if(h.isObject(d)?(k=f,j=d,d=f=void 0):h.isObject(f)&&(k=j,j=f,f=void 0),e.call(this,a,j),!h.isInteger(b)||b<0)throw TypeError("id must be a non-negative integer");if(!h.isString(c))throw TypeError("type must be a string");if(void 0!==d&&!i.test(d=d.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==f&&!h.isString(f))throw TypeError("extend must be a string");"proto3_optional"===d&&(d="optional"),this.rule=d&&"optional"!==d?d:void 0,this.type=c,this.id=b,this.extend=f||void 0,this.repeated="repeated"===d,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!h.Long&&void 0!==g.long[c],this.bytes="bytes"===c,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=k}j.fromJSON=function(a,b){var c=new j(a,b.id,b.type,b.rule,b.extend,b.options,b.comment);return b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},Object.defineProperty(j.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(j.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(j.prototype,"delimited",{get:function(){return this.resolvedType instanceof d&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(j.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(j.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),j.prototype.setOption=function(a,b,c){return e.prototype.setOption.call(this,a,b,c)},j.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return h.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",b?this.comment:void 0])},j.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=g.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof d?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof f&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof f||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=h.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var a;h.base64.test(this.typeDefault)?h.base64.decode(this.typeDefault,a=h.newBuffer(h.base64.length(this.typeDefault)),0):h.utf8.write(this.typeDefault,a=h.newBuffer(h.utf8.length(this.typeDefault)),0),this.typeDefault=a}return this.map?this.defaultValue=h.emptyObject:this.repeated?this.defaultValue=h.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof d&&(this.parent.ctor.prototype[this.name]=this.defaultValue),e.prototype.resolve.call(this)},j.prototype._inferLegacyProtoFeatures=function(a){if("proto2"!==a&&"proto3"!==a)return{};var b={};if("required"===this.rule&&(b.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===g.defaults[this.type]){var c=this.parent.get(this.type.split(".").pop());c&&c instanceof d&&c.group&&(b.message_encoding="DELIMITED")}return!0===this.getOption("packed")?b.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(b.repeated_field_encoding="EXPANDED"),b},j.prototype._resolveFeatures=function(a){return e.prototype._resolveFeatures.call(this,this._edition||a)},j.d=function(a,b,c,d){return"function"==typeof b?b=h.decorateType(b).name:b&&"object"==typeof b&&(b=h.decorateEnum(b).name),function(e,f){h.decorateType(e.constructor).add(new j(f,a,b,c,{default:d}))}},j._configure=function(a){d=a}},22758,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(90133);((g.prototype=Object.create(d.prototype)).constructor=g).className="OneOf";var e=a.r(51475),f=a.r(92022);function g(a,b,c,e){if(Array.isArray(b)||(c=b,b=void 0),d.call(this,a,c),!(void 0===b||Array.isArray(b)))throw TypeError("fieldNames must be an Array");this.oneof=b||[],this.fieldsArray=[],this.comment=e}function h(a){if(a.parent)for(var b=0;b<a.fieldsArray.length;++b)a.fieldsArray[b].parent||a.parent.add(a.fieldsArray[b])}g.fromJSON=function(a,b){return new g(a,b.oneof,b.options,b.comment)},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["options",this.options,"oneof",this.oneof,"comment",b?this.comment:void 0])},g.prototype.add=function(a){if(!(a instanceof e))throw TypeError("field must be a Field");return a.parent&&a.parent!==this.parent&&a.parent.remove(a),this.oneof.push(a.name),this.fieldsArray.push(a),a.partOf=this,h(this),this},g.prototype.remove=function(a){if(!(a instanceof e))throw TypeError("field must be a Field");var b=this.fieldsArray.indexOf(a);if(b<0)throw Error(a+" is not a member of "+this);return this.fieldsArray.splice(b,1),(b=this.oneof.indexOf(a.name))>-1&&this.oneof.splice(b,1),a.partOf=null,this},g.prototype.onAdd=function(a){d.prototype.onAdd.call(this,a);for(var b=this,c=0;c<this.oneof.length;++c){var e=a.get(this.oneof[c]);e&&!e.partOf&&(e.partOf=b,b.fieldsArray.push(e))}h(this)},g.prototype.onRemove=function(a){for(var b,c=0;c<this.fieldsArray.length;++c)(b=this.fieldsArray[c]).parent&&b.parent.remove(b);d.prototype.onRemove.call(this,a)},Object.defineProperty(g.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var a=this.fieldsArray[0];return null!=a.options&&!0===a.options.proto3_optional}}),g.d=function(){for(var a=Array(arguments.length),b=0;b<arguments.length;)a[b]=arguments[b++];return function(b,c){f.decorateType(b.constructor).add(new g(c,a)),Object.defineProperty(b,c,{get:f.oneOfGetter(a),set:f.oneOfSetter(a)})}}},90133,(a,b,c)=>{"use strict";b.exports=j,j.className="ReflectionObject";let d=a.r(22758);var e,f=a.r(92022),g={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},h={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},i={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function j(a,b){if(!f.isString(a))throw TypeError("name must be a string");if(b&&!f.isObject(b))throw TypeError("options must be an object");this.options=b,this.parsedOptions=null,this.name=a,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(j.prototype,{root:{get:function(){for(var a=this;null!==a.parent;)a=a.parent;return a}},fullName:{get:function(){for(var a=[this.name],b=this.parent;b;)a.unshift(b.name),b=b.parent;return a.join(".")}}}),j.prototype.toJSON=function(){throw Error()},j.prototype.onAdd=function(a){this.parent&&this.parent!==a&&this.parent.remove(this),this.parent=a,this.resolved=!1;var b=a.root;b instanceof e&&b._handleAdd(this)},j.prototype.onRemove=function(a){var b=a.root;b instanceof e&&b._handleRemove(this),this.parent=null,this.resolved=!1},j.prototype.resolve=function(){return this.resolved||this.root instanceof e&&(this.resolved=!0),this},j.prototype._resolveFeaturesRecursive=function(a){return this._resolveFeatures(this._edition||a)},j.prototype._resolveFeatures=function(a){if(!this._featuresResolved){var b={};if(!a)throw Error("Unknown edition for "+this.fullName);var c=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(a));if(this._edition){if("proto2"===a)b=Object.assign({},h);else if("proto3"===a)b=Object.assign({},i);else if("2023"===a)b=Object.assign({},g);else throw Error("Unknown edition: "+a);this._features=Object.assign(b,c||{}),this._featuresResolved=!0;return}if(this.partOf instanceof d){var e=Object.assign({},this.partOf._features);this._features=Object.assign(e,c||{})}else if(this.declaringField);else if(this.parent){var f=Object.assign({},this.parent._features);this._features=Object.assign(f,c||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},j.prototype._inferLegacyProtoFeatures=function(){return{}},j.prototype.getOption=function(a){if(this.options)return this.options[a]},j.prototype.setOption=function(a,b,c){return this.options||(this.options={}),/^features\./.test(a)?f.setProperty(this.options,a,b,c):c&&void 0!==this.options[a]||(this.getOption(a)!==b&&(this.resolved=!1),this.options[a]=b),this},j.prototype.setParsedOption=function(a,b,c){this.parsedOptions||(this.parsedOptions=[]);var d=this.parsedOptions;if(c){var e=d.find(function(b){return Object.prototype.hasOwnProperty.call(b,a)});if(e){var g=e[a];f.setProperty(g,c,b)}else(e={})[a]=f.setProperty({},c,b),d.push(e)}else{var h={};h[a]=b,d.push(h)}return this},j.prototype.setOptions=function(a,b){if(a)for(var c=Object.keys(a),d=0;d<c.length;++d)this.setOption(c[d],a[c[d]],b);return this},j.prototype.toString=function(){var a=this.constructor.className,b=this.fullName;return b.length?a+" "+b:a},j.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},j._configure=function(a){e=a}},22761,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(90133);((g.prototype=Object.create(d.prototype)).constructor=g).className="Enum";var e=a.r(14660),f=a.r(92022);function g(a,b,c,e,f,g){if(d.call(this,a,c),b&&"object"!=typeof b)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=e,this.comments=f||{},this.valuesOptions=g,this._valuesFeatures={},this.reserved=void 0,b)for(var h=Object.keys(b),i=0;i<h.length;++i)"number"==typeof b[h[i]]&&(this.valuesById[this.values[h[i]]=b[h[i]]]=h[i])}g.prototype._resolveFeatures=function(a){return a=this._edition||a,d.prototype._resolveFeatures.call(this,a),Object.keys(this.values).forEach(a=>{var b=Object.assign({},this._features);this._valuesFeatures[a]=Object.assign(b,this.valuesOptions&&this.valuesOptions[a]&&this.valuesOptions[a].features)}),this},g.fromJSON=function(a,b){var c=new g(a,b.values,b.options,b.comment,b.comments);return c.reserved=b.reserved,b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",b?this.comment:void 0,"comments",b?this.comments:void 0])},g.prototype.add=function(a,b,c,d){if(!f.isString(a))throw TypeError("name must be a string");if(!f.isInteger(b))throw TypeError("id must be an integer");if(void 0!==this.values[a])throw Error("duplicate name '"+a+"' in "+this);if(this.isReservedId(b))throw Error("id "+b+" is reserved in "+this);if(this.isReservedName(a))throw Error("name '"+a+"' is reserved in "+this);if(void 0!==this.valuesById[b]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+b+" in "+this);this.values[a]=b}else this.valuesById[this.values[a]=b]=a;return d&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[a]=d||null),this.comments[a]=c||null,this},g.prototype.remove=function(a){if(!f.isString(a))throw TypeError("name must be a string");var b=this.values[a];if(null==b)throw Error("name '"+a+"' does not exist in "+this);return delete this.valuesById[b],delete this.values[a],delete this.comments[a],this.valuesOptions&&delete this.valuesOptions[a],this},g.prototype.isReservedId=function(a){return e.isReservedId(this.reserved,a)},g.prototype.isReservedName=function(a){return e.isReservedName(this.reserved,a)}},87799,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(22761),e=a.r(7544),f=a.r(92022);function g(a,b,c,d){return b.delimited?a("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",c,d,(b.id<<3|3)>>>0,(b.id<<3|4)>>>0):a("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",c,d,(b.id<<3|2)>>>0)}function h(a){for(var b,c,h=f.codegen(["m","w"],a.name+"$encode")("if(!w)")("w=Writer.create()"),i=a.fieldsArray.slice().sort(f.compareFieldsById),b=0;b<i.length;++b){var j=i[b].resolve(),k=a._fieldsArray.indexOf(j),l=j.resolvedType instanceof d?"int32":j.type,m=e.basic[l];c="m"+f.safeProp(j.name),j.map?(h("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",c,j.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",c)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(j.id<<3|2)>>>0,8|e.mapKey[j.keyType],j.keyType),void 0===m?h("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",k,c):h(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|m,l,c),h("}")("}")):j.repeated?(h("if(%s!=null&&%s.length){",c,c),j.packed&&void 0!==e.packed[l]?h("w.uint32(%i).fork()",(j.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",c)("w.%s(%s[i])",l,c)("w.ldelim()"):(h("for(var i=0;i<%s.length;++i)",c),void 0===m?g(h,j,k,c+"[i]"):h("w.uint32(%i).%s(%s[i])",(j.id<<3|m)>>>0,l,c)),h("}")):(j.optional&&h("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",c,j.name),void 0===m?g(h,j,k,c):h("w.uint32(%i).%s(%s)",(j.id<<3|m)>>>0,l,c))}return h("return w")}},90680,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(42213);(f.prototype=Object.create(d.prototype)).constructor=f;var e=a.r(7915);function f(){d.call(this)}function g(a,b,c){a.length<40?e.utf8.write(a,b,c):b.utf8Write?b.utf8Write(a,c):b.write(a,c)}f._configure=function(){f.alloc=e._Buffer_allocUnsafe,f.writeBytesBuffer=e.Buffer&&e.Buffer.prototype instanceof Uint8Array&&"set"===e.Buffer.prototype.set.name?function(a,b,c){b.set(a,c)}:function(a,b,c){if(a.copy)a.copy(b,c,0,a.length);else for(var d=0;d<a.length;)b[c++]=a[d++]}},f.prototype.bytes=function(a){e.isString(a)&&(a=e._Buffer_from(a,"base64"));var b=a.length>>>0;return this.uint32(b),b&&this._push(f.writeBytesBuffer,b,a),this},f.prototype.string=function(a){var b=e.Buffer.byteLength(a);return this.uint32(b),b&&this._push(g,b,a),this},f._configure()},20230,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(20209);(f.prototype=Object.create(d.prototype)).constructor=f;var e=a.r(7915);function f(a){d.call(this,a)}f._configure=function(){e.Buffer&&(f.prototype._slice=e.Buffer.prototype.slice)},f.prototype.string=function(){var a=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+a,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+a,this.len))},f._configure()},23042,(a,b,c)=>{"use strict";var d=c;function e(){d.util._configure(),d.Writer._configure(d.BufferWriter),d.Reader._configure(d.BufferReader)}d.build="minimal",d.Writer=a.r(42213),d.BufferWriter=a.r(90680),d.Reader=a.r(20209),d.BufferReader=a.r(20230),d.util=a.r(7915),d.rpc=a.r(17435),d.roots=a.r(75701),d.configure=e,e()},84187,(a,b,c)=>{"use strict";var d=b.exports=a.r(23042);function e(a,b,c){return"function"==typeof b?(c=b,b=new d.Root):b||(b=new d.Root),b.load(a,c)}function f(a,b){return b||(b=new d.Root),b.loadSync(a)}d.build="light",d.load=e,d.loadSync=f,d.encoder=a.r(87799),d.decoder=a.r(93742),d.verifier=a.r(6307),d.converter=a.r(85230),d.ReflectionObject=a.r(90133),d.Namespace=a.r(14660),d.Root=a.r(17407),d.Enum=a.r(22761),d.Type=a.r(25876),d.Field=a.r(51475),d.OneOf=a.r(22758),d.MapField=a.r(58767),d.Service=a.r(87442),d.Method=a.r(17553),d.Message=a.r(30783),d.wrappers=a.r(70320),d.types=a.r(7544),d.util=a.r(92022),d.ReflectionObject._configure(d.Root),d.Namespace._configure(d.Type,d.Service,d.Enum),d.Root._configure(d.Type),d.Field._configure(d.Type)},22156,(a,b,c)=>{"use strict";b.exports=n;var d=/[\s{}=;:[\],'"()<>]/g,e=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,f=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,g=/^ *[*/]+ */,h=/^\s*\*?\/*/,i=/\n/g,j=/\s/,k=/\\(.?)/g,l={0:"\0",r:"\r",n:"\n",t:"	"};function m(a){return a.replace(k,function(a,b){switch(b){case"\\":case"":return b;default:return l[b]||""}})}function n(a,b){a=a.toString();var c=0,k=a.length,l=1,n=0,o={},p=[],q=null;function r(a){return Error("illegal "+a+" (line "+l+")")}function s(){var b="'"===q?f:e;b.lastIndex=c-1;var d=b.exec(a);if(!d)throw r("string");return c=b.lastIndex,y(q),q=null,m(d[1])}function t(b){return a.charAt(b)}function u(c,d,e){var f,j={type:a.charAt(c++),lineEmpty:!1,leading:e},k=c-(b?2:3);do if(--k<0||"\n"===(f=a.charAt(k))){j.lineEmpty=!0;break}while(" "===f||"	"===f)for(var m=a.substring(c,d).split(i),p=0;p<m.length;++p)m[p]=m[p].replace(b?h:g,"").trim();j.text=m.join("\n").trim(),o[l]=j,n=l}function v(b){var c=w(b),d=a.substring(b,c);return/^\s*\/\//.test(d)}function w(a){for(var b=a;b<k&&"\n"!==t(b);)b++;return b}function x(){if(p.length>0)return p.shift();if(q)return s();var e,f,g,h,i,m=0===c;do{if(c===k)return null;for(e=!1;j.test(g=t(c));)if("\n"===g&&(m=!0,++l),++c===k)return null;if("/"===t(c)){if(++c===k)throw r("comment");if("/"===t(c))if(b){if(h=c,i=!1,v(c-1)){i=!0;do if((c=w(c))===k||(c++,!m))break;while(v(c))}else c=Math.min(k,w(c)+1);i&&(u(h,c,m),m=!0),l++,e=!0}else{for(i="/"===t(h=c+1);"\n"!==t(++c);)if(c===k)return null;++c,i&&(u(h,c-1,m),m=!0),++l,e=!0}else{if("*"!==(g=t(c)))return"/";h=c+1,i=b||"*"===t(h);do{if("\n"===g&&++l,++c===k)throw r("comment");f=g,g=t(c)}while("*"!==f||"/"!==g)++c,i&&(u(h,c-2,m),m=!0),e=!0}}}while(e)var n=c;if(d.lastIndex=0,!d.test(t(n++)))for(;n<k&&!d.test(t(n));)++n;var o=a.substring(c,c=n);return('"'===o||"'"===o)&&(q=o),o}function y(a){p.push(a)}function z(){if(!p.length){var a=x();if(null===a)return null;y(a)}return p[0]}function A(a,b){var c=z();if(c===a)return x(),!0;if(!b)throw r("token '"+c+"', '"+a+"' expected");return!1}function B(a){var c,d=null;return void 0===a?(c=o[l-1],delete o[l-1],c&&(b||"*"===c.type||c.lineEmpty)&&(d=c.leading?c.text:null)):(n<a&&z(),c=o[a],delete o[a],c&&!c.lineEmpty&&(b||"/"===c.type)&&(d=c.leading?null:c.text)),d}return Object.defineProperty({next:x,peek:z,push:y,skip:A,cmnt:B},"line",{get:function(){return l}})}n.unescape=m},79259,(a,b,c)=>{"use strict";b.exports=y,y.filename=null,y.defaults={keepCase:!1};var d=a.r(22156),e=a.r(17407),f=a.r(25876),g=a.r(51475),h=a.r(58767),i=a.r(22758),j=a.r(22761),k=a.r(87442),l=a.r(17553),m=a.r(90133),n=a.r(7544),o=a.r(92022),p=/^[1-9][0-9]*$/,q=/^-?[1-9][0-9]*$/,r=/^0[x][0-9a-fA-F]+$/,s=/^-?0[x][0-9a-fA-F]+$/,t=/^0[0-7]+$/,u=/^-?0[0-7]+$/,v=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,w=/^[a-zA-Z_][a-zA-Z_0-9]*$/,x=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function y(a,b,c){b instanceof e||(c=b,b=new e),c||(c=y.defaults);var z,A,B,C,D=c.preferTrailingComment||!1,E=d(a,c.alternateCommentMode||!1),F=E.next,G=E.push,H=E.peek,I=E.skip,J=E.cmnt,K=!0,L="proto2",M=b,N=[],O={},P=c.keepCase?function(a){return a}:o.camelCase;function Q(){N.forEach(a=>{a._edition=L,Object.keys(O).forEach(b=>{void 0===a.getOption(b)&&a.setOption(b,O[b],!0)})})}function R(a,b,c){var d=y.filename;return c||(y.filename=null),Error("illegal "+(b||"token")+" '"+a+"' ("+(d?d+", ":"")+"line "+E.line+")")}function S(){var a,b=[];do{if('"'!==(a=F())&&"'"!==a)throw R(a);b.push(F()),I(a),a=H()}while('"'===a||"'"===a)return b.join("")}function T(a){var b=F();switch(b){case"'":case'"':return G(b),S();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return V(b,!0)}catch(c){if(a&&x.test(b))return b;throw R(b,"value")}}function U(a,b){do if(b&&('"'===(c=H())||"'"===c)){var c,d,e=S();if(a.push(e),L>=2023)throw R(e,"id")}else try{a.push([d=W(F()),I("to",!0)?W(F()):d])}catch(d){if(b&&x.test(c)&&L>=2023)a.push(c);else throw d}while(I(",",!0))var f={options:void 0};f.setOption=function(a,b){void 0===this.options&&(this.options={}),this.options[a]=b},aa(f,function(a){if("option"===a)ai(f,a),I(";");else throw R(a)},function(){am(f)})}function V(a,b){var c=1;switch("-"===a.charAt(0)&&(c=-1,a=a.substring(1)),a){case"inf":case"INF":case"Inf":return 1/0*c;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(p.test(a))return c*parseInt(a,10);if(r.test(a))return c*parseInt(a,16);if(t.test(a))return c*parseInt(a,8);if(v.test(a))return c*parseFloat(a);throw R(a,"number",b)}function W(a,b){switch(a){case"max":case"MAX":case"Max":return 0x1fffffff;case"0":return 0}if(!b&&"-"===a.charAt(0))throw R(a,"id");if(q.test(a))return parseInt(a,10);if(s.test(a))return parseInt(a,16);if(u.test(a))return parseInt(a,8);throw R(a,"id")}function X(){if(void 0!==A)throw R("package");if(A=F(),!x.test(A))throw R(A,"name");M=M.define(A),I(";")}function Y(){var a,b=H();switch(b){case"weak":a=C||(C=[]),F();break;case"public":F();default:a=B||(B=[])}b=S(),I(";"),a.push(b)}function Z(){if(I("="),(L=S())<2023)throw R(L,"syntax");I(";")}function $(){if(I("="),!["2023"].includes(L=S()))throw R(L,"edition");I(";")}function _(a,b){switch(b){case"option":return ai(a,b),I(";"),!0;case"message":return ab(a,b),!0;case"enum":return ag(a,b),!0;case"service":return an(a,b),!0;case"extend":return ap(a,b),!0}return!1}function aa(a,b,c){var d,e=E.line;if(a&&("string"!=typeof a.comment&&(a.comment=J()),a.filename=y.filename),I("{",!0)){for(;"}"!==(d=F());)b(d);I(";",!0)}else c&&c(),I(";"),a&&("string"!=typeof a.comment||D)&&(a.comment=J(e)||a.comment)}function ab(a,b){if(!w.test(b=F()))throw R(b,"type name");var c=new f(b);aa(c,function(a){if(!_(c,a))switch(a){case"map":ae(c,a);break;case"required":if("proto2"!==L)throw R(a);case"repeated":ac(c,a);break;case"optional":if("proto3"===L)ac(c,"proto3_optional");else if("proto2"!==L)throw R(a);else ac(c,"optional");break;case"oneof":af(c,a);break;case"extensions":U(c.extensions||(c.extensions=[]));break;case"reserved":U(c.reserved||(c.reserved=[]),!0);break;default:if("proto2"===L||!x.test(a))throw R(a);G(a),ac(c,"optional")}}),a.add(c),a===M&&N.push(c)}function ac(a,b,c){var d=F();if("group"===d)return void ad(a,b);for(;d.endsWith(".")||H().startsWith(".");)d+=F();if(!x.test(d))throw R(d,"type");var e=F();if(!w.test(e))throw R(e,"name");e=P(e),I("=");var f=new g(e,W(F()),d,b,c);if(aa(f,function(a){if("option"===a)ai(f,a),I(";");else throw R(a)},function(){am(f)}),"proto3_optional"===b){var h=new i("_"+e);f.setOption("proto3_optional",!0),h.add(f),a.add(h)}else a.add(f);a===M&&N.push(f)}function ad(a,b){if(L>=2023)throw R("group");var c=F();if(!w.test(c))throw R(c,"name");var d=o.lcFirst(c);c===d&&(c=o.ucFirst(c)),I("=");var e=W(F()),h=new f(c);h.group=!0;var i=new g(d,e,c,b);i.filename=y.filename,aa(h,function(a){switch(a){case"option":ai(h,a),I(";");break;case"required":case"repeated":ac(h,a);break;case"optional":"proto3"===L?ac(h,"proto3_optional"):ac(h,"optional");break;case"message":ab(h,a);break;case"enum":ag(h,a);break;case"reserved":U(h.reserved||(h.reserved=[]),!0);break;default:throw R(a)}}),a.add(h).add(i)}function ae(a){I("<");var b=F();if(void 0===n.mapKey[b])throw R(b,"type");I(",");var c=F();if(!x.test(c))throw R(c,"type");I(">");var d=F();if(!w.test(d))throw R(d,"name");I("=");var e=new h(P(d),W(F()),b,c);aa(e,function(a){if("option"===a)ai(e,a),I(";");else throw R(a)},function(){am(e)}),a.add(e)}function af(a,b){if(!w.test(b=F()))throw R(b,"name");var c=new i(P(b));aa(c,function(a){"option"===a?(ai(c,a),I(";")):(G(a),ac(c,"optional"))}),a.add(c)}function ag(a,b){if(!w.test(b=F()))throw R(b,"name");var c=new j(b);aa(c,function(a){switch(a){case"option":ai(c,a),I(";");break;case"reserved":U(c.reserved||(c.reserved=[]),!0),void 0===c.reserved&&(c.reserved=[]);break;default:ah(c,a)}}),a.add(c),a===M&&N.push(c)}function ah(a,b){if(!w.test(b))throw R(b,"name");I("=");var c=W(F(),!0),d={options:void 0};d.getOption=function(a){return this.options[a]},d.setOption=function(a,b){m.prototype.setOption.call(d,a,b)},d.setParsedOption=function(){},aa(d,function(a){if("option"===a)ai(d,a),I(";");else throw R(a)},function(){am(d)}),a.add(b,c,d.comment,d.parsedOptions||d.options)}function ai(a,b){var c,d,e=!0;for("option"===b&&(b=F());"="!==b;){if("("===b){var f=F();I(")"),b="("+f+")"}if(e){if(e=!1,b.includes(".")&&!b.includes("(")){var g=b.split(".");c=g[0]+".",b=g[1];continue}c=b}else d=d?d+=b:b;b=F()}var h=aj(a,d?c.concat(d):c);d=d&&"."===d[0]?d.slice(1):d,al(a,c=c&&"."===c[c.length-1]?c.slice(0,-1):c,h,d)}function aj(a,b){if(I("{",!0)){for(var c={};!I("}",!0);){if(!w.test(z=F()))throw R(z,"name");if(null===z)throw R(z,"end of input");var d,e,f=z;if(I(":",!0),"{"===H())d=aj(a,b+"."+z);else if("["===H()){if(d=[],I("[",!0)){do e=T(!0),d.push(e);while(I(",",!0))I("]"),void 0!==e&&ak(a,b+"."+z,e)}}else d=T(!0),ak(a,b+"."+z,d);var g=c[f];g&&(d=[].concat(g).concat(d)),c[f]=d,I(",",!0),I(";",!0)}return c}var h=T(!0);return ak(a,b,h),h}function ak(a,b,c){if(M===a&&/^features\./.test(b)){O[b]=c;return}a.setOption&&a.setOption(b,c)}function al(a,b,c,d){a.setParsedOption&&a.setParsedOption(b,c,d)}function am(a){if(I("[",!0)){do ai(a,"option");while(I(",",!0))I("]")}return a}function an(a,b){if(!w.test(b=F()))throw R(b,"service name");var c=new k(b);aa(c,function(a){if(!_(c,a))if("rpc"===a)ao(c,a);else throw R(a)}),a.add(c),a===M&&N.push(c)}function ao(a,b){var c=J(),d=b;if(!w.test(b=F()))throw R(b,"name");var e,f,g,h,i=b;if(I("("),I("stream",!0)&&(f=!0),!x.test(b=F())||(e=b,I(")"),I("returns"),I("("),I("stream",!0)&&(h=!0),!x.test(b=F())))throw R(b);g=b,I(")");var j=new l(i,d,e,g,f,h);j.comment=c,aa(j,function(a){if("option"===a)ai(j,a),I(";");else throw R(a)}),a.add(j)}function ap(a,b){if(!x.test(b=F()))throw R(b,"reference");var c=b;aa(null,function(b){switch(b){case"required":case"repeated":ac(a,b,c);break;case"optional":"proto3"===L?ac(a,"proto3_optional",c):ac(a,"optional",c);break;default:if("proto2"===L||!x.test(b))throw R(b);G(b),ac(a,"optional",c)}})}for(;null!==(z=F());)switch(z){case"package":if(!K)throw R(z);X();break;case"import":if(!K)throw R(z);Y();break;case"syntax":if(!K)throw R(z);Z();break;case"edition":if(!K)throw R(z);$();break;case"option":ai(M,z),I(";",!0);break;default:if(_(M,z)){K=!1;continue}throw R(z)}return Q(),y.filename=null,{package:A,imports:B,weakImports:C,root:b}}},16046,(a,b,c)=>{"use strict";b.exports=f;var d,e=/\/|\./;function f(a,b){e.test(a)||(a="google/protobuf/"+a+".proto",b={nested:{google:{nested:{protobuf:{nested:b}}}}}),f[a]=b}f("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),f("duration",{Duration:d={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),f("timestamp",{Timestamp:d}),f("empty",{Empty:{fields:{}}}),f("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),f("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),f("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),f.get=function(a){return f[a]||null}},44980,(a,b,c)=>{"use strict";var d=b.exports=a.r(84187);d.build="full",d.tokenize=a.r(22156),d.parse=a.r(79259),d.common=a.r(16046),d.Root._configure(d.Type,d.parse,d.common)},10889,(a,b,c)=>{"use strict";b.exports=a.r(44980)},47921,(a,b,c)=>{"use strict";var d=a.r(10889);b.exports=c=d.descriptor=d.Root.fromJSON(a.r(11973)).lookup(".google.protobuf");var e=d.Namespace,f=d.Root,g=d.Enum,h=d.Type,i=d.Field,j=d.MapField,k=d.OneOf,l=d.Service,m=d.Method;function n(a,b,d){var j=c.FileDescriptorProto.create({name:a.filename||(a.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});E(d,j),a instanceof f||(j.package=a.fullName.substring(1));for(var k,m=0;m<a.nestedArray.length;++m)(k=a._nestedArray[m])instanceof h?j.messageType.push(k.toDescriptor(d)):k instanceof g?j.enumType.push(k.toDescriptor()):k instanceof i?j.extension.push(k.toDescriptor(d)):k instanceof l?j.service.push(k.toDescriptor()):k instanceof e&&n(k,b,d);j.options=A(a.options,c.FileOptions),j.messageType.length+j.enumType.length+j.extension.length+j.service.length&&b.push(j)}f.fromDescriptor=function(a){"number"==typeof a.length&&(a=c.FileDescriptorSet.decode(a));var b=new f;if(a.file)for(var d,e,j,k=0;k<a.file.length;++k){e=b,(d=a.file[k]).package&&d.package.length&&(e=b.define(d.package));var m=D(d);if(d.name&&d.name.length&&b.files.push(e.filename=d.name),d.messageType)for(j=0;j<d.messageType.length;++j)e.add(h.fromDescriptor(d.messageType[j],m));if(d.enumType)for(j=0;j<d.enumType.length;++j)e.add(g.fromDescriptor(d.enumType[j],m));if(d.extension)for(j=0;j<d.extension.length;++j)e.add(i.fromDescriptor(d.extension[j],m));if(d.service)for(j=0;j<d.service.length;++j)e.add(l.fromDescriptor(d.service[j],m));var n=y(d.options,c.FileOptions);if(n){var o=Object.keys(n);for(j=0;j<o.length;++j)e.setOption(o[j],n[o[j]])}}return b.resolveAll()},f.prototype.toDescriptor=function(a){var b=c.FileDescriptorSet.create();return n(this,b.file,a),b};var o=0;h.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.DescriptorProto.decode(a));var e,f=new h(a.name.length?a.name:"Type"+o++,y(a.options,c.MessageOptions));if(d||(f._edition=b),a.oneofDecl)for(e=0;e<a.oneofDecl.length;++e)f.add(k.fromDescriptor(a.oneofDecl[e]));if(a.field)for(e=0;e<a.field.length;++e){var j=i.fromDescriptor(a.field[e],b,!0);f.add(j),a.field[e].hasOwnProperty("oneofIndex")&&f.oneofsArray[a.field[e].oneofIndex].add(j)}if(a.extension)for(e=0;e<a.extension.length;++e)f.add(i.fromDescriptor(a.extension[e],b,!0));if(a.nestedType)for(e=0;e<a.nestedType.length;++e)f.add(h.fromDescriptor(a.nestedType[e],b,!0)),a.nestedType[e].options&&a.nestedType[e].options.mapEntry&&f.setOption("map_entry",!0);if(a.enumType)for(e=0;e<a.enumType.length;++e)f.add(g.fromDescriptor(a.enumType[e],b,!0));if(a.extensionRange&&a.extensionRange.length)for(e=0,f.extensions=[];e<a.extensionRange.length;++e)f.extensions.push([a.extensionRange[e].start,a.extensionRange[e].end]);if(a.reservedRange&&a.reservedRange.length||a.reservedName&&a.reservedName.length){if(f.reserved=[],a.reservedRange)for(e=0;e<a.reservedRange.length;++e)f.reserved.push([a.reservedRange[e].start,a.reservedRange[e].end]);if(a.reservedName)for(e=0;e<a.reservedName.length;++e)f.reserved.push(a.reservedName[e])}return f},h.prototype.toDescriptor=function(a){var b,d,e=c.DescriptorProto.create({name:this.name});for(d=0;d<this.fieldsArray.length;++d)if(e.field.push(b=this._fieldsArray[d].toDescriptor(a)),this._fieldsArray[d]instanceof j){var f=w(this._fieldsArray[d].keyType,this._fieldsArray[d].resolvedKeyType,!1),k=w(this._fieldsArray[d].type,this._fieldsArray[d].resolvedType,!1),l=11===k||14===k?this._fieldsArray[d].resolvedType&&B(this.parent,this._fieldsArray[d].resolvedType)||this._fieldsArray[d].type:void 0;e.nestedType.push(c.DescriptorProto.create({name:b.typeName,field:[c.FieldDescriptorProto.create({name:"key",number:1,label:1,type:f}),c.FieldDescriptorProto.create({name:"value",number:2,label:1,type:k,typeName:l})],options:c.MessageOptions.create({mapEntry:!0})}))}for(d=0;d<this.oneofsArray.length;++d)e.oneofDecl.push(this._oneofsArray[d].toDescriptor());for(d=0;d<this.nestedArray.length;++d)this._nestedArray[d]instanceof i?e.field.push(this._nestedArray[d].toDescriptor(a)):this._nestedArray[d]instanceof h?e.nestedType.push(this._nestedArray[d].toDescriptor(a)):this._nestedArray[d]instanceof g&&e.enumType.push(this._nestedArray[d].toDescriptor());if(this.extensions)for(d=0;d<this.extensions.length;++d)e.extensionRange.push(c.DescriptorProto.ExtensionRange.create({start:this.extensions[d][0],end:this.extensions[d][1]}));if(this.reserved)for(d=0;d<this.reserved.length;++d)"string"==typeof this.reserved[d]?e.reservedName.push(this.reserved[d]):e.reservedRange.push(c.DescriptorProto.ReservedRange.create({start:this.reserved[d][0],end:this.reserved[d][1]}));return e.options=A(this.options,c.MessageOptions),e};var p=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;i.fromDescriptor=function(a,b,d){if("number"==typeof a.length&&(a=c.DescriptorProto.decode(a)),"number"!=typeof a.number)throw Error("missing field id");switch(e=a.typeName&&a.typeName.length?a.typeName:u(a.type),a.label){case 1:f=void 0;break;case 2:f="required";break;case 3:f="repeated";break;default:throw Error("illegal label: "+a.label)}var e,f,g=a.extendee;void 0!==a.extendee&&(g=g.length?g:void 0);var h=new i(a.name.length?a.name:"field"+a.number,a.number,e,f,g);if(d||(h._edition=b),h.options=y(a.options,c.FieldOptions),a.proto3_optional&&(h.options.proto3_optional=!0),a.defaultValue&&a.defaultValue.length){var j=a.defaultValue;switch(j){case"true":case"TRUE":j=!0;break;case"false":case"FALSE":j=!1;break;default:p.exec(j)&&(j=parseInt(j))}h.setOption("default",j)}return v(a.type)&&("proto3"===b?a.options&&!a.options.packed&&h.setOption("packed",!1):(!b||"proto2"===b)&&a.options&&a.options.packed&&h.setOption("packed",!0)),h},i.prototype.toDescriptor=function(a){var b=c.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)b.type=11,b.typeName=d.util.ucFirst(this.name),b.label=3;else{switch(b.type=w(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:b.typeName=this.resolvedType?B(this.parent,this.resolvedType):this.type}"repeated"===this.rule?b.label=3:this.required&&"proto2"===a?b.label=2:b.label=1}if(b.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(b.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(b.options=A(this.options,c.FieldOptions),null!=this.options.default&&(b.defaultValue=String(this.options.default)),this.options.proto3_optional&&(b.proto3_optional=!0)),"proto3"===a?this.packed||((b.options||(b.options=c.FieldOptions.create())).packed=!1):(!a||"proto2"===a)&&this.packed&&((b.options||(b.options=c.FieldOptions.create())).packed=!0),b};var q=0;g.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.EnumDescriptorProto.decode(a));var e={};if(a.value)for(var f=0;f<a.value.length;++f){var h=a.value[f].name,i=a.value[f].number||0;e[h&&h.length?h:"NAME"+i]=i}var j=new g(a.name&&a.name.length?a.name:"Enum"+q++,e,y(a.options,c.EnumOptions));return d||(j._edition=b),j},g.prototype.toDescriptor=function(){for(var a=[],b=0,d=Object.keys(this.values);b<d.length;++b)a.push(c.EnumValueDescriptorProto.create({name:d[b],number:this.values[d[b]]}));return c.EnumDescriptorProto.create({name:this.name,value:a,options:A(this.options,c.EnumOptions)})};var r=0;k.fromDescriptor=function(a){return"number"==typeof a.length&&(a=c.OneofDescriptorProto.decode(a)),new k(a.name&&a.name.length?a.name:"oneof"+r++)},k.prototype.toDescriptor=function(){return c.OneofDescriptorProto.create({name:this.name})};var s=0;l.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.ServiceDescriptorProto.decode(a));var e=new l(a.name&&a.name.length?a.name:"Service"+s++,y(a.options,c.ServiceOptions));if(d||(e._edition=b),a.method)for(var f=0;f<a.method.length;++f)e.add(m.fromDescriptor(a.method[f]));return e},l.prototype.toDescriptor=function(){for(var a=[],b=0;b<this.methodsArray.length;++b)a.push(this._methodsArray[b].toDescriptor());return c.ServiceDescriptorProto.create({name:this.name,method:a,options:A(this.options,c.ServiceOptions)})};var t=0;function u(a){switch(a){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+a)}function v(a){switch(a){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function w(a,b,c){switch(a){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(b instanceof g)return 14;if(b instanceof h)return c?10:11;throw Error("illegal type: "+a)}function x(a,b){for(var c,d,e={},f=0;f<b.fieldsArray.length;++f)if("uninterpretedOption"!==(d=(c=b._fieldsArray[f]).name)&&Object.prototype.hasOwnProperty.call(a,d)){var i=C(d);c.resolvedType instanceof h?e[i]=x(a[d],c.resolvedType):c.resolvedType instanceof g?e[i]=c.resolvedType.valuesById[a[d]]:e[i]=a[d]}return e}function y(a,b){if(a)return x(b.toObject(a),b)}function z(a,b){for(var c={},e=Object.keys(a),f=0;f<e.length;++f){var g=e[f],i=d.util.camelCase(g);if(Object.prototype.hasOwnProperty.call(b.fields,i)){var j=b.fields[i];j.resolvedType instanceof h?c[i]=z(a[g],j.resolvedType):c[i]=a[g],j.repeated&&!Array.isArray(c[i])&&(c[i]=[c[i]])}}return c}function A(a,b){if(a)return b.fromObject(z(a,b))}function B(a,b){var c=a.fullName.split("."),d=b.fullName.split("."),g=0,h=0,i=d.length-1;if(!(a instanceof f)&&b instanceof e)for(;g<c.length&&h<i&&c[g]===d[h];){var j=b.lookup(c[g++],!0);if(null!==j&&j!==b)break;++h}else for(;g<c.length&&h<i&&c[g]===d[h];++g,++h);return d.slice(h).join(".")}function C(a){return a.substring(0,1)+a.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(a,b){return"_"+b.toLowerCase()})}function D(a){if("editions"===a.syntax)if(a.edition===c.Edition.EDITION_2023)return"2023";else throw Error("Unsupported edition "+a.edition);return"proto3"===a.syntax?"proto3":"proto2"}function E(a,b){if(a)if("proto2"===a||"proto3"===a)b.syntax=a;else if(b.syntax="editions","2023"===a)b.edition=c.Edition.EDITION_2023;else throw Error("Unsupported edition "+a)}m.fromDescriptor=function(a){return"number"==typeof a.length&&(a=c.MethodDescriptorProto.decode(a)),new m(a.name&&a.name.length?a.name:"Method"+t++,"rpc",a.inputType,a.outputType,!!a.clientStreaming,!!a.serverStreaming,y(a.options,c.MethodOptions))},m.prototype.toDescriptor=function(){return c.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:A(this.options,c.MethodOptions)})}},25487,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.addCommonProtos=c.loadProtosWithOptionsSync=c.loadProtosWithOptions=void 0;let d=a.r(22734),e=a.r(14747),f=a.r(10889);function g(a,b){let c=a.resolvePath;a.resolvePath=(a,f)=>{if(e.isAbsolute(f))return f;for(let a of b){let b=e.join(a,f);try{return d.accessSync(b,d.constants.R_OK),b}catch(a){continue}}return process.emitWarning(`${f} not found in any of the include paths ${b}`),c(a,f)}}c.loadProtosWithOptions=async function(a,b){let c=new f.Root;if((b=b||{}).includeDirs){if(!Array.isArray(b.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));g(c,b.includeDirs)}let d=await c.load(a,b);return d.resolveAll(),d},c.loadProtosWithOptionsSync=function(a,b){let c=new f.Root;if((b=b||{}).includeDirs){if(!Array.isArray(b.includeDirs))throw Error("The includeDirs option must be an array");g(c,b.includeDirs)}let d=c.loadSync(a,b);return d.resolveAll(),d},c.addCommonProtos=function(){let b=a.r(43707),c=a.r(11973),d=a.r(89452),e=a.r(72341);f.common("api",b.nested.google.nested.protobuf.nested),f.common("descriptor",c.nested.google.nested.protobuf.nested),f.common("source_context",d.nested.google.nested.protobuf.nested),f.common("type",e.nested.google.nested.protobuf.nested)}},46184,(a,b,c)=>{!function(d,e){function f(a){return a.default||a}if("function"==typeof define&&define.amd){let b;void 0!==(b=function(){var a={};return e(a),f(a)}())&&a.v(b)}else e(c),b.exports=f(c)}("u">typeof globalThis?globalThis:"u">typeof self?self:a.e,function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var b=null;try{b=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function c(a,b,c){this.low=0|a,this.high=0|b,this.unsigned=!!c}function d(a){return!0===(a&&a.__isLong__)}function e(a){var b=Math.clz32(a&-a);return a?31-b:b}c.prototype.__isLong__,Object.defineProperty(c.prototype,"__isLong__",{value:!0}),c.isLong=d;var f={},g={};function h(a,b){var c,d,e;if(b)return(a>>>=0,(e=0<=a&&a<256)&&(d=g[a]))?d:(c=j(a,0,!0),e&&(g[a]=c),c);return(a|=0,(e=-128<=a&&a<128)&&(d=f[a]))?d:(c=j(a,a<0?-1:0,!1),e&&(f[a]=c),c)}function i(a,b){if(isNaN(a))return b?s:r;if(b){if(a<0)return s;if(a>=o)return x}else{if(a<=-p)return y;if(a+1>=p)return w}return a<0?i(-a,b).neg():j(a%n|0,a/n|0,b)}function j(a,b,d){return new c(a,b,d)}c.fromInt=h,c.fromNumber=i,c.fromBits=j;var k=Math.pow;function l(a,b,c){if(0===a.length)throw Error("empty string");if("number"==typeof b?(c=b,b=!1):b=!!b,"NaN"===a||"Infinity"===a||"+Infinity"===a||"-Infinity"===a)return b?s:r;if((c=c||10)<2||36<c)throw RangeError("radix");if((d=a.indexOf("-"))>0)throw Error("interior hyphen");if(0===d)return l(a.substring(1),b,c).neg();for(var d,e=i(k(c,8)),f=r,g=0;g<a.length;g+=8){var h=Math.min(8,a.length-g),j=parseInt(a.substring(g,g+h),c);if(h<8){var m=i(k(c,h));f=f.mul(m).add(i(j))}else f=(f=f.mul(e)).add(i(j))}return f.unsigned=b,f}function m(a,b){return"number"==typeof a?i(a,b):"string"==typeof a?l(a,b):j(a.low,a.high,"boolean"==typeof b?b:a.unsigned)}c.fromString=l,c.fromValue=m;var n=0x100000000,o=0xffffffffffffffff,p=0x8000000000000000,q=h(0x1000000),r=h(0);c.ZERO=r;var s=h(0,!0);c.UZERO=s;var t=h(1);c.ONE=t;var u=h(1,!0);c.UONE=u;var v=h(-1);c.NEG_ONE=v;var w=j(-1,0x7fffffff,!1);c.MAX_VALUE=w;var x=j(-1,-1,!0);c.MAX_UNSIGNED_VALUE=x;var y=j(0,-0x80000000,!1);c.MIN_VALUE=y;var z=c.prototype;z.toInt=function(){return this.unsigned?this.low>>>0:this.low},z.toNumber=function(){return this.unsigned?(this.high>>>0)*n+(this.low>>>0):this.high*n+(this.low>>>0)},z.toString=function(a){if((a=a||10)<2||36<a)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(!this.eq(y))return"-"+this.neg().toString(a);else{var b=i(a),c=this.div(b),d=c.mul(b).sub(this);return c.toString(a)+d.toInt().toString(a)}for(var e=i(k(a,6),this.unsigned),f=this,g="";;){var h=f.div(e),j=(f.sub(h.mul(e)).toInt()>>>0).toString(a);if((f=h).isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},z.getHighBits=function(){return this.high},z.getHighBitsUnsigned=function(){return this.high>>>0},z.getLowBits=function(){return this.low},z.getLowBitsUnsigned=function(){return this.low>>>0},z.getNumBitsAbs=function(){if(this.isNegative())return this.eq(y)?64:this.neg().getNumBitsAbs();for(var a=0!=this.high?this.high:this.low,b=31;b>0&&(a&1<<b)==0;b--);return 0!=this.high?b+33:b+1},z.isSafeInteger=function(){var a=this.high>>21;return!a||!this.unsigned&&-1===a&&(0!==this.low||-2097152!==this.high)},z.isZero=function(){return 0===this.high&&0===this.low},z.eqz=z.isZero,z.isNegative=function(){return!this.unsigned&&this.high<0},z.isPositive=function(){return this.unsigned||this.high>=0},z.isOdd=function(){return(1&this.low)==1},z.isEven=function(){return(1&this.low)==0},z.equals=function(a){return d(a)||(a=m(a)),(this.unsigned===a.unsigned||this.high>>>31!=1||a.high>>>31!=1)&&this.high===a.high&&this.low===a.low},z.eq=z.equals,z.notEquals=function(a){return!this.eq(a)},z.neq=z.notEquals,z.ne=z.notEquals,z.lessThan=function(a){return 0>this.comp(a)},z.lt=z.lessThan,z.lessThanOrEqual=function(a){return 0>=this.comp(a)},z.lte=z.lessThanOrEqual,z.le=z.lessThanOrEqual,z.greaterThan=function(a){return this.comp(a)>0},z.gt=z.greaterThan,z.greaterThanOrEqual=function(a){return this.comp(a)>=0},z.gte=z.greaterThanOrEqual,z.ge=z.greaterThanOrEqual,z.compare=function(a){if(d(a)||(a=m(a)),this.eq(a))return 0;var b=this.isNegative(),c=a.isNegative();return b&&!c?-1:!b&&c?1:this.unsigned?a.high>>>0>this.high>>>0||a.high===this.high&&a.low>>>0>this.low>>>0?-1:1:this.sub(a).isNegative()?-1:1},z.comp=z.compare,z.negate=function(){return!this.unsigned&&this.eq(y)?y:this.not().add(t)},z.neg=z.negate,z.add=function(a){d(a)||(a=m(a));var b,c,e=this.high>>>16,f=65535&this.high,g=this.low>>>16,h=65535&this.low,i=a.high>>>16,k=65535&a.high,l=a.low>>>16,n=65535&a.low,o=0,p=0;return b=0+((c=0+(h+n))>>>16),c&=65535,b+=g+l,p+=b>>>16,b&=65535,p+=f+k,o+=p>>>16,p&=65535,o+=e+i,j(b<<16|c,(o&=65535)<<16|p,this.unsigned)},z.subtract=function(a){return d(a)||(a=m(a)),this.add(a.neg())},z.sub=z.subtract,z.multiply=function(a){if(this.isZero())return this;if(d(a)||(a=m(a)),b)return j(b.mul(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned);if(a.isZero())return this.unsigned?s:r;if(this.eq(y))return a.isOdd()?y:r;if(a.eq(y))return this.isOdd()?y:r;if(this.isNegative())if(a.isNegative())return this.neg().mul(a.neg());else return this.neg().mul(a).neg();if(a.isNegative())return this.mul(a.neg()).neg();if(this.lt(q)&&a.lt(q))return i(this.toNumber()*a.toNumber(),this.unsigned);var c,e,f=this.high>>>16,g=65535&this.high,h=this.low>>>16,k=65535&this.low,l=a.high>>>16,n=65535&a.high,o=a.low>>>16,p=65535&a.low,t=0,u=0;return c=0+((e=0+k*p)>>>16),e&=65535,c+=h*p,u+=c>>>16,c&=65535,c+=k*o,u+=c>>>16,c&=65535,u+=g*p,t+=u>>>16,u&=65535,u+=h*o,t+=u>>>16,u&=65535,u+=k*n,t+=u>>>16,u&=65535,t+=f*p+g*o+h*n+k*l,j(c<<16|e,(t&=65535)<<16|u,this.unsigned)},z.mul=z.multiply,z.divide=function(a){if(d(a)||(a=m(a)),a.isZero())throw Error("division by zero");if(b){var c,e,f;return this.unsigned||-0x80000000!==this.high||-1!==a.low||-1!==a.high?j((this.unsigned?b.div_u:b.div_s)(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?s:r;if(this.unsigned){if(a.unsigned||(a=a.toUnsigned()),a.gt(this))return s;if(a.gt(this.shru(1)))return u;f=s}else{if(this.eq(y))if(a.eq(t)||a.eq(v))return y;else return a.eq(y)?t:(c=this.shr(1).div(a).shl(1)).eq(r)?a.isNegative()?t:v:(e=this.sub(a.mul(c)),f=c.add(e.div(a)));if(a.eq(y))return this.unsigned?s:r;if(this.isNegative())return a.isNegative()?this.neg().div(a.neg()):this.neg().div(a).neg();if(a.isNegative())return this.div(a.neg()).neg();f=r}for(e=this;e.gte(a);){for(var g=Math.ceil(Math.log(c=Math.max(1,Math.floor(e.toNumber()/a.toNumber())))/Math.LN2),h=g<=48?1:k(2,g-48),l=i(c),n=l.mul(a);n.isNegative()||n.gt(e);)c-=h,n=(l=i(c,this.unsigned)).mul(a);l.isZero()&&(l=t),f=f.add(l),e=e.sub(n)}return f},z.div=z.divide,z.modulo=function(a){return(d(a)||(a=m(a)),b)?j((this.unsigned?b.rem_u:b.rem_s)(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned):this.sub(this.div(a).mul(a))},z.mod=z.modulo,z.rem=z.modulo,z.not=function(){return j(~this.low,~this.high,this.unsigned)},z.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},z.clz=z.countLeadingZeros,z.countTrailingZeros=function(){return this.low?e(this.low):e(this.high)+32},z.ctz=z.countTrailingZeros,z.and=function(a){return d(a)||(a=m(a)),j(this.low&a.low,this.high&a.high,this.unsigned)},z.or=function(a){return d(a)||(a=m(a)),j(this.low|a.low,this.high|a.high,this.unsigned)},z.xor=function(a){return d(a)||(a=m(a)),j(this.low^a.low,this.high^a.high,this.unsigned)},z.shiftLeft=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low<<a,this.high<<a|this.low>>>32-a,this.unsigned):j(0,this.low<<a-32,this.unsigned)},z.shl=z.shiftLeft,z.shiftRight=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low>>>a|this.high<<32-a,this.high>>a,this.unsigned):j(this.high>>a-32,this.high>=0?0:-1,this.unsigned)},z.shr=z.shiftRight,z.shiftRightUnsigned=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low>>>a|this.high<<32-a,this.high>>>a,this.unsigned):32===a?j(this.high,0,this.unsigned):j(this.high>>>a-32,0,this.unsigned)},z.shru=z.shiftRightUnsigned,z.shr_u=z.shiftRightUnsigned,z.rotateLeft=function(a){var b;return(d(a)&&(a=a.toInt()),0==(a&=63))?this:32===a?j(this.high,this.low,this.unsigned):a<32?(b=32-a,j(this.low<<a|this.high>>>b,this.high<<a|this.low>>>b,this.unsigned)):(a-=32,b=32-a,j(this.high<<a|this.low>>>b,this.low<<a|this.high>>>b,this.unsigned))},z.rotl=z.rotateLeft,z.rotateRight=function(a){var b;return(d(a)&&(a=a.toInt()),0==(a&=63))?this:32===a?j(this.high,this.low,this.unsigned):a<32?(b=32-a,j(this.high<<b|this.low>>>a,this.low<<b|this.high>>>a,this.unsigned)):(a-=32,b=32-a,j(this.low<<b|this.high>>>a,this.high<<b|this.low>>>a,this.unsigned))},z.rotr=z.rotateRight,z.toSigned=function(){return this.unsigned?j(this.low,this.high,!1):this},z.toUnsigned=function(){return this.unsigned?this:j(this.low,this.high,!0)},z.toBytes=function(a){return a?this.toBytesLE():this.toBytesBE()},z.toBytesLE=function(){var a=this.high,b=this.low;return[255&b,b>>>8&255,b>>>16&255,b>>>24,255&a,a>>>8&255,a>>>16&255,a>>>24]},z.toBytesBE=function(){var a=this.high,b=this.low;return[a>>>24,a>>>16&255,a>>>8&255,255&a,b>>>24,b>>>16&255,b>>>8&255,255&b]},c.fromBytes=function(a,b,d){return d?c.fromBytesLE(a,b):c.fromBytesBE(a,b)},c.fromBytesLE=function(a,b){return new c(a[0]|a[1]<<8|a[2]<<16|a[3]<<24,a[4]|a[5]<<8|a[6]<<16|a[7]<<24,b)},c.fromBytesBE=function(a,b){return new c(a[4]<<24|a[5]<<16|a[6]<<8|a[7],a[0]<<24|a[1]<<16|a[2]<<8|a[3],b)},"function"==typeof BigInt&&(c.fromBigInt=function(a,b){return j(Number(BigInt.asIntN(32,a)),Number(BigInt.asIntN(32,a>>BigInt(32))),b)},c.fromValue=function(a,b){return"bigint"==typeof a?c.fromBigInt(a,b):m(a,b)},z.toBigInt=function(){var a=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|a}),a.default=c})},36789,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.loadFileDescriptorSetFromObject=c.loadFileDescriptorSetFromBuffer=c.fromJSON=c.loadSync=c.load=c.IdempotencyLevel=c.isAnyExtension=c.Long=void 0;let e=a.r(80801),f=a.r(10889),g=a.r(47921),h=a.r(25487);c.Long=a.r(46184),c.isAnyExtension=function(a){return"@type"in a&&"string"==typeof a["@type"]},function(a){a.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",a.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",a.IDEMPOTENT="IDEMPOTENT"}(d=c.IdempotencyLevel||(c.IdempotencyLevel={}));let i={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function j(a,b){return""===a?b:a+"."+b}function k(a){return a instanceof f.Service||a instanceof f.Type||a instanceof f.Enum}function l(a){return a instanceof f.Namespace||a instanceof f.Root}function m(a,b){let c=j(b,a.name);return k(a)?[[c,a]]:l(a)&&void 0!==a.nested?Object.keys(a.nested).map(b=>m(a.nested[b],c)).reduce((a,b)=>a.concat(b),[]):[]}function n(a,b){return function(c){return a.toObject(a.decode(c),b)}}function o(a){return function(b){if(Array.isArray(b))throw Error(`Failed to serialize message: expected object with ${a.name} structure, got array instead`);let c=a.fromObject(b);return a.encode(c).finish()}}function p(a){return(a||[]).reduce((a,b)=>{for(let[c,d]of Object.entries(b))"uninterpreted_option"===c?a.uninterpreted_option.push(b.uninterpreted_option):a[c]=d;return a},{deprecated:!1,idempotency_level:d.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function q(a,b,c,d){let f=a.resolvedRequestType,g=a.resolvedResponseType;return{path:"/"+b+"/"+a.name,requestStream:!!a.requestStream,responseStream:!!a.responseStream,requestSerialize:o(f),requestDeserialize:n(f,c),responseSerialize:o(g),responseDeserialize:n(g,c),originalName:e(a.name),requestType:s(f,d),responseType:s(g,d),options:p(a.parsedOptions)}}function r(a,b,c,d){let e={};for(let f of a.methodsArray)e[f.name]=q(f,b,c,d);return e}function s(a,b){let c=a.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:c.$type.toObject(c,i),fileDescriptorProtos:b}}function t(a,b){let c=a.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:c.$type.toObject(c,i),fileDescriptorProtos:b}}function u(a,b,c,d){if(a instanceof f.Service)return r(a,b,c,d);if(a instanceof f.Type)return s(a,d);if(a instanceof f.Enum)return t(a,d);throw Error("Type mismatch in reflection object handling")}function v(a,b){let c={};a.resolveAll();let d=a.toDescriptor("proto3").file.map(a=>Buffer.from(g.FileDescriptorProto.encode(a).finish()));for(let[e,f]of m(a,""))c[e]=u(f,e,b,d);return c}function w(a,b){b=b||{};let c=f.Root.fromDescriptor(a);return c.resolveAll(),v(c,b)}c.load=function(a,b){return(0,h.loadProtosWithOptions)(a,b).then(a=>v(a,b))},c.loadSync=function(a,b){return v((0,h.loadProtosWithOptionsSync)(a,b),b)},c.fromJSON=function(a,b){b=b||{};let c=f.Root.fromJSON(a);return c.resolveAll(),v(c,b)},c.loadFileDescriptorSetFromBuffer=function(a,b){return w(g.FileDescriptorSet.decode(a),b)},c.loadFileDescriptorSetFromObject=function(a,b){return w(g.FileDescriptorSet.fromObject(a),b)},(0,h.addCommonProtos)()},77748,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.getChannelzServiceDefinition=c.getChannelzHandlers=c.unregisterChannelzRef=c.registerChannelzSocket=c.registerChannelzServer=c.registerChannelzSubchannel=c.registerChannelzChannel=c.ChannelzCallTracker=c.ChannelzChildrenTracker=c.ChannelzTrace=void 0;let d=a.r(4446),e=a.r(33706),f=a.r(78996),g=a.r(5367),h=a.r(15410),i=a.r(48988);function j(a){return{channel_id:a.id,name:a.name}}function k(a){return{subchannel_id:a.id,name:a.name}}function l(a){return{server_id:a.id}}function m(a){return{socket_id:a.id,name:a.name}}let n=32;class o{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(a,b,c){let d=new Date;this.events.push({description:b,severity:a,timestamp:d,childChannel:(null==c?void 0:c.kind)==="channel"?c:void 0,childSubchannel:(null==c?void 0:c.kind)==="subchannel"?c:void 0}),this.events.length>=2*n&&(this.events=this.events.slice(n)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:B(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(a=>({description:a.description,severity:a.severity,timestamp:B(a.timestamp),channel_ref:a.childChannel?j(a.childChannel):null,subchannel_ref:a.childSubchannel?k(a.childSubchannel):null}))}}}c.ChannelzTrace=o;class p{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(a){var b,c,d;switch(a.kind){case"channel":{let c=null!=(b=this.channelChildren.get(a.id))?b:{ref:a,count:0};c.count+=1,this.channelChildren.set(a.id,c);break}case"subchannel":{let b=null!=(c=this.subchannelChildren.get(a.id))?c:{ref:a,count:0};b.count+=1,this.subchannelChildren.set(a.id,b);break}case"socket":{let b=null!=(d=this.socketChildren.get(a.id))?d:{ref:a,count:0};b.count+=1,this.socketChildren.set(a.id,b)}}}unrefChild(a){switch(a.kind){case"channel":{let b=this.channelChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.channelChildren.delete(a.id):this.channelChildren.set(a.id,b));break}case"subchannel":{let b=this.subchannelChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.subchannelChildren.delete(a.id):this.subchannelChildren.set(a.id,b));break}case"socket":{let b=this.socketChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.socketChildren.delete(a.id):this.socketChildren.set(a.id,b))}}}getChildLists(){let a=[];for(let{ref:b}of this.channelChildren.values())a.push(b);let b=[];for(let{ref:a}of this.subchannelChildren.values())b.push(a);let c=[];for(let{ref:a}of this.socketChildren.values())c.push(a);return{channels:a,subchannels:b,sockets:c}}}c.ChannelzChildrenTracker=p;class q{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}c.ChannelzCallTracker=q;let r=1;function s(){return r++}let t=[],u=[],v=[],w=[];function x(a){let b=Number.parseInt(a,16);return[b/256|0,b%256]}function y(a){return""===a?[]:[].concat(...a.split(":").map(a=>x(a)))}function z(a){if((0,d.isIPv4)(a))return Buffer.from(Uint8Array.from(a.split(".").map(a=>Number.parseInt(a))));if(!(0,d.isIPv6)(a))return null;{let b,c,d=a.indexOf("::");-1===d?(b=a,c=""):(b=a.substring(0,d),c=a.substring(d+2));let e=Buffer.from(y(b)),f=Buffer.from(y(c)),g=Buffer.alloc(16-e.length-f.length,0);return Buffer.concat([e,g,f])}}function A(a){switch(a){case e.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case e.ConnectivityState.IDLE:return{state:"IDLE"};case e.ConnectivityState.READY:return{state:"READY"};case e.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case e.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function B(a){if(!a)return null;let b=a.getTime();return{seconds:b/1e3|0,nanos:b%1e3*1e6}}function C(a){let b=a.getInfo();return{ref:j(a.ref),data:{target:b.target,state:A(b.state),calls_started:b.callTracker.callsStarted,calls_succeeded:b.callTracker.callsSucceeded,calls_failed:b.callTracker.callsFailed,last_call_started_timestamp:B(b.callTracker.lastCallStartedTimestamp),trace:b.trace.getTraceMessage()},channel_ref:b.children.channels.map(a=>j(a)),subchannel_ref:b.children.subchannels.map(a=>k(a))}}function D(a,b){let c=Number.parseInt(a.request.channel_id),d=t[c];void 0===d?b({code:f.Status.NOT_FOUND,details:"No channel data found for id "+c}):b(null,{channel:C(d)})}function E(a,b){let c=Number.parseInt(a.request.max_results),d=[],e=Number.parseInt(a.request.start_channel_id);for(;e<t.length;e++){let a=t[e];if(void 0!==a&&(d.push(C(a)),d.length>=c))break}b(null,{channel:d,end:e>=v.length})}function F(a){let b=a.getInfo();return{ref:l(a.ref),data:{calls_started:b.callTracker.callsStarted,calls_succeeded:b.callTracker.callsSucceeded,calls_failed:b.callTracker.callsFailed,last_call_started_timestamp:B(b.callTracker.lastCallStartedTimestamp),trace:b.trace.getTraceMessage()},listen_socket:b.listenerChildren.sockets.map(a=>m(a))}}function G(a,b){let c=Number.parseInt(a.request.server_id),d=v[c];void 0===d?b({code:f.Status.NOT_FOUND,details:"No server data found for id "+c}):b(null,{server:F(d)})}function H(a,b){let c=Number.parseInt(a.request.max_results),d=[],e=Number.parseInt(a.request.start_server_id);for(;e<v.length;e++){let a=v[e];if(void 0!==a&&(d.push(F(a)),d.length>=c))break}b(null,{server:d,end:e>=v.length})}function I(a,b){let c=Number.parseInt(a.request.subchannel_id),d=u[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No subchannel data found for id "+c});let e=d.getInfo();b(null,{subchannel:{ref:k(d.ref),data:{target:e.target,state:A(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:B(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},socket_ref:e.children.sockets.map(a=>m(a))}})}function J(a){var b;return(0,g.isTcpSubchannelAddress)(a)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(b=z(a.host))?b:void 0,port:a.port}}:{address:"uds_address",uds_address:{filename:a.path}}}function K(a,b){var c,d,e,g,h;let i=Number.parseInt(a.request.socket_id),j=w[i];if(void 0===j)return void b({code:f.Status.NOT_FOUND,details:"No socket data found for id "+i});let k=j.getInfo(),l=k.security?{model:"tls",tls:{cipher_suite:k.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(c=k.security.cipherSuiteStandardName)?c:void 0,other_name:null!=(d=k.security.cipherSuiteOtherName)?d:void 0,local_certificate:null!=(e=k.security.localCertificate)?e:void 0,remote_certificate:null!=(g=k.security.remoteCertificate)?g:void 0}}:null;b(null,{socket:{ref:m(j.ref),local:k.localAddress?J(k.localAddress):null,remote:k.remoteAddress?J(k.remoteAddress):null,remote_name:null!=(h=k.remoteName)?h:void 0,security:l,data:{keep_alives_sent:k.keepAlivesSent,streams_started:k.streamsStarted,streams_succeeded:k.streamsSucceeded,streams_failed:k.streamsFailed,last_local_stream_created_timestamp:B(k.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:B(k.lastRemoteStreamCreatedTimestamp),messages_received:k.messagesReceived,messages_sent:k.messagesSent,last_message_received_timestamp:B(k.lastMessageReceivedTimestamp),last_message_sent_timestamp:B(k.lastMessageSentTimestamp),local_flow_control_window:k.localFlowControlWindow?{value:k.localFlowControlWindow}:null,remote_flow_control_window:k.remoteFlowControlWindow?{value:k.remoteFlowControlWindow}:null}}})}function L(a,b){let c=Number.parseInt(a.request.server_id),d=v[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No server data found for id "+c});let e=Number.parseInt(a.request.start_socket_id),g=Number.parseInt(a.request.max_results),h=d.getInfo().sessionChildren.sockets.sort((a,b)=>a.id-b.id),i=[],j=0;for(;j<h.length&&(!(h[j].id>=e)||(i.push(m(h[j])),!(i.length>=g)));j++);b(null,{socket_ref:i,end:j>=h.length})}function M(){return{GetChannel:D,GetTopChannels:E,GetServer:G,GetServers:H,GetSubchannel:I,GetSocket:K,GetServerSockets:L}}c.registerChannelzChannel=function(a,b,c){let d=s(),e={id:d,name:a,kind:"channel"};return c&&(t[d]={ref:e,getInfo:b}),e},c.registerChannelzSubchannel=function(a,b,c){let d=s(),e={id:d,name:a,kind:"subchannel"};return c&&(u[d]={ref:e,getInfo:b}),e},c.registerChannelzServer=function(a,b){let c=s(),d={id:c,kind:"server"};return b&&(v[c]={ref:d,getInfo:a}),d},c.registerChannelzSocket=function(a,b,c){let d=s(),e={id:d,name:a,kind:"socket"};return c&&(w[d]={ref:e,getInfo:b}),e},c.unregisterChannelzRef=function(a){switch(a.kind){case"channel":delete t[a.id];return;case"subchannel":delete u[a.id];return;case"server":delete v[a.id];return;case"socket":delete w[a.id];return}},c.getChannelzHandlers=M;let N=null;function O(){if(N)return N;let b=(0,a.r(36789).loadSync)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:["/ROOT/Desktop/gps-tracker/node_modules/@grpc/grpc-js/build/src/../../proto"]});return N=(0,i.loadPackageDefinition)(b).grpc.channelz.v1.Channelz.service}c.getChannelzServiceDefinition=O,c.setup=function(){(0,h.registerAdminService)(O,M)}},43553,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Subchannel=void 0;let d=a.r(33706),e=a.r(51982),f=a.r(70799),g=a.r(78996),h=a.r(1617),i=a.r(5367),j=a.r(77748),k="subchannel",l=0x7fffffff;class m{constructor(a,b,c,f,g){var h;this.channelTarget=a,this.subchannelAddress=b,this.options=c,this.credentials=f,this.connector=g,this.connectivityState=d.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new j.ChannelzCallTracker,this.childrenTracker=new j.ChannelzChildrenTracker,this.streamTracker=new j.ChannelzCallTracker;const k={initialDelay:c["grpc.initial_reconnect_backoff_ms"],maxDelay:c["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new e.BackoffTimeout(()=>{this.handleBackoffTimer()},k),this.backoffTimeout.unref(),this.subchannelAddressString=(0,i.subchannelAddressToString)(b),this.keepaliveTime=null!=(h=c["grpc.keepalive_time_ms"])?h:-1,0===c["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new j.ChannelzTrace,this.channelzRef=(0,j.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(c,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(a){f.trace(g.LogVerbosity.DEBUG,k,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}refTrace(a){f.trace(g.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.CONNECTING):this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let a=this.options;if(a["grpc.keepalive_time_ms"]){let b=Math.min(this.keepaliveTime,l);a=Object.assign(Object.assign({},a),{"grpc.keepalive_time_ms":b})}this.connector.connect(this.subchannelAddress,this.credentials,a).then(a=>{this.transitionToState([d.ConnectivityState.CONNECTING],d.ConnectivityState.READY)?(this.transport=a,this.channelzEnabled&&this.childrenTracker.refChild(a.getChannelzRef()),a.addDisconnectListener(a=>{this.transitionToState([d.ConnectivityState.READY],d.ConnectivityState.IDLE),a&&this.keepaliveTime>0&&(this.keepaliveTime*=2,f.log(g.LogVerbosity.ERROR,`Connection to ${(0,h.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):a.shutdown()},a=>{this.transitionToState([d.ConnectivityState.CONNECTING],d.ConnectivityState.TRANSIENT_FAILURE,`${a}`)})}transitionToState(a,b,c){var e,f;if(-1===a.indexOf(this.connectivityState))return!1;this.trace(d.ConnectivityState[this.connectivityState]+" -> "+d.ConnectivityState[b]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+d.ConnectivityState[b]);let g=this.connectivityState;switch(this.connectivityState=b,b){case d.ConnectivityState.READY:this.stopBackoff();break;case d.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case d.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(e=this.transport)||e.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case d.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(f=this.transport)||f.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${b}`)}for(let a of this.stateListeners)a(this,g,b,this.keepaliveTime,c);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,j.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([d.ConnectivityState.CONNECTING,d.ConnectivityState.READY],d.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(a,b,c,d){let e;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),e={onCallEnd:a=>{a.code===g.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):e={},this.transport.createCall(a,b,c,d,e)}startConnecting(){process.nextTick(()=>{this.transitionToState([d.ConnectivityState.IDLE],d.ConnectivityState.CONNECTING)||this.connectivityState!==d.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(a){this.stateListeners.add(a)}removeConnectivityStateListener(a){this.stateListeners.delete(a)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(a){return a.getRealSubchannel()===this}throttleKeepalive(a){a>this.keepaliveTime&&(this.keepaliveTime=a)}}c.Subchannel=m},16511,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.DEFAULT_PORT=void 0;let d=a.r(40142),e=a.r(79594),f=a.r(24361),g=a.r(24432),h=a.r(78996),i=a.r(14694),j=a.r(70799),k=a.r(78996),l=a.r(1617),m=a.r(4446),n=a.r(51982),o="dns_resolver";function p(a){j.trace(k.LogVerbosity.DEBUG,o,a)}c.DEFAULT_PORT=443;let q=3e4,r=f.promisify(e.resolveTxt),s=f.promisify(e.lookup);function t(...a){let b=[];for(let c=0;c<Math.max.apply(null,a.map(a=>a.length));c++)for(let d of a)c<d.length&&b.push(d[c]);return b}class u{constructor(a,b,d){var e,f,g;this.target=a,this.listener=b,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,p("Resolver constructed for target "+(0,l.uriToString)(a));const j=(0,l.splitHostPort)(a.path);null===j?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,m.isIPv4)(j.host)||(0,m.isIPv6)(j.host)?(this.ipResult=[{host:j.host,port:null!=(e=j.port)?e:c.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=j.host,this.port=null!=(f=j.port)?f:c.DEFAULT_PORT),this.percentage=100*Math.random(),1===d["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:h.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,l.uriToString)(this.target)}`,metadata:new i.Metadata};const k={initialDelay:d["grpc.initial_reconnect_backoff_ms"],maxDelay:d["grpc.max_reconnect_backoff_ms"]};this.backoff=new n.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},k),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(g=d["grpc.dns_min_time_between_resolutions_ms"])?g:q,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(p("Returning IP address for target "+(0,l.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)p("Failed to parse DNS address "+(0,l.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:h.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,l.uriToString)(this.target)}`,metadata:new i.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;p("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let a=this.dnsHostname;this.pendingLookupPromise=s(a,{all:!0}),this.pendingLookupPromise.then(a=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let b=a.filter(a=>4===a.family),c=a.filter(a=>6===a.family);this.latestLookupResult=t(c,b).map(a=>({host:a.address,port:+this.port}));let d="["+this.latestLookupResult.map(a=>a.host+":"+a.port).join(",")+"]";(p("Resolved addresses for target "+(0,l.uriToString)(this.target)+": "+d),0===this.latestLookupResult.length)?this.listener.onError(this.defaultResolutionError):this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},a=>{null!==this.pendingLookupPromise&&(p("Resolution error for target "+(0,l.uriToString)(this.target)+": "+a.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=r(a),this.pendingTxtPromise.then(a=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,g.extractAndSelectServiceConfig)(a,this.percentage)}catch(a){this.latestServiceConfigError={code:h.Status.UNAVAILABLE,details:`Parsing service config failed with error ${a.message}`,metadata:new i.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},a=>{}))}}startNextResolutionTimer(){var a,b;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(b=(a=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:b.call(a),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?p('resolution update delayed by "min time between resolutions" rate limit'):p("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(a){return a.path}}c.setup=function(){(0,d.registerResolver)("dns",u),(0,d.registerDefaultScheme)("dns")}},27876,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getProxiedConnection=c.mapProxyName=void 0;let d=a.r(70799),e=a.r(78996),f=a.r(40142),g=a.r(21517),h=a.r(55004),i=a.r(70799),j=a.r(5367),k=a.r(1617),l=a.r(92509),m=a.r(16511),n="proxy";function o(a){i.trace(e.LogVerbosity.DEBUG,n,a)}function p(){let a,b="",c="";if(process.env.grpc_proxy)c="grpc_proxy",b=process.env.grpc_proxy;else if(process.env.https_proxy)c="https_proxy",b=process.env.https_proxy;else{if(!process.env.http_proxy)return{};c="http_proxy",b=process.env.http_proxy}try{a=new l.URL(b)}catch(a){return(0,d.log)(e.LogVerbosity.ERROR,`cannot parse value of "${c}" env var`),{}}if("http:"!==a.protocol)return(0,d.log)(e.LogVerbosity.ERROR,`"${a.protocol}" scheme not supported in proxy URI`),{};let f=null;a.username&&(a.password?((0,d.log)(e.LogVerbosity.INFO,"userinfo found in proxy URI"),f=`${a.username}:${a.password}`):f=a.username);let g=a.hostname,h=a.port;""===h&&(h="80");let i={address:`${g}:${h}`};return f&&(i.creds=f),o("Proxy server "+i.address+" set by environment variable "+c),i}function q(){let a=process.env.no_grpc_proxy,b="no_grpc_proxy";return(a||(a=process.env.no_proxy,b="no_proxy"),a)?(o("No proxy server list set by environment variable "+b),a.split(",")):[]}c.mapProxyName=function(a,b){var c;let d={target:a,extraOptions:{}};if((null!=(c=b["grpc.enable_http_proxy"])?c:1)===0||"unix"===a.scheme)return d;let e=p();if(!e.address)return d;let f=(0,k.splitHostPort)(a.path);if(!f)return d;let g=f.host;for(let b of q())if(b===g)return o("Not using proxy for target in no_proxy list: "+(0,k.uriToString)(a)),d;let h={"grpc.http_connect_target":(0,k.uriToString)(a)};return e.creds&&(h["grpc.http_connect_creds"]=e.creds),{target:{scheme:"dns",path:e.address},extraOptions:h}},c.getProxiedConnection=function(a,b,c){var i;if(!("grpc.http_connect_target"in b))return Promise.resolve({});let l=b["grpc.http_connect_target"],n=(0,k.parseUri)(l);if(null===n)return Promise.resolve({});let p=(0,k.splitHostPort)(n.path);if(null===p)return Promise.resolve({});let q=`${p.host}:${null!=(i=p.port)?i:m.DEFAULT_PORT}`,r={method:"CONNECT",path:q},s={Host:q};(0,j.isTcpSubchannelAddress)(a)?(r.host=a.host,r.port=a.port):r.socketPath=a.path,"grpc.http_connect_creds"in b&&(s["Proxy-Authorization"]="Basic "+Buffer.from(b["grpc.http_connect_creds"]).toString("base64")),r.headers=s;let t=(0,j.subchannelAddressToString)(a);return o("Using proxy "+t+" to connect to "+r.path),new Promise((a,b)=>{let i=g.request(r);i.once("connect",(g,j,l)=>{var m;if(i.removeAllListeners(),j.removeAllListeners(),200===g.statusCode)if(o("Successfully connected to "+r.path+" through proxy "+t),"secureContext"in c){let d=(0,f.getDefaultAuthority)(n),e=(0,k.splitHostPort)(d),g=null!=(m=null==e?void 0:e.host)?m:d,i=h.connect(Object.assign({host:g,servername:g,socket:j},c),()=>{o("Successfully established a TLS connection to "+r.path+" through proxy "+t),a({socket:i,realTarget:n})});i.on("error",a=>{o("Failed to establish a TLS connection to "+r.path+" through proxy "+t+" with error "+a.message),b()})}else o("Successfully established a plaintext connection to "+r.path+" through proxy "+t),a({socket:j,realTarget:n});else(0,d.log)(e.LogVerbosity.ERROR,"Failed to connect to "+r.path+" through proxy "+t+" with status "+g.statusCode),b()}),i.once("error",a=>{i.removeAllListeners(),(0,d.log)(e.LogVerbosity.ERROR,"Failed to connect to proxy "+t+" with error "+a.message),b()}),i.end()})}},64869,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.StreamDecoder=void 0,function(a){a[a.NO_DATA=0]="NO_DATA",a[a.READING_SIZE=1]="READING_SIZE",a[a.READING_MESSAGE=2]="READING_MESSAGE"}(d||(d={}));class e{constructor(a){this.maxReadMessageLength=a,this.readState=d.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(a){let b,c=0,e=[];for(;c<a.length;)switch(this.readState){case d.NO_DATA:this.readCompressFlag=a.slice(c,c+1),c+=1,this.readState=d.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case d.READING_SIZE:if(b=Math.min(a.length-c,this.readSizeRemaining),a.copy(this.readPartialSize,4-this.readSizeRemaining,c,c+b),this.readSizeRemaining-=b,c+=b,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=d.READING_MESSAGE;else{let a=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=d.NO_DATA,e.push(a)}}break;case d.READING_MESSAGE:if(b=Math.min(a.length-c,this.readMessageRemaining),this.readPartialMessage.push(a.slice(c,c+b)),this.readMessageRemaining-=b,c+=b,0===this.readMessageRemaining){let a=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),b=Buffer.concat(a,this.readMessageSize+5);this.readState=d.NO_DATA,e.push(b)}break;default:throw Error("Unexpected read state")}return e}}c.StreamDecoder=e},21644,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2SubchannelCall=void 0;let d=a.r(25328),e=a.r(46786),f=a.r(78996),g=a.r(14694),h=a.r(64869),i=a.r(70799),j=a.r(78996),k="subchannel_call";function l(a){for(let[b,c]of Object.entries(e.constants.errno))if(c===a)return b;return"Unknown system error "+a}class m{constructor(a,b,c,e,i){var j;this.http2Stream=a,this.callEventTracker=b,this.listener=c,this.transport=e,this.callId=i,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=f.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;const k=null!=(j=e.getOptions()["grpc.max_receive_message_length"])?j:f.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new h.StreamDecoder(k),a.on("response",(a,b)=>{let c="";for(let b of Object.keys(a))c+="		"+b+": "+a[b]+"\n";switch(this.trace("Received server headers:\n"+c),a[":status"]){case 400:this.mappedStatusCode=f.Status.INTERNAL;break;case 401:this.mappedStatusCode=f.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=f.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=f.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=f.Status.UNAVAILABLE;break;default:this.mappedStatusCode=f.Status.UNKNOWN}if(b&d.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(a);else{let b;try{b=g.Metadata.fromHttp2Headers(a)}catch(a){this.endCall({code:f.Status.UNKNOWN,details:a.message,metadata:new g.Metadata});return}this.listener.onReceiveMetadata(b)}}),a.on("trailers",a=>{this.handleTrailers(a)}),a.on("data",a=>{let b;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+a.length);try{b=this.decoder.write(a)}catch(a){this.cancelWithStatus(f.Status.RESOURCE_EXHAUSTED,a.message);return}for(let a of b)this.trace("parsed message of length "+a.length),this.callEventTracker.addMessageReceived(),this.tryPush(a)}}),a.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),a.on("close",()=>{process.nextTick(()=>{var b;let c;if(this.trace("HTTP/2 stream closed with code "+a.rstCode),(null==(b=this.finalStatus)?void 0:b.code)===f.Status.OK)return;let e="";switch(a.rstCode){case d.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;c=f.Status.INTERNAL,e=`Received RST_STREAM with code ${a.rstCode}`;break;case d.constants.NGHTTP2_REFUSED_STREAM:c=f.Status.UNAVAILABLE,e="Stream refused by server";break;case d.constants.NGHTTP2_CANCEL:c=f.Status.CANCELLED,e="Call cancelled";break;case d.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=f.Status.RESOURCE_EXHAUSTED,e="Bandwidth exhausted or memory limit exceeded";break;case d.constants.NGHTTP2_INADEQUATE_SECURITY:c=f.Status.PERMISSION_DENIED,e="Protocol not secure enough";break;case d.constants.NGHTTP2_INTERNAL_ERROR:c=f.Status.INTERNAL,null===this.internalError?e=`Received RST_STREAM with code ${a.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(c=f.Status.UNAVAILABLE,e=this.internalError.message):e=`Received RST_STREAM with code ${a.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=f.Status.INTERNAL,e=`Received RST_STREAM with code ${a.rstCode}`}this.endCall({code:c,details:e,metadata:new g.Metadata,rstCode:a.rstCode})})}),a.on("error",a=>{"ERR_HTTP2_STREAM_ERROR"!==a.code&&(this.trace("Node error event: message="+a.message+" code="+a.code+" errno="+l(a.errno)+" syscall="+a.syscall),this.internalError=a),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:f.Status.UNAVAILABLE,details:"Connection dropped",metadata:new g.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(a){i.trace(j.LogVerbosity.DEBUG,k,"["+this.callId+"] "+a)}endCall(a){(null===this.finalStatus||this.finalStatus.code===f.Status.OK)&&(this.finalStatus=a,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===f.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(a){this.trace("pushing to reader message of length "+(a instanceof Buffer?a.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(a),this.maybeOutputStatus())})}tryPush(a){this.canPush?(this.http2Stream.pause(),this.push(a)):(this.trace("unpushedReadMessages.push message of length "+a.length),this.unpushedReadMessages.push(a))}handleTrailers(a){let b;this.callEventTracker.onStreamEnd(!0);let c="";for(let b of Object.keys(a))c+="		"+b+": "+a[b]+"\n";this.trace("Received server trailers:\n"+c);try{b=g.Metadata.fromHttp2Headers(a)}catch(a){b=new g.Metadata}let d=b.getMap(),e=this.mappedStatusCode;if(e===f.Status.UNKNOWN&&"string"==typeof d["grpc-status"]){let a=Number(d["grpc-status"]);a in f.Status&&(e=a,this.trace("received status code "+a+" from server")),b.remove("grpc-status")}let h="";if("string"==typeof d["grpc-message"]){try{h=decodeURI(d["grpc-message"])}catch(a){h=d["grpc-message"]}b.remove("grpc-message"),this.trace('received status details string "'+h+'" from server')}let i={code:e,details:h,metadata:b};this.endCall(i)}destroyHttp2Stream(){var a;if(!this.http2Stream.destroyed){let b;b=(null==(a=this.finalStatus)?void 0:a.code)===f.Status.OK?d.constants.NGHTTP2_NO_ERROR:d.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+b),this.http2Stream.close(b)}}cancelWithStatus(a,b){this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),this.endCall({code:a,details:b,metadata:new g.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==f.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let a=this.unpushedReadMessages.shift();this.push(a);return}this.http2Stream.resume()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length);let c=b=>{process.nextTick(()=>{var c;let d=f.Status.UNAVAILABLE;(null==b?void 0:b.code)==="ERR_STREAM_WRITE_AFTER_END"&&(d=f.Status.INTERNAL),b&&this.cancelWithStatus(d,`Write error: ${b.message}`),null==(c=a.callback)||c.call(a)})};this.trace("sending data chunk of length "+b.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(b,c)}catch(a){this.endCall({code:f.Status.UNAVAILABLE,details:`Write failed with error ${a.message}`,metadata:new g.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}c.Http2SubchannelCall=m},22316,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getNextCallNumber=void 0;let d=0;c.getNextCallNumber=function(){return d++}},44706,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2SubchannelConnector=void 0;let d=a.r(25328),e=a.r(55004),f=a.r(77748),g=a.r(78996),h=a.r(27876),i=a.r(70799),j=a.r(40142),k=a.r(5367),l=a.r(1617),m=a.r(4446),n=a.r(21644),o=a.r(22316),p="transport",q="transport_flowctrl",r=a.r(6235).version,{HTTP2_HEADER_AUTHORITY:s,HTTP2_HEADER_CONTENT_TYPE:t,HTTP2_HEADER_METHOD:u,HTTP2_HEADER_PATH:v,HTTP2_HEADER_TE:w,HTTP2_HEADER_USER_AGENT:x}=d.constants,y=2e4,z=Buffer.from("too_many_pings","ascii");class A{constructor(a,b,c,e){this.session=a,this.options=c,this.remoteName=e,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=y,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new f.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,k.subchannelAddressToString)(b),0===c["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,f.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[c["grpc.primary_user_agent"],`grpc-node-js/${r}`,c["grpc.secondary_user_agent"]].filter(a=>a).join(" "),"grpc.keepalive_time_ms"in c&&(this.keepaliveTimeMs=c["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in c&&(this.keepaliveTimeoutMs=c["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in c?this.keepaliveWithoutCalls=1===c["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,a.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),a.once("goaway",(a,b,c)=>{let e=!1;a===d.constants.NGHTTP2_ENHANCE_YOUR_CALM&&c&&c.equals(z)&&(e=!0),this.trace("connection closed by GOAWAY with code "+a+" and data "+(null==c?void 0:c.toString())),this.reportDisconnectToOwner(e)}),a.once("error",a=>{this.trace("connection closed with error "+a.message)}),i.isTracerEnabled(p)&&(a.on("remoteSettings",b=>{this.trace("new settings received"+(this.session!==a?" on the old connection":"")+": "+JSON.stringify(b))}),a.on("localSettings",b=>{this.trace("local settings acknowledged by remote"+(this.session!==a?" on the old connection":"")+": "+JSON.stringify(b))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var a,b,c;let d,e=this.session.socket,f=e.remoteAddress?(0,k.stringToSubchannelAddress)(e.remoteAddress,e.remotePort):null,g=e.localAddress?(0,k.stringToSubchannelAddress)(e.localAddress,e.localPort):null;if(this.session.encrypted){let b=e,c=b.getCipher(),f=b.getCertificate(),g=b.getPeerCertificate();d={cipherSuiteStandardName:null!=(a=c.standardName)?a:null,cipherSuiteOtherName:c.standardName?null:c.name,localCertificate:f&&"raw"in f?f.raw:null,remoteCertificate:g&&"raw"in g?g.raw:null}}else d=null;return{remoteAddress:f,localAddress:g,security:d,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(b=this.session.state.localWindowSize)?b:null,remoteFlowControlWindow:null!=(c=this.session.state.remoteWindowSize)?c:null}}trace(a){i.trace(g.LogVerbosity.DEBUG,p,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}keepaliveTrace(a){i.trace(g.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}flowControlTrace(a){i.trace(g.LogVerbosity.DEBUG,q,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}internalsTrace(a){i.trace(g.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}reportDisconnectToOwner(a){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(b=>b(a)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let a of this.activeCalls)a.onDisconnect()})}addDisconnectListener(a){this.disconnectListeners.push(a)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var a,b;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(b=(a=this.keepaliveTimeoutId).unref)||b.call(a));try{this.session.ping((a,b,c)=>{a&&(this.keepaliveTrace("Ping failed with error "+a.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(a){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var a,b;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(b=(a=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:b.call(a)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(a){this.activeCalls.delete(a),0===this.activeCalls.size&&this.session.unref()}addActiveCall(a){this.activeCalls.add(a),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(a,b,c,d,e){let f,g,h,i=a.toHttp2Headers();i[s]=b,i[x]=this.userAgent,i[t]="application/grpc",i[u]="POST",i[v]=c,i[w]="trailers";try{f=this.session.request(i)}catch(a){throw this.handleDisconnect(),a}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),g={addMessageSent:()=>{var a;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(a=e.addMessageSent)||a.call(e)},addMessageReceived:()=>{var a;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(a=e.addMessageReceived)||a.call(e)},onCallEnd:a=>{var b;null==(b=e.onCallEnd)||b.call(e,a),this.removeActiveCall(h)},onStreamEnd:a=>{var b;a?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(b=e.onStreamEnd)||b.call(e,a)}}):g={addMessageSent:()=>{var a;null==(a=e.addMessageSent)||a.call(e)},addMessageReceived:()=>{var a;null==(a=e.addMessageReceived)||a.call(e)},onCallEnd:a=>{var b;null==(b=e.onCallEnd)||b.call(e,a),this.removeActiveCall(h)},onStreamEnd:a=>{var b;null==(b=e.onStreamEnd)||b.call(e,a)}},h=new n.Http2SubchannelCall(f,g,d,this,(0,o.getNextCallNumber)()),this.addActiveCall(h),h}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,f.unregisterChannelzRef)(this.channelzRef)}}class B{constructor(a){this.channelTarget=a,this.session=null,this.isShutdown=!1}trace(a){i.trace(g.LogVerbosity.DEBUG,p,(0,l.uriToString)(this.channelTarget)+" "+a)}createSession(a,b,c,f){return this.isShutdown?Promise.reject():new Promise((g,h)=>{var i,n,o;let p;f.realTarget?(p=(0,l.uriToString)(f.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,l.uriToString)(f.realTarget))):(p=null,this.trace("creating HTTP/2 session to "+(0,k.subchannelAddressToString)(a)));let q=(0,j.getDefaultAuthority)(null!=(i=f.realTarget)?i:this.channelTarget),r=b._getConnectionOptions()||{};r.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in c?r.maxSessionMemory=c["grpc-node.max_session_memory"]:r.maxSessionMemory=Number.MAX_SAFE_INTEGER;let s="http://";if("secureContext"in r){if(s="https://",c["grpc.ssl_target_name_override"]){let a=c["grpc.ssl_target_name_override"];r.checkServerIdentity=(b,c)=>(0,e.checkServerIdentity)(a,c),r.servername=a}else{let a=null!=(o=null==(n=(0,l.splitHostPort)(q))?void 0:n.host)?o:"localhost";r.servername=a}f.socket&&(r.createConnection=(a,b)=>f.socket)}else r.createConnection=(b,c)=>f.socket?f.socket:m.connect(a);r=Object.assign(Object.assign(Object.assign({},r),a),{enableTrace:1===c["grpc-node.tls_enable_trace"]});let t=d.connect(s+q,r);this.session=t;let u="Failed to connect";t.unref(),t.once("connect",()=>{t.removeAllListeners(),g(new A(t,a,c,p)),this.session=null}),t.once("close",()=>{this.session=null,setImmediate(()=>{h(`${u} (${new Date().toISOString()})`)})}),t.once("error",a=>{u=a.message,this.trace("connection failed with error "+u)})})}connect(a,b,c){var d,f;if(this.isShutdown)return Promise.reject();let g=b._getConnectionOptions()||{};if("secureContext"in g){if(g.ALPNProtocols=["h2"],c["grpc.ssl_target_name_override"]){let a=c["grpc.ssl_target_name_override"];g.checkServerIdentity=(b,c)=>(0,e.checkServerIdentity)(a,c),g.servername=a}else if("grpc.http_connect_target"in c){let a=(0,j.getDefaultAuthority)(null!=(d=(0,l.parseUri)(c["grpc.http_connect_target"]))?d:{path:"localhost"}),b=(0,l.splitHostPort)(a);g.servername=null!=(f=null==b?void 0:b.host)?f:a}c["grpc-node.tls_enable_trace"]&&(g.enableTrace=!0)}return(0,h.getProxiedConnection)(a,c,g).then(d=>this.createSession(a,b,c,d))}shutdown(){var a;this.isShutdown=!0,null==(a=this.session)||a.close(),this.session=null}}c.Http2SubchannelConnector=B},3609,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getSubchannelPool=c.SubchannelPool=void 0;let d=a.r(42547),e=a.r(43553),f=a.r(5367),g=a.r(1617),h=a.r(44706),i=1e4;class j{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let a=!0;for(let b in this.pool){let c=this.pool[b].filter(a=>!a.subchannel.unrefIfOneRef());c.length>0&&(a=!1),this.pool[b]=c}a&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var a,b;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},i),null==(b=(a=this.cleanupTimer).unref)||b.call(a))}getOrCreateSubchannel(a,b,c,i){this.ensureCleanupTask();let j=(0,g.uriToString)(a);if(j in this.pool){for(let a of this.pool[j])if((0,f.subchannelAddressEqual)(b,a.subchannelAddress)&&(0,d.channelOptionsEqual)(c,a.channelArguments)&&i._equals(a.channelCredentials))return a.subchannel}let k=new e.Subchannel(a,b,c,i,new h.Http2SubchannelConnector(a));return j in this.pool||(this.pool[j]=[]),this.pool[j].push({subchannelAddress:b,channelArguments:c,channelCredentials:i,subchannel:k}),k.ref(),k}}c.SubchannelPool=j;let k=new j;c.getSubchannelPool=function(a){return a?k:new j}},4026,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.FilterStackFactory=c.FilterStack=void 0;class d{constructor(a){this.filters=a}sendMetadata(a){let b=a;for(let a=0;a<this.filters.length;a++)b=this.filters[a].sendMetadata(b);return b}receiveMetadata(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveMetadata(b);return b}sendMessage(a){let b=a;for(let a=0;a<this.filters.length;a++)b=this.filters[a].sendMessage(b);return b}receiveMessage(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveMessage(b);return b}receiveTrailers(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveTrailers(b);return b}push(a){this.filters.unshift(...a)}getFilters(){return this.filters}}c.FilterStack=d;class e{constructor(a){this.factories=a}push(a){this.factories.unshift(...a)}clone(){return new e([...this.factories])}createFilter(){return new d(this.factories.map(a=>a.createFilter()))}}c.FilterStackFactory=e},98422,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.CompressionAlgorithms=void 0,function(a){a[a.identity=0]="identity",a[a.deflate=1]="deflate",a[a.gzip=2]="gzip"}(d||(c.CompressionAlgorithms=d={}))},14120,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BaseFilter=void 0;class d{async sendMetadata(a){return a}receiveMetadata(a){return a}async sendMessage(a){return a}async receiveMessage(a){return a}receiveTrailers(a){return a}}c.BaseFilter=d},69154,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CompressionFilterFactory=c.CompressionFilter=void 0;let d=a.r(6461),e=a.r(98422),f=a.r(78996),g=a.r(14120),h=a.r(70799),i=a=>"number"==typeof a&&"string"==typeof e.CompressionAlgorithms[a];class j{async writeMessage(a,b){let c=a;b&&(c=await this.compressMessage(c));let d=Buffer.allocUnsafe(c.length+5);return d.writeUInt8(+!!b,0),d.writeUInt32BE(c.length,1),c.copy(d,5),d}async readMessage(a){let b=1===a.readUInt8(0),c=a.slice(5);return b&&(c=await this.decompressMessage(c)),c}}class k extends j{async compressMessage(a){return a}async writeMessage(a,b){let c=Buffer.allocUnsafe(a.length+5);return c.writeUInt8(0,0),c.writeUInt32BE(a.length,1),a.copy(c,5),c}decompressMessage(a){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class l extends j{constructor(a){super(),this.maxRecvMessageLength=a}compressMessage(a){return new Promise((b,c)=>{d.deflate(a,(a,d)=>{a?c(a):b(d)})})}decompressMessage(a){return new Promise((b,c)=>{let e=0,g=[],h=d.createInflate();h.on("data",a=>{g.push(a),e+=a.byteLength,-1!==this.maxRecvMessageLength&&e>this.maxRecvMessageLength&&(h.destroy(),c({code:f.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),h.on("end",()=>{b(Buffer.concat(g))}),h.write(a),h.end()})}}class m extends j{constructor(a){super(),this.maxRecvMessageLength=a}compressMessage(a){return new Promise((b,c)=>{d.gzip(a,(a,d)=>{a?c(a):b(d)})})}decompressMessage(a){return new Promise((b,c)=>{let e=0,g=[],h=d.createGunzip();h.on("data",a=>{g.push(a),e+=a.byteLength,-1!==this.maxRecvMessageLength&&e>this.maxRecvMessageLength&&(h.destroy(),c({code:f.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),h.on("end",()=>{b(Buffer.concat(g))}),h.write(a),h.end()})}}class n extends j{constructor(a){super(),this.compressionName=a}compressMessage(a){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(a){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function o(a,b){switch(a){case"identity":return new k;case"deflate":return new l(b);case"gzip":return new m(b);default:return new n(a)}}class p extends g.BaseFilter{constructor(a,b){var c,d;super(),this.sharedFilterConfig=b,this.sendCompression=new k,this.receiveCompression=new k,this.currentCompressionAlgorithm="identity";const g=a["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(c=a["grpc.max_receive_message_length"])?c:f.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==g)if(i(g)){const a=e.CompressionAlgorithms[g],c=null==(d=b.serverSupportedEncodingHeader)?void 0:d.split(",");(!c||c.includes(a))&&(this.currentCompressionAlgorithm=a,this.sendCompression=o(this.currentCompressionAlgorithm,-1))}else h.log(f.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${g}`)}async sendMetadata(a){let b=await a;return b.set("grpc-accept-encoding","identity,deflate,gzip"),b.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?b.remove("grpc-encoding"):b.set("grpc-encoding",this.currentCompressionAlgorithm),b}receiveMetadata(a){let b=a.get("grpc-encoding");if(b.length>0){let a=b[0];"string"==typeof a&&(this.receiveCompression=o(a,this.maxReceiveMessageLength))}a.remove("grpc-encoding");let c=a.get("grpc-accept-encoding")[0];return c&&(this.sharedFilterConfig.serverSupportedEncodingHeader=c,c.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new k,this.currentCompressionAlgorithm="identity")),a.remove("grpc-accept-encoding"),a}async sendMessage(a){var b;let c,d=await a;return c=!(this.sendCompression instanceof k)&&((null!=(b=d.flags)?b:0)&2)==0,{message:await this.sendCompression.writeMessage(d.message,c),flags:d.flags}}async receiveMessage(a){return this.receiveCompression.readMessage(await a)}}c.CompressionFilter=p;class q{constructor(a,b){this.options=b,this.sharedFilterConfig={}}createFilter(){return new p(this.options,this.sharedFilterConfig)}}c.CompressionFilterFactory=q},27370,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.deadlineToString=c.getRelativeTimeout=c.getDeadlineTimeoutString=c.minDeadline=void 0,c.minDeadline=function(...a){let b=1/0;for(let c of a){let a=c instanceof Date?c.getTime():c;a<b&&(b=a)}return b};let d=[["m",1],["S",1e3],["M",6e4],["H",36e5]];c.getDeadlineTimeoutString=function(a){let b=new Date().getTime();a instanceof Date&&(a=a.getTime());let c=Math.max(a-b,0);for(let[a,b]of d){let d=c/b;if(d<1e8)return String(Math.ceil(d))+a}throw Error("Deadline is too far in the future")};let e=0x7fffffff;c.getRelativeTimeout=function(a){let b=(a instanceof Date?a.getTime():a)-new Date().getTime();return b<0?0:b>e?1/0:b},c.deadlineToString=function(a){if(a instanceof Date)return a.toISOString();{let b=new Date(a);return Number.isNaN(b.getTime())?""+a:b.toISOString()}}},16671,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.restrictControlPlaneStatusCode=void 0;let d=a.r(78996),e=[d.Status.OK,d.Status.INVALID_ARGUMENT,d.Status.NOT_FOUND,d.Status.ALREADY_EXISTS,d.Status.FAILED_PRECONDITION,d.Status.ABORTED,d.Status.OUT_OF_RANGE,d.Status.DATA_LOSS];c.restrictControlPlaneStatusCode=function(a,b){return e.includes(a)?{code:d.Status.INTERNAL,details:`Invalid status from control plane: ${a} ${d.Status[a]} ${b}`}:{code:a,details:b}}},74832,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.LoadBalancingCall=void 0;let d=a.r(33706),e=a.r(78996),f=a.r(27370),g=a.r(14694),h=a.r(50324),i=a.r(1617),j=a.r(70799),k=a.r(16671),l=a.r(25328),m="load_balancing_call";class n{constructor(a,b,c,d,e,f,g){var h,j;this.channel=a,this.callConfig=b,this.methodName=c,this.host=d,this.credentials=e,this.deadline=f,this.callNumber=g,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;const k=this.methodName.split("/");let l="";k.length>=2&&(l=k[1]);const m=null!=(j=null==(h=(0,i.splitHostPort)(this.host))?void 0:h.host)?j:"localhost";this.serviceUrl=`https://${m}/${l}`}trace(a){j.trace(e.LogVerbosity.DEBUG,m,"["+this.callNumber+"] "+a)}outputStatus(a,b){var c,d;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+a.code+' details="'+a.details+'"');let e=Object.assign(Object.assign({},a),{progress:b});null==(c=this.listener)||c.onReceiveStatus(e),null==(d=this.onCallEnded)||d.call(this,e.code)}}doPick(){var a,b;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let c=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=c.subchannel?"("+c.subchannel.getChannelzRef().id+") "+c.subchannel.getAddress():""+c.subchannel;switch(this.trace("Pick result: "+h.PickResultType[c.pickResultType]+" subchannel: "+i+" status: "+(null==(a=c.status)?void 0:a.code)+" "+(null==(b=c.status)?void 0:b.details)),c.pickResultType){case h.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var b,h,j;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let k=this.metadata.clone();if(k.merge(a),k.get("authorization").length>1&&this.outputStatus({code:e.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new g.Metadata},"PROCESSED"),c.subchannel.getConnectivityState()!==d.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+d.ConnectivityState[c.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&k.set("grpc-timeout",(0,f.getDeadlineTimeoutString)(this.deadline));try{this.child=c.subchannel.getRealSubchannel().createCall(k,this.host,this.methodName,{onReceiveMetadata:a=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(a)},onReceiveMessage:a=>{this.trace("Received message"),this.listener.onReceiveMessage(a)},onReceiveStatus:a=>{this.trace("Received status"),a.rstCode===l.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(a,"REFUSED"):this.outputStatus(a,"PROCESSED")}})}catch(a){this.trace("Failed to start call on picked subchannel "+i+" with error "+a.message),this.outputStatus({code:e.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+a.message,metadata:new g.Metadata},"NOT_STARTED");return}null==(h=(b=this.callConfig).onCommitted)||h.call(b),null==(j=c.onCallStarted)||j.call(c),this.onCallEnded=c.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:b,details:c}=(0,k.restrictControlPlaneStatusCode)("number"==typeof a.code?a.code:e.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:b,details:c,metadata:new g.Metadata},"PROCESSED")});break;case h.PickResultType.DROP:let{code:j,details:m}=(0,k.restrictControlPlaneStatusCode)(c.status.code,c.status.details);setImmediate(()=>{this.outputStatus({code:j,details:m,metadata:c.status.metadata},"DROP")});break;case h.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:b}=(0,k.restrictControlPlaneStatusCode)(c.status.code,c.status.details);setImmediate(()=>{this.outputStatus({code:a,details:b,metadata:c.status.metadata},"PROCESSED")})}break;case h.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(a,b){var c;this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),null==(c=this.child)||c.cancelWithStatus(a,b),this.outputStatus({code:a,details:b,metadata:new g.Metadata},"PROCESSED")}getPeer(){var a,b;return null!=(b=null==(a=this.child)?void 0:a.getPeer())?b:this.channel.getTarget()}start(a,b){this.trace("start called"),this.listener=b,this.metadata=a,this.doPick()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length),this.child?this.child.sendMessageWithContext(a,b):this.pendingMessage={context:a,message:b}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(a){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}c.LoadBalancingCall=n},28036,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ResolvingCall=void 0;let d=a.r(78996),e=a.r(27370),f=a.r(14694),g=a.r(70799),h=a.r(16671),i="resolving_call";class j{constructor(a,b,c,f,g,h){this.channel=a,this.method=b,this.filterStackFactory=f,this.credentials=g,this.callNumber=h,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=c.deadline,this.host=c.host,c.parentCall&&(c.flags&d.Propagate.CANCELLATION&&c.parentCall.on("cancelled",()=>{this.cancelWithStatus(d.Status.CANCELLED,"Cancelled by parent call")}),c.flags&d.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+c.parentCall.getDeadline()),this.deadline=(0,e.minDeadline)(this.deadline,c.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(a){g.trace(d.LogVerbosity.DEBUG,i,"["+this.callNumber+"] "+a)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,e.deadlineToString)(this.deadline));let a=(0,e.getRelativeTimeout)(this.deadline);if(a!==1/0){this.trace("Deadline will be reached in "+a+"ms");let b=()=>{this.cancelWithStatus(d.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};a<=0?process.nextTick(b):this.deadlineTimer=setTimeout(b,a)}}outputStatus(a){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let b=this.filterStack.receiveTrailers(a);this.trace("ended with status: code="+b.code+' details="'+b.details+'"'),this.statusWatchers.forEach(a=>a(b)),process.nextTick(()=>{var a;null==(a=this.listener)||a.onReceiveStatus(b)})}}sendMessageOnChild(a,b){if(!this.child)throw Error("sendMessageonChild called with child not populated");let c=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:b,flags:a.flags})).then(b=>{this.writeFilterPending=!1,c.sendMessageWithContext(a,b.message),this.pendingHalfClose&&c.halfClose()},a=>{this.cancelWithStatus(a.code,a.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let a=this.channel.getConfig(this.method,this.metadata);if("NONE"===a.type)return void this.channel.queueCallForConfig(this);if("ERROR"===a.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(a.error));let b=a.config;if(b.status!==d.Status.OK){let{code:a,details:c}=(0,h.restrictControlPlaneStatusCode)(b.status,"Failed to route call to method "+this.method);this.outputStatus({code:a,details:c,metadata:new f.Metadata});return}if(b.methodConfig.timeout){let a=new Date;a.setSeconds(a.getSeconds()+b.methodConfig.timeout.seconds),a.setMilliseconds(a.getMilliseconds()+b.methodConfig.timeout.nanos/1e6),this.deadline=(0,e.minDeadline)(this.deadline,a),this.runDeadlineTimer()}this.filterStackFactory.push(b.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(a=>{this.child=this.channel.createInnerCall(b,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(a,{onReceiveMetadata:a=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(a))},onReceiveMessage:a=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(a).then(a=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(a),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},a=>{this.cancelWithStatus(a.code,a.details)})},onReceiveStatus:a=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=a:this.outputStatus(a)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},a=>{this.outputStatus(a)})}reportResolverError(a){var b;(null==(b=this.metadata)?void 0:b.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(a)}cancelWithStatus(a,b){var c;this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),null==(c=this.child)||c.cancelWithStatus(a,b),this.outputStatus({code:a,details:b,metadata:new f.Metadata})}getPeer(){var a,b;return null!=(b=null==(a=this.child)?void 0:a.getPeer())?b:this.channel.getTarget()}start(a,b){this.trace("start called"),this.metadata=a.clone(),this.listener=b,this.getConfig()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length),this.child?this.sendMessageOnChild(a,b):this.pendingMessage={context:a,message:b}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(a){this.credentials=this.credentials.compose(a)}addStatusWatcher(a){this.statusWatchers.push(a)}getCallNumber(){return this.callNumber}}c.ResolvingCall=j},67848,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.RetryingCall=c.MessageBufferTracker=c.RetryThrottler=void 0;let d=a.r(78996),e=a.r(14694),f=a.r(70799),g="retrying_call";class h{constructor(a,b,c){this.maxTokens=a,this.tokenRatio=b,c?this.tokens=c.tokens*(a/c.maxTokens):this.tokens=a}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}c.RetryThrottler=h;class i{constructor(a,b){this.totalLimit=a,this.limitPerCall=b,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(a,b){var c;let d=null!=(c=this.allocatedPerCall.get(b))?c:0;return!(this.limitPerCall-d<a)&&!(this.totalLimit-this.totalAllocated<a)&&(this.allocatedPerCall.set(b,d+a),this.totalAllocated+=a,!0)}free(a,b){var c;if(this.totalAllocated<a)throw Error(`Invalid buffer allocation state: call ${b} freed ${a} > total allocated ${this.totalAllocated}`);this.totalAllocated-=a;let d=null!=(c=this.allocatedPerCall.get(b))?c:0;if(d<a)throw Error(`Invalid buffer allocation state: call ${b} freed ${a} > allocated for call ${d}`);this.allocatedPerCall.set(b,d-a)}freeAll(a){var b;let c=null!=(b=this.allocatedPerCall.get(a))?b:0;if(this.totalAllocated<c)throw Error(`Invalid buffer allocation state: call ${a} allocated ${c} > total allocated ${this.totalAllocated}`);this.totalAllocated-=c,this.allocatedPerCall.delete(a)}}c.MessageBufferTracker=i;let j="grpc-previous-rpc-attempts";class k{constructor(a,b,c,d,e,f,g,h,i){if(this.channel=a,this.callConfig=b,this.methodName=c,this.host=d,this.credentials=e,this.deadline=f,this.callNumber=g,this.bufferTracker=h,this.retryThrottler=i,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,b.methodConfig.retryPolicy){this.state="RETRY";const a=b.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(a.initialBackoff.substring(0,a.initialBackoff.length-1))}else b.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(a){f.trace(d.LogVerbosity.DEBUG,g,"["+this.callNumber+"] "+a)}reportStatus(a){this.trace("ended with status: code="+a.code+' details="'+a.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var b;null==(b=this.listener)||b.onReceiveStatus({code:a.code,details:a.details,metadata:a.metadata})})}cancelWithStatus(a,b){for(let{call:c}of(this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),this.reportStatus({code:a,details:b,metadata:new e.Metadata}),this.underlyingCalls))c.cancelWithStatus(a,b)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(a){var b;return null!=(b=this.writeBuffer[a-this.writeBufferOffset])?b:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let a=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let b=this.writeBufferOffset;b<a;b++){let a=this.getBufferEntry(b);a.allocated&&this.bufferTracker.free(a.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(a-this.writeBufferOffset),this.writeBufferOffset=a}commitCall(a){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[a].state){this.trace("Committing call ["+this.underlyingCalls[a].call.getCallNumber()+"] at index "+a),this.state="COMMITTED",this.committedCallIndex=a;for(let b=0;b<this.underlyingCalls.length;b++)b!==a&&"COMPLETED"!==this.underlyingCalls[b].state&&(this.underlyingCalls[b].state="COMPLETED",this.underlyingCalls[b].call.cancelWithStatus(d.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let a=-1,b=-1;for(let[c,d]of this.underlyingCalls.entries())"ACTIVE"===d.state&&d.nextMessageToSend>a&&(a=d.nextMessageToSend,b=c);-1===b?this.state="TRANSPARENT_ONLY":this.commitCall(b)}isStatusCodeInList(a,b){return a.some(a=>a===b||a.toString().toLowerCase()===d.Status[b].toLowerCase())}getNextRetryBackoffMs(){var a;let b=null==(a=this.callConfig)?void 0:a.methodConfig.retryPolicy;if(!b)return 0;let c=Math.random()*this.nextRetryBackoffSec*1e3,d=Number(b.maxBackoff.substring(0,b.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*b.backoffMultiplier,d),c}maybeRetryCall(a,b){let c;if("RETRY"!==this.state)return void b(!1);let d=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(d.maxAttempts,5))return void b(!1);if(null===a)c=this.getNextRetryBackoffMs();else if(a<0){this.state="TRANSPARENT_ONLY",b(!1);return}else c=a,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var a,c;"RETRY"!==this.state?b(!1):(null==(c=null==(a=this.retryThrottler)?void 0:a.canRetryCall())||c)&&(b(!0),this.attempts+=1,this.startNewAttempt())},c)}countActiveCalls(){let a=0;for(let b of this.underlyingCalls)(null==b?void 0:b.state)==="ACTIVE"&&(a+=1);return a}handleProcessedStatus(a,b,c){var d,e,f;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(b),this.reportStatus(a);break;case"HEDGING":if(this.isStatusCodeInList(null!=(d=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?d:[],a.code)){let d;if(null==(e=this.retryThrottler)||e.addCallFailed(),null===c)d=0;else if(c<0){this.state="TRANSPARENT_ONLY",this.commitCall(b),this.reportStatus(a);return}else d=c;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(b),this.reportStatus(a))},d)}else this.commitCall(b),this.reportStatus(a);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,a.code)?(null==(f=this.retryThrottler)||f.addCallFailed(),this.maybeRetryCall(c,c=>{c||(this.commitCall(b),this.reportStatus(a))})):(this.commitCall(b),this.reportStatus(a))}}getPushback(a){let b=a.get("grpc-retry-pushback-ms");if(0===b.length)return null;try{return parseInt(b[0])}catch(a){return -1}}handleChildStatus(a,b){var c;if("COMPLETED"===this.underlyingCalls[b].state)return;if(this.trace("state="+this.state+" handling status with progress "+a.progress+" from child ["+this.underlyingCalls[b].call.getCallNumber()+"] in state "+this.underlyingCalls[b].state),this.underlyingCalls[b].state="COMPLETED",a.code===d.Status.OK){null==(c=this.retryThrottler)||c.addCallSucceeded(),this.commitCall(b),this.reportStatus(a);return}if("COMMITTED"===this.state)return void this.reportStatus(a);let e=this.getPushback(a.metadata);switch(a.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(a,b,e):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(b),this.reportStatus(a);break;case"PROCESSED":this.handleProcessedStatus(a,b,e)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let a=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(a.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var a,b,c;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let d=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(d.maxAttempts,5))return;let e=null!=(a=d.hedgingDelay)?a:"0s",f=Number(e.substring(0,e.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*f),null==(c=(b=this.hedgingTimer).unref)||c.call(b)}startNewAttempt(){let a=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+a.getCallNumber()+"] for attempt "+this.attempts);let b=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:a,nextMessageToSend:0});let c=this.attempts-1,d=this.initialMetadata.clone();c>0&&d.set(j,`${c}`);let e=!1;a.start(d,{onReceiveMetadata:d=>{this.trace("Received metadata from child ["+a.getCallNumber()+"]"),this.commitCall(b),e=!0,c>0&&d.set(j,`${c}`),"ACTIVE"===this.underlyingCalls[b].state&&this.listener.onReceiveMetadata(d)},onReceiveMessage:c=>{this.trace("Received message from child ["+a.getCallNumber()+"]"),this.commitCall(b),"ACTIVE"===this.underlyingCalls[b].state&&this.listener.onReceiveMessage(c)},onReceiveStatus:d=>{this.trace("Received status from child ["+a.getCallNumber()+"]"),!e&&c>0&&d.metadata.set(j,`${c}`),this.handleChildStatus(d,b)}}),this.sendNextChildMessage(b),this.readStarted&&a.startRead()}start(a,b){this.trace("start called"),this.listener=b,this.initialMetadata=a,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(a){var b,c;let d=this.underlyingCalls[a],e=d.nextMessageToSend;null==(c=(b=this.getBufferEntry(e)).callback)||c.call(b),this.clearSentMessages(),d.nextMessageToSend+=1,this.sendNextChildMessage(a)}sendNextChildMessage(a){let b=this.underlyingCalls[a];if("COMPLETED"!==b.state&&this.getBufferEntry(b.nextMessageToSend)){let c=this.getBufferEntry(b.nextMessageToSend);switch(c.entryType){case"MESSAGE":b.call.sendMessageWithContext({callback:b=>{this.handleChildWriteCompleted(a)}},c.message.message);break;case"HALF_CLOSE":b.nextMessageToSend+=1,b.call.halfClose()}}}sendMessageWithContext(a,b){var c;this.trace("write() called with message of length "+b.length);let d={message:b,flags:a.flags},e=this.getNextBufferIndex(),f={entryType:"MESSAGE",message:d,allocated:this.bufferTracker.allocate(b.length,this.callNumber)};if(this.writeBuffer.push(f),f.allocated)for(let[d,f]of(null==(c=a.callback)||c.call(a),this.underlyingCalls.entries()))"ACTIVE"===f.state&&f.nextMessageToSend===e&&f.call.sendMessageWithContext({callback:a=>{this.handleChildWriteCompleted(d)}},b);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let c=this.underlyingCalls[this.committedCallIndex];f.callback=a.callback,"ACTIVE"===c.state&&c.nextMessageToSend===e&&c.call.sendMessageWithContext({callback:a=>{this.handleChildWriteCompleted(this.committedCallIndex)}},b)}}startRead(){for(let a of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==a?void 0:a.state)==="ACTIVE"&&a.call.startRead()}halfClose(){this.trace("halfClose called");let a=this.getNextBufferIndex();for(let b of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==b?void 0:b.state)==="ACTIVE"&&b.nextMessageToSend===a&&(b.nextMessageToSend+=1,b.call.halfClose())}setCredentials(a){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}c.RetryingCall=k},66833,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BaseSubchannelWrapper=void 0;class d{constructor(a){this.child=a}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(a){this.child.addConnectivityStateListener(a)}removeConnectivityStateListener(a){this.child.removeConnectivityStateListener(a)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(a){this.child.throttleKeepalive(a)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(a){return this.getRealSubchannel()===a.getRealSubchannel()}}c.BaseSubchannelWrapper=d},84018,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InternalChannel=void 0;let d=a.r(72859),e=a.r(85697),f=a.r(3609),g=a.r(50324),h=a.r(78996),i=a.r(4026),j=a.r(69154),k=a.r(40142),l=a.r(70799),m=a.r(27876),n=a.r(1617),o=a.r(33706),p=a.r(77748),q=a.r(74832),r=a.r(27370),s=a.r(28036),t=a.r(22316),u=a.r(16671),v=a.r(67848),w=a.r(66833),x=0x7fffffff,y=1e3,z=18e5,A=new Map,B=0x1000000,C=1048576;class D extends w.BaseSubchannelWrapper{constructor(a,b){super(a),this.channel=b,this.refCount=0,this.subchannelStateListener=(a,c,d,e)=>{b.throttleKeepalive(e)},a.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class E{constructor(a,b,c){var q,r,s,t,w,E,F,G;if(this.credentials=b,this.options=c,this.connectivityState=o.ConnectivityState.IDLE,this.currentPicker=new g.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new p.ChannelzCallTracker,this.childrenTracker=new p.ChannelzChildrenTracker,"string"!=typeof a)throw TypeError("Channel target must be a string");if(!(b instanceof d.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(c&&"object"!=typeof c)throw TypeError("Channel options must be an object");this.originalTarget=a;const H=(0,n.parseUri)(a);if(null===H)throw Error(`Could not parse target name "${a}"`);const I=(0,k.mapUriDefaultScheme)(H);if(null===I)throw Error(`Could not find a default scheme for target name "${a}"`);this.callRefTimer=setInterval(()=>{},x),null==(r=(q=this.callRefTimer).unref)||r.call(q),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new p.ChannelzTrace,this.channelzRef=(0,p.registerChannelzChannel)(a,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,k.getDefaultAuthority)(I);const J=(0,m.mapProxyName)(I,c);this.target=J.target,this.options=Object.assign({},this.options,J.extraOptions),this.subchannelPool=(0,f.getSubchannelPool)((null!=(s=c["grpc.use_local_subchannel_pool"])?s:0)===0),this.retryBufferTracker=new v.MessageBufferTracker(null!=(t=c["grpc.retry_buffer_size"])?t:B,null!=(w=c["grpc.per_rpc_retry_buffer_size"])?w:C),this.keepaliveTime=null!=(E=c["grpc.keepalive_time_ms"])?E:-1,this.idleTimeoutMs=Math.max(null!=(F=c["grpc.client_idle_timeout_ms"])?F:z,y);const K={createSubchannel:(a,b)=>{let c=this.subchannelPool.getOrCreateSubchannel(this.target,a,Object.assign({},this.options,b),this.credentials);c.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",c.getChannelzRef());let d=new D(c,this);return this.wrappedSubchannels.add(d),d},updateState:(a,b)=>{this.currentPicker=b;let c=this.pickQueue.slice();for(let a of(this.pickQueue=[],c.length>0&&this.callRefTimerUnref(),c))a.doPick();this.updateState(a)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:a=>{this.channelzEnabled&&this.childrenTracker.refChild(a)},removeChannelzChild:a=>{this.channelzEnabled&&this.childrenTracker.unrefChild(a)}};this.resolvingLoadBalancer=new e.ResolvingLoadBalancer(this.target,K,c,(a,b)=>{a.retryThrottling?A.set(this.getTarget(),new v.RetryThrottler(a.retryThrottling.maxTokens,a.retryThrottling.tokenRatio,A.get(this.getTarget()))):A.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=b,this.currentResolutionError=null,process.nextTick(()=>{let a=this.configSelectionQueue;for(let b of(this.configSelectionQueue=[],a.length>0&&this.callRefTimerUnref(),a))b.getConfig()})},a=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+a.code+' and details "'+a.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,u.restrictControlPlaneStatusCode)(a.code,a.details)),{metadata:a.metadata}));let b=this.configSelectionQueue;for(let c of(this.configSelectionQueue=[],b.length>0&&this.callRefTimerUnref(),b))c.reportResolverError(a)}),this.filterStackFactory=new i.FilterStackFactory([new j.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(c,void 0,2));const L=Error();(0,l.trace)(h.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(G=L.stack)?void 0:G.substring(L.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(a,b){(0,l.trace)(null!=b?b:h.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,n.uriToString)(this.target)+" "+a)}callRefTimerRef(){var a,b,c,d;(null==(b=(a=this.callRefTimer).hasRef)?void 0:b.call(a))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(d=(c=this.callRefTimer).ref)||d.call(c))}callRefTimerUnref(){var a,b;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(b=(a=this.callRefTimer).unref)||b.call(a))}removeConnectivityStateWatcher(a){let b=this.connectivityStateWatchers.findIndex(b=>b===a);b>=0&&this.connectivityStateWatchers.splice(b,1)}updateState(a){for(let b of((0,l.trace)(h.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,n.uriToString)(this.target)+" "+o.ConnectivityState[this.connectivityState]+" -> "+o.ConnectivityState[a]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+o.ConnectivityState[a]),this.connectivityState=a,this.connectivityStateWatchers.slice()))a!==b.currentState&&(b.timer&&clearTimeout(b.timer),this.removeConnectivityStateWatcher(b),b.callback());a!==o.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(a){if(a>this.keepaliveTime)for(let b of(this.keepaliveTime=a,this.wrappedSubchannels))b.throttleKeepalive(a)}removeWrappedSubchannel(a){this.wrappedSubchannels.delete(a)}doPick(a,b){return this.currentPicker.pick({metadata:a,extraPickInfo:b})}queueCallForPick(a){this.pickQueue.push(a),this.callRefTimerRef()}getConfig(a,b){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(a,b)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(a){this.configSelectionQueue.push(a),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(o.ConnectivityState.IDLE),this.currentPicker=new g.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(a){var b,c;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let a=new Date().valueOf()-this.lastActivityTimestamp.valueOf();a>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-a)},a),null==(c=(b=this.idleTimer).unref)||c.call(b)}maybeStartIdleTimer(){this.connectivityState===o.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(a){this.channelzEnabled&&(a.code===h.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+f+'] method="'+b+'"'),new q.LoadBalancingCall(this,a,b,c,d,e,f)}createRetryingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();return this.trace("createRetryingCall ["+f+'] method="'+b+'"'),new v.RetryingCall(this,a,b,c,d,e,f,this.retryBufferTracker,A.get(this.getTarget()))}createInnerCall(a,b,c,d,e){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(a,b,c,d,e):this.createRetryingCall(a,b,c,d,e)}createResolvingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();this.trace("createResolvingCall ["+f+'] method="'+a+'", deadline='+(0,r.deadlineToString)(b));let g={deadline:b,flags:null!=e?e:h.Propagate.DEFAULTS,host:null!=c?c:this.defaultAuthority,parentCall:d},i=new s.ResolvingCall(this,a,g,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),f);return this.onCallStart(),i.addStatusWatcher(a=>{this.onCallEnd(a)}),i}close(){this.resolvingLoadBalancer.destroy(),this.updateState(o.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,p.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,n.uriToString)(this.target)}getConnectivityState(a){let b=this.connectivityState;return a&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),b}watchConnectivityState(a,b,c){if(this.connectivityState===o.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let d=null;if(b!==1/0){let a=b instanceof Date?b:new Date(b),f=new Date;if(b===-1/0||a<=f)return void process.nextTick(c,Error("Deadline passed without connectivity state change"));d=setTimeout(()=>{this.removeConnectivityStateWatcher(e),c(Error("Deadline passed without connectivity state change"))},a.getTime()-f.getTime())}let e={currentState:a,callback:c,timer:d};this.connectivityStateWatchers.push(e)}getChannelzRef(){return this.channelzRef}createCall(a,b,c,d,e){if("string"!=typeof a)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof b||b instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===o.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(a,b,c,d,e)}}c.InternalChannel=E},18400,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChannelImplementation=void 0;let d=a.r(72859),e=a.r(84018);class f{constructor(a,b,c){if("string"!=typeof a)throw TypeError("Channel target must be a string");if(!(b instanceof d.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(c&&"object"!=typeof c)throw TypeError("Channel options must be an object");this.internalChannel=new e.InternalChannel(a,b,c)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(a){return this.internalChannel.getConnectivityState(a)}watchConnectivityState(a,b,c){this.internalChannel.watchConnectivityState(a,b,c)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(a,b,c,d,e){if("string"!=typeof a)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof b||b instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(a,b,c,d,e)}}c.ChannelImplementation=f},82654,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2ServerCallStream=c.ServerDuplexStreamImpl=c.ServerWritableStreamImpl=c.ServerReadableStreamImpl=c.ServerUnaryCallImpl=void 0;let d=a.r(27699),e=a.r(25328),f=a.r(88947),g=a.r(6461),h=a.r(78996),i=a.r(14694),j=a.r(64869),k=a.r(70799),l=a.r(30246),m="server_call";function n(a){k.trace(h.LogVerbosity.DEBUG,m,a)}let o="grpc-message",p="grpc-status",q="grpc-timeout",r=/(\d{1,8})\s*([HMSmun])/,s={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},t={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},u={[e.constants.HTTP2_HEADER_STATUS]:e.constants.HTTP_STATUS_OK,[e.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},v={waitForTrailers:!0};class w extends d.EventEmitter{constructor(a,b,c){super(),this.call=a,this.metadata=b,this.request=c,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}c.ServerUnaryCallImpl=w;class x extends f.Readable{constructor(a,b,c,d){super({objectMode:!0}),this.call=a,this.metadata=b,this.deserialize=c,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,d)}_read(a){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}c.ServerReadableStreamImpl=x;class y extends f.Writable{constructor(a,b,c,d){super({objectMode:!0}),this.call=a,this.metadata=b,this.serialize=c,this.request=d,this.cancelled=!1,this.trailingMetadata=new i.Metadata,this.call.setupSurfaceCall(this),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(a,b,c){try{let b=this.call.serializeMessage(a);if(!this.call.write(b))return void this.call.once("drain",c)}catch(a){this.emit("error",{details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL})}c()}_final(a){this.call.sendStatus({code:h.Status.OK,details:"OK",metadata:this.trailingMetadata}),a(null)}end(a){return a&&(this.trailingMetadata=a),super.end()}}c.ServerWritableStreamImpl=y;class z extends f.Duplex{constructor(a,b,c,d,e){super({objectMode:!0}),this.call=a,this.metadata=b,this.serialize=c,this.deserialize=d,this.cancelled=!1,this.trailingMetadata=new i.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,e),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(a){return a&&(this.trailingMetadata=a),super.end()}}c.ServerDuplexStreamImpl=z,z.prototype._read=x.prototype._read,z.prototype._write=y.prototype._write,z.prototype._final=y.prototype._final;class A extends d.EventEmitter{constructor(a,b,c){super(),this.stream=a,this.handler=b,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=h.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=h.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",a=>{}),this.stream.once("close",()=>{var a;n("Request to method "+(null==(a=this.handler)?void 0:a.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:h.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in c&&(this.maxSendMessageSize=c["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in c&&(this.maxReceiveMessageSize=c["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(a,b){let c=a.subarray(5);if("identity"===b)return c;if("deflate"!==b&&"gzip"!==b)return Promise.reject({code:h.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${b}"`});{let a;return a="deflate"===b?g.createInflate():g.createGunzip(),new Promise((b,d)=>{let e=0,f=[];a.on("data",b=>{f.push(b),e+=b.byteLength,-1!==this.maxReceiveMessageSize&&e>this.maxReceiveMessageSize&&(a.destroy(),d({code:h.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),a.on("end",()=>{b(Buffer.concat(f))}),a.write(c),a.end()})}}sendMetadata(a){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let b=a?a.toHttp2Headers():null,c=Object.assign(Object.assign(Object.assign({},u),t),b);this.stream.respond(c,v)}receiveMetadata(a){let b=i.Metadata.fromHttp2Headers(a);k.isTracerEnabled(m)&&n("Request to "+this.handler.path+" received headers "+JSON.stringify(b.toJSON()));let c=b.get(q);if(c.length>0){let a=c[0].toString().match(r);if(null===a){let a=Error("Invalid deadline");return a.code=h.Status.OUT_OF_RANGE,this.sendError(a),b}let d=a[1]*s[a[2]]|0,e=new Date;this.deadline=e.setMilliseconds(e.getMilliseconds()+d),this.deadlineTimer=setTimeout(B,d,this),b.remove(q)}return b.remove(e.constants.HTTP2_HEADER_ACCEPT_ENCODING),b.remove(e.constants.HTTP2_HEADER_TE),b.remove(e.constants.HTTP2_HEADER_CONTENT_TYPE),b.remove("grpc-accept-encoding"),b}receiveUnaryMessage(a){return new Promise((b,c)=>{let{stream:d}=this,e=0,f=this,g=[],i=this.maxReceiveMessageSize;function j(a){if(e+=a.byteLength,-1!==i&&e>i){d.removeListener("data",j),d.removeListener("end",k),d.removeListener("error",k),c({code:h.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${e} vs. ${i})`});return}g.push(a)}function k(i){if(d.removeListener("data",j),d.removeListener("end",k),d.removeListener("error",k),void 0!==i)return void c({code:h.Status.INTERNAL,details:i.message});if(0===e)return void c({code:h.Status.INTERNAL,details:"received empty unary message"});f.emit("receiveMessage");let l=Buffer.concat(g,e),m=1===l.readUInt8(0)?a:"identity",n=f.getDecompressedMessage(l,m);Buffer.isBuffer(n)?b(f.deserializeMessageWithInternalError(n)):n.then(a=>b(f.deserializeMessageWithInternalError(a)),b=>c(b.code?b:{code:h.Status.INTERNAL,details:`Received "grpc-encoding" header "${a}" but ${a} decompression failed`}))}this.stream.on("data",j),this.stream.on("end",k),this.stream.on("error",k)})}async deserializeMessageWithInternalError(a){try{return this.deserializeMessage(a)}catch(a){throw{details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL}}}serializeMessage(a){let b=this.handler.serialize(a),c=b.byteLength,d=Buffer.allocUnsafe(c+5);return d.writeUInt8(0,0),d.writeUInt32BE(c,1),b.copy(d,5),d}deserializeMessage(a){return this.handler.deserialize(a)}async sendUnaryMessage(a,b,c,d){if(!this.checkCancelled()){if(void 0===c&&(c=null),a){!Object.prototype.hasOwnProperty.call(a,"metadata")&&c&&(a.metadata=c),this.sendError(a);return}try{let a=this.serializeMessage(b);this.write(a),this.sendStatus({code:h.Status.OK,details:"OK",metadata:c})}catch(a){this.sendError({details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL})}}}sendStatus(a){var b,c;if(this.emit("callEnd",a.code),this.emit("streamEnd",a.code===h.Status.OK),!this.checkCancelled())if(n("Request to method "+(null==(b=this.handler)?void 0:b.path)+" ended with status code: "+h.Status[a.code]+" details: "+a.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var b;let c=Object.assign({[p]:a.code,[o]:encodeURI(a.details)},null==(b=a.metadata)?void 0:b.toHttp2Headers());this.stream.sendTrailers(c),this.statusSent=!0}),this.stream.end());else{let b=Object.assign(Object.assign({[p]:a.code,[o]:encodeURI(a.details)},u),null==(c=a.metadata)?void 0:c.toHttp2Headers());this.stream.respond(b,{endStream:!0}),this.statusSent=!0}}sendError(a){let b={code:h.Status.UNKNOWN,details:"message"in a?a.message:"Unknown Error",metadata:"metadata"in a&&void 0!==a.metadata?a.metadata:null};"code"in a&&"number"==typeof a.code&&Number.isInteger(a.code)&&(b.code=a.code,"details"in a&&"string"==typeof a.details&&(b.details=a.details)),this.sendStatus(b)}write(a){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&a.length>this.maxSendMessageSize?void this.sendError({code:h.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${a.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(a))}resume(){this.stream.resume()}setupSurfaceCall(a){this.once("cancelled",b=>{a.cancelled=!0,a.emit("cancelled",b)}),this.once("callEnd",b=>a.emit("callEnd",b))}setupReadable(a,b){let c=new j.StreamDecoder(this.maxReceiveMessageSize),d=!1,e=!1,f=!1,g=async()=>{f||!d||e||(f=!0,await this.pushOrBufferMessage(a,null))};this.stream.on("data",async d=>{let f;try{f=c.write(d)}catch(a){this.sendError({code:h.Status.RESOURCE_EXHAUSTED,details:a.message});return}for(let c of(e=!0,this.stream.pause(),f)){let d;this.emit("receiveMessage");let e=1===c.readUInt8(0)?b:"identity";try{d=await this.getDecompressedMessage(c,e)}catch(a){this.sendError(a);return}if(!d)return;await this.pushOrBufferMessage(a,d)}e=!1,this.stream.resume(),await g()}),this.stream.once("end",async()=>{d=!0,await g()})}consumeUnpushedMessages(a){for(this.canPush=!0;this.messagesToPush.length>0;){let b=this.messagesToPush.shift(),c=a.push(b);if(null===b||!1===c){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(a,b){this.isPushPending?this.bufferedMessages.push(b):await this.pushMessage(a,b)}async pushMessage(a,b){if(null===b){n("Received end of stream"),this.canPush?a.push(null):this.messagesToPush.push(null);return}n("Received message of length "+b.length),this.isPushPending=!0;try{let c=await this.deserializeMessage(b);this.canPush?a.push(c)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(c)}catch(c){this.bufferedMessages.length=0;let b=(0,l.getErrorCode)(c);(null===b||b<h.Status.OK||b>h.Status.UNAUTHENTICATED)&&(b=h.Status.INTERNAL),a.emit("error",{details:(0,l.getErrorMessage)(c),code:b})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(a,this.bufferedMessages.shift())}getPeer(){var a;let b=null==(a=this.stream.session)?void 0:a.socket;return null!=b&&b.remoteAddress?b.remotePort?`${b.remoteAddress}:${b.remotePort}`:b.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function B(a){let b=Error("Deadline exceeded");b.code=h.Status.DEADLINE_EXCEEDED,a.sendError(b),a.cancelled=!0,a.emit("cancelled","deadline")}c.Http2ServerCallStream=A},963,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ServerCredentials=void 0;let d=a.r(1280);class e{static createInsecure(){return new f}static createSsl(a,b,c=!1){if(null!==a&&!Buffer.isBuffer(a))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(b))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof c)throw TypeError("checkClientCertificate must be a boolean");let e=[],f=[];for(let a=0;a<b.length;a++){let c=b[a];if(null===c||"object"!=typeof c)throw TypeError(`keyCertPair[${a}] must be an object`);if(!Buffer.isBuffer(c.private_key))throw TypeError(`keyCertPair[${a}].private_key must be a Buffer`);if(!Buffer.isBuffer(c.cert_chain))throw TypeError(`keyCertPair[${a}].cert_chain must be a Buffer`);e.push(c.cert_chain),f.push(c.private_key)}return new g({ca:a||(0,d.getDefaultRootsData)()||void 0,cert:e,key:f,requestCert:c,ciphers:d.CIPHER_SUITES})}}c.ServerCredentials=e;class f extends e{_isSecure(){return!1}_getSettings(){return null}}class g extends e{constructor(a){super(),this.options=a}_isSecure(){return!0}_getSettings(){return this.options}}},52402,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Server=void 0;let d=a.r(25328),e=a.r(78996),f=a.r(82654),g=a.r(963),h=a.r(40142),i=a.r(70799),j=a.r(5367),k=a.r(1617),l=a.r(77748),m=0x7fffffff,n=0x7fffffff,o=2e4,{HTTP2_HEADER_PATH:p}=d.constants,q="server";function r(){}function s(a){return{code:e.Status.UNIMPLEMENTED,details:`The server does not implement the method ${a}`}}function t(a,b){let c=s(b);switch(a){case"unary":return(a,b)=>{b(c,null)};case"clientStream":return(a,b)=>{b(c,null)};case"serverStream":return a=>{a.emit("error",c)};case"bidi":return a=>{a.emit("error",c)};default:throw Error(`Invalid handlerType ${a}`)}}class u{constructor(a){var b,c,d,e;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new l.ChannelzTrace,this.callTracker=new l.ChannelzCallTracker,this.listenerChildrenTracker=new l.ChannelzChildrenTracker,this.sessionChildrenTracker=new l.ChannelzChildrenTracker,this.options=null!=a?a:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,l.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(b=this.options["grpc.max_connection_age_ms"])?b:m,this.maxConnectionAgeGraceMs=null!=(c=this.options["grpc.max_connection_age_grace_ms"])?c:m,this.keepaliveTimeMs=null!=(d=this.options["grpc.keepalive_time_ms"])?d:n,this.keepaliveTimeoutMs=null!=(e=this.options["grpc.keepalive_timeout_ms"])?e:o,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(a){return()=>{var b,c,d;let e,f=this.sessions.get(a),g=a.socket,h=g.remoteAddress?(0,j.stringToSubchannelAddress)(g.remoteAddress,g.remotePort):null,i=g.localAddress?(0,j.stringToSubchannelAddress)(g.localAddress,g.localPort):null;if(a.encrypted){let a=g,c=a.getCipher(),d=a.getCertificate(),f=a.getPeerCertificate();e={cipherSuiteStandardName:null!=(b=c.standardName)?b:null,cipherSuiteOtherName:c.standardName?null:c.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else e=null;return{remoteAddress:h,localAddress:i,security:e,remoteName:null,streamsStarted:f.streamTracker.callsStarted,streamsSucceeded:f.streamTracker.callsSucceeded,streamsFailed:f.streamTracker.callsFailed,messagesSent:f.messagesSent,messagesReceived:f.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:f.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:f.lastMessageSentTimestamp,lastMessageReceivedTimestamp:f.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(c=a.state.localWindowSize)?c:null,remoteFlowControlWindow:null!=(d=a.state.remoteWindowSize)?d:null}}}trace(a){i.trace(e.LogVerbosity.DEBUG,q,"("+this.channelzRef.id+") "+a)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(a,b){if(null===a||"object"!=typeof a||null===b||"object"!=typeof b)throw Error("addService() requires two objects as arguments");let c=Object.keys(a);if(0===c.length)throw Error("Cannot add an empty service to a server");c.forEach(c=>{let d,e,f=a[c];d=f.requestStream?f.responseStream?"bidi":"clientStream":f.responseStream?"serverStream":"unary";let g=b[c];if(void 0===g&&"string"==typeof f.originalName&&(g=b[f.originalName]),e=void 0!==g?g.bind(b):t(d,c),!1===this.register(f.path,e,f.responseSerialize,f.requestDeserialize,d))throw Error(`Method handler for ${f.path} already provided.`)})}removeService(a){if(null===a||"object"!=typeof a)throw Error("removeService() requires object as argument");Object.keys(a).forEach(b=>{let c=a[b];this.unregister(c.path)})}bind(a,b){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(a,b,c){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof a)throw TypeError("port must be a string");if(null===b||!(b instanceof g.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof c)throw TypeError("callback must be a function");let f=(0,k.parseUri)(a);if(null===f)throw Error(`Could not parse port "${a}"`);let m=(0,h.mapUriDefaultScheme)(f);if(null===m)throw Error(`Could not get a default scheme for port "${a}"`);let n={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?n.maxSessionMemory=this.options["grpc-node.max_session_memory"]:n.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(n.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let o=(a,b)=>{process.nextTick(()=>c(a,b))},p=()=>{let a;if(b._isSecure()){let c=Object.assign(n,b._getSettings());c.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(a=d.createSecureServer(c)).on("secureConnection",a=>{a.on("error",a=>{this.trace("An incoming TLS connection closed with error: "+a.message)})})}else a=d.createServer(n);return a.setTimeout(0,r),this._setupHandlers(a),a},q=(a,b,c)=>0===a.length?Promise.resolve({port:b,count:c}):Promise.all(a.map(a=>{let c;this.trace("Attempting to bind "+(0,j.subchannelAddressToString)(a)),c=(0,j.isTcpSubchannelAddress)(a)?{host:a.host,port:b}:a;let d=p();return new Promise((e,f)=>{let g=b=>{this.trace("Failed to bind "+(0,j.subchannelAddressToString)(a)+" with error "+b.message),e(b)};d.once("error",g),d.listen(c,()=>{let a;if(this.shutdown){d.close(),e(Error("bindAsync failed because server is shutdown"));return}let c=d.address();a="string"==typeof c?{path:c}:{host:c.address,port:c.port};let f=(0,l.registerChannelzSocket)((0,j.subchannelAddressToString)(a),()=>({localAddress:a,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(f),this.http2ServerList.push({server:d,channelzRef:f}),this.trace("Successfully bound "+(0,j.subchannelAddressToString)(a)),e("port"in a?a.port:b),d.removeListener("error",g)})})})).then(a=>{let d=0;for(let c of a)if("number"==typeof c&&(d+=1,c!==b))throw Error("Invalid state: multiple port numbers added from single address");return{port:b,count:d+c}}),s=a=>{if(0===a.length)return Promise.resolve({port:0,count:0});let b=a[0],c=p();return new Promise((d,e)=>{let f=c=>{this.trace("Failed to bind "+(0,j.subchannelAddressToString)(b)+" with error "+c.message),d(s(a.slice(1)))};c.once("error",f),c.listen(b,()=>{if(this.shutdown){c.close(),d({port:0,count:0});return}let b=c.address(),e={host:b.address,port:b.port},g=(0,l.registerChannelzSocket)((0,j.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:c,channelzRef:g}),this.trace("Successfully bound "+(0,j.subchannelAddressToString)(e)),d(q(a.slice(1),b.port,1)),c.removeListener("error",f)})})},t={onSuccessfulResolution:(b,c,d)=>{let f;(t.onSuccessfulResolution=()=>{},this.shutdown&&o(Error("bindAsync failed because server is shutdown"),0),0===b.length)?o(Error(`No addresses resolved for port ${a}`),0):(f=(0,j.isTcpSubchannelAddress)(b[0])?0===b[0].port?s(b):q(b,b[0].port,0):q(b,1,0)).then(a=>{if(0===a.count){let a=`No address added out of total ${b.length} resolved`;i.log(e.LogVerbosity.ERROR,a),o(Error(a),0)}else a.count<b.length&&i.log(e.LogVerbosity.INFO,`WARNING Only ${a.count} addresses added out of total ${b.length} resolved`),o(null,a.port)},a=>{let c=`No address added out of total ${b.length} resolved`;i.log(e.LogVerbosity.ERROR,c),o(Error(c),0)})},onError:a=>{o(Error(a.details),0)}};(0,h.createResolver)(m,t,this.options).updateResolution()}forceShutdown(){for(let{server:a,channelzRef:b}of this.http2ServerList)a.listening&&a.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(b),(0,l.unregisterChannelzRef)(b))});this.started=!1,this.shutdown=!0,this.sessions.forEach((a,b)=>{b.destroy(d.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,l.unregisterChannelzRef)(this.channelzRef)}register(a,b,c,d,e){return!this.handlers.has(a)&&(this.handlers.set(a,{func:b,serialize:c,deserialize:d,type:e,path:a}),!0)}unregister(a){return this.handlers.delete(a)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:a})=>!0!==a.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(a){let b=b=>{this.channelzEnabled&&(0,l.unregisterChannelzRef)(this.channelzRef),a(b)},c=0;function d(){0==--c&&b()}for(let{server:a,channelzRef:b}of(this.started=!1,this.shutdown=!0,this.http2ServerList))a.listening&&(c++,a.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(b),(0,l.unregisterChannelzRef)(b)),d()}));this.sessions.forEach((a,b)=>{b.closed||(c+=1,b.close(d))}),0===c&&b()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(a,b){let c=b[d.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof c&&!!c.startsWith("application/grpc")||(a.respond({[d.constants.HTTP2_HEADER_STATUS]:d.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(a){this.trace("Received call to method "+a+" at address "+this.serverAddressString);let b=this.handlers.get(a);return void 0===b?(this.trace("No handler registered for method "+a+". Sending UNIMPLEMENTED status."),null):b}_respondWithError(a,b,c=null){let d=new f.Http2ServerCallStream(b,null,this.options);void 0===a.code&&(a.code=e.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed()),d.sendError(a)}_channelzHandler(a,b){let c=this.sessions.get(a.session);if(this.callTracker.addCallStarted(),null==c||c.streamTracker.addCallStarted(),!this._verifyContentType(a,b)){this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed();return}let d=b[p],g=this._retrieveHandler(d);if(!g)return void this._respondWithError(s(d),a,c);let h=new f.Http2ServerCallStream(a,g,this.options);h.once("callEnd",a=>{a===e.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),c&&(h.once("streamEnd",a=>{a?c.streamTracker.addCallSucceeded():c.streamTracker.addCallFailed()}),h.on("sendMessage",()=>{c.messagesSent+=1,c.lastMessageSentTimestamp=new Date}),h.on("receiveMessage",()=>{c.messagesReceived+=1,c.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(h,g,b)||(this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed(),h.sendError({code:e.Status.INTERNAL,details:`Unknown handler type: ${g.type}`}))}_streamHandler(a,b){if(!0!==this._verifyContentType(a,b))return;let c=b[p],d=this._retrieveHandler(c);if(!d)return void this._respondWithError(s(c),a,null);let g=new f.Http2ServerCallStream(a,d,this.options);this._runHandlerForCall(g,d,b)||g.sendError({code:e.Status.INTERNAL,details:`Unknown handler type: ${d.type}`})}_runHandlerForCall(a,b,c){var d;let e=a.receiveMetadata(c),f=null!=(d=e.get("grpc-encoding")[0])?d:"identity";e.remove("grpc-encoding");let{type:g}=b;if("unary"===g)v(a,b,e,f);else if("clientStream"===g)w(a,b,e,f);else if("serverStream"===g)x(a,b,e,f);else{if("bidi"!==g)return!1;y(a,b,e,f)}return!0}_setupHandlers(a){if(null===a)return;let b=a.address(),c="null";b&&(c="string"==typeof b?b:b.address+":"+b.port),this.serverAddressString=c;let e=this.channelzEnabled?this._channelzHandler:this._streamHandler;a.on("stream",e.bind(this)),a.on("session",a=>{var b,c,e,f,g;if(!this.started)return void a.destroy();let h=(0,l.registerChannelzSocket)(null!=(b=a.socket.remoteAddress)?b:"unknown",this.getChannelzSessionInfoGetter(a),this.channelzEnabled),i={ref:h,streamTracker:new l.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(a,i);let j=a.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+j),this.sessionChildrenTracker.refChild(h));let k=null,n=null,o=!1;if(this.maxConnectionAgeMs!==m){let b=this.maxConnectionAgeMs/10,f=Math.random()*b*2-b;k=null==(e=(c=setTimeout(()=>{var b,c;o=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+j);try{a.goaway(d.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(b){a.destroy();return}a.close(),this.maxConnectionAgeGraceMs!==m&&(n=null==(c=(b=setTimeout(()=>{a.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:c.call(b))},this.maxConnectionAgeMs+f)).unref)?void 0:e.call(c)}let p=null==(g=(f=setInterval(()=>{var b,c;let d=null==(c=(b=setTimeout(()=>{o=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+j),a.close()},this.keepaliveTimeoutMs)).unref)?void 0:c.call(b);try{a.ping((a,b,c)=>{clearTimeout(d)})}catch(b){a.destroy()}},this.keepaliveTimeMs)).unref)?void 0:g.call(f);a.on("close",()=>{this.channelzEnabled&&(o||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+j),this.sessionChildrenTracker.unrefChild(h),(0,l.unregisterChannelzRef)(h)),k&&clearTimeout(k),n&&clearTimeout(n),p&&clearTimeout(p),this.sessions.delete(a)})})}}async function v(a,b,c,d){try{let e=await a.receiveUnaryMessage(d);if(void 0===e||a.cancelled)return;let g=new f.ServerUnaryCallImpl(a,c,e);b.func(g,(b,c,d,e)=>{a.sendUnaryMessage(b,c,d,e)})}catch(b){a.sendError(b)}}function w(a,b,c,d){let e=new f.ServerReadableStreamImpl(a,c,b.deserialize,d);function g(b,c,d,f){e.destroy(),a.sendUnaryMessage(b,c,d,f)}a.cancelled||(e.on("error",g),b.func(e,g))}async function x(a,b,c,d){try{let e=await a.receiveUnaryMessage(d);if(void 0===e||a.cancelled)return;let g=new f.ServerWritableStreamImpl(a,c,b.serialize,e);b.func(g)}catch(b){a.sendError(b)}}function y(a,b,c,d){let e=new f.ServerDuplexStreamImpl(a,c,b.serialize,b.deserialize,d);a.cancelled||b.func(e)}c.Server=u},5349,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.StatusBuilder=void 0;class d{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(a){return this.code=a,this}withDetails(a){return this.details=a,this}withMetadata(a){return this.metadata=a,this}build(){let a={};return null!==this.code&&(a.code=this.code),null!==this.details&&(a.details=this.details),null!==this.metadata&&(a.metadata=this.metadata),a}}c.StatusBuilder=d},56842,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.isDuration=c.durationToMs=c.msToDuration=void 0,c.msToDuration=function(a){return{seconds:a/1e3|0,nanos:a%1e3*1e6|0}},c.durationToMs=function(a){return 1e3*a.seconds+a.nanos/1e6|0},c.isDuration=function(a){return"number"==typeof a.seconds&&"number"==typeof a.nanos}},9711,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.OutlierDetectionLoadBalancer=c.OutlierDetectionLoadBalancingConfig=void 0;let e=a.r(33706),f=a.r(78996),g=a.r(56842),h=a.r(8080),i=a.r(75424),j=a.r(39355),k=a.r(50324),l=a.r(5367),m=a.r(66833),n=a.r(70799),o="outlier_detection";function p(a){n.trace(f.LogVerbosity.DEBUG,o,a)}let q="outlier_detection",r=(null!=(d=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?d:"true")==="true",s={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},t={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function u(a,b,c,d){if(b in a&&typeof a[b]!==c){let e=d?`${d}.${b}`:b;throw Error(`outlier detection config ${e} parse error: expected ${c}, got ${typeof a[b]}`)}}function v(a,b,c){let d=c?`${c}.${b}`:b;if(b in a){if(!(0,g.isDuration)(a[b]))throw Error(`outlier detection config ${d} parse error: expected Duration, got ${typeof a[b]}`);if(!(a[b].seconds>=0&&a[b].seconds<=315576e6&&a[b].nanos>=0&&a[b].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${d} parse error: values out of range for non-negative Duaration`)}}function w(a,b,c){let d=c?`${c}.${b}`:b;if(u(a,b,"number",c),b in a&&!(a[b]>=0&&a[b]<=100))throw Error(`outlier detection config ${d} parse error: value out of range for percentage (0-100)`)}class x{constructor(a,b,c,d,e,f,g){if(this.childPolicy=g,g.length>0&&"pick_first"===g[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=a?a:1e4,this.baseEjectionTimeMs=null!=b?b:3e4,this.maxEjectionTimeMs=null!=c?c:3e5,this.maxEjectionPercent=null!=d?d:10,this.successRateEjection=e?Object.assign(Object.assign({},s),e):null,this.failurePercentageEjection=f?Object.assign(Object.assign({},t),f):null}getLoadBalancerName(){return q}toJsonObject(){return{interval:(0,g.msToDuration)(this.intervalMs),base_ejection_time:(0,g.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,g.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(a=>a.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(a){return new x(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,a)}static createFromJson(a){var b;if(v(a,"interval"),v(a,"base_ejection_time"),v(a,"max_ejection_time"),w(a,"max_ejection_percent"),"success_rate_ejection"in a){if("object"!=typeof a.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");u(a.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),w(a.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),u(a.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),u(a.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in a){if("object"!=typeof a.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");w(a.failure_percentage_ejection,"threshold","failure_percentage_ejection"),w(a.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),u(a.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),u(a.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new x(a.interval?(0,g.durationToMs)(a.interval):null,a.base_ejection_time?(0,g.durationToMs)(a.base_ejection_time):null,a.max_ejection_time?(0,g.durationToMs)(a.max_ejection_time):null,null!=(b=a.max_ejection_percent)?b:null,a.success_rate_ejection,a.failure_percentage_ejection,a.child_policy.map(i.validateLoadBalancingConfig))}}c.OutlierDetectionLoadBalancingConfig=x;class y extends m.BaseSubchannelWrapper{constructor(a,b){super(a),this.mapEntry=b,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=a.getConnectivityState(),a.addConnectivityStateListener((a,b,c,d)=>{if(this.childSubchannelState=c,!this.ejected)for(let a of this.stateListeners)a(this,b,c,d)})}getConnectivityState(){return this.ejected?e.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(a){this.stateListeners.push(a)}removeConnectivityStateListener(a){let b=this.stateListeners.indexOf(a);b>-1&&this.stateListeners.splice(b,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let a=this.mapEntry.subchannelWrappers.indexOf(this);a>=0&&this.mapEntry.subchannelWrappers.splice(a,1)}}eject(){for(let a of(this.ejected=!0,this.stateListeners))a(this,this.childSubchannelState,e.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let a of(this.ejected=!1,this.stateListeners))a(this,e.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function z(){return{success:0,failure:0}}class A{constructor(){this.activeBucket=z(),this.inactiveBucket=z()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=z()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class B{constructor(a,b){this.wrappedPicker=a,this.countCalls=b}pick(a){let b=this.wrappedPicker.pick(a);if(b.pickResultType!==k.PickResultType.COMPLETE)return b;{let a=b.subchannel,c=a.getMapEntry();if(!c)return Object.assign(Object.assign({},b),{subchannel:a.getWrappedSubchannel()});{let d=b.onCallEnded;return this.countCalls&&(d=a=>{var d;a===f.Status.OK?c.counter.addSuccess():c.counter.addFailure(),null==(d=b.onCallEnded)||d.call(b,a)}),Object.assign(Object.assign({},b),{subchannel:a.getWrappedSubchannel(),onCallEnded:d})}}}}class C{constructor(a){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new j.ChildLoadBalancerHandler((0,h.createChildChannelControlHelper)(a,{createSubchannel:(b,c)=>{let d=a.createSubchannel(b,c),e=this.addressMap.get((0,l.subchannelAddressToString)(b)),f=new y(d,e);return(null==e?void 0:e.currentEjectionTimestamp)!==null&&f.eject(),null==e||e.subchannelWrappers.push(f),f},updateState:(b,c)=>{b===e.ConnectivityState.READY?a.updateState(b,new B(c,this.isCountingEnabled())):a.updateState(b,c)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let a=0;for(let b of this.addressMap.values())null!==b.currentEjectionTimestamp&&(a+=1);return 100*a/this.addressMap.size}runSuccessRateCheck(a){if(!this.latestConfig)return;let b=this.latestConfig.getSuccessRateEjectionConfig();if(!b)return;p("Running success rate check");let c=b.request_volume,d=0,e=[];for(let[a,b]of this.addressMap){let f=b.counter.getLastSuccesses(),g=b.counter.getLastFailures();p("Stats for "+a+": successes="+f+" failures="+g+" targetRequestVolume="+c),f+g>=c&&(d+=1,e.push(f/(f+g)))}if(p("Found "+d+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+e+"]"),d<b.minimum_hosts)return;let f=e.reduce((a,b)=>a+b)/e.length,g=0;for(let a of e){let b=a-f;g+=b*b}let h=Math.sqrt(g/e.length),i=f-h*(b.stdev_factor/1e3);for(let[d,e]of(p("stdev="+h+" ejectionThreshold="+i),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let f=e.counter.getLastSuccesses(),g=e.counter.getLastFailures();if(f+g<c)continue;let h=f/(f+g);if(p("Checking candidate "+d+" successRate="+h),h<i){let c=100*Math.random();p("Candidate "+d+" randomNumber="+c+" enforcement_percentage="+b.enforcement_percentage),c<b.enforcement_percentage&&(p("Ejecting candidate "+d),this.eject(e,a))}}}runFailurePercentageCheck(a){if(!this.latestConfig)return;let b=this.latestConfig.getFailurePercentageEjectionConfig();if(!b)return;p("Running failure percentage check. threshold="+b.threshold+" request volume threshold="+b.request_volume);let c=0;for(let a of this.addressMap.values())a.counter.getLastSuccesses()+a.counter.getLastFailures()>=b.request_volume&&(c+=1);if(!(c<b.minimum_hosts))for(let[c,d]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let e=d.counter.getLastSuccesses(),f=d.counter.getLastFailures();if((p("Candidate successes="+e+" failures="+f),!(e+f<b.request_volume))&&100*f/(f+e)>b.threshold){let e=100*Math.random();p("Candidate "+c+" randomNumber="+e+" enforcement_percentage="+b.enforcement_percentage),e<b.enforcement_percentage&&(p("Ejecting candidate "+c),this.eject(d,a))}}}eject(a,b){for(let b of(a.currentEjectionTimestamp=new Date,a.ejectionTimeMultiplier+=1,a.subchannelWrappers))b.eject()}uneject(a){for(let b of(a.currentEjectionTimestamp=null,a.subchannelWrappers))b.uneject()}switchAllBuckets(){for(let a of this.addressMap.values())a.counter.switchBuckets()}startTimer(a){var b,c;this.ejectionTimer=setTimeout(()=>this.runChecks(),a),null==(c=(b=this.ejectionTimer).unref)||c.call(b)}runChecks(){let a=new Date;if(p("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[b,c]of(this.timerStartTime=a,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(a),this.runFailurePercentageCheck(a),this.addressMap.entries()))if(null===c.currentEjectionTimestamp)c.ejectionTimeMultiplier>0&&(c.ejectionTimeMultiplier-=1);else{let a=this.latestConfig.getBaseEjectionTimeMs(),d=this.latestConfig.getMaxEjectionTimeMs(),e=new Date(c.currentEjectionTimestamp.getTime());e.setMilliseconds(e.getMilliseconds()+Math.min(a*c.ejectionTimeMultiplier,Math.max(a,d))),e<new Date&&(p("Unejecting "+b),this.uneject(c))}}updateAddressList(a,b,c){if(!(b instanceof x))return;let d=new Set;for(let b of a)d.add((0,l.subchannelAddressToString)(b));for(let a of d)this.addressMap.has(a)||(p("Adding map entry for "+a),this.addressMap.set(a,{counter:new A,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let a of this.addressMap.keys())d.has(a)||(p("Removing map entry for "+a),this.addressMap.delete(a));let e=(0,i.getFirstUsableConfig)(b.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(a,e,c),b.getSuccessRateEjectionConfig()||b.getFailurePercentageEjectionConfig())if(this.timerStartTime){p("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let a=b.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(a)}else p("Starting new timer"),this.timerStartTime=new Date,this.startTimer(b.getIntervalMs()),this.switchAllBuckets();else for(let a of(p("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(a),a.ejectionTimeMultiplier=0;this.latestConfig=b}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return q}}c.OutlierDetectionLoadBalancer=C,c.setup=function(){r&&(0,h.registerLoadBalancerType)(q,C,x)}},8080,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.OutlierDetectionLoadBalancingConfig=c.BaseSubchannelWrapper=c.registerAdminService=c.FilterStackFactory=c.BaseFilter=c.PickResultType=c.QueuePicker=c.UnavailablePicker=c.ChildLoadBalancerHandler=c.subchannelAddressToString=c.validateLoadBalancingConfig=c.getFirstUsableConfig=c.registerLoadBalancerType=c.createChildChannelControlHelper=c.BackoffTimeout=c.durationToMs=c.uriToString=c.createResolver=c.registerResolver=c.log=c.trace=void 0;var d=a.r(70799);Object.defineProperty(c,"trace",{enumerable:!0,get:function(){return d.trace}}),Object.defineProperty(c,"log",{enumerable:!0,get:function(){return d.log}});var e=a.r(40142);Object.defineProperty(c,"registerResolver",{enumerable:!0,get:function(){return e.registerResolver}}),Object.defineProperty(c,"createResolver",{enumerable:!0,get:function(){return e.createResolver}});var f=a.r(1617);Object.defineProperty(c,"uriToString",{enumerable:!0,get:function(){return f.uriToString}});var g=a.r(56842);Object.defineProperty(c,"durationToMs",{enumerable:!0,get:function(){return g.durationToMs}});var h=a.r(51982);Object.defineProperty(c,"BackoffTimeout",{enumerable:!0,get:function(){return h.BackoffTimeout}});var i=a.r(75424);Object.defineProperty(c,"createChildChannelControlHelper",{enumerable:!0,get:function(){return i.createChildChannelControlHelper}}),Object.defineProperty(c,"registerLoadBalancerType",{enumerable:!0,get:function(){return i.registerLoadBalancerType}}),Object.defineProperty(c,"getFirstUsableConfig",{enumerable:!0,get:function(){return i.getFirstUsableConfig}}),Object.defineProperty(c,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return i.validateLoadBalancingConfig}});var j=a.r(5367);Object.defineProperty(c,"subchannelAddressToString",{enumerable:!0,get:function(){return j.subchannelAddressToString}});var k=a.r(39355);Object.defineProperty(c,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return k.ChildLoadBalancerHandler}});var l=a.r(50324);Object.defineProperty(c,"UnavailablePicker",{enumerable:!0,get:function(){return l.UnavailablePicker}}),Object.defineProperty(c,"QueuePicker",{enumerable:!0,get:function(){return l.QueuePicker}}),Object.defineProperty(c,"PickResultType",{enumerable:!0,get:function(){return l.PickResultType}});var m=a.r(14120);Object.defineProperty(c,"BaseFilter",{enumerable:!0,get:function(){return m.BaseFilter}});var n=a.r(4026);Object.defineProperty(c,"FilterStackFactory",{enumerable:!0,get:function(){return n.FilterStackFactory}});var o=a.r(15410);Object.defineProperty(c,"registerAdminService",{enumerable:!0,get:function(){return o.registerAdminService}});var p=a.r(66833);Object.defineProperty(c,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return p.BaseSubchannelWrapper}});var q=a.r(9711);Object.defineProperty(c,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return q.OutlierDetectionLoadBalancingConfig}})},92845,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=void 0;let d=a.r(40142);class e{constructor(a,b,c){let d;this.listener=b,this.addresses=[],this.hasReturnedResult=!1,d=""===a.authority?"/"+a.path:a.path,this.addresses=[{path:d}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(a){return"localhost"}}c.setup=function(){(0,d.registerResolver)("unix",e)}},78805,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=void 0;let d=a.r(4446),e=a.r(78996),f=a.r(14694),g=a.r(40142),h=a.r(1617),i=a.r(70799),j="ip_resolver";function k(a){i.trace(e.LogVerbosity.DEBUG,j,a)}let l="ipv4",m="ipv6",n=443;class o{constructor(a,b,c){var g;this.listener=b,this.addresses=[],this.error=null,this.hasReturnedResult=!1,k("Resolver constructed for target "+(0,h.uriToString)(a));const i=[];if(a.scheme!==l&&a.scheme!==m){this.error={code:e.Status.UNAVAILABLE,details:`Unrecognized scheme ${a.scheme} in IP resolver`,metadata:new f.Metadata};return}for(const b of a.path.split(",")){const c=(0,h.splitHostPort)(b);if(null===c||a.scheme===l&&!(0,d.isIPv4)(c.host)||a.scheme===m&&!(0,d.isIPv6)(c.host)){this.error={code:e.Status.UNAVAILABLE,details:`Failed to parse ${a.scheme} address ${b}`,metadata:new f.Metadata};return}i.push({host:c.host,port:null!=(g=c.port)?g:n})}this.addresses=i,k("Parsed "+a.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(a){return a.path.split(",")[0]}}c.setup=function(){(0,g.registerResolver)(l,o),(0,g.registerResolver)(m,o)}},87899,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.PickFirstLoadBalancer=c.shuffled=c.PickFirstLoadBalancingConfig=void 0;let d=a.r(75424),e=a.r(33706),f=a.r(50324),g=a.r(70799),h=a.r(78996),i="pick_first";function j(a){g.trace(h.LogVerbosity.DEBUG,i,a)}let k="pick_first",l=250;class m{constructor(a){this.shuffleAddressList=a}getLoadBalancerName(){return k}toJsonObject(){return{[k]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(a){if("shuffleAddressList"in a&&"boolean"!=typeof a.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new m(!0===a.shuffleAddressList)}}c.PickFirstLoadBalancingConfig=m;class n{constructor(a){this.subchannel=a}pick(a){return{pickResultType:f.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function o(a){let b=a.slice();for(let a=b.length-1;a>1;a--){let c=Math.floor(Math.random()*(a+1)),d=b[a];b[a]=b[c],b[c]=d}return b}c.shuffled=o;class p{constructor(a){this.channelControlHelper=a,this.children=[],this.currentState=e.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(a,b,c,d,e)=>{this.onSubchannelStateUpdate(a,b,c,e)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(a=>a.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(e.ConnectivityState.READY,new n(this.currentPick)):0===this.children.length?this.updateState(e.ConnectivityState.IDLE,new f.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(e.ConnectivityState.TRANSIENT_FAILURE,new f.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(e.ConnectivityState.CONNECTING,new f.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:a}of(this.stickyTransientFailureMode=!0,this.children))a.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let a=this.currentPick;this.currentPick=null,a.unref(),a.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(a.getChannelzRef())}}onSubchannelStateUpdate(a,b,c,d){var f;if(null==(f=this.currentPick)?void 0:f.realSubchannelEquals(a)){c!==e.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[b,f]of this.children.entries())if(a.realSubchannelEquals(f.subchannel)){c===e.ConnectivityState.READY&&this.pickSubchannel(f.subchannel),c===e.ConnectivityState.TRANSIENT_FAILURE&&(f.hasReportedTransientFailure=!0,d&&(this.lastError=d),this.maybeEnterStickyTransientFailureMode(),b===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(b+1)),f.subchannel.startConnecting();return}}startNextSubchannelConnecting(a){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[b,c]of this.children.entries())if(b>=a){let a=c.subchannel.getConnectivityState();if(a===e.ConnectivityState.IDLE||a===e.ConnectivityState.CONNECTING)return void this.startConnecting(b)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(a){var b,c;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=a,this.children[a].subchannel.getConnectivityState()===e.ConnectivityState.IDLE&&(j("Start connecting to subchannel with address "+this.children[a].subchannel.getAddress()),process.nextTick(()=>{var b;null==(b=this.children[a])||b.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(c=(b=setTimeout(()=>{this.startNextSubchannelConnecting(a+1)},l)).unref)?void 0:c.call(b)}pickSubchannel(a){this.currentPick&&a.realSubchannelEquals(this.currentPick)||(j("Pick subchannel with address "+a.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=a,a.ref(),this.channelControlHelper.addChannelzChild(a.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(a,b){j(e.ConnectivityState[this.currentState]+" -> "+e.ConnectivityState[a]),this.currentState=a,this.channelControlHelper.updateState(a,b)}resetSubchannelList(){for(let a of this.children)this.currentPick&&a.subchannel.realSubchannelEquals(this.currentPick)||a.subchannel.removeConnectivityStateListener(this.subchannelStateListener),a.subchannel.unref(),this.channelControlHelper.removeChannelzChild(a.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(a){let b=a.map(a=>({subchannel:this.channelControlHelper.createSubchannel(a,{}),hasReportedTransientFailure:!1}));for(let{subchannel:a}of b)a.ref(),this.channelControlHelper.addChannelzChild(a.getChannelzRef());for(let{subchannel:a}of(this.resetSubchannelList(),this.children=b,this.children))if(a.addConnectivityStateListener(this.subchannelStateListener),a.getConnectivityState()===e.ConnectivityState.READY)return void this.pickSubchannel(a);for(let a of this.children)a.subchannel.getConnectivityState()===e.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(a,b){b instanceof m&&(b.getShuffleAddressList()&&(a=o(a)),this.latestAddressList=a,this.connectToAddressList(a))}exitIdle(){this.currentState===e.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return k}}c.PickFirstLoadBalancer=p,c.setup=function(){(0,d.registerLoadBalancerType)(k,p,m),(0,d.registerDefaultLoadBalancerType)(k)}},73153,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.RoundRobinLoadBalancer=void 0;let d=a.r(75424),e=a.r(33706),f=a.r(50324),g=a.r(5367),h=a.r(70799),i=a.r(78996),j="round_robin";function k(a){h.trace(i.LogVerbosity.DEBUG,j,a)}let l="round_robin";class m{getLoadBalancerName(){return l}toJsonObject(){return{[l]:{}}}static createFromJson(a){return new m}}class n{constructor(a,b=0){this.subchannelList=a,this.nextIndex=b}pick(a){let b=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:f.PickResultType.COMPLETE,subchannel:b,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class o{constructor(a){this.channelControlHelper=a,this.subchannels=[],this.currentState=e.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(a,b,c,d,f)=>{this.calculateAndUpdateState(),(c===e.ConnectivityState.TRANSIENT_FAILURE||c===e.ConnectivityState.IDLE)&&(f&&(this.lastError=f),this.channelControlHelper.requestReresolution(),a.startConnecting())}}countSubchannelsWithState(a){return this.subchannels.filter(b=>b.getConnectivityState()===a).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(e.ConnectivityState.READY)>0){let a=this.subchannels.filter(a=>a.getConnectivityState()===e.ConnectivityState.READY),b=0;null!==this.currentReadyPicker&&(b=a.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(b=0),this.updateState(e.ConnectivityState.READY,new n(a,b))}else this.countSubchannelsWithState(e.ConnectivityState.CONNECTING)>0?this.updateState(e.ConnectivityState.CONNECTING,new f.QueuePicker(this)):this.countSubchannelsWithState(e.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(e.ConnectivityState.TRANSIENT_FAILURE,new f.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(e.ConnectivityState.IDLE,new f.QueuePicker(this))}updateState(a,b){k(e.ConnectivityState[this.currentState]+" -> "+e.ConnectivityState[a]),a===e.ConnectivityState.READY?this.currentReadyPicker=b:this.currentReadyPicker=null,this.currentState=a,this.channelControlHelper.updateState(a,b)}resetSubchannelList(){for(let a of this.subchannels)a.removeConnectivityStateListener(this.subchannelStateListener),a.unref(),this.channelControlHelper.removeChannelzChild(a.getChannelzRef());this.subchannels=[]}updateAddressList(a,b){for(let b of(this.resetSubchannelList(),k("Connect to address list "+a.map(a=>(0,g.subchannelAddressToString)(a))),this.subchannels=a.map(a=>this.channelControlHelper.createSubchannel(a,{})),this.subchannels)){b.ref(),b.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(b.getChannelzRef());let a=b.getConnectivityState();(a===e.ConnectivityState.IDLE||a===e.ConnectivityState.TRANSIENT_FAILURE)&&b.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let a of this.subchannels)a.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return l}}c.RoundRobinLoadBalancer=o,c.setup=function(){(0,d.registerLoadBalancerType)(l,o,m)}},9784,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.experimental=c.addAdminServicesToServer=c.getChannelzHandlers=c.getChannelzServiceDefinition=c.InterceptorConfigurationError=c.InterceptingCall=c.RequesterBuilder=c.ListenerBuilder=c.StatusBuilder=c.getClientChannel=c.ServerCredentials=c.Server=c.setLogVerbosity=c.setLogger=c.load=c.loadObject=c.CallCredentials=c.ChannelCredentials=c.waitForClientReady=c.closeClient=c.Channel=c.makeGenericClientConstructor=c.makeClientConstructor=c.loadPackageDefinition=c.Client=c.compressionAlgorithms=c.propagate=c.connectivityState=c.status=c.logVerbosity=c.Metadata=c.credentials=void 0;let d=a.r(80749);Object.defineProperty(c,"CallCredentials",{enumerable:!0,get:function(){return d.CallCredentials}});let e=a.r(18400);Object.defineProperty(c,"Channel",{enumerable:!0,get:function(){return e.ChannelImplementation}});let f=a.r(98422);Object.defineProperty(c,"compressionAlgorithms",{enumerable:!0,get:function(){return f.CompressionAlgorithms}});let g=a.r(33706);Object.defineProperty(c,"connectivityState",{enumerable:!0,get:function(){return g.ConnectivityState}});let h=a.r(72859);Object.defineProperty(c,"ChannelCredentials",{enumerable:!0,get:function(){return h.ChannelCredentials}});let i=a.r(40830);Object.defineProperty(c,"Client",{enumerable:!0,get:function(){return i.Client}});let j=a.r(78996);Object.defineProperty(c,"logVerbosity",{enumerable:!0,get:function(){return j.LogVerbosity}}),Object.defineProperty(c,"status",{enumerable:!0,get:function(){return j.Status}}),Object.defineProperty(c,"propagate",{enumerable:!0,get:function(){return j.Propagate}});let k=a.r(70799),l=a.r(48988);Object.defineProperty(c,"loadPackageDefinition",{enumerable:!0,get:function(){return l.loadPackageDefinition}}),Object.defineProperty(c,"makeClientConstructor",{enumerable:!0,get:function(){return l.makeClientConstructor}}),Object.defineProperty(c,"makeGenericClientConstructor",{enumerable:!0,get:function(){return l.makeClientConstructor}});let m=a.r(14694);Object.defineProperty(c,"Metadata",{enumerable:!0,get:function(){return m.Metadata}});let n=a.r(52402);Object.defineProperty(c,"Server",{enumerable:!0,get:function(){return n.Server}});let o=a.r(963);Object.defineProperty(c,"ServerCredentials",{enumerable:!0,get:function(){return o.ServerCredentials}});let p=a.r(5349);Object.defineProperty(c,"StatusBuilder",{enumerable:!0,get:function(){return p.StatusBuilder}}),c.credentials={combineChannelCredentials:(a,...b)=>b.reduce((a,b)=>a.compose(b),a),combineCallCredentials:(a,...b)=>b.reduce((a,b)=>a.compose(b),a),createInsecure:h.ChannelCredentials.createInsecure,createSsl:h.ChannelCredentials.createSsl,createFromSecureContext:h.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:d.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:d.CallCredentials.createFromGoogleCredential,createEmpty:d.CallCredentials.createEmpty},c.closeClient=a=>a.close(),c.waitForClientReady=(a,b,c)=>a.waitForReady(b,c),c.loadObject=(a,b)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},c.load=(a,b,c)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},c.setLogger=a=>{k.setLogger(a)},c.setLogVerbosity=a=>{k.setLoggerVerbosity(a)},c.getClientChannel=a=>i.Client.prototype.getChannel.call(a);var q=a.r(23924);Object.defineProperty(c,"ListenerBuilder",{enumerable:!0,get:function(){return q.ListenerBuilder}}),Object.defineProperty(c,"RequesterBuilder",{enumerable:!0,get:function(){return q.RequesterBuilder}}),Object.defineProperty(c,"InterceptingCall",{enumerable:!0,get:function(){return q.InterceptingCall}}),Object.defineProperty(c,"InterceptorConfigurationError",{enumerable:!0,get:function(){return q.InterceptorConfigurationError}});var r=a.r(77748);Object.defineProperty(c,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return r.getChannelzServiceDefinition}}),Object.defineProperty(c,"getChannelzHandlers",{enumerable:!0,get:function(){return r.getChannelzHandlers}});var s=a.r(15410);Object.defineProperty(c,"addAdminServicesToServer",{enumerable:!0,get:function(){return s.addAdminServicesToServer}}),c.experimental=a.r(8080);let t=a.r(16511),u=a.r(92845),v=a.r(78805),w=a.r(87899),x=a.r(73153),y=a.r(9711),z=a.r(77748);(()=>{t.setup(),u.setup(),v.setup(),w.setup(),x.setup(),y.setup(),z.setup()})()},37119,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l,m;var n,o,p,q,r,s,t=a.i(78182),u=a.i(66033),v=a.i(45636);let w=()=>void 0,x={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},y=function(a,b){if(!a)throw z(b)},z=function(a){return Error("Firebase Database ("+x.SDK_VERSION+") INTERNAL ASSERT FAILED: "+a)},A=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:((64512&e)==55296&&d+1<a.length&&(64512&a.charCodeAt(d+1))==56320?(e=65536+((1023&e)<<10)+(1023&a.charCodeAt(++d)),b[c++]=e>>18|240,b[c++]=e>>12&63|128):b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},B=function(a){let b=[],c=0,d=0;for(;c<a.length;){let e=a[c++];if(e<128)b[d++]=String.fromCharCode(e);else if(e>191&&e<224){let f=a[c++];b[d++]=String.fromCharCode((31&e)<<6|63&f)}else if(e>239&&e<365){let f=((7&e)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;b[d++]=String.fromCharCode(55296+(f>>10)),b[d++]=String.fromCharCode(56320+(1023&f))}else{let f=a[c++],g=a[c++];b[d++]=String.fromCharCode((15&e)<<12|(63&f)<<6|63&g)}}return b.join("")},C={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(a,b){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();let c=b?this.byteToCharMapWebSafe_:this.byteToCharMap_,d=[];for(let b=0;b<a.length;b+=3){let e=a[b],f=b+1<a.length,g=f?a[b+1]:0,h=b+2<a.length,i=h?a[b+2]:0,j=e>>2,k=(3&e)<<4|g>>4,l=(15&g)<<2|i>>6,m=63&i;!h&&(m=64,f||(l=64)),d.push(c[j],c[k],c[l],c[m])}return d.join("")},encodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?btoa(a):this.encodeByteArray(A(a),b)},decodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?atob(a):B(this.decodeStringToByteArray(a,b))},decodeStringToByteArray(a,b){this.init_();let c=b?this.charToByteMapWebSafe_:this.charToByteMap_,d=[];for(let b=0;b<a.length;){let e=c[a.charAt(b++)],f=b<a.length?c[a.charAt(b)]:0,g=++b<a.length?c[a.charAt(b)]:64,h=++b<a.length?c[a.charAt(b)]:64;if(++b,null==e||null==f||null==g||null==h)throw new D;let i=e<<2|f>>4;if(d.push(i),64!==g){let a=f<<4&240|g>>2;if(d.push(a),64!==h){let a=g<<6&192|h;d.push(a)}}}return d},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class D extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let E=function(a){let b=A(a);return C.encodeByteArray(b,!0)},F=function(a){return E(a).replace(/\./g,"")},G=function(a){try{return C.decodeString(a,!0)}catch(a){console.error("base64Decode failed: ",a)}return null};function H(a){return I(void 0,a)}function I(a,b){if(!(b instanceof Object))return b;switch(b.constructor){case Date:return new Date(b.getTime());case Object:void 0===a&&(a={});break;case Array:a=[];break;default:return b}for(let c in b)b.hasOwnProperty(c)&&J(c)&&(a[c]=I(a[c],b[c]));return a}function J(a){return"__proto__"!==a}function K(){return"u">typeof self?self:a.g}let L=()=>K().__FIREBASE_DEFAULTS__,M=()=>{if("u"<typeof process||void 0===process.env)return;let a=process.env.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)},N=()=>{let a;if("u"<typeof document)return;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}let b=a&&G(a[1]);return b&&JSON.parse(b)},O=()=>{try{return w()||L()||M()||N()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},P=a=>O()?.emulatorHosts?.[a],Q=a=>{let b=P(a);if(!b)return;let c=b.lastIndexOf(":");if(c<=0||c+1===b.length)throw Error(`Invalid host ${b} with no separate hostname and port!`);let d=parseInt(b.substring(c+1),10);return"["===b[0]?[b.substring(1,c-1),d]:[b.substring(0,c),d]},R=()=>O()?.config;class S{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}wrapCallback(a){return(b,c)=>{b?this.reject(b):this.resolve(c),"function"==typeof a&&(this.promise.catch(()=>{}),1===a.length?a(b):a(b,c))}}}function T(a){try{return(a.startsWith("http://")||a.startsWith("https://")?new URL(a).hostname:a).endsWith(".cloudworkstations.dev")}catch{return!1}}async function U(a){return(await fetch(a,{credentials:"include"})).ok}function V(a,b){if(a.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let c={alg:"none",type:"JWT"},d=b||"demo-project",e=a.iat||0,f=a.sub||a.user_id;if(!f)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let g={iss:`https://securetoken.google.com/${d}`,aud:d,iat:e,exp:e+3600,auth_time:e,sub:f,user_id:f,firebase:{sign_in_provider:"custom",identities:{}},...a},h="";return[F(JSON.stringify(c)),F(JSON.stringify(g)),h].join(".")}function W(a,b){}function X(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Y(){return!1}function Z(){let b=O()?.forceEnvironment;if("node"===b)return!0;if("browser"===b)return!1;try{return"[object process]"===Object.prototype.toString.call(a.g.process)}catch(a){return!1}}function $(){return _()}function _(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function aa(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function ab(){return!0===x.NODE_CLIENT||!0===x.NODE_ADMIN}function ac(){return!Z()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ad(){return!Z()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function ae(){try{return"object"==typeof indexedDB}catch(a){return!1}}function af(){return new Promise((a,b)=>{try{let c=!0,d="validate-browser-context-for-indexeddb-analytics-module",e=self.indexedDB.open(d);e.onsuccess=()=>{e.result.close(),c||self.indexedDB.deleteDatabase(d),a(!0)},e.onupgradeneeded=()=>{c=!1},e.onerror=()=>{b(e.error?.message||"")}}catch(a){b(a)}})}let ag="FirebaseError";class ah extends Error{constructor(a,b,c){super(b),this.code=a,this.customData=c,this.name=ag,Object.setPrototypeOf(this,ah.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ai.prototype.create)}}class ai{constructor(a,b,c){this.service=a,this.serviceName=b,this.errors=c}create(a,...b){let c=b[0]||{},d=`${this.service}/${a}`,e=this.errors[a],f=e?aj(e,c):"Error",g=`${this.serviceName}: ${f} (${d}).`;return new ah(d,g,c)}}function aj(a,b){return a.replace(ak,(a,c)=>{let d=b[c];return null!=d?String(d):`<${c}?>`})}let ak=/\{\$([^}]+)}/g;function al(a){return JSON.parse(a)}function am(a){return JSON.stringify(a)}let an=function(a){let b={},c={},d={},e="";try{let f=a.split(".");b=al(G(f[0])||""),c=al(G(f[1])||""),e=f[2],d=c.d||{},delete c.d}catch(a){}return{header:b,claims:c,data:d,signature:e}},ao=function(a){let b=an(a).claims;return!!b&&"object"==typeof b&&b.hasOwnProperty("iat")},ap=function(a){let b=an(a).claims;return"object"==typeof b&&!0===b.admin};function aq(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function ar(a,b){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:void 0}function as(a){for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}function at(a,b,c){let d={};for(let e in a)Object.prototype.hasOwnProperty.call(a,e)&&(d[e]=b.call(c,a[e],e,a));return d}function au(a,b){if(a===b)return!0;let c=Object.keys(a),d=Object.keys(b);for(let e of c){if(!d.includes(e))return!1;let c=a[e],f=b[e];if(av(c)&&av(f)){if(!au(c,f))return!1}else if(c!==f)return!1}for(let a of d)if(!c.includes(a))return!1;return!0}function av(a){return null!==a&&"object"==typeof a}function aw(a){let b=[];for(let[c,d]of Object.entries(a))Array.isArray(d)?d.forEach(a=>{b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}):b.push(encodeURIComponent(c)+"="+encodeURIComponent(d));return b.length?"&"+b.join("&"):""}class ax{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let a=1;a<this.blockSize;++a)this.pad_[a]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(a,b){let c,d;b||(b=0);let e=this.W_;if("string"==typeof a)for(let c=0;c<16;c++)e[c]=a.charCodeAt(b)<<24|a.charCodeAt(b+1)<<16|a.charCodeAt(b+2)<<8|a.charCodeAt(b+3),b+=4;else for(let c=0;c<16;c++)e[c]=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3],b+=4;for(let a=16;a<80;a++){let b=e[a-3]^e[a-8]^e[a-14]^e[a-16];e[a]=(b<<1|b>>>31)&0xffffffff}let f=this.chain_[0],g=this.chain_[1],h=this.chain_[2],i=this.chain_[3],j=this.chain_[4];for(let a=0;a<80;a++){a<40?a<20?(c=i^g&(h^i),d=0x5a827999):(c=g^h^i,d=0x6ed9eba1):a<60?(c=g&h|i&(g|h),d=0x8f1bbcdc):(c=g^h^i,d=0xca62c1d6);let b=(f<<5|f>>>27)+c+j+d+e[a]|0;j=i,i=h,h=(g<<30|g>>>2)&0xffffffff,g=f,f=b}this.chain_[0]=this.chain_[0]+f|0,this.chain_[1]=this.chain_[1]+g|0,this.chain_[2]=this.chain_[2]+h|0,this.chain_[3]=this.chain_[3]+i|0,this.chain_[4]=this.chain_[4]+j|0}update(a,b){if(null==a)return;void 0===b&&(b=a.length);let c=b-this.blockSize,d=0,e=this.buf_,f=this.inbuf_;for(;d<b;){if(0===f)for(;d<=c;)this.compress_(a,d),d+=this.blockSize;if("string"==typeof a){for(;d<b;)if(e[f]=a.charCodeAt(d),++f,++d,f===this.blockSize){this.compress_(e),f=0;break}}else for(;d<b;)if(e[f]=a[d],++f,++d,f===this.blockSize){this.compress_(e),f=0;break}}this.inbuf_=f,this.total_+=b}digest(){let a=[],b=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let a=this.blockSize-1;a>=56;a--)this.buf_[a]=255&b,b/=256;this.compress_(this.buf_);let c=0;for(let b=0;b<5;b++)for(let d=24;d>=0;d-=8)a[c]=this.chain_[b]>>d&255,++c;return a}}function ay(a,b){return`${a} failed: ${b} argument `}let az=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);if(e>=55296&&e<=56319){let b=e-55296;y(++d<a.length,"Surrogate pair missing trail surrogate."),e=65536+(b<<10)+(a.charCodeAt(d)-56320)}e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:(e<65536?b[c++]=e>>12|224:(b[c++]=e>>18|240,b[c++]=e>>12&63|128),b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},aA=function(a){let b=0;for(let c=0;c<a.length;c++){let d=a.charCodeAt(c);d<128?b++:d<2048?b+=2:d>=55296&&d<=56319?(b+=4,c++):b+=3}return b};function aB(a){return a&&a._delegate?a._delegate:a}x.NODE_CLIENT=!0;let aC=[];!function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"}(n||(n={}));let aD={debug:n.DEBUG,verbose:n.VERBOSE,info:n.INFO,warn:n.WARN,error:n.ERROR,silent:n.SILENT},aE=n.INFO,aF={[n.DEBUG]:"log",[n.VERBOSE]:"log",[n.INFO]:"info",[n.WARN]:"warn",[n.ERROR]:"error"},aG=(a,b,...c)=>{if(b<a.logLevel)return;let d=new Date().toISOString(),e=aF[b];if(e)console[e](`[${d}]  ${a.name}:`,...c);else throw Error(`Attempted to log a message with an invalid logType (value: ${b})`)};class aH{constructor(a){this.name=a,this._logLevel=aE,this._logHandler=aG,this._userLogHandler=null,aC.push(this)}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in n))throw TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel="string"==typeof a?aD[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if("function"!=typeof a)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,n.DEBUG,...a),this._logHandler(this,n.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,n.VERBOSE,...a),this._logHandler(this,n.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,n.INFO,...a),this._logHandler(this,n.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,n.WARN,...a),this._logHandler(this,n.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,n.ERROR,...a),this._logHandler(this,n.ERROR,...a)}}function aI(a){aC.forEach(b=>{b.setLogLevel(a)})}function aJ(a,b){for(let c of aC){let d=null;b&&b.level&&(d=aD[b.level]),null===a?c.userLogHandler=null:c.userLogHandler=(b,c,...e)=>{let f=e.map(a=>{if(null==a)return null;if("string"==typeof a)return a;if("number"==typeof a||"boolean"==typeof a)return a.toString();if(a instanceof Error)return a.message;try{return JSON.stringify(a)}catch(a){return null}}).filter(a=>a).join(" ");c>=(d??b.logLevel)&&a({level:n[c].toLowerCase(),message:f,args:e,type:b.name})}}}class aK{constructor(a,b,c){this.name=a,this.instanceFactory=b,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}}let aL="[DEFAULT]";class aM{constructor(a,b){this.name=a,this.container=b,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(a){let b=this.normalizeInstanceIdentifier(a);if(!this.instancesDeferred.has(b)){let a=new S;if(this.instancesDeferred.set(b,a),this.isInitialized(b)||this.shouldAutoInitialize())try{let c=this.getOrInitializeService({instanceIdentifier:b});c&&a.resolve(c)}catch(a){}}return this.instancesDeferred.get(b).promise}getImmediate(a){let b=this.normalizeInstanceIdentifier(a?.identifier),c=a?.optional??!1;if(this.isInitialized(b)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:b})}catch(a){if(c)return null;throw a}if(c)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(a){if(a.name!==this.name)throw Error(`Mismatching Component ${a.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=a,this.shouldAutoInitialize()){if(aO(a))try{this.getOrInitializeService({instanceIdentifier:aL})}catch(a){}for(let[a,b]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(a);try{let a=this.getOrInitializeService({instanceIdentifier:c});b.resolve(a)}catch(a){}}}}clearInstance(a=aL){this.instancesDeferred.delete(a),this.instancesOptions.delete(a),this.instances.delete(a)}async delete(){let a=Array.from(this.instances.values());await Promise.all([...a.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...a.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return null!=this.component}isInitialized(a=aL){return this.instances.has(a)}getOptions(a=aL){return this.instancesOptions.get(a)||{}}initialize(a={}){let{options:b={}}=a,c=this.normalizeInstanceIdentifier(a.instanceIdentifier);if(this.isInitialized(c))throw Error(`${this.name}(${c}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let d=this.getOrInitializeService({instanceIdentifier:c,options:b});for(let[a,b]of this.instancesDeferred.entries())c===this.normalizeInstanceIdentifier(a)&&b.resolve(d);return d}onInit(a,b){let c=this.normalizeInstanceIdentifier(b),d=this.onInitCallbacks.get(c)??new Set;d.add(a),this.onInitCallbacks.set(c,d);let e=this.instances.get(c);return e&&a(e,c),()=>{d.delete(a)}}invokeOnInitCallbacks(a,b){let c=this.onInitCallbacks.get(b);if(c)for(let d of c)try{d(a,b)}catch{}}getOrInitializeService({instanceIdentifier:a,options:b={}}){let c=this.instances.get(a);if(!c&&this.component&&(c=this.component.instanceFactory(this.container,{instanceIdentifier:aN(a),options:b}),this.instances.set(a,c),this.instancesOptions.set(a,b),this.invokeOnInitCallbacks(c,a),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,a,c)}catch{}return c||null}normalizeInstanceIdentifier(a=aL){return this.component?this.component.multipleInstances?a:aL:a}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function aN(a){return a===aL?void 0:a}function aO(a){return"EAGER"===a.instantiationMode}class aP{constructor(a){this.name=a,this.providers=new Map}addComponent(a){let b=this.getProvider(a.name);if(b.isComponentSet())throw Error(`Component ${a.name} has already been registered with ${this.name}`);b.setComponent(a)}addOrOverwriteComponent(a){this.getProvider(a.name).isComponentSet()&&this.providers.delete(a.name),this.addComponent(a)}getProvider(a){if(this.providers.has(a))return this.providers.get(a);let b=new aM(a,this);return this.providers.set(a,b),b}getProviders(){return Array.from(this.providers.values())}}let aQ=(a,b)=>b.some(b=>a instanceof b);function aR(){return b||(b=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function aS(){return c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let aT=new WeakMap,aU=new WeakMap,aV=new WeakMap,aW=new WeakMap,aX=new WeakMap;function aY(a){let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(a2(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)});return b.then(b=>{b instanceof IDBCursor&&aT.set(b,a)}).catch(()=>{}),aX.set(b,a),b}function aZ(a){if(aU.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});aU.set(a,b)}let a$={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return aU.get(a);if("objectStoreNames"===b)return a.objectStoreNames||aV.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return a2(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function a_(a){a$=a(a$)}function a0(a){return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?aS().includes(a)?function(...b){return a.apply(a3(this),b),a2(aT.get(this))}:function(...b){return a2(a.apply(a3(this),b))}:function(b,...c){let d=a.call(a3(this),b,...c);return aV.set(d,b.sort?b.sort():[b]),a2(d)}}function a1(a){return"function"==typeof a?a0(a):(a instanceof IDBTransaction&&aZ(a),aQ(a,aR()))?new Proxy(a,a$):a}function a2(a){if(a instanceof IDBRequest)return aY(a);if(aW.has(a))return aW.get(a);let b=a1(a);return b!==a&&(aW.set(a,b),aX.set(b,a)),b}let a3=a=>aX.get(a);function a4(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,b),h=a2(g);return d&&g.addEventListener("upgradeneeded",a=>{d(a2(g.result),a.oldVersion,a.newVersion,a2(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h}let a5=["get","getKey","getAll","getAllKeys","count"],a6=["put","add","delete","clear"],a7=new Map;function a8(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(a7.get(b))return a7.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=a6.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||a5.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return a7.set(b,f),f}a_(a=>({...a,get:(b,c,d)=>a8(b,c)||a.get(b,c,d),has:(b,c)=>!!a8(b,c)||a.has(b,c)}));class a9{constructor(a){this.container=a}getPlatformInfoString(){return this.container.getProviders().map(a=>{if(!ba(a))return null;{let b=a.getImmediate();return`${b.library}/${b.version}`}}).filter(a=>a).join(" ")}}function ba(a){let b=a.getComponent();return b?.type==="VERSION"}let bb="@firebase/app",bc="0.14.7",bd=new aH("@firebase/app"),be="12.8.0",bf="[DEFAULT]",bg={[bb]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},bh=new Map,bi=new Map,bj=new Map;function bk(a,b){try{a.container.addComponent(b)}catch(c){bd.debug(`Component ${b.name} failed to register with FirebaseApp ${a.name}`,c)}}function bl(a,b){a.container.addOrOverwriteComponent(b)}function bm(a){let b=a.name;if(bj.has(b))return bd.debug(`There were multiple attempts to register component ${b}.`),!1;for(let c of(bj.set(b,a),bh.values()))bk(c,a);for(let b of bi.values())bk(b,a);return!0}function bn(a,b){let c=a.container.getProvider("heartbeat").getImmediate({optional:!0});return c&&c.triggerHeartbeat(),a.container.getProvider(b)}function bo(a,b,c=bf){bn(a,b).clearInstance(c)}function bp(a){return void 0!==a.options}function bq(a){return!bp(a)&&("authIdToken"in a||"appCheckToken"in a||"releaseOnDeref"in a||"automaticDataCollectionEnabled"in a)}function br(a){return null!=a&&void 0!==a.settings}function bs(){bj.clear()}let bt=new ai("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class bu{constructor(a,b,c){this._isDeleted=!1,this._options={...a},this._config={...b},this._name=b.name,this._automaticDataCollectionEnabled=b.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new aK("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(a){this.checkDestroyed(),this._automaticDataCollectionEnabled=a}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(a){this._isDeleted=a}checkDestroyed(){if(this.isDeleted)throw bt.create("app-deleted",{appName:this._name})}}function bv(a,b){let c=G(a.split(".")[1]);null===c?console.error(`FirebaseServerApp ${b} is invalid: second part could not be parsed.`):void 0===JSON.parse(c).exp?console.error(`FirebaseServerApp ${b} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(c).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${b} is invalid: the token has expired.`)}class bw extends bu{constructor(a,b,c,d){const e=void 0===b.automaticDataCollectionEnabled||b.automaticDataCollectionEnabled,f={name:c,automaticDataCollectionEnabled:e};void 0!==a.apiKey?super(a,f,d):super(a.options,f,d),this._serverConfig={automaticDataCollectionEnabled:e,...b},this._serverConfig.authIdToken&&bv(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&bv(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,b.releaseOnDeref=void 0,bD(bb,bc,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(a){this.isDeleted||(this._refCount++,void 0!==a&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(a,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){bC(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw bt.create("server-app-deleted")}}let bx=be;function by(a,b={}){let c=a;"object"!=typeof b&&(b={name:b});let d={name:bf,automaticDataCollectionEnabled:!0,...b},e=d.name;if("string"!=typeof e||!e)throw bt.create("bad-app-name",{appName:String(e)});if(c||(c=R()),!c)throw bt.create("no-options");let f=bh.get(e);if(f)if(au(c,f.options)&&au(d,f.config))return f;else throw bt.create("duplicate-app",{appName:e});let g=new aP(e);for(let a of bj.values())g.addComponent(a);let h=new bu(c,d,g);return bh.set(e,h),h}function bz(a,b={}){let c;if($()&&!_())throw bt.create("invalid-server-app-environment");let d=b||{};if(a&&(bp(a)?c=a.options:bq(a)?d=a:c=a),void 0===d.automaticDataCollectionEnabled&&(d.automaticDataCollectionEnabled=!0),c||(c=R()),!c)throw bt.create("no-options");let e={...d,...c};void 0!==e.releaseOnDeref&&delete e.releaseOnDeref;let f=a=>[...a].reduce((a,b)=>Math.imul(31,a)+b.charCodeAt(0)|0,0);if(void 0!==d.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw bt.create("finalization-registry-not-supported",{});let g=""+f(JSON.stringify(e)),h=bi.get(g);if(h)return h.incRefCount(d.releaseOnDeref),h;let i=new aP(g);for(let a of bj.values())i.addComponent(a);let j=new bw(c,d,g,i);return bi.set(g,j),j}function bA(a=bf){let b=bh.get(a);if(!b&&a===bf&&R())return by();if(!b)throw bt.create("no-app",{appName:a});return b}function bB(){return Array.from(bh.values())}async function bC(a){let b=!1,c=a.name;bh.has(c)?(b=!0,bh.delete(c)):bi.has(c)&&0>=a.decRefCount()&&(bi.delete(c),b=!0),b&&(await Promise.all(a.container.getProviders().map(a=>a.delete())),a.isDeleted=!0)}function bD(a,b,c){let d=bg[a]??a;c&&(d+=`-${c}`);let e=d.match(/\s|\//),f=b.match(/\s|\//);if(e||f){let a=[`Unable to register library "${d}" with version "${b}":`];e&&a.push(`library name "${d}" contains illegal characters (whitespace or "/")`),e&&f&&a.push("and"),f&&a.push(`version name "${b}" contains illegal characters (whitespace or "/")`),bd.warn(a.join(" "));return}bm(new aK(`${d}-version`,()=>({library:d,version:b}),"VERSION"))}function bE(a,b){if(null!==a&&"function"!=typeof a)throw bt.create("invalid-log-argument");aJ(a,b)}function bF(a){aI(a)}let bG="firebase-heartbeat-database",bH=1,bI="firebase-heartbeat-store",bJ=null;function bK(){return bJ||(bJ=a4(bG,bH,{upgrade:(a,b)=>{if(0===b)try{a.createObjectStore(bI)}catch(a){console.warn(a)}}}).catch(a=>{throw bt.create("idb-open",{originalErrorMessage:a.message})})),bJ}async function bL(a){try{let b=(await bK()).transaction(bI),c=await b.objectStore(bI).get(bN(a));return await b.done,c}catch(a){if(a instanceof ah)bd.warn(a.message);else{let b=bt.create("idb-get",{originalErrorMessage:a?.message});bd.warn(b.message)}}}async function bM(a,b){try{let c=(await bK()).transaction(bI,"readwrite"),d=c.objectStore(bI);await d.put(b,bN(a)),await c.done}catch(a){if(a instanceof ah)bd.warn(a.message);else{let b=bt.create("idb-set",{originalErrorMessage:a?.message});bd.warn(b.message)}}}function bN(a){return`${a.name}!${a.options.appId}`}let bO=1024,bP=30;class bQ{constructor(a){this.container=a,this._heartbeatsCache=null;const b=this.container.getProvider("app").getImmediate();this._storage=new bT(b),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){try{let a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),b=bR();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===b||this._heartbeatsCache.heartbeats.some(a=>a.date===b))return;if(this._heartbeatsCache.heartbeats.push({date:b,agent:a}),this._heartbeatsCache.heartbeats.length>bP){let a=bV(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){bd.warn(a)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let a=bR(),{heartbeatsToSend:b,unsentEntries:c}=bS(this._heartbeatsCache.heartbeats),d=F(JSON.stringify({version:2,heartbeats:b}));return this._heartbeatsCache.lastSentHeartbeatDate=a,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(a){return bd.warn(a),""}}}function bR(){return new Date().toISOString().substring(0,10)}function bS(a,b=bO){let c=[],d=a.slice();for(let e of a){let a=c.find(a=>a.agent===e.agent);if(a){if(a.dates.push(e.date),bU(c)>b){a.dates.pop();break}}else if(c.push({agent:e.agent,dates:[e.date]}),bU(c)>b){c.pop();break}d=d.slice(1)}return{heartbeatsToSend:c,unsentEntries:d}}class bT{constructor(a){this.app=a,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!ae()&&af().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let a=await bL(this.app);return a?.heartbeats?a:{heartbeats:[]}}}async overwrite(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return bM(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:a.heartbeats})}}async add(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return bM(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:[...b.heartbeats,...a.heartbeats]})}}}function bU(a){return F(JSON.stringify({version:2,heartbeats:a})).length}function bV(a){if(0===a.length)return -1;let b=0,c=a[0].date;for(let d=1;d<a.length;d++)a[d].date<c&&(c=a[d].date,b=d);return b}(function(a){bm(new aK("platform-logger",a=>new a9(a),"PRIVATE")),bm(new aK("heartbeat",a=>new bQ(a),"PRIVATE")),bD(bb,bc,""),bD(bb,bc,"esm2020"),bD("fire-js","")})(""),a.s(["SDK_VERSION",()=>bx,"_DEFAULT_ENTRY_NAME",()=>bf,"_addComponent",()=>bk,"_addOrOverwriteComponent",()=>bl,"_apps",()=>bh,"_clearComponents",()=>bs,"_components",()=>bj,"_getProvider",()=>bn,"_isFirebaseApp",()=>bp,"_isFirebaseServerApp",()=>br,"_isFirebaseServerAppSettings",()=>bq,"_registerComponent",()=>bm,"_removeServiceInstance",()=>bo,"_serverApps",()=>bi,"deleteApp",()=>bC,"getApp",()=>bA,"getApps",()=>bB,"initializeApp",()=>by,"initializeServerApp",()=>bz,"onLog",()=>bE,"registerVersion",()=>bD,"setLogLevel",()=>bF],73429);let bW="5",bX="v",bY="s",bZ="r",b$="f",b_=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,b0="ls",b1="p",b2="ac",b3="websocket",b4="long_polling";class b5{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(a,b){null==b?delete this.cache_[a]:this.cache_[a]=b}get(a){return aq(this.cache_,a)?this.cache_[a]:null}remove(a){delete this.cache_[a]}}let b6=function(a){return new b5},b7=b6("localStorage"),b8=b6("sessionStorage"),b9=new aH("@firebase/database"),ca=function(){let a=1;return function(){return a++}}(),cb=function(a){let b=az(a),c=new ax;c.update(b);let d=c.digest();return C.encodeByteArray(d)},cc=function(...a){let b="";for(let c=0;c<a.length;c++){let d=a[c];Array.isArray(d)||d&&"object"==typeof d&&"number"==typeof d.length?b+=cc.apply(null,d):"object"==typeof d?b+=am(d):b+=d,b+=" "}return b},cd=null,ce=!0,cf=function(a,b){y(!b||!0===a||!1===a,"Can't turn on custom loggers persistently."),!0===a?(b9.logLevel=n.VERBOSE,cd=b9.log.bind(b9),b&&b8.set("logging_enabled",!0)):"function"==typeof a?cd=a:(cd=null,b8.remove("logging_enabled"))},cg=function(...a){if(!0===ce&&(ce=!1,null===cd&&!0===b8.get("logging_enabled")&&cf(!0)),cd){let b=cc.apply(null,a);cd(b)}},ch=function(a){return function(...b){cg(a,...b)}},ci=function(...a){let b="FIREBASE INTERNAL ERROR: "+cc(...a);b9.error(b)},cj=function(...a){let b=`FIREBASE FATAL ERROR: ${cc(...a)}`;throw b9.error(b),Error(b)},ck=function(...a){let b="FIREBASE WARNING: "+cc(...a);b9.warn(b)},cl=function(){},cm=function(a){return"number"==typeof a&&(a!=a||a===1/0||a===-1/0)},cn=function(a){if(ab()||"complete"===document.readyState)a();else{let b=!1,c=function(){document.body?b||(b=!0,a()):setTimeout(c,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&c()}),window.attachEvent("onload",c))}},co="[MIN_NAME]",cp="[MAX_NAME]",cq=function(a,b){if(a===b)return 0;{if(a===co||b===cp)return -1;if(b===co||a===cp)return 1;let c=cD(a),d=cD(b);if(null!==c)if(null!==d)return c-d==0?a.length-b.length:c-d;else return -1;return null!==d?1:a<b?-1:1}},cr=function(a,b){return a===b?0:a<b?-1:1},cs=function(a,b){if(b&&a in b)return b[a];throw Error("Missing required key ("+a+") in object: "+am(b))},ct=function(a){if("object"!=typeof a||null===a)return am(a);let b=[];for(let c in a)b.push(c);b.sort();let c="{";for(let d=0;d<b.length;d++)0!==d&&(c+=","),c+=am(b[d]),c+=":",c+=ct(a[b[d]]);return c+"}"},cu=function(a,b){let c=a.length;if(c<=b)return[a];let d=[];for(let e=0;e<c;e+=b)e+b>c?d.push(a.substring(e,c)):d.push(a.substring(e,e+b));return d};function cv(a,b){for(let c in a)a.hasOwnProperty(c)&&b(c,a[c])}let cw=function(a){let b,c,d,e,f;y(!cm(a),"Invalid JSON number");let g=11,h=52,i=1023;0===a?(c=0,d=0,b=+(1/a==-1/0)):(b=a<0,(a=Math.abs(a))>=Math.pow(2,1-i)?(c=(e=Math.min(Math.floor(Math.log(a)/Math.LN2),i))+i,d=Math.round(a*Math.pow(2,h-e)-Math.pow(2,h))):(c=0,d=Math.round(a/Math.pow(2,1-i-h))));let j=[];for(f=h;f;f-=1)j.push(d%2?1:0),d=Math.floor(d/2);for(f=g;f;f-=1)j.push(c%2?1:0),c=Math.floor(c/2);j.push(+!!b),j.reverse();let k=j.join(""),l="";for(f=0;f<64;f+=8){let a=parseInt(k.substr(f,8),2).toString(16);1===a.length&&(a="0"+a),l+=a}return l.toLowerCase()},cx=function(){return!1},cy=function(){return"object"==typeof Windows&&"object"==typeof Windows.UI};function cz(a,b){let c="Unknown Error";"too_big"===a?c="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===a?c="Client doesn't have permission to access the desired data.":"unavailable"===a&&(c="The service is unavailable");let d=Error(a+" at "+b._path.toString()+": "+c);return d.code=a.toUpperCase(),d}let cA=RegExp("^-?(0*)\\d{1,10}$"),cB=-0x80000000,cC=0x7fffffff,cD=function(a){if(cA.test(a)){let b=Number(a);if(b>=cB&&b<=cC)return b}return null},cE=function(a){try{a()}catch(a){setTimeout(()=>{throw ck("Exception was thrown by user callback.",a.stack||""),a},Math.floor(0))}},cF=function(){return"".search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},cG=function(a,b){let c=setTimeout(a,b);return"number"==typeof c&&"u">typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(c):"object"==typeof c&&c.unref&&c.unref(),c};class cH{constructor(a,b,c,d,e=!1,f="",g=!1,h=!1,i=null){this.secure=b,this.namespace=c,this.webSocketOnly=d,this.nodeAdmin=e,this.persistenceKey=f,this.includeNamespaceInQueryParams=g,this.isUsingEmulator=h,this.emulatorOptions=i,this._host=a.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=b7.get("host:"+a)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(a){a!==this.internalHost&&(this.internalHost=a,this.isCacheableHost()&&b7.set("host:"+this._host,this.internalHost))}toString(){let a=this.toURLString();return this.persistenceKey&&(a+="<"+this.persistenceKey+">"),a}toURLString(){let a=this.secure?"https://":"http://",b=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${a}${this.host}/${b}`}}function cI(a){return a.host!==a.internalHost||a.isCustomHost()||a.includeNamespaceInQueryParams}function cJ(a,b,c){let d;if(y("string"==typeof b,"typeof type must == string"),y("object"==typeof c,"typeof params must == object"),b===b3)d=(a.secure?"wss://":"ws://")+a.internalHost+"/.ws?";else if(b===b4)d=(a.secure?"https://":"http://")+a.internalHost+"/.lp?";else throw Error("Unknown connection type: "+b);cI(a)&&(c.ns=a.namespace);let e=[];return cv(c,(a,b)=>{e.push(a+"="+b)}),d+e.join("&")}class cK{constructor(){this.counters_={}}incrementCounter(a,b=1){aq(this.counters_,a)||(this.counters_[a]=0),this.counters_[a]+=b}get(){return H(this.counters_)}}let cL={},cM={};function cN(a){let b=a.toString();return cL[b]||(cL[b]=new cK),cL[b]}function cO(a,b){let c=a.toString();return cM[c]||(cM[c]=b()),cM[c]}let cP="";function cQ(a){cP=a}let cR=16384,cS=45e3,cT=null;function cU(a){cT=a}"u">typeof MozWebSocket?cT=MozWebSocket:"u">typeof WebSocket&&(cT=WebSocket);class cV{constructor(a,b,c,d,e,f,g){this.connId=a,this.applicationId=c,this.appCheckToken=d,this.authToken=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ch(this.connId),this.stats_=cN(b),this.connURL=cV.connectionURL_(b,f,g,d,c),this.nodeAdmin=b.nodeAdmin}static connectionURL_(a,b,c,d,e){let f={};return f[bX]=bW,!ab()&&"u">typeof location&&location.hostname&&b_.test(location.hostname)&&(f[bZ]=b$),b&&(f[bY]=b),c&&(f[b0]=c),d&&(f[b2]=d),e&&(f[b1]=e),cJ(a,b3,f)}open(a,b){this.onDisconnect=b,this.onMessage=a,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,b7.set("previous_websocket_failure",!0);try{let a;if(ab()){let b=this.nodeAdmin?"AdminNode":"Node";a={headers:{"User-Agent":`Firebase/${bW}/${cP}/${process.platform}/${b}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(a.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(a.headers["X-Firebase-AppCheck"]=this.appCheckToken);let c=process.env,d=0===this.connURL.indexOf("wss://")?c.HTTPS_PROXY||c.https_proxy:c.HTTP_PROXY||c.http_proxy;d&&(a.proxy={origin:d})}this.mySock=new cT(this.connURL,[],a)}catch(b){this.log_("Error instantiating WebSocket.");let a=b.message||b.data;a&&this.log_(a),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=a=>{this.handleIncomingFrame(a)},this.mySock.onerror=a=>{this.log_("WebSocket error.  Closing connection.");let b=a.message||a.data;b&&this.log_(b),this.onClosed_()}}start(){}static forceDisallow(){cV.forceDisallow_=!0}static isAvailable(){let a=!1;if("u">typeof navigator&&navigator.userAgent){let b=/Android ([0-9]{0,}\.[0-9]{0,})/,c=navigator.userAgent.match(b);c&&c.length>1&&4.4>parseFloat(c[1])&&(a=!0)}return!a&&null!==cT&&!cV.forceDisallow_}static previouslyFailed(){return b7.isInMemoryStorage||!0===b7.get("previous_websocket_failure")}markConnectionHealthy(){b7.remove("previous_websocket_failure")}appendFrame_(a){if(this.frames.push(a),this.frames.length===this.totalFrames){let a=this.frames.join("");this.frames=null;let b=al(a);this.onMessage(b)}}handleNewFrameCount_(a){this.totalFrames=a,this.frames=[]}extractFrameCount_(a){if(y(null===this.frames,"We already have a frame buffer"),a.length<=6){let b=Number(a);if(!isNaN(b))return this.handleNewFrameCount_(b),null}return this.handleNewFrameCount_(1),a}handleIncomingFrame(a){if(null===this.mySock)return;let b=a.data;if(this.bytesReceived+=b.length,this.stats_.incrementCounter("bytes_received",b.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(b);else{let a=this.extractFrameCount_(b);null!==a&&this.appendFrame_(a)}}send(a){this.resetKeepAlive();let b=am(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);let c=cu(b,cR);c.length>1&&this.sendString_(String(c.length));for(let a=0;a<c.length;a++)this.sendString_(c[a])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(cS))}sendString_(a){try{this.mySock.send(a)}catch(a){this.log_("Exception thrown from WebSocket.send():",a.message||a.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}cV.responsesRequiredToBeHealthy=2,cV.healthyTimeout=3e4;let cW="@firebase/database",cX="1.1.0";class cY{constructor(a,b){this.appCheckProvider=b,this.appName=a.name,br(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken),this.appCheck=b?.getImmediate({optional:!0}),this.appCheck||b?.get().then(a=>this.appCheck=a)}getToken(a){if(this.serverAppAppCheckToken){if(a)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(a):new Promise((b,c)=>{setTimeout(()=>{this.appCheck?this.getToken(a).then(b,c):b(null)},0)})}addTokenChangeListener(a){this.appCheckProvider?.get().then(b=>b.addTokenListener(a))}notifyForInvalidToken(){ck(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class cZ{constructor(a,b,c){this.appName_=a,this.firebaseOptions_=b,this.authProvider_=c,this.auth_=null,this.auth_=c.getImmediate({optional:!0}),this.auth_||c.onInit(a=>this.auth_=a)}getToken(a){return this.auth_?this.auth_.getToken(a).catch(a=>a&&"auth/token-not-initialized"===a.code?(cg("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(a)):new Promise((b,c)=>{setTimeout(()=>{this.auth_?this.getToken(a).then(b,c):b(null)},0)})}addTokenChangeListener(a){this.auth_?this.auth_.addAuthTokenListener(a):this.authProvider_.get().then(b=>b.addAuthTokenListener(a))}removeTokenChangeListener(a){this.authProvider_.get().then(b=>b.removeAuthTokenListener(a))}notifyForInvalidToken(){let a='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?a+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?a+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':a+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ck(a)}}class c${constructor(a){this.accessToken=a}getToken(a){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(a){a(this.accessToken)}removeTokenChangeListener(a){}notifyForInvalidToken(){}}c$.OWNER="owner";class c_{constructor(a){this.onMessage_=a,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(a,b){this.closeAfterResponse=a,this.onClose=b,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(a,b){for(this.pendingResponses[a]=b;this.pendingResponses[this.currentResponseNum];){let a=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let b=0;b<a.length;++b)a[b]&&cE(()=>{this.onMessage_(a[b])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let c0="start",c1="close",c2="pLPCommand",c3="pRTLPCB",c4="id",c5="pw",c6="ser",c7="cb",c8="seg",c9="ts",da="d",db="dframe",dc=1870,dd=30,de=1840,df=25e3,dg=3e4;class dh{constructor(a,b,c,d,e,f,g){this.connId=a,this.repoInfo=b,this.applicationId=c,this.appCheckToken=d,this.authToken=e,this.transportSessionId=f,this.lastSessionId=g,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ch(a),this.stats_=cN(b),this.urlFn=a=>(this.appCheckToken&&(a[b2]=this.appCheckToken),cJ(b,b4,a))}open(a,b){this.curSegmentNum=0,this.onDisconnect_=b,this.myPacketOrderer=new c_(a),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(dg)),cn(()=>{if(this.isClosed_)return;this.scriptTagHolder=new di((...a)=>{let[b,c,d,e,f]=a;if(this.incrementIncomingBytes_(a),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,b===c0)this.id=c,this.password=d;else if(b===c1)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+b)},(...a)=>{let[b,c]=a;this.incrementIncomingBytes_(a),this.myPacketOrderer.handleResponse(b,c)},()=>{this.onClosed_()},this.urlFn);let a={};a[c0]="t",a[c6]=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(a[c7]=this.scriptTagHolder.uniqueCallbackIdentifier),a[bX]=bW,this.transportSessionId&&(a[bY]=this.transportSessionId),this.lastSessionId&&(a[b0]=this.lastSessionId),this.applicationId&&(a[b1]=this.applicationId),this.appCheckToken&&(a[b2]=this.appCheckToken),"u">typeof location&&location.hostname&&b_.test(location.hostname)&&(a[bZ]=b$);let b=this.urlFn(a);this.log_("Connecting via long-poll to "+b),this.scriptTagHolder.addTag(b,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){dh.forceAllow_=!0}static forceDisallow(){dh.forceDisallow_=!0}static isAvailable(){return!ab()&&(!!dh.forceAllow_||!dh.forceDisallow_&&"u">typeof document&&null!=document.createElement&&!cx()&&!cy())}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(a){let b=am(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);let c=cu(E(b),de);for(let a=0;a<c.length;a++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,c.length,c[a]),this.curSegmentNum++}addDisconnectPingFrame(a,b){if(ab())return;this.myDisconnFrame=document.createElement("iframe");let c={};c[db]="t",c[c4]=a,c[c5]=b,this.myDisconnFrame.src=this.urlFn(c),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(a){let b=am(a).length;this.bytesReceived+=b,this.stats_.incrementCounter("bytes_received",b)}}class di{constructor(a,b,c,d){if(this.onDisconnect=c,this.urlFn=d,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,ab())this.commandCB=a,this.onMessageCB=b;else{this.uniqueCallbackIdentifier=ca(),window[c2+this.uniqueCallbackIdentifier]=a,window[c3+this.uniqueCallbackIdentifier]=b,this.myIFrame=di.createIFrame_();let c="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(c='<script>document.domain="'+document.domain+'";</script>');const d="<html><body>"+c+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(d),this.myIFrame.doc.close()}catch(a){cg("frame writing exception"),a.stack&&cg(a.stack),cg(a)}}}static createIFrame_(){let a=document.createElement("iframe");if(a.style.display="none",document.body){document.body.appendChild(a);try{a.contentWindow.document||cg("No IE domain setting required")}catch(b){a.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return a.contentDocument?a.doc=a.contentDocument:a.contentWindow?a.doc=a.contentWindow.document:a.document&&(a.doc=a.document),a}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let a=this.onDisconnect;a&&(this.onDisconnect=null,a())}startLongPoll(a,b){for(this.myID=a,this.myPW=b,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let a={};a[c4]=this.myID,a[c5]=this.myPW,a[c6]=this.currentSerial;let b=this.urlFn(a),c="",d=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+dd+c.length<=dc){let a=this.pendingSegs.shift();c=c+"&"+c8+d+"="+a.seg+"&"+c9+d+"="+a.ts+"&"+da+d+"="+a.d,d++}else break;return b+=c,this.addLongPollTag_(b,this.currentSerial),!0}}enqueueSegment(a,b,c){this.pendingSegs.push({seg:a,ts:b,d:c}),this.alive&&this.newRequest_()}addLongPollTag_(a,b){this.outstandingRequests.add(b);let c=()=>{this.outstandingRequests.delete(b),this.newRequest_()},d=setTimeout(c,Math.floor(df)),e=()=>{clearTimeout(d),c()};this.addTag(a,e)}addTag(a,b){ab()?this.doNodeLongPoll(a,b):setTimeout(()=>{try{if(!this.sendNewPolls)return;let c=this.myIFrame.doc.createElement("script");c.type="text/javascript",c.async=!0,c.src=a,c.onload=c.onreadystatechange=function(){let a=c.readyState;a&&"loaded"!==a&&"complete"!==a||(c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),b())},c.onerror=()=>{cg("Long-poll script failed to load: "+a),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(c)}catch(a){}},Math.floor(1))}}class dj{static get ALL_TRANSPORTS(){return[dh,cV]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(a){this.initTransports_(a)}initTransports_(a){let b=cV&&cV.isAvailable(),c=b&&!cV.previouslyFailed();if(a.webSocketOnly&&(b||ck("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),c=!0),c)this.transports_=[cV];else{let a=this.transports_=[];for(let b of dj.ALL_TRANSPORTS)b&&b.isAvailable()&&a.push(b);dj.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}dj.globalTransportInitialized_=!1;let dk=6e4,dl=5e3,dm=10240,dn=102400,dp="t",dq="d",dr="s",ds="r",dt="e",du="o",dv="a",dw="n",dx="p",dy="h";class dz{constructor(a,b,c,d,e,f,g,h,i,j){this.id=a,this.repoInfo_=b,this.applicationId_=c,this.appCheckToken_=d,this.authToken_=e,this.onMessage_=f,this.onReady_=g,this.onDisconnect_=h,this.onKill_=i,this.lastSessionId=j,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ch("c:"+this.id+":"),this.transportManager_=new dj(b),this.log_("Connection created"),this.start_()}start_(){let a=this.transportManager_.initialTransport();this.conn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;let b=this.connReceiver_(this.conn_),c=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(b,c)},Math.floor(0));let d=a.healthyTimeout||0;d>0&&(this.healthyTimeout_=cG(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>dn?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>dm?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(d)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(a){return b=>{a===this.conn_?this.onConnectionLost_(b):a===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(a){return b=>{2!==this.state_&&(a===this.rx_?this.onPrimaryMessageReceived_(b):a===this.secondaryConn_?this.onSecondaryMessageReceived_(b):this.log_("message on old connection"))}}sendRequest(a){let b={t:"d",d:a};this.sendData_(b)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(a){if(dp in a){let b=a[dp];b===dv?this.upgradeIfSecondaryHealthy_():b===ds?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):b===du&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(a){let b=cs("t",a),c=cs("d",a);if("c"===b)this.onSecondaryControl_(c);else if("d"===b)this.pendingDataMessages.push(c);else throw Error("Unknown protocol layer: "+b)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:dx,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:dv,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:dw,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(a){let b=cs("t",a),c=cs("d",a);"c"===b?this.onControl_(c):"d"===b&&this.onDataMessage_(c)}onDataMessage_(a){this.onPrimaryResponse_(),this.onMessage_(a)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(a){let b=cs(dp,a);if(dq in a){let c=a[dq];if(b===dy){let a={...c};this.repoInfo_.isUsingEmulator&&(a.h=this.repoInfo_.host),this.onHandshake_(a)}else if(b===dw){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let a=0;a<this.pendingDataMessages.length;++a)this.onDataMessage_(this.pendingDataMessages[a]);this.pendingDataMessages=[],this.tryCleanupConnection()}else b===dr?this.onConnectionShutdown_(c):b===ds?this.onReset_(c):b===dt?ci("Server Error: "+c):b===du?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ci("Unknown control packet command: "+b)}}onHandshake_(a){let b=a.ts,c=a.v,d=a.h;this.sessionId=a.s,this.repoInfo_.host=d,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,b),bW!==c&&ck("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let a=this.transportManager_.upgradeTransport();a&&this.startUpgrade_(a)}startUpgrade_(a){this.secondaryConn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;let b=this.connReceiver_(this.secondaryConn_),c=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(b,c),cG(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(dk))}onReset_(a){this.log_("Reset packet received.  New host: "+a),this.repoInfo_.host=a,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(a,b){this.log_("Realtime connection established."),this.conn_=a,this.state_=1,this.onReady_&&(this.onReady_(b,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):cG(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(dl))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:dx,d:{}}}))}onSecondaryConnectionLost_(){let a=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===a||this.rx_===a)&&this.close()}onConnectionLost_(a){this.conn_=null,a||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(b7.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(a){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(a),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(a){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(a)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class dA{put(a,b,c,d){}merge(a,b,c,d){}refreshAuthToken(a){}refreshAppCheckToken(a){}onDisconnectPut(a,b,c){}onDisconnectMerge(a,b,c){}onDisconnectCancel(a,b){}reportStats(a){}}class dB{constructor(a){this.allowedEvents_=a,this.listeners_={},y(Array.isArray(a)&&a.length>0,"Requires a non-empty array")}trigger(a,...b){if(Array.isArray(this.listeners_[a])){let c=[...this.listeners_[a]];for(let a=0;a<c.length;a++)c[a].callback.apply(c[a].context,b)}}on(a,b,c){this.validateEventType_(a),this.listeners_[a]=this.listeners_[a]||[],this.listeners_[a].push({callback:b,context:c});let d=this.getInitialEvent(a);d&&b.apply(c,d)}off(a,b,c){this.validateEventType_(a);let d=this.listeners_[a]||[];for(let a=0;a<d.length;a++)if(d[a].callback===b&&(!c||c===d[a].context))return void d.splice(a,1)}validateEventType_(a){y(this.allowedEvents_.find(b=>b===a),"Unknown event: "+a)}}class dC extends dB{static getInstance(){return new dC}constructor(){super(["online"]),this.online_=!0}getInitialEvent(a){return y("online"===a,"Unknown event type: "+a),[this.online_]}currentlyOnline(){return this.online_}}let dD=32,dE=768;class dF{constructor(a,b){if(void 0===b){this.pieces_=a.split("/");let b=0;for(let a=0;a<this.pieces_.length;a++)this.pieces_[a].length>0&&(this.pieces_[b]=this.pieces_[a],b++);this.pieces_.length=b,this.pieceNum_=0}else this.pieces_=a,this.pieceNum_=b}toString(){let a="";for(let b=this.pieceNum_;b<this.pieces_.length;b++)""!==this.pieces_[b]&&(a+="/"+this.pieces_[b]);return a||"/"}}function dG(){return new dF("")}function dH(a){return a.pieceNum_>=a.pieces_.length?null:a.pieces_[a.pieceNum_]}function dI(a){return a.pieces_.length-a.pieceNum_}function dJ(a){let b=a.pieceNum_;return b<a.pieces_.length&&b++,new dF(a.pieces_,b)}function dK(a){return a.pieceNum_<a.pieces_.length?a.pieces_[a.pieces_.length-1]:null}function dL(a){let b="";for(let c=a.pieceNum_;c<a.pieces_.length;c++)""!==a.pieces_[c]&&(b+="/"+encodeURIComponent(String(a.pieces_[c])));return b||"/"}function dM(a,b=0){return a.pieces_.slice(a.pieceNum_+b)}function dN(a){if(a.pieceNum_>=a.pieces_.length)return null;let b=[];for(let c=a.pieceNum_;c<a.pieces_.length-1;c++)b.push(a.pieces_[c]);return new dF(b,0)}function dO(a,b){let c=[];for(let b=a.pieceNum_;b<a.pieces_.length;b++)c.push(a.pieces_[b]);if(b instanceof dF)for(let a=b.pieceNum_;a<b.pieces_.length;a++)c.push(b.pieces_[a]);else{let a=b.split("/");for(let b=0;b<a.length;b++)a[b].length>0&&c.push(a[b])}return new dF(c,0)}function dP(a){return a.pieceNum_>=a.pieces_.length}function dQ(a,b){let c=dH(a),d=dH(b);if(null===c)return b;if(c===d)return dQ(dJ(a),dJ(b));throw Error("INTERNAL ERROR: innerPath ("+b+") is not within outerPath ("+a+")")}function dR(a,b){if(dI(a)!==dI(b))return!1;for(let c=a.pieceNum_,d=b.pieceNum_;c<=a.pieces_.length;c++,d++)if(a.pieces_[c]!==b.pieces_[d])return!1;return!0}function dS(a,b){let c=a.pieceNum_,d=b.pieceNum_;if(dI(a)>dI(b))return!1;for(;c<a.pieces_.length;){if(a.pieces_[c]!==b.pieces_[d])return!1;++c,++d}return!0}class dT{constructor(a,b){this.errorPrefix_=b,this.parts_=dM(a,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=aA(this.parts_[a]);dW(this)}}function dU(a,b){a.parts_.length>0&&(a.byteLength_+=1),a.parts_.push(b),a.byteLength_+=aA(b),dW(a)}function dV(a){let b=a.parts_.pop();a.byteLength_-=aA(b),a.parts_.length>0&&(a.byteLength_-=1)}function dW(a){if(a.byteLength_>dE)throw Error(a.errorPrefix_+"has a key path longer than "+dE+" bytes ("+a.byteLength_+").");if(a.parts_.length>dD)throw Error(a.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+dD+") or object contains a cycle "+dX(a))}function dX(a){return 0===a.parts_.length?"":"in property '"+a.parts_.join(".")+"'"}class dY extends dB{static getInstance(){return new dY}constructor(){let a,b;super(["visible"]),"u">typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(b="visibilitychange",a="hidden"):void 0!==document.mozHidden?(b="mozvisibilitychange",a="mozHidden"):void 0!==document.msHidden?(b="msvisibilitychange",a="msHidden"):void 0!==document.webkitHidden&&(b="webkitvisibilitychange",a="webkitHidden")),this.visible_=!0,b&&document.addEventListener(b,()=>{let b=!document[a];b!==this.visible_&&(this.visible_=b,this.trigger("visible",b))},!1)}getInitialEvent(a){return y("visible"===a,"Unknown event type: "+a),[this.visible_]}}let dZ=1e3,d$=3e5,d_=3e4,d0=1.3,d1=3e4,d2="server_kill",d3=3;class d4 extends dA{constructor(a,b,c,d,e,f,g,h){if(super(),this.repoInfo_=a,this.applicationId_=b,this.onDataUpdate_=c,this.onConnectStatus_=d,this.onServerInfoUpdate_=e,this.authTokenProvider_=f,this.appCheckTokenProvider_=g,this.authOverride_=h,this.id=d4.nextPersistentConnectionId_++,this.log_=ch("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=dZ,this.maxReconnectDelay_=d$,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h&&!ab())throw Error("Auth override specified in options, but not supported on non Node.js platforms");dY.getInstance().on("visible",this.onVisible_,this),-1===a.host.indexOf("fblocal")&&dC.getInstance().on("online",this.onOnline_,this)}sendRequest(a,b,c){let d=++this.requestNumber_,e={r:d,a:a,b:b};this.log_(am(e)),y(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(e),c&&(this.requestCBHash_[d]=c)}get(a){this.initConnection_();let b=new S,c={action:"g",request:{p:a._path.toString(),q:a._queryObject},onComplete:a=>{let c=a.d;"ok"===a.s?b.resolve(c):b.reject(c)}};this.outstandingGets_.push(c),this.outstandingGetCount_++;let d=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(d),b.promise}listen(a,b,c,d){this.initConnection_();let e=a._queryIdentifier,f=a._path.toString();this.log_("Listen called for "+f+" "+e),this.listens.has(f)||this.listens.set(f,new Map),y(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"listen() called for non-default but complete query"),y(!this.listens.get(f).has(e),"listen() called twice for same path/queryId.");let g={onComplete:d,hashFn:b,query:a,tag:c};this.listens.get(f).set(e,g),this.connected_&&this.sendListen_(g)}sendGet_(a){let b=this.outstandingGets_[a];this.sendRequest("g",b.request,c=>{delete this.outstandingGets_[a],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),b.onComplete&&b.onComplete(c)})}sendListen_(a){let b=a.query,c=b._path.toString(),d=b._queryIdentifier;this.log_("Listen on "+c+" for "+d);let e={p:c},f="q";a.tag&&(e.q=b._queryObject,e.t=a.tag),e.h=a.hashFn(),this.sendRequest(f,e,e=>{let f=e.d,g=e.s;d4.warnOnListenWarnings_(f,b),(this.listens.get(c)&&this.listens.get(c).get(d))===a&&(this.log_("listen response",e),"ok"!==g&&this.removeListen_(c,d),a.onComplete&&a.onComplete(g,f))})}static warnOnListenWarnings_(a,b){if(a&&"object"==typeof a&&aq(a,"w")){let c=ar(a,"w");if(Array.isArray(c)&&~c.indexOf("no_index")){let a='".indexOn": "'+b._queryParams.getIndex().toString()+'"',c=b._path.toString();ck(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${a} at ${c} to your security rules for better performance.`)}}}refreshAuthToken(a){this.authToken_=a,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(a)}reduceReconnectDelayIfAdminCredential_(a){(a&&40===a.length||ap(a))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=d_)}refreshAppCheckToken(a){this.appCheckToken_=a,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let a=this.authToken_,b=ao(a)?"auth":"gauth",c={cred:a};null===this.authOverride_?c.noauth=!0:"object"==typeof this.authOverride_&&(c.authvar=this.authOverride_),this.sendRequest(b,c,b=>{let c=b.s,d=b.d||"error";this.authToken_===a&&("ok"===c?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(c,d))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},a=>{let b=a.s,c=a.d||"error";"ok"===b?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(b,c)})}unlisten(a,b){let c=a._path.toString(),d=a._queryIdentifier;this.log_("Unlisten called for "+c+" "+d),y(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(c,d)&&this.connected_&&this.sendUnlisten_(c,d,a._queryObject,b)}sendUnlisten_(a,b,c,d){this.log_("Unlisten on "+a+" for "+b);let e={p:a},f="n";d&&(e.q=c,e.t=d),this.sendRequest(f,e)}onDisconnectPut(a,b,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"o",data:b,onComplete:c})}onDisconnectMerge(a,b,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"om",data:b,onComplete:c})}onDisconnectCancel(a,b){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",a,null,b):this.onDisconnectRequestQueue_.push({pathString:a,action:"oc",data:null,onComplete:b})}sendOnDisconnect_(a,b,c,d){let e={p:b,d:c};this.log_("onDisconnect "+a,e),this.sendRequest(a,e,a=>{d&&setTimeout(()=>{d(a.s,a.d)},Math.floor(0))})}put(a,b,c,d){this.putInternal("p",a,b,c,d)}merge(a,b,c,d){this.putInternal("m",a,b,c,d)}putInternal(a,b,c,d,e){this.initConnection_();let f={p:b,d:c};void 0!==e&&(f.h=e),this.outstandingPuts_.push({action:a,request:f,onComplete:d}),this.outstandingPutCount_++;let g=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(g):this.log_("Buffering put: "+b)}sendPut_(a){let b=this.outstandingPuts_[a].action,c=this.outstandingPuts_[a].request,d=this.outstandingPuts_[a].onComplete;this.outstandingPuts_[a].queued=this.connected_,this.sendRequest(b,c,c=>{this.log_(b+" response",c),delete this.outstandingPuts_[a],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),d&&d(c.s,c.d)})}reportStats(a){if(this.connected_){let b={c:a};this.log_("reportStats",b),this.sendRequest("s",b,a=>{if("ok"!==a.s){let b=a.d;this.log_("reportStats","Error sending stats: "+b)}})}}onDataMessage_(a){if("r"in a){this.log_("from server: "+am(a));let b=a.r,c=this.requestCBHash_[b];c&&(delete this.requestCBHash_[b],c(a.b))}else if("error"in a)throw"A server-side error has occurred: "+a.error;else"a"in a&&this.onDataPush_(a.a,a.b)}onDataPush_(a,b){this.log_("handleServerMessage",a,b),"d"===a?this.onDataUpdate_(b.p,b.d,!1,b.t):"m"===a?this.onDataUpdate_(b.p,b.d,!0,b.t):"c"===a?this.onListenRevoked_(b.p,b.q):"ac"===a?this.onAuthRevoked_(b.s,b.d):"apc"===a?this.onAppCheckRevoked_(b.s,b.d):"sd"===a?this.onSecurityDebugPacket_(b):ci("Unrecognized action received from server: "+am(a)+"\nAre you using the latest client?")}onReady_(a,b){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(a),this.lastSessionId=b,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(a){y(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(a))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(a){a&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=dZ,this.realtime_||this.scheduleConnect_(0)),this.visible_=a}onOnline_(a){a?(this.log_("Browser went online."),this.reconnectDelay_=dZ,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>d1&&(this.reconnectDelay_=dZ),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let a=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),b=Math.max(0,this.reconnectDelay_-a);b=Math.random()*b,this.log_("Trying to reconnect in "+b+"ms"),this.scheduleConnect_(b),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*d0)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let a=this.onDataMessage_.bind(this),b=this.onReady_.bind(this),c=this.onRealtimeDisconnect_.bind(this),d=this.id+":"+d4.nextConnectionId_++,e=this.lastSessionId,f=!1,g=null,h=function(){g?g.close():(f=!0,c())},i=function(a){y(g,"sendRequest call when we're not connected not allowed."),g.sendRequest(a)};this.realtime_={close:h,sendRequest:i};let j=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[h,i]=await Promise.all([this.authTokenProvider_.getToken(j),this.appCheckTokenProvider_.getToken(j)]);f?cg("getToken() completed but was canceled"):(cg("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=i&&i.token,g=new dz(d,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,a,b,c,a=>{ck(a+" ("+this.repoInfo_.toString()+")"),this.interrupt(d2)},e))}catch(a){this.log_("Failed to get token: "+a),f||(this.repoInfo_.nodeAdmin&&ck(a),h())}}}interrupt(a){cg("Interrupting connection for reason: "+a),this.interruptReasons_[a]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(a){cg("Resuming connection for reason: "+a),delete this.interruptReasons_[a],as(this.interruptReasons_)&&(this.reconnectDelay_=dZ,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(a){let b=a-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:b})}cancelSentTransactions_(){for(let a=0;a<this.outstandingPuts_.length;a++){let b=this.outstandingPuts_[a];b&&"h"in b.request&&b.queued&&(b.onComplete&&b.onComplete("disconnect"),delete this.outstandingPuts_[a],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(a,b){let c;c=b?b.map(a=>ct(a)).join("$"):"default";let d=this.removeListen_(a,c);d&&d.onComplete&&d.onComplete("permission_denied")}removeListen_(a,b){let c,d=new dF(a).toString();if(this.listens.has(d)){let a=this.listens.get(d);c=a.get(b),a.delete(b),0===a.size&&this.listens.delete(d)}else c=void 0;return c}onAuthRevoked_(a,b){cg("Auth token revoked: "+a+"/"+b),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===a||"permission_denied"===a)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=d3&&(this.reconnectDelay_=d_,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(a,b){cg("App check token revoked: "+a+"/"+b),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===a||"permission_denied"===a)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=d3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(a){this.securityDebugCallback_?this.securityDebugCallback_(a):"msg"in a&&console.log("FIREBASE: "+a.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let a of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let b of a.values())this.sendListen_(b);for(let a=0;a<this.outstandingPuts_.length;a++)this.outstandingPuts_[a]&&this.sendPut_(a);for(;this.onDisconnectRequestQueue_.length;){let a=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(a.action,a.pathString,a.data,a.onComplete)}for(let a=0;a<this.outstandingGets_.length;a++)this.outstandingGets_[a]&&this.sendGet_(a)}sendConnectStats_(){let a={},b="js";ab()&&(b=this.repoInfo_.nodeAdmin?"admin_node":"node"),a["sdk."+b+"."+cP.replace(/\./g,"-")]=1,Y()?a["framework.cordova"]=1:aa()&&(a["framework.reactnative"]=1),this.reportStats(a)}shouldReconnect_(){let a=dC.getInstance().currentlyOnline();return as(this.interruptReasons_)&&a}}d4.nextPersistentConnectionId_=0,d4.nextConnectionId_=0;class d5{constructor(a,b){this.name=a,this.node=b}static Wrap(a,b){return new d5(a,b)}}class d6{getCompare(){return this.compare.bind(this)}indexedValueChanged(a,b){let c=new d5(co,a),d=new d5(co,b);return 0!==this.compare(c,d)}minPost(){return d5.MIN}}class d7 extends d6{static get __EMPTY_NODE(){return d}static set __EMPTY_NODE(a){d=a}compare(a,b){return cq(a.name,b.name)}isDefinedOn(a){throw z("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(a,b){return!1}minPost(){return d5.MIN}maxPost(){return new d5(cp,d)}makePost(a,b){return y("string"==typeof a,"KeyIndex indexValue must always be a string."),new d5(a,d)}toString(){return".key"}}let d8=new d7;class d9{constructor(a,b,c,d,e=null){this.isReverse_=d,this.resultGenerator_=e,this.nodeStack_=[];let f=1;for(;!a.isEmpty();)if(f=b?c(a.key,b):1,d&&(f*=-1),f<0)a=this.isReverse_?a.left:a.right;else if(0===f){this.nodeStack_.push(a);break}else this.nodeStack_.push(a),a=this.isReverse_?a.right:a.left}getNext(){let a;if(0===this.nodeStack_.length)return null;let b=this.nodeStack_.pop();if(a=this.resultGenerator_?this.resultGenerator_(b.key,b.value):{key:b.key,value:b.value},this.isReverse_)for(b=b.left;!b.isEmpty();)this.nodeStack_.push(b),b=b.right;else for(b=b.right;!b.isEmpty();)this.nodeStack_.push(b),b=b.left;return a}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let a=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(a.key,a.value):{key:a.key,value:a.value}}}class ea{constructor(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:ea.RED,this.left=null!=d?d:ec.EMPTY_NODE,this.right=null!=e?e:ec.EMPTY_NODE}copy(a,b,c,d,e){return new ea(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||!!a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,b,c){let d=this,e=c(a,d.key);return(d=e<0?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c))).fixUp_()}removeMin_(){if(this.left.isEmpty())return ec.EMPTY_NODE;let a=this;return a.left.isRed_()||a.left.left.isRed_()||(a=a.moveRedLeft_()),(a=a.copy(null,null,null,a.left.removeMin_(),null)).fixUp_()}remove(a,b){let c,d;if(c=this,0>b(a,c.key))c.left.isEmpty()||c.left.isRed_()||c.left.left.isRed_()||(c=c.moveRedLeft_()),c=c.copy(null,null,null,c.left.remove(a,b),null);else{if(c.left.isRed_()&&(c=c.rotateRight_()),c.right.isEmpty()||c.right.isRed_()||c.right.left.isRed_()||(c=c.moveRedRight_()),0===b(a,c.key))if(c.right.isEmpty())return ec.EMPTY_NODE;else d=c.right.min_(),c=c.copy(d.key,d.value,null,null,c.right.removeMin_());c=c.copy(null,null,null,null,c.right.remove(a,b))}return c.fixUp_()}isRed_(){return this.color}fixUp_(){let a=this;return a.right.isRed_()&&!a.left.isRed_()&&(a=a.rotateLeft_()),a.left.isRed_()&&a.left.left.isRed_()&&(a=a.rotateRight_()),a.left.isRed_()&&a.right.isRed_()&&(a=a.colorFlip_()),a}moveRedLeft_(){let a=this.colorFlip_();return a.right.left.isRed_()&&(a=(a=(a=a.copy(null,null,null,null,a.right.rotateRight_())).rotateLeft_()).colorFlip_()),a}moveRedRight_(){let a=this.colorFlip_();return a.left.left.isRed_()&&(a=(a=a.rotateRight_()).colorFlip_()),a}rotateLeft_(){let a=this.copy(null,null,ea.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight_(){let a=this.copy(null,null,ea.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip_(){let a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let a=this.left.check_();if(a===this.right.check_())return a+ +!this.isRed_();throw Error("Black depths differ")}}ea.RED=!0,ea.BLACK=!1;class eb{copy(a,b,c,d,e){return this}insert(a,b,c){return new ea(a,b,null)}remove(a,b){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class ec{constructor(a,b=ec.EMPTY_NODE){this.comparator_=a,this.root_=b}insert(a,b){return new ec(this.comparator_,this.root_.insert(a,b,this.comparator_).copy(null,null,ea.BLACK,null,null))}remove(a){return new ec(this.comparator_,this.root_.remove(a,this.comparator_).copy(null,null,ea.BLACK,null,null))}get(a){let b,c=this.root_;for(;!c.isEmpty();){if(0===(b=this.comparator_(a,c.key)))return c.value;b<0?c=c.left:b>0&&(c=c.right)}return null}getPredecessorKey(a){let b,c=this.root_,d=null;for(;!c.isEmpty();){if(0===(b=this.comparator_(a,c.key)))if(c.left.isEmpty())if(d)return d.key;else return null;else{for(c=c.left;!c.right.isEmpty();)c=c.right;return c.key}b<0?c=c.left:b>0&&(d=c,c=c.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(a){return this.root_.inorderTraversal(a)}reverseTraversal(a){return this.root_.reverseTraversal(a)}getIterator(a){return new d9(this.root_,null,this.comparator_,!1,a)}getIteratorFrom(a,b){return new d9(this.root_,a,this.comparator_,!1,b)}getReverseIteratorFrom(a,b){return new d9(this.root_,a,this.comparator_,!0,b)}getReverseIterator(a){return new d9(this.root_,null,this.comparator_,!0,a)}}function ed(a,b){return cq(a.name,b.name)}function ee(a,b){return cq(a,b)}function ef(a){e=a}ec.EMPTY_NODE=new eb;let eg=function(a){return"number"==typeof a?"number:"+cw(a):"string:"+a},eh=function(a){if(a.isLeafNode()){let b=a.val();y("string"==typeof b||"number"==typeof b||"object"==typeof b&&aq(b,".sv"),"Priority must be a string or number.")}else y(a===e||a.isEmpty(),"priority of unexpected type.");y(a===e||a.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class ei{static set __childrenNodeConstructor(a){f=a}static get __childrenNodeConstructor(){return f}constructor(a,b=ei.__childrenNodeConstructor.EMPTY_NODE){this.value_=a,this.priorityNode_=b,this.lazyHash_=null,y(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),eh(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(a){return new ei(this.value_,a)}getImmediateChild(a){return".priority"===a?this.priorityNode_:ei.__childrenNodeConstructor.EMPTY_NODE}getChild(a){return dP(a)?this:".priority"===dH(a)?this.priorityNode_:ei.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(a,b){return null}updateImmediateChild(a,b){return".priority"===a?this.updatePriority(b):b.isEmpty()&&".priority"!==a?this:ei.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(a,b).updatePriority(this.priorityNode_)}updateChild(a,b){let c=dH(a);return null===c?b:b.isEmpty()&&".priority"!==c?this:(y(".priority"!==c||1===dI(a),".priority must be the last token in a path"),this.updateImmediateChild(c,ei.__childrenNodeConstructor.EMPTY_NODE.updateChild(dJ(a),b)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(a,b){return!1}val(a){return a&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let a="";this.priorityNode_.isEmpty()||(a+="priority:"+eg(this.priorityNode_.val())+":");let b=typeof this.value_;a+=b+":","number"===b?a+=cw(this.value_):a+=this.value_,this.lazyHash_=cb(a)}return this.lazyHash_}getValue(){return this.value_}compareTo(a){return a===ei.__childrenNodeConstructor.EMPTY_NODE?1:a instanceof ei.__childrenNodeConstructor?-1:(y(a.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(a))}compareToLeafNode_(a){let b=typeof a.value_,c=typeof this.value_,d=ei.VALUE_TYPE_ORDER.indexOf(b),e=ei.VALUE_TYPE_ORDER.indexOf(c);return(y(d>=0,"Unknown leaf type: "+b),y(e>=0,"Unknown leaf type: "+c),d!==e)?e-d:"object"===c?0:this.value_<a.value_?-1:1*(this.value_!==a.value_)}withIndex(){return this}isIndexed(){return!0}equals(a){if(a===this)return!0;if(!a.isLeafNode())return!1;{let b=a;return this.value_===b.value_&&this.priorityNode_.equals(b.priorityNode_)}}}function ej(a){g=a}function ek(a){h=a}ei.VALUE_TYPE_ORDER=["object","boolean","number","string"];class el extends d6{compare(a,b){let c=a.node.getPriority(),d=b.node.getPriority(),e=c.compareTo(d);return 0===e?cq(a.name,b.name):e}isDefinedOn(a){return!a.getPriority().isEmpty()}indexedValueChanged(a,b){return!a.getPriority().equals(b.getPriority())}minPost(){return d5.MIN}maxPost(){return new d5(cp,new ei("[PRIORITY-POST]",h))}makePost(a,b){return new d5(b,new ei("[PRIORITY-POST]",g(a)))}toString(){return".priority"}}let em=new el,en=Math.log(2);class eo{constructor(a){const b=a=>parseInt(Math.log(a)/en,10),c=a=>parseInt(Array(a+1).join("1"),2);this.count=b(a+1),this.current_=this.count-1;const d=c(this.count);this.bits_=a+1&d}nextBitIsOne(){let a=!(this.bits_&1<<this.current_);return this.current_--,a}}let ep=function(a,b,c,d){a.sort(b);let e=function(b,d){let f,g,h=d-b;if(0===h)return null;if(1===h)return f=a[b],new ea(g=c?c(f):f,f.node,ea.BLACK,null,null);{let i=parseInt(h/2,10)+b,j=e(b,i),k=e(i+1,d);return f=a[i],new ea(g=c?c(f):f,f.node,ea.BLACK,j,k)}};return new ec(d||b,function(b){let d=null,f=null,g=a.length,h=function(b,d){let f=g-b,h=g;g-=b;let j=e(f+1,h),k=a[f];i(new ea(c?c(k):k,k.node,d,null,j))},i=function(a){d?d.left=a:f=a,d=a};for(let a=0;a<b.count;++a){let c=b.nextBitIsOne(),d=Math.pow(2,b.count-(a+1));c?h(d,ea.BLACK):(h(d,ea.BLACK),h(d,ea.RED))}return f}(new eo(a.length)))},eq={};class er{static get Default(){return y(eq&&em,"ChildrenNode.ts has not been loaded"),i=i||new er({".priority":eq},{".priority":em})}constructor(a,b){this.indexes_=a,this.indexSet_=b}get(a){let b=ar(this.indexes_,a);if(!b)throw Error("No index defined for "+a);return b instanceof ec?b:null}hasIndex(a){return aq(this.indexSet_,a.toString())}addIndex(a,b){let c;y(a!==d8,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let d=[],e=!1,f=b.getIterator(d5.Wrap),g=f.getNext();for(;g;)e=e||a.isDefinedOn(g.node),d.push(g),g=f.getNext();c=e?ep(d,a.getCompare()):eq;let h=a.toString(),i={...this.indexSet_};i[h]=a;let j={...this.indexes_};return j[h]=c,new er(j,i)}addToIndexes(a,b){return new er(at(this.indexes_,(c,d)=>{let e=ar(this.indexSet_,d);if(y(e,"Missing index implementation for "+d),c===eq)if(!e.isDefinedOn(a.node))return eq;else{let c=[],d=b.getIterator(d5.Wrap),f=d.getNext();for(;f;)f.name!==a.name&&c.push(f),f=d.getNext();return c.push(a),ep(c,e.getCompare())}{let d=b.get(a.name),e=c;return d&&(e=e.remove(new d5(a.name,d))),e.insert(a,a.node)}}),this.indexSet_)}removeFromIndexes(a,b){return new er(at(this.indexes_,c=>{if(c===eq)return c;{let d=b.get(a.name);return d?c.remove(new d5(a.name,d)):c}}),this.indexSet_)}}class es{static get EMPTY_NODE(){return j||(j=new es(new ec(ee),null,er.Default))}constructor(a,b,c){this.children_=a,this.priorityNode_=b,this.indexMap_=c,this.lazyHash_=null,this.priorityNode_&&eh(this.priorityNode_),this.children_.isEmpty()&&y(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||j}updatePriority(a){return this.children_.isEmpty()?this:new es(this.children_,a,this.indexMap_)}getImmediateChild(a){if(".priority"===a)return this.getPriority();{let b=this.children_.get(a);return null===b?j:b}}getChild(a){let b=dH(a);return null===b?this:this.getImmediateChild(b).getChild(dJ(a))}hasChild(a){return null!==this.children_.get(a)}updateImmediateChild(a,b){if(y(b,"We should always be passing snapshot nodes"),".priority"===a)return this.updatePriority(b);{let c,d,e=new d5(a,b);b.isEmpty()?(c=this.children_.remove(a),d=this.indexMap_.removeFromIndexes(e,this.children_)):(c=this.children_.insert(a,b),d=this.indexMap_.addToIndexes(e,this.children_));let f=c.isEmpty()?j:this.priorityNode_;return new es(c,f,d)}}updateChild(a,b){let c=dH(a);if(null===c)return b;{y(".priority"!==dH(a)||1===dI(a),".priority must be the last token in a path");let d=this.getImmediateChild(c).updateChild(dJ(a),b);return this.updateImmediateChild(c,d)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(a){if(this.isEmpty())return null;let b={},c=0,d=0,e=!0;if(this.forEachChild(em,(f,g)=>{b[f]=g.val(a),c++,e&&es.INTEGER_REGEXP_.test(f)?d=Math.max(d,Number(f)):e=!1}),a||!e||!(d<2*c))return a&&!this.getPriority().isEmpty()&&(b[".priority"]=this.getPriority().val()),b;{let a=[];for(let c in b)a[c]=b[c];return a}}hash(){if(null===this.lazyHash_){let a="";this.getPriority().isEmpty()||(a+="priority:"+eg(this.getPriority().val())+":"),this.forEachChild(em,(b,c)=>{let d=c.hash();""!==d&&(a+=":"+b+":"+d)}),this.lazyHash_=""===a?"":cb(a)}return this.lazyHash_}getPredecessorChildName(a,b,c){let d=this.resolveIndex_(c);if(!d)return this.children_.getPredecessorKey(a);{let c=d.getPredecessorKey(new d5(a,b));return c?c.name:null}}getFirstChildName(a){let b=this.resolveIndex_(a);if(!b)return this.children_.minKey();{let a=b.minKey();return a&&a.name}}getFirstChild(a){let b=this.getFirstChildName(a);return b?new d5(b,this.children_.get(b)):null}getLastChildName(a){let b=this.resolveIndex_(a);if(!b)return this.children_.maxKey();{let a=b.maxKey();return a&&a.name}}getLastChild(a){let b=this.getLastChildName(a);return b?new d5(b,this.children_.get(b)):null}forEachChild(a,b){let c=this.resolveIndex_(a);return c?c.inorderTraversal(a=>b(a.name,a.node)):this.children_.inorderTraversal(b)}getIterator(a){return this.getIteratorFrom(a.minPost(),a)}getIteratorFrom(a,b){let c=this.resolveIndex_(b);if(c)return c.getIteratorFrom(a,a=>a);{let c=this.children_.getIteratorFrom(a.name,d5.Wrap),d=c.peek();for(;null!=d&&0>b.compare(d,a);)c.getNext(),d=c.peek();return c}}getReverseIterator(a){return this.getReverseIteratorFrom(a.maxPost(),a)}getReverseIteratorFrom(a,b){let c=this.resolveIndex_(b);if(c)return c.getReverseIteratorFrom(a,a=>a);{let c=this.children_.getReverseIteratorFrom(a.name,d5.Wrap),d=c.peek();for(;null!=d&&b.compare(d,a)>0;)c.getNext(),d=c.peek();return c}}compareTo(a){if(this.isEmpty())if(a.isEmpty())return 0;else return -1;return a.isLeafNode()||a.isEmpty()?1:a===eu?-1:0}withIndex(a){if(a===d8||this.indexMap_.hasIndex(a))return this;{let b=this.indexMap_.addIndex(a,this.children_);return new es(this.children_,this.priorityNode_,b)}}isIndexed(a){return a===d8||this.indexMap_.hasIndex(a)}equals(a){if(a===this)return!0;{if(a.isLeafNode())return!1;let b=a;if(!this.getPriority().equals(b.getPriority()))return!1;if(this.children_.count()!==b.children_.count())return!1;{let a=this.getIterator(em),c=b.getIterator(em),d=a.getNext(),e=c.getNext();for(;d&&e;){if(d.name!==e.name||!d.node.equals(e.node))return!1;d=a.getNext(),e=c.getNext()}return null===d&&null===e}}}resolveIndex_(a){return a===d8?null:this.indexMap_.get(a.toString())}}es.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class et extends es{constructor(){super(new ec(ee),es.EMPTY_NODE,er.Default)}compareTo(a){return+(a!==this)}equals(a){return a===this}getPriority(){return this}getImmediateChild(a){return es.EMPTY_NODE}isEmpty(){return!1}}let eu=new et;Object.defineProperties(d5,{MIN:{value:new d5(co,es.EMPTY_NODE)},MAX:{value:new d5(cp,eu)}}),d7.__EMPTY_NODE=es.EMPTY_NODE,ei.__childrenNodeConstructor=es,ef(eu),ek(eu);let ev=!0;function ew(a,b=null){if(null===a)return es.EMPTY_NODE;if("object"==typeof a&&".priority"in a&&(b=a[".priority"]),y(null===b||"string"==typeof b||"number"==typeof b||"object"==typeof b&&".sv"in b,"Invalid priority type found: "+typeof b),"object"==typeof a&&".value"in a&&null!==a[".value"]&&(a=a[".value"]),"object"!=typeof a||".sv"in a)return new ei(a,ew(b));if(a instanceof Array||!ev){let c=es.EMPTY_NODE;return cv(a,(b,d)=>{if(aq(a,b)&&"."!==b.substring(0,1)){let a=ew(d);(a.isLeafNode()||!a.isEmpty())&&(c=c.updateImmediateChild(b,a))}}),c.updatePriority(ew(b))}{let c=[],d=!1;if(cv(a,(a,b)=>{if("."!==a.substring(0,1)){let e=ew(b);e.isEmpty()||(d=d||!e.getPriority().isEmpty(),c.push(new d5(a,e)))}}),0===c.length)return es.EMPTY_NODE;let e=ep(c,ed,a=>a.name,ee);if(!d)return new es(e,ew(b),er.Default);{let a=ep(c,em.getCompare());return new es(e,ew(b),new er({".priority":a},{".priority":em}))}}}ej(ew);class ex extends d6{constructor(a){super(),this.indexPath_=a,y(!dP(a)&&".priority"!==dH(a),"Can't create PathIndex with empty path or .priority key")}extractChild(a){return a.getChild(this.indexPath_)}isDefinedOn(a){return!a.getChild(this.indexPath_).isEmpty()}compare(a,b){let c=this.extractChild(a.node),d=this.extractChild(b.node),e=c.compareTo(d);return 0===e?cq(a.name,b.name):e}makePost(a,b){let c=ew(a);return new d5(b,es.EMPTY_NODE.updateChild(this.indexPath_,c))}maxPost(){return new d5(cp,es.EMPTY_NODE.updateChild(this.indexPath_,eu))}toString(){return dM(this.indexPath_,0).join("/")}}class ey extends d6{compare(a,b){let c=a.node.compareTo(b.node);return 0===c?cq(a.name,b.name):c}isDefinedOn(a){return!0}indexedValueChanged(a,b){return!a.equals(b)}minPost(){return d5.MIN}maxPost(){return d5.MAX}makePost(a,b){return new d5(b,ew(a))}toString(){return".value"}}let ez=new ey;function eA(a){return{type:"value",snapshotNode:a}}function eB(a,b){return{type:"child_added",snapshotNode:b,childName:a}}function eC(a,b){return{type:"child_removed",snapshotNode:b,childName:a}}function eD(a,b,c){return{type:"child_changed",snapshotNode:b,childName:a,oldSnap:c}}function eE(a,b){return{type:"child_moved",snapshotNode:b,childName:a}}class eF{constructor(a){this.index_=a}updateChild(a,b,c,d,e,f){y(a.isIndexed(this.index_),"A node must be indexed if only a child is updated");let g=a.getImmediateChild(b);return g.getChild(d).equals(c.getChild(d))&&g.isEmpty()===c.isEmpty()||(null!=f&&(c.isEmpty()?a.hasChild(b)?f.trackChildChange(eC(b,g)):y(a.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):g.isEmpty()?f.trackChildChange(eB(b,c)):f.trackChildChange(eD(b,c,g))),a.isLeafNode()&&c.isEmpty())?a:a.updateImmediateChild(b,c).withIndex(this.index_)}updateFullNode(a,b,c){return null!=c&&(a.isLeafNode()||a.forEachChild(em,(a,d)=>{b.hasChild(a)||c.trackChildChange(eC(a,d))}),b.isLeafNode()||b.forEachChild(em,(b,d)=>{if(a.hasChild(b)){let e=a.getImmediateChild(b);e.equals(d)||c.trackChildChange(eD(b,d,e))}else c.trackChildChange(eB(b,d))})),b.withIndex(this.index_)}updatePriority(a,b){return a.isEmpty()?es.EMPTY_NODE:a.updatePriority(b)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class eG{constructor(a){this.indexedFilter_=new eF(a.getIndex()),this.index_=a.getIndex(),this.startPost_=eG.getStartPost_(a),this.endPost_=eG.getEndPost_(a),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(a){let b=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),a):0>this.index_.compare(this.getStartPost(),a),c=this.endIsInclusive_?0>=this.index_.compare(a,this.getEndPost()):0>this.index_.compare(a,this.getEndPost());return b&&c}updateChild(a,b,c,d,e,f){return this.matches(new d5(b,c))||(c=es.EMPTY_NODE),this.indexedFilter_.updateChild(a,b,c,d,e,f)}updateFullNode(a,b,c){b.isLeafNode()&&(b=es.EMPTY_NODE);let d=b.withIndex(this.index_);d=d.updatePriority(es.EMPTY_NODE);let e=this;return b.forEachChild(em,(a,b)=>{e.matches(new d5(a,b))||(d=d.updateImmediateChild(a,es.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(a,d,c)}updatePriority(a,b){return a}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(a){if(!a.hasStart())return a.getIndex().minPost();{let b=a.getIndexStartName();return a.getIndex().makePost(a.getIndexStartValue(),b)}}static getEndPost_(a){if(!a.hasEnd())return a.getIndex().maxPost();{let b=a.getIndexEndName();return a.getIndex().makePost(a.getIndexEndValue(),b)}}}class eH{constructor(a){this.withinDirectionalStart=a=>this.reverse_?this.withinEndPost(a):this.withinStartPost(a),this.withinDirectionalEnd=a=>this.reverse_?this.withinStartPost(a):this.withinEndPost(a),this.withinStartPost=a=>{let b=this.index_.compare(this.rangedFilter_.getStartPost(),a);return this.startIsInclusive_?b<=0:b<0},this.withinEndPost=a=>{let b=this.index_.compare(a,this.rangedFilter_.getEndPost());return this.endIsInclusive_?b<=0:b<0},this.rangedFilter_=new eG(a),this.index_=a.getIndex(),this.limit_=a.getLimit(),this.reverse_=!a.isViewFromLeft(),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}updateChild(a,b,c,d,e,f){return(this.rangedFilter_.matches(new d5(b,c))||(c=es.EMPTY_NODE),a.getImmediateChild(b).equals(c))?a:a.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(a,b,c,d,e,f):this.fullLimitUpdateChild_(a,b,c,e,f)}updateFullNode(a,b,c){let d;if(b.isLeafNode()||b.isEmpty())d=es.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<b.numChildren()&&b.isIndexed(this.index_)){let a;d=es.EMPTY_NODE.withIndex(this.index_),a=this.reverse_?b.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):b.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;a.hasNext()&&c<this.limit_;){let b=a.getNext();if(this.withinDirectionalStart(b))if(this.withinDirectionalEnd(b))d=d.updateImmediateChild(b.name,b.node),c++;else break}}else{let a;d=(d=b.withIndex(this.index_)).updatePriority(es.EMPTY_NODE),a=this.reverse_?d.getReverseIterator(this.index_):d.getIterator(this.index_);let c=0;for(;a.hasNext();){let b=a.getNext();c<this.limit_&&this.withinDirectionalStart(b)&&this.withinDirectionalEnd(b)?c++:d=d.updateImmediateChild(b.name,es.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(a,d,c)}updatePriority(a,b){return a}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(a,b,c,d,e){let f;if(this.reverse_){let a=this.index_.getCompare();f=(b,c)=>a(c,b)}else f=this.index_.getCompare();let g=a;y(g.numChildren()===this.limit_,"");let h=new d5(b,c),i=this.reverse_?g.getFirstChild(this.index_):g.getLastChild(this.index_),j=this.rangedFilter_.matches(h);if(g.hasChild(b)){let a=g.getImmediateChild(b),k=d.getChildAfterChild(this.index_,i,this.reverse_);for(;null!=k&&(k.name===b||g.hasChild(k.name));)k=d.getChildAfterChild(this.index_,k,this.reverse_);let l=null==k?1:f(k,h);if(j&&!c.isEmpty()&&l>=0)return null!=e&&e.trackChildChange(eD(b,c,a)),g.updateImmediateChild(b,c);{null!=e&&e.trackChildChange(eC(b,a));let c=g.updateImmediateChild(b,es.EMPTY_NODE);return null!=k&&this.rangedFilter_.matches(k)?(null!=e&&e.trackChildChange(eB(k.name,k.node)),c.updateImmediateChild(k.name,k.node)):c}}return c.isEmpty()?a:j?f(i,h)>=0?(null!=e&&(e.trackChildChange(eC(i.name,i.node)),e.trackChildChange(eB(b,c))),g.updateImmediateChild(b,c).updateImmediateChild(i.name,es.EMPTY_NODE)):a:a}}class eI{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=em}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return y(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(y(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:co}hasEnd(){return this.endSet_}getIndexEndValue(){return y(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(y(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:cp}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return y(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===em}copy(){let a=new eI;return a.limitSet_=this.limitSet_,a.limit_=this.limit_,a.startSet_=this.startSet_,a.startAfterSet_=this.startAfterSet_,a.indexStartValue_=this.indexStartValue_,a.startNameSet_=this.startNameSet_,a.indexStartName_=this.indexStartName_,a.endSet_=this.endSet_,a.endBeforeSet_=this.endBeforeSet_,a.indexEndValue_=this.indexEndValue_,a.endNameSet_=this.endNameSet_,a.indexEndName_=this.indexEndName_,a.index_=this.index_,a.viewFrom_=this.viewFrom_,a}}function eJ(a){return a.loadsAllData()?new eF(a.getIndex()):a.hasLimit()?new eH(a):new eG(a)}function eK(a){let b,c={};if(a.isDefault())return c;if(a.index_===em?b="$priority":a.index_===ez?b="$value":a.index_===d8?b="$key":(y(a.index_ instanceof ex,"Unrecognized index type!"),b=a.index_.toString()),c.orderBy=am(b),a.startSet_){let b=a.startAfterSet_?"startAfter":"startAt";c[b]=am(a.indexStartValue_),a.startNameSet_&&(c[b]+=","+am(a.indexStartName_))}if(a.endSet_){let b=a.endBeforeSet_?"endBefore":"endAt";c[b]=am(a.indexEndValue_),a.endNameSet_&&(c[b]+=","+am(a.indexEndName_))}return a.limitSet_&&(a.isViewFromLeft()?c.limitToFirst=a.limit_:c.limitToLast=a.limit_),c}function eL(a){let b={};if(a.startSet_&&(b.sp=a.indexStartValue_,a.startNameSet_&&(b.sn=a.indexStartName_),b.sin=!a.startAfterSet_),a.endSet_&&(b.ep=a.indexEndValue_,a.endNameSet_&&(b.en=a.indexEndName_),b.ein=!a.endBeforeSet_),a.limitSet_){b.l=a.limit_;let c=a.viewFrom_;""===c&&(c=a.isViewFromLeft()?"l":"r"),b.vf=c}return a.index_!==em&&(b.i=a.index_.toString()),b}class eM extends dA{reportStats(a){throw Error("Method not implemented.")}static getListenId_(a,b){return void 0!==b?"tag$"+b:(y(a._queryParams.isDefault(),"should have a tag if it's not a default query."),a._path.toString())}constructor(a,b,c,d){super(),this.repoInfo_=a,this.onDataUpdate_=b,this.authTokenProvider_=c,this.appCheckTokenProvider_=d,this.log_=ch("p:rest:"),this.listens_={}}listen(a,b,c,d){let e=a._path.toString();this.log_("Listen called for "+e+" "+a._queryIdentifier);let f=eM.getListenId_(a,c),g={};this.listens_[f]=g;let h=eK(a._queryParams);this.restRequest_(e+".json",h,(a,b)=>{let h=b;if(404===a&&(h=null,a=null),null===a&&this.onDataUpdate_(e,h,!1,c),ar(this.listens_,f)===g){let b;d(b=a?401===a?"permission_denied":"rest_error:"+a:"ok",null)}})}unlisten(a,b){let c=eM.getListenId_(a,b);delete this.listens_[c]}get(a){let b=eK(a._queryParams),c=a._path.toString(),d=new S;return this.restRequest_(c+".json",b,(a,b)=>{let e=b;404===a&&(e=null,a=null),null===a?(this.onDataUpdate_(c,e,!1,null),d.resolve(e)):d.reject(Error(e))}),d.promise}refreshAuthToken(a){}restRequest_(a,b={},c){return b.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([d,e])=>{d&&d.accessToken&&(b.auth=d.accessToken),e&&e.token&&(b.ac=e.token);let f=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+a+"?ns="+this.repoInfo_.namespace+aw(b);this.log_("Sending REST request for "+f);let g=new XMLHttpRequest;g.onreadystatechange=()=>{if(c&&4===g.readyState){this.log_("REST Response for "+f+" received. status:",g.status,"response:",g.responseText);let a=null;if(g.status>=200&&g.status<300){try{a=al(g.responseText)}catch(a){ck("Failed to parse JSON response for "+f+": "+g.responseText)}c(null,a)}else 401!==g.status&&404!==g.status&&ck("Got unsuccessful REST response for "+f+" Status: "+g.status),c(g.status);c=null}},g.open("GET",f,!0),g.send()})}}class eN{constructor(){this.rootNode_=es.EMPTY_NODE}getNode(a){return this.rootNode_.getChild(a)}updateSnapshot(a,b){this.rootNode_=this.rootNode_.updateChild(a,b)}}function eO(){return{value:null,children:new Map}}function eP(a,b,c){if(dP(b))a.value=c,a.children.clear();else if(null!==a.value)a.value=a.value.updateChild(b,c);else{let d=dH(b);a.children.has(d)||a.children.set(d,eO()),eP(a.children.get(d),b=dJ(b),c)}}function eQ(a,b,c){null!==a.value?c(b,a.value):eR(a,(a,d)=>{eQ(d,new dF(b.toString()+"/"+a),c)})}function eR(a,b){a.children.forEach((a,c)=>{b(c,a)})}class eS{constructor(a){this.collection_=a,this.last_=null}get(){let a=this.collection_.get(),b={...a};return this.last_&&cv(this.last_,(a,c)=>{b[a]=b[a]-c}),this.last_=a,b}}let eT=1e4,eU=3e4,eV=3e5;class eW{constructor(a,b){this.server_=b,this.statsToReport_={},this.statsListener_=new eS(a);const c=eT+(eU-eT)*Math.random();cG(this.reportStats_.bind(this),Math.floor(c))}reportStats_(){let a=this.statsListener_.get(),b={},c=!1;cv(a,(a,d)=>{d>0&&aq(this.statsToReport_,a)&&(b[a]=d,c=!0)}),c&&this.server_.reportStats(b),cG(this.reportStats_.bind(this),Math.floor(2*Math.random()*eV))}}function eX(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function eY(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function eZ(a){return{fromUser:!1,fromServer:!0,queryId:a,tagged:!0}}!function(a){a[a.OVERWRITE=0]="OVERWRITE",a[a.MERGE=1]="MERGE",a[a.ACK_USER_WRITE=2]="ACK_USER_WRITE",a[a.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(o||(o={}));class e${constructor(a,b,c){this.path=a,this.affectedTree=b,this.revert=c,this.type=o.ACK_USER_WRITE,this.source=eX()}operationForChild(a){if(!dP(this.path))return y(dH(this.path)===a,"operationForChild called for unrelated child."),new e$(dJ(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return y(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let b=this.affectedTree.subtree(new dF(a));return new e$(dG(),b,this.revert)}}}class e_{constructor(a,b){this.source=a,this.path=b,this.type=o.LISTEN_COMPLETE}operationForChild(a){return dP(this.path)?new e_(this.source,dG()):new e_(this.source,dJ(this.path))}}class e0{constructor(a,b,c){this.source=a,this.path=b,this.snap=c,this.type=o.OVERWRITE}operationForChild(a){return dP(this.path)?new e0(this.source,dG(),this.snap.getImmediateChild(a)):new e0(this.source,dJ(this.path),this.snap)}}class e1{constructor(a,b,c){this.source=a,this.path=b,this.children=c,this.type=o.MERGE}operationForChild(a){if(!dP(this.path))return y(dH(this.path)===a,"Can't get a merge for a child not on the path of the operation"),new e1(this.source,dJ(this.path),this.children);{let b=this.children.subtree(new dF(a));return b.isEmpty()?null:b.value?new e0(this.source,dG(),b.value):new e1(this.source,dG(),b)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class e2{constructor(a,b,c){this.node_=a,this.fullyInitialized_=b,this.filtered_=c}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(a){if(dP(a))return this.isFullyInitialized()&&!this.filtered_;let b=dH(a);return this.isCompleteForChild(b)}isCompleteForChild(a){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(a)}getNode(){return this.node_}}class e3{constructor(a){this.query_=a,this.index_=this.query_._queryParams.getIndex()}}function e4(a,b,c,d){let e=[],f=[];return b.forEach(b=>{"child_changed"===b.type&&a.index_.indexedValueChanged(b.oldSnap,b.snapshotNode)&&f.push(eE(b.childName,b.snapshotNode))}),e5(a,e,"child_removed",b,d,c),e5(a,e,"child_added",b,d,c),e5(a,e,"child_moved",f,d,c),e5(a,e,"child_changed",b,d,c),e5(a,e,"value",b,d,c),e}function e5(a,b,c,d,e,f){let g=d.filter(a=>a.type===c);g.sort((b,c)=>e7(a,b,c)),g.forEach(c=>{let d=e6(a,c,f);e.forEach(e=>{e.respondsTo(c.type)&&b.push(e.createEvent(d,a.query_))})})}function e6(a,b,c){return"value"===b.type||"child_removed"===b.type||(b.prevName=c.getPredecessorChildName(b.childName,b.snapshotNode,a.index_)),b}function e7(a,b,c){if(null==b.childName||null==c.childName)throw z("Should only compare child_ events.");let d=new d5(b.childName,b.snapshotNode),e=new d5(c.childName,c.snapshotNode);return a.index_.compare(d,e)}function e8(a,b){return{eventCache:a,serverCache:b}}function e9(a,b,c,d){return e8(new e2(b,c,d),a.serverCache)}function fa(a,b,c,d){return e8(a.eventCache,new e2(b,c,d))}function fb(a){return a.eventCache.isFullyInitialized()?a.eventCache.getNode():null}function fc(a){return a.serverCache.isFullyInitialized()?a.serverCache.getNode():null}let fd=()=>(k||(k=new ec(cr)),k);class fe{static fromObject(a){let b=new fe(null);return cv(a,(a,c)=>{b=b.set(new dF(a),c)}),b}constructor(a,b=fd()){this.value=a,this.children=b}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(a,b){if(null!=this.value&&b(this.value))return{path:dG(),value:this.value};{if(dP(a))return null;let c=dH(a),d=this.children.get(c);if(null===d)return null;{let e=d.findRootMostMatchingPathAndValue(dJ(a),b);return null!=e?{path:dO(new dF(c),e.path),value:e.value}:null}}}findRootMostValueAndPath(a){return this.findRootMostMatchingPathAndValue(a,()=>!0)}subtree(a){if(dP(a))return this;{let b=dH(a),c=this.children.get(b);return null!==c?c.subtree(dJ(a)):new fe(null)}}set(a,b){if(dP(a))return new fe(b,this.children);{let c=dH(a),d=(this.children.get(c)||new fe(null)).set(dJ(a),b),e=this.children.insert(c,d);return new fe(this.value,e)}}remove(a){if(dP(a))if(this.children.isEmpty())return new fe(null);else return new fe(null,this.children);{let b=dH(a),c=this.children.get(b);if(!c)return this;{let d,e=c.remove(dJ(a));return(d=e.isEmpty()?this.children.remove(b):this.children.insert(b,e),null===this.value&&d.isEmpty())?new fe(null):new fe(this.value,d)}}}get(a){if(dP(a))return this.value;{let b=dH(a),c=this.children.get(b);return c?c.get(dJ(a)):null}}setTree(a,b){if(dP(a))return b;{let c,d=dH(a),e=(this.children.get(d)||new fe(null)).setTree(dJ(a),b);return c=e.isEmpty()?this.children.remove(d):this.children.insert(d,e),new fe(this.value,c)}}fold(a){return this.fold_(dG(),a)}fold_(a,b){let c={};return this.children.inorderTraversal((d,e)=>{c[d]=e.fold_(dO(a,d),b)}),b(a,this.value,c)}findOnPath(a,b){return this.findOnPath_(a,dG(),b)}findOnPath_(a,b,c){let d=!!this.value&&c(b,this.value);if(d)return d;{if(dP(a))return null;let d=dH(a),e=this.children.get(d);return e?e.findOnPath_(dJ(a),dO(b,d),c):null}}foreachOnPath(a,b){return this.foreachOnPath_(a,dG(),b)}foreachOnPath_(a,b,c){if(dP(a))return this;{this.value&&c(b,this.value);let d=dH(a),e=this.children.get(d);return e?e.foreachOnPath_(dJ(a),dO(b,d),c):new fe(null)}}foreach(a){this.foreach_(dG(),a)}foreach_(a,b){this.children.inorderTraversal((c,d)=>{d.foreach_(dO(a,c),b)}),this.value&&b(a,this.value)}foreachChild(a){this.children.inorderTraversal((b,c)=>{c.value&&a(b,c.value)})}}class ff{constructor(a){this.writeTree_=a}static empty(){return new ff(new fe(null))}}function fg(a,b,c){if(dP(b))return new ff(new fe(c));{let d=a.writeTree_.findRootMostValueAndPath(b);if(null!=d){let e=d.path,f=d.value,g=dQ(e,b);return f=f.updateChild(g,c),new ff(a.writeTree_.set(e,f))}{let d=new fe(c);return new ff(a.writeTree_.setTree(b,d))}}}function fh(a,b,c){let d=a;return cv(c,(a,c)=>{d=fg(d,dO(b,a),c)}),d}function fi(a,b){return dP(b)?ff.empty():new ff(a.writeTree_.setTree(b,new fe(null)))}function fj(a,b){return null!=fk(a,b)}function fk(a,b){let c=a.writeTree_.findRootMostValueAndPath(b);return null!=c?a.writeTree_.get(c.path).getChild(dQ(c.path,b)):null}function fl(a){let b=[],c=a.writeTree_.value;return null!=c?c.isLeafNode()||c.forEachChild(em,(a,c)=>{b.push(new d5(a,c))}):a.writeTree_.children.inorderTraversal((a,c)=>{null!=c.value&&b.push(new d5(a,c.value))}),b}function fm(a,b){if(dP(b))return a;{let c=fk(a,b);return new ff(null!=c?new fe(c):a.writeTree_.subtree(b))}}function fn(a){return a.writeTree_.isEmpty()}function fo(a,b){return fp(dG(),a.writeTree_,b)}function fp(a,b,c){if(null!=b.value)return c.updateChild(a,b.value);{let d=null;return b.children.inorderTraversal((b,e)=>{".priority"===b?(y(null!==e.value,"Priority writes must always be leaf nodes"),d=e.value):c=fp(dO(a,b),e,c)}),c.getChild(a).isEmpty()||null===d||(c=c.updateChild(dO(a,".priority"),d)),c}}function fq(a,b){return fM(b,a)}function fr(a,b,c,d,e){y(d>a.lastWriteId,"Stacking an older write on top of newer ones"),void 0===e&&(e=!0),a.allWrites.push({path:b,snap:c,writeId:d,visible:e}),e&&(a.visibleWrites=fg(a.visibleWrites,b,c)),a.lastWriteId=d}function fs(a,b){for(let c=0;c<a.allWrites.length;c++){let d=a.allWrites[c];if(d.writeId===b)return d}return null}function ft(a,b){let c=a.allWrites.findIndex(a=>a.writeId===b);y(c>=0,"removeWrite called with nonexistent writeId.");let d=a.allWrites[c];a.allWrites.splice(c,1);let e=d.visible,f=!1,g=a.allWrites.length-1;for(;e&&g>=0;){let b=a.allWrites[g];b.visible&&(g>=c&&fu(b,d.path)?e=!1:dS(d.path,b.path)&&(f=!0)),g--}return!!e&&(f?fv(a):d.snap?a.visibleWrites=fi(a.visibleWrites,d.path):cv(d.children,b=>{a.visibleWrites=fi(a.visibleWrites,dO(d.path,b))}),!0)}function fu(a,b){if(a.snap)return dS(a.path,b);for(let c in a.children)if(a.children.hasOwnProperty(c)&&dS(dO(a.path,c),b))return!0;return!1}function fv(a){a.visibleWrites=fx(a.allWrites,fw,dG()),a.allWrites.length>0?a.lastWriteId=a.allWrites[a.allWrites.length-1].writeId:a.lastWriteId=-1}function fw(a){return a.visible}function fx(a,b,c){let d=ff.empty();for(let e=0;e<a.length;++e){let f=a[e];if(b(f)){let a,b=f.path;if(f.snap)dS(c,b)?d=fg(d,a=dQ(c,b),f.snap):dS(b,c)&&(a=dQ(b,c),d=fg(d,dG(),f.snap.getChild(a)));else if(f.children){if(dS(c,b))d=fh(d,a=dQ(c,b),f.children);else if(dS(b,c))if(dP(a=dQ(b,c)))d=fh(d,dG(),f.children);else{let b=ar(f.children,dH(a));if(b){let c=b.getChild(dJ(a));d=fg(d,dG(),c)}}}else throw z("WriteRecord should have .snap or .children")}}return d}function fy(a,b,c,d,e){if(d||e){let f=fm(a.visibleWrites,b);if(!e&&fn(f))return c;{if(!e&&null==c&&!fj(f,dG()))return null;let g=function(a){return(a.visible||e)&&(!d||!~d.indexOf(a.writeId))&&(dS(a.path,b)||dS(b,a.path))};return fo(fx(a.allWrites,g,b),c||es.EMPTY_NODE)}}{let d=fk(a.visibleWrites,b);if(null!=d)return d;{let d=fm(a.visibleWrites,b);return fn(d)?c:null!=c||fj(d,dG())?fo(d,c||es.EMPTY_NODE):null}}}function fz(a,b,c){let d=es.EMPTY_NODE,e=fk(a.visibleWrites,b);if(e)return e.isLeafNode()||e.forEachChild(em,(a,b)=>{d=d.updateImmediateChild(a,b)}),d;if(!c)return fl(fm(a.visibleWrites,b)).forEach(a=>{d=d.updateImmediateChild(a.name,a.node)}),d;{let e=fm(a.visibleWrites,b);return c.forEachChild(em,(a,b)=>{let c=fo(fm(e,new dF(a)),b);d=d.updateImmediateChild(a,c)}),fl(e).forEach(a=>{d=d.updateImmediateChild(a.name,a.node)}),d}}function fA(a,b,c,d,e){y(d||e,"Either existingEventSnap or existingServerSnap must exist");let f=dO(b,c);if(fj(a.visibleWrites,f))return null;{let b=fm(a.visibleWrites,f);return fn(b)?e.getChild(c):fo(b,e.getChild(c))}}function fB(a,b,c,d){let e=dO(b,c),f=fk(a.visibleWrites,e);return null!=f?f:d.isCompleteForChild(c)?fo(fm(a.visibleWrites,e),d.getNode().getImmediateChild(c)):null}function fC(a,b){return fk(a.visibleWrites,b)}function fD(a,b,c,d,e,f,g){let h,i=fm(a.visibleWrites,b),j=fk(i,dG());if(null!=j)h=j;else{if(null==c)return[];h=fo(i,c)}if((h=h.withIndex(g)).isEmpty()||h.isLeafNode())return[];{let a=[],b=g.getCompare(),c=f?h.getReverseIteratorFrom(d,g):h.getIteratorFrom(d,g),i=c.getNext();for(;i&&a.length<e;)0!==b(i,d)&&a.push(i),i=c.getNext();return a}}function fE(){return{visibleWrites:ff.empty(),allWrites:[],lastWriteId:-1}}function fF(a,b,c,d){return fy(a.writeTree,a.treePath,b,c,d)}function fG(a,b){return fz(a.writeTree,a.treePath,b)}function fH(a,b,c,d){return fA(a.writeTree,a.treePath,b,c,d)}function fI(a,b){return fC(a.writeTree,dO(a.treePath,b))}function fJ(a,b,c,d,e,f){return fD(a.writeTree,a.treePath,b,c,d,e,f)}function fK(a,b,c){return fB(a.writeTree,a.treePath,b,c)}function fL(a,b){return fM(dO(a.treePath,b),a.writeTree)}function fM(a,b){return{treePath:a,writeTree:b}}class fN{constructor(){this.changeMap=new Map}trackChildChange(a){let b=a.type,c=a.childName;y("child_added"===b||"child_changed"===b||"child_removed"===b,"Only child changes supported for tracking"),y(".priority"!==c,"Only non-priority child changes can be tracked.");let d=this.changeMap.get(c);if(d){let e=d.type;if("child_added"===b&&"child_removed"===e)this.changeMap.set(c,eD(c,a.snapshotNode,d.snapshotNode));else if("child_removed"===b&&"child_added"===e)this.changeMap.delete(c);else if("child_removed"===b&&"child_changed"===e)this.changeMap.set(c,eC(c,d.oldSnap));else if("child_changed"===b&&"child_added"===e)this.changeMap.set(c,eB(c,a.snapshotNode));else if("child_changed"===b&&"child_changed"===e)this.changeMap.set(c,eD(c,a.snapshotNode,d.oldSnap));else throw z("Illegal combination of changes: "+a+" occurred after "+d)}else this.changeMap.set(c,a)}getChanges(){return Array.from(this.changeMap.values())}}class fO{getCompleteChild(a){return null}getChildAfterChild(a,b,c){return null}}let fP=new fO;class fQ{constructor(a,b,c=null){this.writes_=a,this.viewCache_=b,this.optCompleteServerCache_=c}getCompleteChild(a){let b=this.viewCache_.eventCache;if(b.isCompleteForChild(a))return b.getNode().getImmediateChild(a);{let b=null!=this.optCompleteServerCache_?new e2(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return fK(this.writes_,a,b)}}getChildAfterChild(a,b,c){let d=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:fc(this.viewCache_),e=fJ(this.writes_,d,b,1,c,a);return 0===e.length?null:e[0]}}function fR(a){return{filter:a}}function fS(a,b){y(b.eventCache.getNode().isIndexed(a.filter.getIndex()),"Event snap not indexed"),y(b.serverCache.getNode().isIndexed(a.filter.getIndex()),"Server snap not indexed")}function fT(a,b,c,d,e){let f,g,h=new fN;if(c.type===o.OVERWRITE){let i=c;i.source.fromUser?f=fX(a,b,i.path,i.snap,d,e,h):(y(i.source.fromServer,"Unknown source."),g=i.source.tagged||b.serverCache.isFiltered()&&!dP(i.path),f=fW(a,b,i.path,i.snap,d,e,g,h))}else if(c.type===o.MERGE){let i=c;i.source.fromUser?f=fZ(a,b,i.path,i.children,d,e,h):(y(i.source.fromServer,"Unknown source."),g=i.source.tagged||b.serverCache.isFiltered(),f=f_(a,b,i.path,i.children,d,e,g,h))}else if(c.type===o.ACK_USER_WRITE){let g=c;f=g.revert?f2(a,b,g.path,d,e,h):f0(a,b,g.path,g.affectedTree,d,e,h)}else if(c.type===o.LISTEN_COMPLETE)f=f1(a,b,c.path,d,h);else throw z("Unknown operation type: "+c.type);let i=h.getChanges();return fU(b,f,i),{viewCache:f,changes:i}}function fU(a,b,c){let d=b.eventCache;if(d.isFullyInitialized()){let e=d.getNode().isLeafNode()||d.getNode().isEmpty(),f=fb(a);!(c.length>0)&&a.eventCache.isFullyInitialized()&&(!e||d.getNode().equals(f))&&d.getNode().getPriority().equals(f.getPriority())||c.push(eA(fb(b)))}}function fV(a,b,c,d,e,f){let g=b.eventCache;if(null!=fI(d,c))return b;{let h,i;if(dP(c))if(y(b.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),b.serverCache.isFiltered()){let c=fc(b),e=fG(d,c instanceof es?c:es.EMPTY_NODE);h=a.filter.updateFullNode(b.eventCache.getNode(),e,f)}else{let c=fF(d,fc(b));h=a.filter.updateFullNode(b.eventCache.getNode(),c,f)}else{let j=dH(c);if(".priority"===j){y(1===dI(c),"Can't have a priority with additional path components");let e=g.getNode(),f=fH(d,c,e,i=b.serverCache.getNode());h=null!=f?a.filter.updatePriority(e,f):g.getNode()}else{let k,l=dJ(c);if(g.isCompleteForChild(j)){i=b.serverCache.getNode();let a=fH(d,c,g.getNode(),i);k=null!=a?g.getNode().getImmediateChild(j).updateChild(l,a):g.getNode().getImmediateChild(j)}else k=fK(d,j,b.serverCache);h=null!=k?a.filter.updateChild(g.getNode(),j,k,l,e,f):g.getNode()}}return e9(b,h,g.isFullyInitialized()||dP(c),a.filter.filtersNodes())}}function fW(a,b,c,d,e,f,g,h){let i,j=b.serverCache,k=g?a.filter:a.filter.getIndexedFilter();if(dP(c))i=k.updateFullNode(j.getNode(),d,null);else if(k.filtersNodes()&&!j.isFiltered()){let a=j.getNode().updateChild(c,d);i=k.updateFullNode(j.getNode(),a,null)}else{let a=dH(c);if(!j.isCompleteForPath(c)&&dI(c)>1)return b;let e=dJ(c),f=j.getNode().getImmediateChild(a).updateChild(e,d);i=".priority"===a?k.updatePriority(j.getNode(),f):k.updateChild(j.getNode(),a,f,e,fP,null)}let l=fa(b,i,j.isFullyInitialized()||dP(c),k.filtersNodes()),m=new fQ(e,l,f);return fV(a,l,c,e,m,h)}function fX(a,b,c,d,e,f,g){let h,i,j=b.eventCache,k=new fQ(e,b,f);if(dP(c))i=a.filter.updateFullNode(b.eventCache.getNode(),d,g),h=e9(b,i,!0,a.filter.filtersNodes());else{let e=dH(c);if(".priority"===e)i=a.filter.updatePriority(b.eventCache.getNode(),d),h=e9(b,i,j.isFullyInitialized(),j.isFiltered());else{let f,i=dJ(c),l=j.getNode().getImmediateChild(e);if(dP(i))f=d;else{let a=k.getCompleteChild(e);f=null!=a?".priority"===dK(i)&&a.getChild(dN(i)).isEmpty()?a:a.updateChild(i,d):es.EMPTY_NODE}h=l.equals(f)?b:e9(b,a.filter.updateChild(j.getNode(),e,f,i,k,g),j.isFullyInitialized(),a.filter.filtersNodes())}}return h}function fY(a,b){return a.eventCache.isCompleteForChild(b)}function fZ(a,b,c,d,e,f,g){let h=b;return d.foreach((d,i)=>{let j=dO(c,d);fY(b,dH(j))&&(h=fX(a,h,j,i,e,f,g))}),d.foreach((d,i)=>{let j=dO(c,d);fY(b,dH(j))||(h=fX(a,h,j,i,e,f,g))}),h}function f$(a,b,c){return c.foreach((a,c)=>{b=b.updateChild(a,c)}),b}function f_(a,b,c,d,e,f,g,h){let i;if(b.serverCache.getNode().isEmpty()&&!b.serverCache.isFullyInitialized())return b;let j=b;i=dP(c)?d:new fe(null).setTree(c,d);let k=b.serverCache.getNode();return i.children.inorderTraversal((c,d)=>{if(k.hasChild(c)){let i=f$(a,b.serverCache.getNode().getImmediateChild(c),d);j=fW(a,j,new dF(c),i,e,f,g,h)}}),i.children.inorderTraversal((c,d)=>{let i=!b.serverCache.isCompleteForChild(c)&&null===d.value;if(!k.hasChild(c)&&!i){let i=f$(a,b.serverCache.getNode().getImmediateChild(c),d);j=fW(a,j,new dF(c),i,e,f,g,h)}}),j}function f0(a,b,c,d,e,f,g){if(null!=fI(e,c))return b;let h=b.serverCache.isFiltered(),i=b.serverCache;if(null!=d.value)if(dP(c)&&i.isFullyInitialized()||i.isCompleteForPath(c))return fW(a,b,c,i.getNode().getChild(c),e,f,h,g);else{if(!dP(c))return b;let d=new fe(null);return i.getNode().forEachChild(d8,(a,b)=>{d=d.set(new dF(a),b)}),f_(a,b,c,d,e,f,h,g)}{let j=new fe(null);return d.foreach((a,b)=>{let d=dO(c,a);i.isCompleteForPath(d)&&(j=j.set(a,i.getNode().getChild(d)))}),f_(a,b,c,j,e,f,h,g)}}function f1(a,b,c,d,e){let f=b.serverCache;return fV(a,fa(b,f.getNode(),f.isFullyInitialized()||dP(c),f.isFiltered()),c,d,fP,e)}function f2(a,b,c,d,e,f){let g;if(null!=fI(d,c))return b;{let h,i=new fQ(d,b,e),j=b.eventCache.getNode();if(dP(c)||".priority"===dH(c)){let c;if(b.serverCache.isFullyInitialized())c=fF(d,fc(b));else{let a=b.serverCache.getNode();y(a instanceof es,"serverChildren would be complete if leaf node"),c=fG(d,a)}h=a.filter.updateFullNode(j,c,f)}else{let e=dH(c),k=fK(d,e,b.serverCache);null==k&&b.serverCache.isCompleteForChild(e)&&(k=j.getImmediateChild(e)),(h=null!=k?a.filter.updateChild(j,e,k,dJ(c),i,f):b.eventCache.getNode().hasChild(e)?a.filter.updateChild(j,e,es.EMPTY_NODE,dJ(c),i,f):j).isEmpty()&&b.serverCache.isFullyInitialized()&&(g=fF(d,fc(b))).isLeafNode()&&(h=a.filter.updateFullNode(h,g,f))}return g=b.serverCache.isFullyInitialized()||null!=fI(d,dG()),e9(b,h,g,a.filter.filtersNodes())}}class f3{constructor(a,b){this.query_=a,this.eventRegistrations_=[];const c=this.query_._queryParams,d=new eF(c.getIndex()),e=eJ(c);this.processor_=fR(e);const f=b.serverCache,g=b.eventCache,h=d.updateFullNode(es.EMPTY_NODE,f.getNode(),null),i=e.updateFullNode(es.EMPTY_NODE,g.getNode(),null),j=new e2(h,f.isFullyInitialized(),d.filtersNodes()),k=new e2(i,g.isFullyInitialized(),e.filtersNodes());this.viewCache_=e8(k,j),this.eventGenerator_=new e3(this.query_)}get query(){return this.query_}}function f4(a){return a.viewCache_.serverCache.getNode()}function f5(a,b){let c=fc(a.viewCache_);return c&&(a.query._queryParams.loadsAllData()||!dP(b)&&!c.getImmediateChild(dH(b)).isEmpty())?c.getChild(b):null}function f6(a){return 0===a.eventRegistrations_.length}function f7(a,b){a.eventRegistrations_.push(b)}function f8(a,b,c){let d=[];if(c){y(null==b,"A cancel should cancel all event registrations.");let e=a.query._path;a.eventRegistrations_.forEach(a=>{let b=a.createCancelEvent(c,e);b&&d.push(b)})}if(b){let c=[];for(let d=0;d<a.eventRegistrations_.length;++d){let e=a.eventRegistrations_[d];if(e.matches(b)){if(b.hasAnyCallback()){c=c.concat(a.eventRegistrations_.slice(d+1));break}}else c.push(e)}a.eventRegistrations_=c}else a.eventRegistrations_=[];return d}function f9(a,b,c,d){b.type===o.MERGE&&null!==b.source.queryId&&(y(fc(a.viewCache_),"We should always have a full cache before handling merges"),y(fb(a.viewCache_),"Missing event cache, even though we have a server cache"));let e=a.viewCache_,f=fT(a.processor_,e,b,c,d);return fS(a.processor_,f.viewCache),y(f.viewCache.serverCache.isFullyInitialized()||!e.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),a.viewCache_=f.viewCache,gb(a,f.changes,f.viewCache.eventCache.getNode(),null)}function ga(a,b){let c=a.viewCache_.eventCache,d=[];return c.getNode().isLeafNode()||c.getNode().forEachChild(em,(a,b)=>{d.push(eB(a,b))}),c.isFullyInitialized()&&d.push(eA(c.getNode())),gb(a,d,c.getNode(),b)}function gb(a,b,c,d){let e=d?[d]:a.eventRegistrations_;return e4(a.eventGenerator_,b,c,e)}class gc{constructor(){this.views=new Map}}function gd(a){y(!l,"__referenceConstructor has already been defined"),l=a}function ge(){return y(l,"Reference.ts has not been loaded"),l}function gf(a){return 0===a.views.size}function gg(a,b,c,d){let e=b.source.queryId;if(null!==e){let f=a.views.get(e);return y(null!=f,"SyncTree gave us an op for an invalid query."),f9(f,b,c,d)}{let e=[];for(let f of a.views.values())e=e.concat(f9(f,b,c,d));return e}}function gh(a,b,c,d,e){let f=b._queryIdentifier,g=a.views.get(f);if(!g){let a=fF(c,e?d:null),f=!1;return a?f=!0:(a=d instanceof es?fG(c,d):es.EMPTY_NODE,f=!1),new f3(b,e8(new e2(a,f,!1),new e2(d,e,!1)))}return g}function gi(a,b,c,d,e,f){let g=gh(a,b,d,e,f);return a.views.has(b._queryIdentifier)||a.views.set(b._queryIdentifier,g),f7(g,c),ga(g,c)}function gj(a,b,c,d){let e=b._queryIdentifier,f=[],g=[],h=go(a);if("default"===e)for(let[b,e]of a.views.entries())g=g.concat(f8(e,c,d)),f6(e)&&(a.views.delete(b),e.query._queryParams.loadsAllData()||f.push(e.query));else{let b=a.views.get(e);b&&(g=g.concat(f8(b,c,d)),f6(b)&&(a.views.delete(e),b.query._queryParams.loadsAllData()||f.push(b.query)))}return h&&!go(a)&&f.push(new(ge())(b._repo,b._path)),{removed:f,events:g}}function gk(a){let b=[];for(let c of a.views.values())c.query._queryParams.loadsAllData()||b.push(c);return b}function gl(a,b){let c=null;for(let d of a.views.values())c=c||f5(d,b);return c}function gm(a,b){if(b._queryParams.loadsAllData())return gp(a);{let c=b._queryIdentifier;return a.views.get(c)}}function gn(a,b){return null!=gm(a,b)}function go(a){return null!=gp(a)}function gp(a){for(let b of a.views.values())if(b.query._queryParams.loadsAllData())return b;return null}function gq(a){y(!m,"__referenceConstructor has already been defined"),m=a}function gr(){return y(m,"Reference.ts has not been loaded"),m}let gs=1;class gt{constructor(a){this.listenProvider_=a,this.syncPointTree_=new fe(null),this.pendingWriteTree_=fE(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function gu(a,b,c,d,e){return(fr(a.pendingWriteTree_,b,c,d,e),e)?gF(a,new e0(eX(),b,c)):[]}function gv(a,b,c=!1){let d=fs(a.pendingWriteTree_,b);if(!ft(a.pendingWriteTree_,b))return[];{let b=new fe(null);return null!=d.snap?b=b.set(dG(),!0):cv(d.children,a=>{b=b.set(new dF(a),!0)}),gF(a,new e$(d.path,b,c))}}function gw(a,b,c){return gF(a,new e0(eY(),b,c))}function gx(a,b,c){let d=fe.fromObject(c);return gF(a,new e1(eY(),b,d))}function gy(a,b){return gF(a,new e_(eY(),b))}function gz(a,b,c){let d=gL(a,c);if(!d)return[];{let c=gM(d),e=c.path,f=c.queryId,g=dQ(e,b);return gN(a,e,new e_(eZ(f),g))}}function gA(a,b,c,d,e=!1){let f=b._path,g=a.syncPointTree_.get(f),h=[];if(g&&("default"===b._queryIdentifier||gn(g,b))){let i=gj(g,b,c,d);gf(g)&&(a.syncPointTree_=a.syncPointTree_.remove(f));let j=i.removed;if(h=i.events,!e){let c=-1!==j.findIndex(a=>a._queryParams.loadsAllData()),e=a.syncPointTree_.findOnPath(f,(a,b)=>go(b));if(c&&!e){let b=a.syncPointTree_.subtree(f);if(!b.isEmpty()){let c=gO(b);for(let b=0;b<c.length;++b){let d=c[b],e=d.query,f=gI(a,d);a.listenProvider_.startListening(gP(e),gJ(a,e),f.hashFn,f.onComplete)}}}if(!e&&j.length>0&&!d)if(c){let c=null;a.listenProvider_.stopListening(gP(b),c)}else j.forEach(b=>{let c=a.queryToTagMap.get(gK(b));a.listenProvider_.stopListening(gP(b),c)})}gQ(a,j)}return h}function gB(a,b,c,d){let e=gL(a,d);if(null==e)return[];{let d=gM(e),f=d.path,g=d.queryId,h=dQ(f,b);return gN(a,f,new e0(eZ(g),h,c))}}function gC(a,b,c,d){let e=gL(a,d);if(!e)return[];{let d=gM(e),f=d.path,g=d.queryId,h=dQ(f,b),i=fe.fromObject(c);return gN(a,f,new e1(eZ(g),h,i))}}function gD(a,b,c,d=!1){let e,f=b._path,g=null,h=!1;a.syncPointTree_.foreachOnPath(f,(a,b)=>{let c=dQ(a,f);g=g||gl(b,c),h=h||go(b)});let i=a.syncPointTree_.get(f);i?(h=h||go(i),g=g||gl(i,dG())):(i=new gc,a.syncPointTree_=a.syncPointTree_.set(f,i)),null!=g?e=!0:(e=!1,g=es.EMPTY_NODE,a.syncPointTree_.subtree(f).foreachChild((a,b)=>{let c=gl(b,dG());c&&(g=g.updateImmediateChild(a,c))}));let j=gn(i,b);if(!j&&!b._queryParams.loadsAllData()){let c=gK(b);y(!a.queryToTagMap.has(c),"View does not exist, but we have a tag");let d=gR();a.queryToTagMap.set(c,d),a.tagToQueryMap.set(d,c)}let k=gi(i,b,c,fq(a.pendingWriteTree_,f),g,e);if(!j&&!h&&!d){let c=gm(i,b);k=k.concat(gS(a,b,c))}return k}function gE(a,b,c){let d=!0,e=a.pendingWriteTree_,f=a.syncPointTree_.findOnPath(b,(a,c)=>{let d=gl(c,dQ(a,b));if(d)return d});return fy(e,b,f,c,d)}function gF(a,b){return gG(b,a.syncPointTree_,null,fq(a.pendingWriteTree_,dG()))}function gG(a,b,c,d){if(dP(a.path))return gH(a,b,c,d);{let e=b.get(dG());null==c&&null!=e&&(c=gl(e,dG()));let f=[],g=dH(a.path),h=a.operationForChild(g),i=b.children.get(g);if(i&&h){let a=c?c.getImmediateChild(g):null,b=fL(d,g);f=f.concat(gG(h,i,a,b))}return e&&(f=f.concat(gg(e,a,d,c))),f}}function gH(a,b,c,d){let e=b.get(dG());null==c&&null!=e&&(c=gl(e,dG()));let f=[];return b.children.inorderTraversal((b,e)=>{let g=c?c.getImmediateChild(b):null,h=fL(d,b),i=a.operationForChild(b);i&&(f=f.concat(gH(i,e,g,h)))}),e&&(f=f.concat(gg(e,a,d,c))),f}function gI(a,b){let c=b.query,d=gJ(a,c);return{hashFn:()=>(f4(b)||es.EMPTY_NODE).hash(),onComplete:b=>{if("ok"===b)if(d)return gz(a,c._path,d);else return gy(a,c._path);{let d=cz(b,c);return gA(a,c,null,d)}}}}function gJ(a,b){let c=gK(b);return a.queryToTagMap.get(c)}function gK(a){return a._path.toString()+"$"+a._queryIdentifier}function gL(a,b){return a.tagToQueryMap.get(b)}function gM(a){let b=a.indexOf("$");return y(-1!==b&&b<a.length-1,"Bad queryKey."),{queryId:a.substr(b+1),path:new dF(a.substr(0,b))}}function gN(a,b,c){let d=a.syncPointTree_.get(b);return y(d,"Missing sync point for query tag that we're tracking"),gg(d,c,fq(a.pendingWriteTree_,b),null)}function gO(a){return a.fold((a,b,c)=>{if(b&&go(b))return[gp(b)];{let a=[];return b&&(a=gk(b)),cv(c,(b,c)=>{a=a.concat(c)}),a}})}function gP(a){return a._queryParams.loadsAllData()&&!a._queryParams.isDefault()?new(gr())(a._repo,a._path):a}function gQ(a,b){for(let c=0;c<b.length;++c){let d=b[c];if(!d._queryParams.loadsAllData()){let b=gK(d),c=a.queryToTagMap.get(b);a.queryToTagMap.delete(b),a.tagToQueryMap.delete(c)}}}function gR(){return gs++}function gS(a,b,c){let d=b._path,e=gJ(a,b),f=gI(a,c),g=a.listenProvider_.startListening(gP(b),e,f.hashFn,f.onComplete),h=a.syncPointTree_.subtree(d);if(e)y(!go(h.value),"If we're adding a query, it shouldn't be shadowed");else{let b=h.fold((a,b,c)=>{if(!dP(a)&&b&&go(b))return[gp(b).query];{let a=[];return b&&(a=a.concat(gk(b).map(a=>a.query))),cv(c,(b,c)=>{a=a.concat(c)}),a}});for(let c=0;c<b.length;++c){let d=b[c];a.listenProvider_.stopListening(gP(d),gJ(a,d))}}return g}class gT{constructor(a){this.node_=a}getImmediateChild(a){return new gT(this.node_.getImmediateChild(a))}node(){return this.node_}}class gU{constructor(a,b){this.syncTree_=a,this.path_=b}getImmediateChild(a){let b=dO(this.path_,a);return new gU(this.syncTree_,b)}node(){return gE(this.syncTree_,this.path_)}}let gV=function(a){return(a=a||{}).timestamp=a.timestamp||new Date().getTime(),a},gW=function(a,b,c){return a&&"object"==typeof a?(y(".sv"in a,"Unexpected leaf node or priority contents"),"string"==typeof a[".sv"])?gX(a[".sv"],b,c):"object"==typeof a[".sv"]?gY(a[".sv"],b):void y(!1,"Unexpected server value: "+JSON.stringify(a,null,2)):a},gX=function(a,b,c){if("timestamp"===a)return c.timestamp;y(!1,"Unexpected server value: "+a)},gY=function(a,b,c){a.hasOwnProperty("increment")||y(!1,"Unexpected server value: "+JSON.stringify(a,null,2));let d=a.increment;"number"!=typeof d&&y(!1,"Unexpected increment value: "+d);let e=b.node();if(y(null!=e,"Expected ChildrenNode.EMPTY_NODE for nulls"),!e.isLeafNode())return d;let f=e.getValue();return"number"!=typeof f?d:f+d},gZ=function(a,b,c,d){return g_(b,new gU(c,a),d)},g$=function(a,b,c){return g_(a,new gT(b),c)};function g_(a,b,c){let d,e=gW(a.getPriority().val(),b.getImmediateChild(".priority"),c);if(a.isLeafNode()){let d=a,f=gW(d.getValue(),b,c);return f!==d.getValue()||e!==d.getPriority().val()?new ei(f,ew(e)):a}{let f=a;return d=f,e!==f.getPriority().val()&&(d=d.updatePriority(new ei(e))),f.forEachChild(em,(a,e)=>{let f=g_(e,b.getImmediateChild(a),c);f!==e&&(d=d.updateImmediateChild(a,f))}),d}}class g0{constructor(a="",b=null,c={children:{},childCount:0}){this.name=a,this.parent=b,this.node=c}}function g1(a,b){let c=b instanceof dF?b:new dF(b),d=a,e=dH(c);for(;null!==e;){let a=ar(d.node.children,e)||{children:{},childCount:0};d=new g0(e,d,a),e=dH(c=dJ(c))}return d}function g2(a){return a.node.value}function g3(a,b){a.node.value=b,ha(a)}function g4(a){return a.node.childCount>0}function g5(a){return void 0===g2(a)&&!g4(a)}function g6(a,b){cv(a.node.children,(c,d)=>{b(new g0(c,a,d))})}function g7(a,b,c,d){c&&!d&&b(a),g6(a,a=>{g7(a,b,!0,d)}),c&&d&&b(a)}function g8(a,b,c){let d=c?a:a.parent;for(;null!==d;){if(b(d))return!0;d=d.parent}return!1}function g9(a){return new dF(null===a.parent?a.name:g9(a.parent)+"/"+a.name)}function ha(a){null!==a.parent&&hb(a.parent,a.name,a)}function hb(a,b,c){let d=g5(c),e=aq(a.node.children,b);d&&e?(delete a.node.children[b],a.node.childCount--,ha(a)):d||e||(a.node.children[b]=c.node,a.node.childCount++,ha(a))}let hc=/[\[\].#$\/\u0000-\u001F\u007F]/,hd=/[\[\].#$\u0000-\u001F\u007F]/,he=0xa00000,hf=function(a){return"string"==typeof a&&0!==a.length&&!hc.test(a)},hg=function(a){return"string"==typeof a&&0!==a.length&&!hd.test(a)},hh=function(a){return a&&(a=a.replace(/^\/*\.info(\/|$)/,"/")),hg(a)},hi=function(a,b,c){let d=c instanceof dF?new dT(c,a):c;if(void 0===b)throw Error(a+"contains undefined "+dX(d));if("function"==typeof b)throw Error(a+"contains a function "+dX(d)+" with contents = "+b.toString());if(cm(b))throw Error(a+"contains "+b.toString()+" "+dX(d));if("string"==typeof b&&b.length>he/3&&aA(b)>he)throw Error(a+"contains a string greater than "+he+" utf8 bytes "+dX(d)+" ('"+b.substring(0,50)+"...')");if(b&&"object"==typeof b){let c=!1,e=!1;if(cv(b,(b,f)=>{if(".value"===b)c=!0;else if(".priority"!==b&&".sv"!==b&&(e=!0,!hf(b)))throw Error(a+" contains an invalid key ("+b+") "+dX(d)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');dU(d,b),hi(a,f,d),dV(d)}),c&&e)throw Error(a+' contains ".value" child '+dX(d)+" in addition to actual children.")}},hj=function(a,b,c,d){if((!d||void 0!==c)&&!hg(c))throw Error(ay(a,b)+'was an invalid path = "'+c+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},hk=function(a,b,c,d){c&&(c=c.replace(/^\/*\.info(\/|$)/,"/")),hj(a,b,c,d)},hl=function(a,b){let c=b.path.toString();if("string"!=typeof b.repoInfo.host||0===b.repoInfo.host.length||!hf(b.repoInfo.namespace)&&"localhost"!==b.repoInfo.host.split(":")[0]||0!==c.length&&!hh(c))throw Error(ay(a,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class hm{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function hn(a,b){let c=null;for(let d=0;d<b.length;d++){let e=b[d],f=e.getPath();null===c||dR(f,c.path)||(a.eventLists_.push(c),c=null),null===c&&(c={events:[],path:f}),c.events.push(e)}c&&a.eventLists_.push(c)}function ho(a,b,c){hn(a,c),hq(a,a=>dR(a,b))}function hp(a,b,c){hn(a,c),hq(a,a=>dS(a,b)||dS(b,a))}function hq(a,b){a.recursionDepth_++;let c=!0;for(let d=0;d<a.eventLists_.length;d++){let e=a.eventLists_[d];e&&(b(e.path)?(hr(a.eventLists_[d]),a.eventLists_[d]=null):c=!1)}c&&(a.eventLists_=[]),a.recursionDepth_--}function hr(a){for(let b=0;b<a.events.length;b++){let c=a.events[b];if(null!==c){a.events[b]=null;let d=c.getEventRunner();cd&&cg("event: "+c.toString()),cE(d)}}}let hs="repo_interrupt",ht=25;class hu{constructor(a,b,c,d){this.repoInfo_=a,this.forceRestClient_=b,this.authTokenProvider_=c,this.appCheckProvider_=d,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new hm,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=eO(),this.transactionQueueTree_=new g0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function hv(a,b,c){if(a.stats_=cN(a.repoInfo_),a.forceRestClient_||cF())a.server_=new eM(a.repoInfo_,(b,c,d,e)=>{hy(a,b,c,d,e)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>hz(a,!0),0);else{if(null!=c){if("object"!=typeof c)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{am(c)}catch(a){throw Error("Invalid authOverride provided: "+a)}}a.persistentConnection_=new d4(a.repoInfo_,b,(b,c,d,e)=>{hy(a,b,c,d,e)},b=>{hz(a,b)},b=>{hA(a,b)},a.authTokenProvider_,a.appCheckProvider_,c),a.server_=a.persistentConnection_}a.authTokenProvider_.addTokenChangeListener(b=>{a.server_.refreshAuthToken(b)}),a.appCheckProvider_.addTokenChangeListener(b=>{a.server_.refreshAppCheckToken(b.token)}),a.statsReporter_=cO(a.repoInfo_,()=>new eW(a.stats_,a.server_)),a.infoData_=new eN,a.infoSyncTree_=new gt({startListening:(b,c,d,e)=>{let f=[],g=a.infoData_.getNode(b._path);return g.isEmpty()||(f=gw(a.infoSyncTree_,b._path,g),setTimeout(()=>{e("ok")},0)),f},stopListening:()=>{}}),hB(a,"connected",!1),a.serverSyncTree_=new gt({startListening:(b,c,d,e)=>(a.server_.listen(b,d,c,(c,d)=>{let f=e(c,d);hp(a.eventQueue_,b._path,f)}),[]),stopListening:(b,c)=>{a.server_.unlisten(b,c)}})}function hw(a){let b=a.infoData_.getNode(new dF(".info/serverTimeOffset")).val()||0;return new Date().getTime()+b}function hx(a){return gV({timestamp:hw(a)})}function hy(a,b,c,d,e){a.dataUpdateCount++;let f=new dF(b);c=a.interceptServerDataCallback_?a.interceptServerDataCallback_(b,c):c;let g=[];if(e)if(d){let b=at(c,a=>ew(a));g=gC(a.serverSyncTree_,f,b,e)}else{let b=ew(c);g=gB(a.serverSyncTree_,f,b,e)}else if(d){let b=at(c,a=>ew(a));g=gx(a.serverSyncTree_,f,b)}else{let b=ew(c);g=gw(a.serverSyncTree_,f,b)}let h=f;g.length>0&&(h=hL(a,f)),hp(a.eventQueue_,h,g)}function hz(a,b){hB(a,"connected",b),!1===b&&hD(a)}function hA(a,b){cv(b,(b,c)=>{hB(a,b,c)})}function hB(a,b,c){let d=new dF("/.info/"+b),e=ew(c);a.infoData_.updateSnapshot(d,e);let f=gw(a.infoSyncTree_,d,e);hp(a.eventQueue_,d,f)}function hC(a){return a.nextWriteId_++}function hD(a){hH(a,"onDisconnectEvents");let b=hx(a),c=eO();eQ(a.onDisconnect_,dG(),(d,e)=>{let f=gZ(d,e,a.serverSyncTree_,b);eP(c,d,f)});let d=[];eQ(c,dG(),(b,c)=>{d=d.concat(gw(a.serverSyncTree_,b,c));let e=hR(a,b);hL(a,e)}),a.onDisconnect_=eO(),hp(a.eventQueue_,dG(),d)}function hE(a,b,c){let d;d=".info"===dH(b._path)?gD(a.infoSyncTree_,b,c):gD(a.serverSyncTree_,b,c),ho(a.eventQueue_,b._path,d)}function hF(a,b,c){let d;d=".info"===dH(b._path)?gA(a.infoSyncTree_,b,c):gA(a.serverSyncTree_,b,c),ho(a.eventQueue_,b._path,d)}function hG(a){a.persistentConnection_&&a.persistentConnection_.interrupt(hs)}function hH(a,...b){let c="";a.persistentConnection_&&(c=a.persistentConnection_.id+":"),cg(c,...b)}function hI(a,b,c){return gE(a.serverSyncTree_,b,c)||es.EMPTY_NODE}function hJ(a,b=a.transactionQueueTree_){if(b||hQ(a,b),g2(b)){let c=hO(a,b);y(c.length>0,"Sending zero length transaction queue"),c.every(a=>0===a.status)&&hK(a,g9(b),c)}else g4(b)&&g6(b,b=>{hJ(a,b)})}function hK(a,b,c){let d=hI(a,b,c.map(a=>a.currentWriteId)),e=d,f=d.hash();for(let a=0;a<c.length;a++){let d=c[a];y(0===d.status,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let f=dQ(b,d.path);e=e.updateChild(f,d.currentOutputSnapshotRaw)}let g=e.val(!0),h=b;a.server_.put(h.toString(),g,d=>{hH(a,"transaction put response",{path:h.toString(),status:d});let e=[];if("ok"===d){let d=[];for(let b=0;b<c.length;b++)c[b].status=2,e=e.concat(gv(a.serverSyncTree_,c[b].currentWriteId)),c[b].onComplete&&d.push(()=>c[b].onComplete(null,!0,c[b].currentOutputSnapshotResolved)),c[b].unwatcher();hQ(a,g1(a.transactionQueueTree_,b)),hJ(a,a.transactionQueueTree_),hp(a.eventQueue_,b,e);for(let a=0;a<d.length;a++)cE(d[a])}else{if("datastale"===d)for(let a=0;a<c.length;a++)3===c[a].status?c[a].status=4:c[a].status=0;else{ck("transaction at "+h.toString()+" failed: "+d);for(let a=0;a<c.length;a++)c[a].status=4,c[a].abortReason=d}hL(a,b)}},f)}function hL(a,b){let c=hN(a,b),d=g9(c),e=hO(a,c);return hM(a,e,d),d}function hM(a,b,c){if(0===b.length)return;let d=[],e=[],f=b.filter(a=>0===a.status).map(a=>a.currentWriteId);for(let g=0;g<b.length;g++){let h=b[g],i=dQ(c,h.path),j=!1,k;if(y(null!==i,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)j=!0,k=h.abortReason,e=e.concat(gv(a.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=ht)j=!0,k="maxretry",e=e.concat(gv(a.serverSyncTree_,h.currentWriteId,!0));else{let c=hI(a,h.path,f);h.currentInputSnapshot=c;let d=b[g].update(c.val());if(void 0!==d){hi("transaction failed: Data returned ",d,h.path);let b=ew(d);"object"==typeof d&&null!=d&&aq(d,".priority")||(b=b.updatePriority(c.getPriority()));let g=h.currentWriteId,i=g$(b,c,hx(a));h.currentOutputSnapshotRaw=b,h.currentOutputSnapshotResolved=i,h.currentWriteId=hC(a),f.splice(f.indexOf(g),1),e=(e=e.concat(gu(a.serverSyncTree_,h.path,i,h.currentWriteId,h.applyLocally))).concat(gv(a.serverSyncTree_,g,!0))}else j=!0,k="nodata",e=e.concat(gv(a.serverSyncTree_,h.currentWriteId,!0))}hp(a.eventQueue_,c,e),e=[],j&&(b[g].status=2,function(a){setTimeout(a,Math.floor(0))}(b[g].unwatcher),b[g].onComplete&&("nodata"===k?d.push(()=>b[g].onComplete(null,!1,b[g].currentInputSnapshot)):d.push(()=>b[g].onComplete(Error(k),!1,null))))}hQ(a,a.transactionQueueTree_);for(let a=0;a<d.length;a++)cE(d[a]);hJ(a,a.transactionQueueTree_)}function hN(a,b){let c,d=a.transactionQueueTree_;for(c=dH(b);null!==c&&void 0===g2(d);)d=g1(d,c),c=dH(b=dJ(b));return d}function hO(a,b){let c=[];return hP(a,b,c),c.sort((a,b)=>a.order-b.order),c}function hP(a,b,c){let d=g2(b);if(d)for(let a=0;a<d.length;a++)c.push(d[a]);g6(b,b=>{hP(a,b,c)})}function hQ(a,b){let c=g2(b);if(c){let a=0;for(let b=0;b<c.length;b++)2!==c[b].status&&(c[a]=c[b],a++);c.length=a,g3(b,c.length>0?c:void 0)}g6(b,b=>{hQ(a,b)})}function hR(a,b){let c=g9(hN(a,b)),d=g1(a.transactionQueueTree_,b);return g8(d,b=>{hS(a,b)}),hS(a,d),g7(d,b=>{hS(a,b)}),c}function hS(a,b){let c=g2(b);if(c){let d=[],e=[],f=-1;for(let b=0;b<c.length;b++)3===c[b].status||(1===c[b].status?(y(f===b-1,"All SENT items should be at beginning of queue."),f=b,c[b].status=3,c[b].abortReason="set"):(y(0===c[b].status,"Unexpected transaction status in abort"),c[b].unwatcher(),e=e.concat(gv(a.serverSyncTree_,c[b].currentWriteId,!0)),c[b].onComplete&&d.push(c[b].onComplete.bind(null,Error("set"),!1,null))));-1===f?g3(b,void 0):c.length=f+1,hp(a.eventQueue_,g9(b),e);for(let a=0;a<d.length;a++)cE(d[a])}}function hT(a){let b="",c=a.split("/");for(let a=0;a<c.length;a++)if(c[a].length>0){let d=c[a];try{d=decodeURIComponent(d.replace(/\+/g," "))}catch(a){}b+="/"+d}return b}function hU(a){let b={};for(let c of("?"===a.charAt(0)&&(a=a.substring(1)),a.split("&"))){if(0===c.length)continue;let d=c.split("=");2===d.length?b[decodeURIComponent(d[0])]=decodeURIComponent(d[1]):ck(`Invalid query segment '${c}' in query '${a}'`)}return b}let hV=function(a,b){let c=hW(a),d=c.namespace;"firebase.com"===c.domain&&cj(c.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),d&&"undefined"!==d||"localhost"===c.domain||cj("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),c.secure||cl();let e="ws"===c.scheme||"wss"===c.scheme;return{repoInfo:new cH(c.host,c.secure,d,e,b,"",d!==c.subdomain),path:new dF(c.pathString)}},hW=function(a){let b="",c="",d="",e="",f="",g=!0,h="https",i=443;if("string"==typeof a){let j=a.indexOf("//");j>=0&&(h=a.substring(0,j-1),a=a.substring(j+2));let k=a.indexOf("/");-1===k&&(k=a.length);let l=a.indexOf("?");-1===l&&(l=a.length),b=a.substring(0,Math.min(k,l)),k<l&&(e=hT(a.substring(k,l)));let m=hU(a.substring(Math.min(a.length,l)));(j=b.indexOf(":"))>=0?(g="https"===h||"wss"===h,i=parseInt(b.substring(j+1),10)):j=b.length;let n=b.slice(0,j);if("localhost"===n.toLowerCase())c="localhost";else if(n.split(".").length<=2)c=n;else{let a=b.indexOf(".");d=b.substring(0,a).toLowerCase(),c=b.substring(a+1),f=d}"ns"in m&&(f=m.ns)}return{host:b,port:i,domain:c,subdomain:d,secure:g,scheme:h,pathString:e,namespace:f}};class hX{constructor(a,b,c,d){this.eventType=a,this.eventRegistration=b,this.snapshot=c,this.prevName=d}getPath(){let a=this.snapshot.ref;return"value"===this.eventType?a._path:a.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+am(this.snapshot.exportVal())}}class hY{constructor(a,b,c){this.eventRegistration=a,this.error=b,this.path=c}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class hZ{constructor(a,b){this.snapshotCallback=a,this.cancelCallback=b}onValue(a,b){this.snapshotCallback.call(null,a,b)}onCancel(a){return y(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,a)}get hasCancelCallback(){return!!this.cancelCallback}matches(a){return this.snapshotCallback===a.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===a.snapshotCallback.userCallback&&this.snapshotCallback.context===a.snapshotCallback.context}}class h${constructor(a,b,c,d){this._repo=a,this._path=b,this._queryParams=c,this._orderByCalled=d}get key(){return dP(this._path)?null:dK(this._path)}get ref(){return new h_(this._repo,this._path)}get _queryIdentifier(){let a=ct(eL(this._queryParams));return"{}"===a?"default":a}get _queryObject(){return eL(this._queryParams)}isEqual(a){if(!((a=aB(a))instanceof h$))return!1;let b=this._repo===a._repo,c=dR(this._path,a._path),d=this._queryIdentifier===a._queryIdentifier;return b&&c&&d}toJSON(){return this.toString()}toString(){return this._repo.toString()+dL(this._path)}}class h_ extends h${constructor(a,b){super(a,b,new eI,!1)}get parent(){let a=dN(this._path);return null===a?null:new h_(this._repo,a)}get root(){let a=this;for(;null!==a.parent;)a=a.parent;return a}}class h0{constructor(a,b,c){this._node=a,this.ref=b,this._index=c}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(a){let b=new dF(a),c=h2(this.ref,a);return new h0(this._node.getChild(b),c,em)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(a){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(b,c)=>a(new h0(c,h2(this.ref,b),em)))}hasChild(a){let b=new dF(a);return!this._node.getChild(b).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function h1(a,b){return(a=aB(a))._checkNotDeleted("ref"),void 0!==b?h2(a._root,b):a._root}function h2(a,b){return null===dH((a=aB(a))._path)?hk("child","path",b,!1):hj("child","path",b,!1),new h_(a._repo,dO(a._path,b))}class h3{constructor(a){this.callbackContext=a}respondsTo(a){return"value"===a}createEvent(a,b){let c=b._queryParams.getIndex();return new hX("value",this,new h0(a.snapshotNode,new h_(b._repo,b._path),c))}getEventRunner(a){return"cancel"===a.getEventType()?()=>this.callbackContext.onCancel(a.error):()=>this.callbackContext.onValue(a.snapshot,null)}createCancelEvent(a,b){return this.callbackContext.hasCancelCallback?new hY(this,a,b):null}matches(a){return a instanceof h3&&(!a.callbackContext||!this.callbackContext||a.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class h4{constructor(a,b){this.eventType=a,this.callbackContext=b}respondsTo(a){let b="children_added"===a?"child_added":a;return b="children_removed"===b?"child_removed":b,this.eventType===b}createCancelEvent(a,b){return this.callbackContext.hasCancelCallback?new hY(this,a,b):null}createEvent(a,b){y(null!=a.childName,"Child events should have a childName.");let c=h2(new h_(b._repo,b._path),a.childName),d=b._queryParams.getIndex();return new hX(a.type,this,new h0(a.snapshotNode,c,d),a.prevName)}getEventRunner(a){return"cancel"===a.getEventType()?()=>this.callbackContext.onCancel(a.error):()=>this.callbackContext.onValue(a.snapshot,a.prevName)}matches(a){return a instanceof h4&&this.eventType===a.eventType&&(!this.callbackContext||!a.callbackContext||this.callbackContext.matches(a.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function h5(a,b,c,d,e){let f;if("object"==typeof d&&(f=void 0,e=d),"function"==typeof d&&(f=d),e&&e.onlyOnce){let b=c,d=(c,d)=>{hF(a._repo,a,h),b(c,d)};d.userCallback=c.userCallback,d.context=c.context,c=d}let g=new hZ(c,f||void 0),h="value"===b?new h3(g):new h4(b,g);return hE(a._repo,a,h),()=>hF(a._repo,a,h)}function h6(a,b,c,d){return h5(a,"value",b,c,d)}gd(h_),gq(h_);let h7="FIREBASE_DATABASE_EMULATOR_HOST",h8={},h9=!1;function ia(a,b,c,d){let e=b.lastIndexOf(":"),f=T(b.substring(0,e));a.repoInfo_=new cH(b,f,a.repoInfo_.namespace,a.repoInfo_.webSocketOnly,a.repoInfo_.nodeAdmin,a.repoInfo_.persistenceKey,a.repoInfo_.includeNamespaceInQueryParams,!0,c),d&&(a.authTokenProvider_=d)}function ib(a,b,c,d,e){let f,g,h=d||a.options.databaseURL;void 0===h&&(a.options.projectId||cj("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),cg("Using default host for project ",a.options.projectId),h=`${a.options.projectId}-default-rtdb.firebaseio.com`);let i=hV(h,e),j=i.repoInfo;"u">typeof process&&process.env&&(f=process.env[h7]),f?(g=!0,j=(i=hV(h=`http://${f}?ns=${j.namespace}`,e)).repoInfo):g=!i.repoInfo.secure;let k=e&&g?new c$(c$.OWNER):new cZ(a.name,a.options,b);return hl("Invalid Firebase Database URL",i),dP(i.path)||cj("Database URL must point to the root of a Firebase Database (not including a child path)."),new ie(id(j,a,k,new cY(a,c)),a)}function ic(a,b){let c=h8[b];c&&c[a.key]===a||cj(`Database ${b}(${a.repoInfo_}) has already been deleted.`),hG(a),delete c[a.key]}function id(a,b,c,d){let e=h8[b.name];e||(e={},h8[b.name]=e);let f=e[a.toURLString()];return f&&cj("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),f=new hu(a,h9,c,d),e[a.toURLString()]=f,f}class ie{constructor(a,b){this._repoInternal=a,this.app=b,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(hv(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new h_(this._repo,dG())),this._rootInternal}_delete(){return null!==this._rootInternal&&(ic(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(a){null===this._rootInternal&&cj("Cannot call "+a+" on a deleted database.")}}function ig(a=bA(),b){let c=bn(a,"database").getImmediate({identifier:b});if(!c._instanceStarted){let a=Q("database");a&&ih(c,...a)}return c}function ih(a,b,c,d={}){let e;(a=aB(a))._checkNotDeleted("useEmulator");let f=`${b}:${c}`,g=a._repoInternal;if(a._instanceStarted){if(f===a._repoInternal.repoInfo_.host&&au(d,g.repoInfo_.emulatorOptions))return;cj("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}g.repoInfo_.nodeAdmin?(d.mockUserToken&&cj('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),e=new c$(c$.OWNER)):d.mockUserToken&&(e=new c$("string"==typeof d.mockUserToken?d.mockUserToken:V(d.mockUserToken,a.app.options.projectId))),T(b)&&(U(b),W("Database",!0)),ia(g,f,d,e)}function ii(a){cQ(bx),bm(new aK("database",(a,{instanceIdentifier:b})=>ib(a.getProvider("app").getImmediate(),a.getProvider("auth-internal"),a.getProvider("app-check-internal"),b),"PUBLIC").setMultipleInstances(!0)),bD(cW,cX,a),bD(cW,cX,"esm2020")}d4.prototype.simpleListen=function(a,b){this.sendRequest("q",{p:a},b)},d4.prototype.echo=function(a,b){this.sendRequest("echo",{d:a},b)},cU(v.default.Client),ii("node"),bD("firebase","12.8.0","app"),a.i(73429);var ij="u">typeof globalThis?globalThis:a.g,ik={};(function(){function a(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function b(a,b,c){c||(c=0);let d=Array(16);if("string"==typeof b)for(var e=0;e<16;++e)d[e]=b.charCodeAt(c++)|b.charCodeAt(c++)<<8|b.charCodeAt(c++)<<16|b.charCodeAt(c++)<<24;else for(e=0;e<16;++e)d[e]=b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24;b=a.g[0],c=a.g[1],e=a.g[2];let f=a.g[3],g;g=b+(f^c&(e^f))+d[0]+0xd76aa478|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[1]+0xe8c7b756|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[2]+0x242070db|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[3]+0xc1bdceee|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[4]+0xf57c0faf|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[5]+0x4787c62a|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[6]+0xa8304613|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[7]+0xfd469501|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[8]+0x698098d8|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[9]+0x8b44f7af|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[10]+0xffff5bb1|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[11]+0x895cd7be|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[12]+0x6b901122|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[13]+0xfd987193|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[14]+0xa679438e|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[15]+0x49b40821|0,c=e+(g<<22|g>>>10),g=b+(e^f&(c^e))+d[1]+0xf61e2562|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[6]+0xc040b340|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[11]+0x265e5a51|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[0]+0xe9b6c7aa|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[5]+0xd62f105d|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[10]+0x2441453|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[15]+0xd8a1e681|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[4]+0xe7d3fbc8|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[9]+0x21e1cde6|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[14]+0xc33707d6|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[3]+0xf4d50d87|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[8]+0x455a14ed|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[13]+0xa9e3e905|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[2]+0xfcefa3f8|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[7]+0x676f02d9|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[12]+0x8d2a4c8a|0,g=b+((c=e+(g<<20|g>>>12))^e^f)+d[5]+0xfffa3942|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[8]+0x8771f681|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[11]+0x6d9d6122|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[14]+0xfde5380c|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[1]+0xa4beea44|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[4]+0x4bdecfa9|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[7]+0xf6bb4b60|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[10]+0xbebfbc70|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[13]+0x289b7ec6|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[0]+0xeaa127fa|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[3]+0xd4ef3085|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[6]+0x4881d05|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[9]+0xd9d4d039|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[12]+0xe6db99e5|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[15]+0x1fa27cf8|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[2]+0xc4ac5665|0,c=e+(g<<23|g>>>9),g=b+(e^(c|~f))+d[0]+0xf4292244|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[7]+0x432aff97|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[14]+0xab9423a7|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[5]+0xfc93a039|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[12]+0x655b59c3|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[3]+0x8f0ccc92|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[10]+0xffeff47d|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[1]+0x85845dd1|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[8]+0x6fa87e4f|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[15]+0xfe2ce6e0|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[6]+0xa3014314|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[13]+0x4e0811a1|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[4]+0xf7537e82|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[11]+0xbd3af235|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[2]+0x2ad7d2bb|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[9]+0xeb86d391|0,a.g[0]=a.g[0]+b|0,a.g[1]=a.g[1]+(e+(g<<21|g>>>11))|0,a.g[2]=a.g[2]+e|0,a.g[3]=a.g[3]+f|0}function c(a,b){var c=f;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)}function d(a,b){this.h=b;let c=[],d=!0;for(let e=a.length-1;e>=0;e--){let f=0|a[e];d&&f==b||(c[e]=f,d=!1)}this.g=c}(function(a,b){function c(){}c.prototype=b.prototype,a.F=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.D=function(a,c,d){for(var e=Array(arguments.length-2),f=2;f<arguments.length;f++)e[f-2]=arguments[f];return b.prototype[c].apply(a,e)}})(a,function(){this.blockSize=-1}),a.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},a.prototype.v=function(a,c){void 0===c&&(c=a.length);let d=c-this.blockSize,e=this.C,f=this.h,g=0;for(;g<c;){if(0==f)for(;g<=d;)b(this,a,g),g+=this.blockSize;if("string"==typeof a){for(;g<c;)if(e[f++]=a.charCodeAt(g++),f==this.blockSize){b(this,e),f=0;break}}else for(;g<c;)if(e[f++]=a[g++],f==this.blockSize){b(this,e),f=0;break}}this.h=f,this.o+=c},a.prototype.A=function(){var a=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;b=8*this.o;for(var c=a.length-8;c<a.length;++c)a[c]=255&b,b/=256;for(this.v(a),a=Array(16),b=0,c=0;c<4;++c)for(let d=0;d<32;d+=8)a[b++]=this.g[c]>>>d&255;return a};var e,f={};function g(a){return -128<=a&&a<128?c(a,function(a){return new d([0|a],a<0?-1:0)}):new d([0|a],a<0?-1:0)}function h(a){if(isNaN(a)||!isFinite(a))return j;if(a<0)return o(h(-a));let b=[],c=1;for(let d=0;a>=c;d++)b[d]=a/c|0,c*=0x100000000;return new d(b,0)}function i(a,b){if(0==a.length)throw Error("number format error: empty string");if((b=b||10)<2||36<b)throw Error("radix out of range: "+b);if("-"==a.charAt(0))return o(i(a.substring(1),b));if(a.indexOf("-")>=0)throw Error('number format error: interior "-" character');let c=h(Math.pow(b,8)),d=j;for(let f=0;f<a.length;f+=8){var e=Math.min(8,a.length-f);let g=parseInt(a.substring(f,f+e),b);e<8?(e=h(Math.pow(b,e)),d=d.j(e).add(h(g))):d=(d=d.j(c)).add(h(g))}return d}var j=g(0),k=g(1),l=g(0x1000000);function m(a){if(0!=a.h)return!1;for(let b=0;b<a.g.length;b++)if(0!=a.g[b])return!1;return!0}function n(a){return -1==a.h}function o(a){let b=a.g.length,c=[];for(let d=0;d<b;d++)c[d]=~a.g[d];return new d(c,~a.h).add(k)}function r(a,b){return a.add(o(b))}function s(a,b){for(;(65535&a[b])!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function t(a,b){this.g=a,this.h=b}function u(a,b){if(m(b))throw Error("division by zero");if(m(a))return new t(j,j);if(n(a))return b=u(o(a),b),new t(o(b.g),o(b.h));if(n(b))return b=u(a,o(b)),new t(o(b.g),b.h);if(a.g.length>30){if(n(a)||n(b))throw Error("slowDivide_ only works with positive integers.");for(var c=k,d=b;0>=d.l(a);)c=v(c),d=v(d);var e=w(c,1),f=w(d,1);for(d=w(d,2),c=w(c,2);!m(d);){var g=f.add(d);0>=g.l(a)&&(e=e.add(c),f=g),d=w(d,1),c=w(c,1)}return b=r(a,e.j(b)),new t(e,b)}for(e=j;a.l(b)>=0;){for(d=(d=Math.ceil(Math.log(c=Math.max(1,Math.floor(a.m()/b.m())))/Math.LN2))<=48?1:Math.pow(2,d-48),g=(f=h(c)).j(b);n(g)||g.l(a)>0;)c-=d,g=(f=h(c)).j(b);m(f)&&(f=k),e=e.add(f),a=r(a,g)}return new t(e,a)}function v(a){let b=a.g.length+1,c=[];for(let d=0;d<b;d++)c[d]=a.i(d)<<1|a.i(d-1)>>>31;return new d(c,a.h)}function w(a,b){let c=b>>5;b%=32;let e=a.g.length-c,f=[];for(let d=0;d<e;d++)f[d]=b>0?a.i(d+c)>>>b|a.i(d+c+1)<<32-b:a.i(d+c);return new d(f,a.h)}(e=d.prototype).m=function(){if(n(this))return-o(this).m();let a=0,b=1;for(let c=0;c<this.g.length;c++){let d=this.i(c);a+=(d>=0?d:0x100000000+d)*b,b*=0x100000000}return a},e.toString=function(a){if((a=a||10)<2||36<a)throw Error("radix out of range: "+a);if(m(this))return"0";if(n(this))return"-"+o(this).toString(a);let b=h(Math.pow(a,6));var c=this;let d="";for(;;){let e=u(c,b).g,f=(((c=r(c,e.j(b))).g.length>0?c.g[0]:c.h)>>>0).toString(a);if(m(c=e))return f+d;for(;f.length<6;)f="0"+f;d=f+d}},e.i=function(a){return a<0?0:a<this.g.length?this.g[a]:this.h},e.l=function(a){return n(a=r(this,a))?-1:+!m(a)},e.abs=function(){return n(this)?o(this):this},e.add=function(a){let b=Math.max(this.g.length,a.g.length),c=[],e=0;for(let d=0;d<=b;d++){let b=e+(65535&this.i(d))+(65535&a.i(d)),f=(b>>>16)+(this.i(d)>>>16)+(a.i(d)>>>16);e=f>>>16,b&=65535,f&=65535,c[d]=f<<16|b}return new d(c,-0x80000000&c[c.length-1]?-1:0)},e.j=function(a){if(m(this)||m(a))return j;if(n(this))return n(a)?o(this).j(o(a)):o(o(this).j(a));if(n(a))return o(this.j(o(a)));if(0>this.l(l)&&0>a.l(l))return h(this.m()*a.m());let b=this.g.length+a.g.length,c=[];for(var e=0;e<2*b;e++)c[e]=0;for(e=0;e<this.g.length;e++)for(let b=0;b<a.g.length;b++){let d=this.i(e)>>>16,f=65535&this.i(e),g=a.i(b)>>>16,h=65535&a.i(b);c[2*e+2*b]+=f*h,s(c,2*e+2*b),c[2*e+2*b+1]+=d*h,s(c,2*e+2*b+1),c[2*e+2*b+1]+=f*g,s(c,2*e+2*b+1),c[2*e+2*b+2]+=d*g,s(c,2*e+2*b+2)}for(a=0;a<b;a++)c[a]=c[2*a+1]<<16|c[2*a];for(a=b;a<2*b;a++)c[a]=0;return new d(c,0)},e.B=function(a){return u(this,a).h},e.and=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)&a.i(d);return new d(c,this.h&a.h)},e.or=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)|a.i(d);return new d(c,this.h|a.h)},e.xor=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)^a.i(d);return new d(c,this.h^a.h)},a.prototype.digest=a.prototype.A,a.prototype.reset=a.prototype.u,a.prototype.update=a.prototype.v,q=ik.Md5=a,d.prototype.add=d.prototype.add,d.prototype.multiply=d.prototype.j,d.prototype.modulo=d.prototype.B,d.prototype.compare=d.prototype.l,d.prototype.toNumber=d.prototype.m,d.prototype.toString=d.prototype.toString,d.prototype.getBits=d.prototype.i,d.fromNumber=h,d.fromString=i,p=ik.Integer=d}).apply(void 0!==ij?ij:"u">typeof self?self:{});var il=a.i(24361),im=a.i(54799),io=a.i(9784),ip=a.i(36789);class iq{constructor(a){this.uid=a}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(a){return a.uid===this.uid}}iq.UNAUTHENTICATED=new iq(null),iq.GOOGLE_CREDENTIALS=new iq("google-credentials-uid"),iq.FIRST_PARTY=new iq("first-party-uid"),iq.MOCK_USER=new iq("mock-user");let ir="12.8.0";function is(a){ir=a}function it(a){return(0,il.inspect)(a,{depth:100})}let iu=new aH("@firebase/firestore");function iv(){return iu.logLevel}function iw(a,...b){if(iu.logLevel<=n.DEBUG){let c=b.map(iz);iu.debug(`Firestore (${ir}): ${a}`,...c)}}function ix(a,...b){if(iu.logLevel<=n.ERROR){let c=b.map(iz);iu.error(`Firestore (${ir}): ${a}`,...c)}}function iy(a,...b){if(iu.logLevel<=n.WARN){let c=b.map(iz);iu.warn(`Firestore (${ir}): ${a}`,...c)}}function iz(a){if("string"==typeof a)return a;try{return it(a)}catch(b){return a}}function iA(a,b,c){let d="Unexpected state";"string"==typeof b?d=b:c=b,iB(a,d,c)}function iB(a,b,c){let d=`FIRESTORE (${ir}) INTERNAL ASSERTION FAILED: ${b} (ID: ${a.toString(16)})`;if(void 0!==c)try{let a=JSON.stringify(c);d+=" CONTEXT: "+a}catch(a){d+=" CONTEXT: "+c}throw ix(d),Error(d)}function iC(a,b,c,d){let e="Unexpected state";"string"==typeof c?e=c:d=c,a||iB(b,e,d)}function iD(a,b){return a}let iE="ok",iF="cancelled",iG="unknown",iH="invalid-argument",iI="deadline-exceeded",iJ="not-found",iK="already-exists",iL="permission-denied",iM="unauthenticated",iN="resource-exhausted",iO="failed-precondition",iP="aborted",iQ="out-of-range",iR="unimplemented",iS="internal",iT="unavailable",iU="data-loss";class iV extends ah{constructor(a,b){super(a,b),this.code=a,this.message=b,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class iW{constructor(){this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}}class iX{constructor(a,b){this.user=b,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${a}`)}}class iY{getToken(){return Promise.resolve(null)}invalidateToken(){}start(a,b){a.enqueueRetryable(()=>b(iq.UNAUTHENTICATED))}shutdown(){}}class iZ{constructor(a){this.token=a,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(a,b){this.changeListener=b,a.enqueueRetryable(()=>b(this.token.user))}shutdown(){this.changeListener=null}}class i${constructor(a){this.authProvider=a,this.currentUser=iq.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(a,b){iC(void 0===this.tokenListener,42304);let c=this.tokenCounter,d=a=>this.tokenCounter!==c?(c=this.tokenCounter,b(a)):Promise.resolve(),e=new iW;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),e.resolve(),e=new iW,a.enqueueRetryable(()=>d(this.currentUser))};let f=()=>{let b=e;a.enqueueRetryable(async()=>{await b.promise,await d(this.currentUser)})},g=a=>{iw("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),f())};this.authProvider.onInit(a=>g(a)),setTimeout(()=>{if(!this.auth){let a=this.authProvider.getImmediate({optional:!0});a?g(a):(iw("FirebaseAuthCredentialsProvider","Auth not yet detected"),e.resolve(),e=new iW)}},0),f()}getToken(){let a=this.tokenCounter,b=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(b).then(b=>this.tokenCounter!==a?(iw("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):b?(iC("string"==typeof b.accessToken,31837,{tokenData:b}),new iX(b.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let a=this.auth&&this.auth.getUid();return iC(null===a||"string"==typeof a,2055,{currentUid:a}),new iq(a)}}class i_{constructor(a,b,c){this.sessionIndex=a,this.iamToken=b,this.authTokenFactory=c,this.type="FirstParty",this.user=iq.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let a=this.getAuthToken();return a&&this._headers.set("Authorization",a),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class i0{constructor(a,b,c){this.sessionIndex=a,this.iamToken=b,this.authTokenFactory=c}getToken(){return Promise.resolve(new i_(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(a,b){a.enqueueRetryable(()=>b(iq.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class i1{constructor(a){this.value=a,this.type="AppCheck",this.headers=new Map,a&&a.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class i2{constructor(a,b){this.appCheckProvider=b,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,br(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken)}start(a,b){iC(void 0===this.tokenListener,3512);let c=a=>{null!=a.error&&iw("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);let c=a.token!==this.latestAppCheckToken;return this.latestAppCheckToken=a.token,iw("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?b(a.token):Promise.resolve()};this.tokenListener=b=>{a.enqueueRetryable(()=>c(b))};let d=a=>{iw("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(a=>d(a)),setTimeout(()=>{if(!this.appCheck){let a=this.appCheckProvider.getImmediate({optional:!0});a?d(a):iw("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new i1(this.serverAppAppCheckToken));let a=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(a).then(a=>a?(iC("string"==typeof a.token,44558,{tokenResult:a}),this.latestAppCheckToken=a.token,new i1(a.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function i3(a){if(!a)return new iY;switch(a.type){case"firstParty":return new i0(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new iV(iH,"makeAuthCredentialsProvider failed due to invalid credential type")}}function i4(a){return(0,im.randomBytes)(a)}class i5{static newId(){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",b=Math.floor(256/a.length)*a.length,c="",d=20;for(;c.length<d;){let e=i4(40);for(let f=0;f<e.length;++f)c.length<d&&e[f]<b&&(c+=a.charAt(e[f]%a.length))}return c}}function i6(a,b){return a<b?-1:+(a>b)}function i7(a,b){let c=Math.min(a.length,b.length);for(let d=0;d<c;d++){let c=a.charAt(d),e=b.charAt(d);if(c!==e)return ja(c)===ja(e)?i6(c,e):ja(c)?1:-1}return i6(a.length,b.length)}let i8=55296,i9=57343;function ja(a){let b=a.charCodeAt(0);return b>=i8&&b<=i9}function jb(a,b,c){return a.length===b.length&&a.every((a,d)=>c(a,b[d]))}function jc(a){return a+"\0"}let jd="__name__";class je{constructor(a,b,c){void 0===b?b=0:b>a.length&&iA(637,{offset:b,range:a.length}),void 0===c?c=a.length-b:c>a.length-b&&iA(1746,{length:c,range:a.length-b}),this.segments=a,this.offset=b,this.len=c}get length(){return this.len}isEqual(a){return 0===je.comparator(this,a)}child(a){let b=this.segments.slice(this.offset,this.limit());return a instanceof je?a.forEach(a=>{b.push(a)}):b.push(a),this.construct(b)}limit(){return this.offset+this.length}popFirst(a){return a=void 0===a?1:a,this.construct(this.segments,this.offset+a,this.length-a)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(a){return this.segments[this.offset+a]}isEmpty(){return 0===this.length}isPrefixOf(a){if(a.length<this.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}isImmediateParentOf(a){if(this.length+1!==a.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}forEach(a){for(let b=this.offset,c=this.limit();b<c;b++)a(this.segments[b])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(a,b){let c=Math.min(a.length,b.length);for(let d=0;d<c;d++){let c=je.compareSegments(a.get(d),b.get(d));if(0!==c)return c}return i6(a.length,b.length)}static compareSegments(a,b){let c=je.isNumericId(a),d=je.isNumericId(b);return c&&!d?-1:!c&&d?1:c&&d?je.extractNumericId(a).compare(je.extractNumericId(b)):i7(a,b)}static isNumericId(a){return a.startsWith("__id")&&a.endsWith("__")}static extractNumericId(a){return p.fromString(a.substring(4,a.length-2))}}class jf extends je{construct(a,b,c){return new jf(a,b,c)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...a){let b=[];for(let c of a){if(c.indexOf("//")>=0)throw new iV(iH,`Invalid segment (${c}). Paths must not contain // in them.`);b.push(...c.split("/").filter(a=>a.length>0))}return new jf(b)}static emptyPath(){return new jf([])}}let jg=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class jh extends je{construct(a,b,c){return new jh(a,b,c)}static isValidIdentifier(a){return jg.test(a)}canonicalString(){return this.toArray().map(a=>(a=a.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),jh.isValidIdentifier(a)||(a="`"+a+"`"),a)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===jd}static keyField(){return new jh([jd])}static fromServerFormat(a){let b=[],c="",d=0,e=()=>{if(0===c.length)throw new iV(iH,`Invalid field path (${a}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);b.push(c),c=""},f=!1;for(;d<a.length;){let b=a[d];if("\\"===b){if(d+1===a.length)throw new iV(iH,"Path has trailing escape character: "+a);let b=a[d+1];if("\\"!==b&&"."!==b&&"`"!==b)throw new iV(iH,"Path has invalid escape sequence: "+a);c+=b,d+=2}else"`"===b?f=!f:"."!==b||f?c+=b:e(),d++}if(e(),f)throw new iV(iH,"Unterminated ` in path: "+a);return new jh(b)}static emptyPath(){return new jh([])}}class ji{constructor(a){this.path=a}static fromPath(a){return new ji(jf.fromString(a))}static fromName(a){return new ji(jf.fromString(a).popFirst(5))}static empty(){return new ji(jf.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(a){return this.path.length>=2&&this.path.get(this.path.length-2)===a}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(a){return null!==a&&0===jf.comparator(this.path,a.path)}toString(){return this.path.toString()}static comparator(a,b){return jf.comparator(a.path,b.path)}static isDocumentKey(a){return a.length%2==0}static fromSegments(a){return new ji(new jf(a.slice()))}}function jj(a,b,c){if(!c)throw new iV(iH,`Function ${a}() cannot be called with an empty ${b}.`)}function jk(a,b,c,d){if(!0===b&&!0===d)throw new iV(iH,`${a} and ${c} cannot be used together.`)}function jl(a){if(!ji.isDocumentKey(a))throw new iV(iH,`Invalid document reference. Document references must have an even number of segments, but ${a} has ${a.length}.`)}function jm(a){return"object"==typeof a&&null!==a&&(Object.getPrototypeOf(a)===Object.prototype||null===Object.getPrototypeOf(a))}function jn(a){if(void 0===a)return"undefined";if(null===a)return"null";if("string"==typeof a)return a.length>20&&(a=`${a.substring(0,20)}...`),JSON.stringify(a);if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a)if(a instanceof Array)return"an array";else{let b=jo(a);return b?`a custom ${b} object`:"an object"}else if("function"==typeof a)return"a function";else return iA(12329,{type:typeof a})}function jo(a){return a.constructor?a.constructor.name:null}function jp(a,b){if("_delegate"in a&&(a=a._delegate),!(a instanceof b))if(b.name===a.constructor.name)throw new iV(iH,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let c=jn(a);throw new iV(iH,`Expected type '${b.name}', but it was: ${c}`)}return a}function jq(a,b){if(b<=0)throw new iV(iH,`Function ${a}() requires a positive number, but it was: ${b}.`)}function jr(a,b){let c={typeString:a};return b&&(c.value=b),c}function js(a,b){let c;if(!jm(a))throw new iV(iH,"JSON must be an object");for(let d in b)if(b[d]){let e=b[d].typeString,f="value"in b[d]?{value:b[d].value}:void 0;if(!(d in a)){c=`JSON missing required field: '${d}'`;break}let g=a[d];if(e&&typeof g!==e){c=`JSON field '${d}' must be a ${e}.`;break}if(void 0!==f&&g!==f.value){c=`Expected '${d}' field to equal '${f.value}'`;break}}if(c)throw new iV(iH,c);return!0}let jt=-0xe7791f700,ju=1e6;class jv{static now(){return jv.fromMillis(Date.now())}static fromDate(a){return jv.fromMillis(a.getTime())}static fromMillis(a){let b=Math.floor(a/1e3),c=Math.floor((a-1e3*b)*ju);return new jv(b,c)}constructor(a,b){if(this.seconds=a,this.nanoseconds=b,b<0||b>=1e9)throw new iV(iH,"Timestamp nanoseconds out of range: "+b);if(a<jt||a>=0x3afff44180)throw new iV(iH,"Timestamp seconds out of range: "+a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ju}_compareTo(a){return this.seconds===a.seconds?i6(this.nanoseconds,a.nanoseconds):i6(this.seconds,a.seconds)}isEqual(a){return a.seconds===this.seconds&&a.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:jv._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(a){if(js(a,jv._jsonSchema))return new jv(a.seconds,a.nanoseconds)}valueOf(){return String(this.seconds-jt).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}jv._jsonSchemaVersion="firestore/timestamp/1.0",jv._jsonSchema={type:jr("string",jv._jsonSchemaVersion),seconds:jr("number"),nanoseconds:jr("number")};class jw{static fromTimestamp(a){return new jw(a)}static min(){return new jw(new jv(0,0))}static max(){return new jw(new jv(0x3afff4417f,1e9-1))}constructor(a){this.timestamp=a}compareTo(a){return this.timestamp._compareTo(a.timestamp)}isEqual(a){return this.timestamp.isEqual(a.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let jx=-1,jy=0;class jz{constructor(a,b,c,d){this.indexId=a,this.collectionGroup=b,this.fields=c,this.indexState=d}}function jA(a){return a.fields.find(a=>2===a.kind)}function jB(a){return a.fields.filter(a=>2!==a.kind)}function jC(a){let b=jB(a);return 0===b.length?0:b[b.length-1].kind}function jD(a,b){let c=i6(a.collectionGroup,b.collectionGroup);if(0!==c)return c;for(let d=0;d<Math.min(a.fields.length,b.fields.length);++d)if(0!==(c=jG(a.fields[d],b.fields[d])))return c;return i6(a.fields.length,b.fields.length)}function jE(a){return`id=${a.indexId}|cg=${a.collectionGroup}|f=${a.fields.map(a=>`${a.fieldPath}:${a.kind}`).join(",")}`}jz.UNKNOWN_ID=-1;class jF{constructor(a,b){this.fieldPath=a,this.kind=b}}function jG(a,b){let c=jh.comparator(a.fieldPath,b.fieldPath);return 0!==c?c:i6(a.kind,b.kind)}class jH{constructor(a,b){this.sequenceNumber=a,this.offset=b}static empty(){return new jH(jy,jK.min())}}function jI(a,b){let c=a.toTimestamp().seconds,d=a.toTimestamp().nanoseconds+1;return new jK(jw.fromTimestamp(1e9===d?new jv(c+1,0):new jv(c,d)),ji.empty(),b)}function jJ(a){return new jK(a.readTime,a.key,jx)}class jK{constructor(a,b,c){this.readTime=a,this.documentKey=b,this.largestBatchId=c}static min(){return new jK(jw.min(),ji.empty(),jx)}static max(){return new jK(jw.max(),ji.empty(),jx)}}function jL(a,b){let c=a.readTime.compareTo(b.readTime);return 0!==c||0!==(c=ji.comparator(a.documentKey,b.documentKey))?c:i6(a.largestBatchId,b.largestBatchId)}let jM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class jN{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(a){this.onCommittedListeners.push(a)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(a=>a())}}async function jO(a){if(a.code===iO&&a.message===jM)iw("LocalStore","Unexpectedly lost primary lease");else throw a}class jP{constructor(a){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,a(a=>{this.isDone=!0,this.result=a,this.nextCallback&&this.nextCallback(a)},a=>{this.isDone=!0,this.error=a,this.catchCallback&&this.catchCallback(a)})}catch(a){return this.next(void 0,a)}next(a,b){return(this.callbackAttached&&iA(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(b,this.error):this.wrapSuccess(a,this.result):new jP((c,d)=>{this.nextCallback=b=>{this.wrapSuccess(a,b).next(c,d)},this.catchCallback=a=>{this.wrapFailure(b,a).next(c,d)}})}toPromise(){return new Promise((a,b)=>{this.next(a,b)})}wrapUserFunction(a){try{let b=a();if(b instanceof jP)return b;return jP.resolve(b)}catch(a){return jP.reject(a)}}wrapSuccess(a,b){return a?this.wrapUserFunction(()=>a(b)):jP.resolve(b)}wrapFailure(a,b){return a?this.wrapUserFunction(()=>a(b)):jP.reject(b)}static resolve(a){return new jP((b,c)=>{b(a)})}static reject(a){return new jP((b,c)=>{c(a)})}static waitFor(a){return new jP((b,c)=>{let d=0,e=0,f=!1;a.forEach(a=>{++d,a.next(()=>{++e,f&&e===d&&b()},a=>c(a))}),f=!0,e===d&&b()})}static or(a){let b=jP.resolve(!1);for(let c of a)b=b.next(a=>a?jP.resolve(a):c());return b}static forEach(a,b){let c=[];return a.forEach((a,d)=>{c.push(b.call(this,a,d))}),this.waitFor(c)}static mapArray(a,b){return new jP((c,d)=>{let e=a.length,f=Array(e),g=0;for(let h=0;h<e;h++){let i=h;b(a[i]).next(a=>{f[i]=a,++g===e&&c(f)},a=>d(a))}})}static doWhile(a,b){return new jP((c,d)=>{let e=()=>{!0===a()?b().next(()=>{e()},d):c()};e()})}}let jQ="SimpleDb",jR=3;class jS{static open(a,b,c,d){try{return new jS(b,a.transaction(d,c))}catch(a){throw new jW(b,a)}}constructor(a,b){this.action=a,this.transaction=b,this.aborted=!1,this.completionDeferred=new iW,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{b.error?this.completionDeferred.reject(new jW(a,b.error)):this.completionDeferred.resolve()},this.transaction.onerror=b=>{let c=j_(b.target.error);this.completionDeferred.reject(new jW(a,c))}}get completionPromise(){return this.completionDeferred.promise}abort(a){a&&this.completionDeferred.reject(a),this.aborted||(iw(jQ,"Aborting transaction:",a?a.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let a=this.transaction;this.aborted||"function"!=typeof a.commit||a.commit()}store(a){return new jY(this.transaction.objectStore(a))}}class jT{static delete(a){return iw(jQ,"Removing database:",a),jZ(K().indexedDB.deleteDatabase(a)).toPromise()}static isAvailable(){if(!ae())return!1;if(jT.isMockPersistence())return!0;let a=X(),b=jT.getIOSVersion(a),c=0<b&&b<10,d=jU(a),e=0<d&&d<4.5;return!(a.indexOf("MSIE ")>0||a.indexOf("Trident/")>0||a.indexOf("Edge/")>0)&&!c&&!e}static isMockPersistence(){return"u">typeof process&&process.env?.USE_MOCK_PERSISTENCE==="YES"}static getStore(a,b){return a.store(b)}static getIOSVersion(a){let b=a.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(b?b[1].split("_").slice(0,2).join("."):"-1")}constructor(a,b,c){this.name=a,this.version=b,this.schemaConverter=c,this.lastClosedDbVersion=null,12.2===jT.getIOSVersion(X())&&ix("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(a){return this.db||(iw(jQ,"Opening database:",this.name),this.db=await new Promise((b,c)=>{let d=indexedDB.open(this.name,this.version);d.onsuccess=a=>{b(a.target.result)},d.onblocked=()=>{c(new jW(a,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},d.onerror=b=>{let d=b.target.error;"VersionError"===d.name?c(new iV(iO,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===d.name?c(new iV(iO,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+d)):c(new jW(a,d))},d.onupgradeneeded=a=>{iw(jQ,'Database "'+this.name+'" requires upgrade from version:',a.oldVersion);let b=a.target.result;this.schemaConverter.createOrUpgrade(b,d.transaction,a.oldVersion,this.version).next(()=>{iw(jQ,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=a=>this.versionchangelistener(a)),this.db}setVersionChangeListener(a){this.versionchangelistener=a,this.db&&(this.db.onversionchange=b=>a(b))}async runTransaction(a,b,c,d){let e="readonly"===b,f=0;for(;;){++f;try{this.db=await this.ensureDb(a);let b=jS.open(this.db,a,e?"readonly":"readwrite",c),f=d(b).next(a=>(b.maybeCommit(),a)).catch(a=>(b.abort(a),jP.reject(a))).toPromise();return f.catch(()=>{}),await b.completionPromise,f}catch(c){let a=c,b="FirebaseError"!==a.name&&f<jR;if(iw(jQ,"Transaction failed with error:",a.message,"Retrying:",b),this.close(),!b)return Promise.reject(a)}}}close(){this.db&&this.db.close(),this.db=void 0}}function jU(a){let b=a.match(/Android ([\d.]+)/i);return Number(b?b[1].split(".").slice(0,2).join("."):"-1")}class jV{constructor(a){this.dbCursor=a,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(a){this.dbCursor=a}done(){this.shouldStop=!0}skip(a){this.nextKey=a}delete(){return jZ(this.dbCursor.delete())}}class jW extends iV{constructor(a,b){super(iT,`IndexedDB transaction '${a}' failed: ${b}`),this.name="IndexedDbTransactionError"}}function jX(a){return"IndexedDbTransactionError"===a.name}class jY{constructor(a){this.store=a}put(a,b){let c;return void 0!==b?(iw(jQ,"PUT",this.store.name,a,b),c=this.store.put(b,a)):(iw(jQ,"PUT",this.store.name,"<auto-key>",a),c=this.store.put(a)),jZ(c)}add(a){return iw(jQ,"ADD",this.store.name,a,a),jZ(this.store.add(a))}get(a){return jZ(this.store.get(a)).next(b=>(void 0===b&&(b=null),iw(jQ,"GET",this.store.name,a,b),b))}delete(a){return iw(jQ,"DELETE",this.store.name,a),jZ(this.store.delete(a))}count(){return iw(jQ,"COUNT",this.store.name),jZ(this.store.count())}loadAll(a,b){let c=this.options(a,b),d=c.index?this.store.index(c.index):this.store;if("function"==typeof d.getAll){let a=d.getAll(c.range);return new jP((b,c)=>{a.onerror=a=>{c(a.target.error)},a.onsuccess=a=>{b(a.target.result)}})}{let a=this.cursor(c),b=[];return this.iterateCursor(a,(a,c)=>{b.push(c)}).next(()=>b)}}loadFirst(a,b){let c=this.store.getAll(a,null===b?void 0:b);return new jP((a,b)=>{c.onerror=a=>{b(a.target.error)},c.onsuccess=b=>{a(b.target.result)}})}deleteAll(a,b){iw(jQ,"DELETE ALL",this.store.name);let c=this.options(a,b);c.keysOnly=!1;let d=this.cursor(c);return this.iterateCursor(d,(a,b,c)=>c.delete())}iterate(a,b){let c;b?c=a:(c={},b=a);let d=this.cursor(c);return this.iterateCursor(d,b)}iterateSerial(a){let b=this.cursor({});return new jP((c,d)=>{b.onerror=a=>{d(j_(a.target.error))},b.onsuccess=b=>{let d=b.target.result;d?a(d.primaryKey,d.value).next(a=>{a?d.continue():c()}):c()}})}iterateCursor(a,b){let c=[];return new jP((d,e)=>{a.onerror=a=>{e(a.target.error)},a.onsuccess=a=>{let e=a.target.result;if(!e)return void d();let f=new jV(e),g=b(e.primaryKey,e.value,f);if(g instanceof jP){let a=g.catch(a=>(f.done(),jP.reject(a)));c.push(a)}f.isDone?d():null===f.skipToKey?e.continue():e.continue(f.skipToKey)}}).next(()=>jP.waitFor(c))}options(a,b){let c;return void 0!==a&&("string"==typeof a?c=a:b=a),{index:c,range:b}}cursor(a){let b="next";if(a.reverse&&(b="prev"),!a.index)return this.store.openCursor(a.range,b);{let c=this.store.index(a.index);return a.keysOnly?c.openKeyCursor(a.range,b):c.openCursor(a.range,b)}}}function jZ(a){return new jP((b,c)=>{a.onsuccess=a=>{b(a.target.result)},a.onerror=a=>{c(j_(a.target.error))}})}let j$=!1;function j_(a){let b=jT.getIOSVersion(X());if(b>=12.2&&b<13){let b="An internal error was encountered in the Indexed Database server";if(a.message.indexOf(b)>=0){let a=new iV("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${b}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return j$||(j$=!0,setTimeout(()=>{throw a},0)),a}}return a}let j0="IndexBackfiller",j1=15e3,j2=6e4,j3=50;class j4{constructor(a,b){this.asyncQueue=a,this.backfiller=b,this.task=null}start(){this.schedule(j1)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(a){iw(j0,`Scheduled in ${a}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",a,async()=>{this.task=null;try{let a=await this.backfiller.backfill();iw(j0,`Documents written: ${a}`)}catch(a){jX(a)?iw(j0,"Ignoring IndexedDB error during index backfill: ",a):await jO(a)}await this.schedule(j2)})}}class j5{constructor(a,b){this.localStore=a,this.persistence=b}async backfill(a=j3){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",b=>this.writeIndexEntries(b,a))}writeIndexEntries(a,b){let c=new Set,d=b,e=!0;return jP.doWhile(()=>!0===e&&d>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(a).next(b=>{if(!(null===b||c.has(b)))return iw(j0,`Processing collection: ${b}`),this.writeEntriesForCollectionGroup(a,b,d).next(a=>{d-=a,c.add(b)});e=!1})).next(()=>b-d)}writeEntriesForCollectionGroup(a,b,c){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(a,b).next(d=>this.localStore.localDocuments.getNextDocuments(a,b,d,c).next(c=>{let e=c.changes;return this.localStore.indexManager.updateIndexEntries(a,e).next(()=>this.getNewOffset(d,c)).next(c=>(iw(j0,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(a,b,c))).next(()=>e.size)}))}getNewOffset(a,b){let c=a;return b.changes.forEach((a,b)=>{let d=jJ(b);jL(d,c)>0&&(c=d)}),new jK(c.readTime,c.documentKey,Math.max(b.batchId,a.largestBatchId))}}class j6{constructor(a,b){this.previousValue=a,b&&(b.sequenceNumberHandler=a=>this.setPreviousValue(a),this.writeNewSequenceNumber=a=>b.writeSequenceNumber(a))}setPreviousValue(a){return this.previousValue=Math.max(a,this.previousValue),this.previousValue}next(){let a=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(a),a}}j6.INVALID=-1;let j7="\x01",j8="\x01",j9="\x10",ka="\x11";function kb(a){let b="";for(let c=0;c<a.length;c++)b.length>0&&(b=kd(b)),b=kc(a.get(c),b);return kd(b)}function kc(a,b){let c=b,d=a.length;for(let b=0;b<d;b++){let d=a.charAt(b);switch(d){case"\0":c+=j7+j9;break;case j7:c+=j7+ka;break;default:c+=d}}return c}function kd(a){return a+j7+j8}function ke(a){let b=a.length;if(iC(b>=2,64408,{path:a}),2===b)return iC(a.charAt(0)===j7&&a.charAt(1)===j8,56145,{path:a}),jf.emptyPath();let c=b-2,d=[],e="";for(let f=0;f<b;){let b=a.indexOf(j7,f);switch((b<0||b>c)&&iA(50515,{path:a}),a.charAt(b+1)){case j8:let g,h=a.substring(f,b);0===e.length?g=h:(e+=h,g=e,e=""),d.push(g);break;case j9:e+=a.substring(f,b),e+="\0";break;case ka:e+=a.substring(f,b+1);break;default:iA(61167,{path:a})}f=b+2}return new jf(d)}let kf="remoteDocuments",kg="owner",kh="owner",ki="mutationQueues",kj="userId",kk="mutations",kl="batchId",km="userMutationsIndex",kn=["userId","batchId"];function ko(a){return[a]}function kp(a,b){return[a,kb(b)]}function kq(a,b,c){return[a,kb(b),c]}let kr={},ks="documentMutations",kt="remoteDocumentsV14",ku=["prefixPath","collectionGroup","readTime","documentId"],kv="documentKeyIndex",kw=["prefixPath","collectionGroup","documentId"],kx="collectionGroupIndex",ky=["collectionGroup","readTime","prefixPath","documentId"],kz="remoteDocumentGlobal",kA="remoteDocumentGlobalKey",kB="targets",kC="targetId",kD="queryTargetsIndex",kE=["canonicalId","targetId"],kF="targetDocuments",kG=["targetId","path"],kH="documentTargetsIndex",kI=["path","targetId"],kJ="targetGlobalKey",kK="targetGlobal",kL="collectionParents",kM=["collectionId","parent"],kN="clientMetadata",kO="clientId",kP="bundles",kQ="bundleId",kR="namedQueries",kS="name",kT="indexConfiguration",kU="indexId",kV="collectionGroupIndex",kW="collectionGroup",kX="indexState",kY=["indexId","uid"],kZ="sequenceNumberIndex",k$=["uid","sequenceNumber"],k_="indexEntries",k0=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],k1="documentKeyIndex",k2=["indexId","uid","orderedDocumentKey"],k3="documentOverlays",k4=["userId","collectionPath","documentId"],k5="collectionPathOverlayIndex",k6=["userId","collectionPath","largestBatchId"],k7="collectionGroupOverlayIndex",k8=["userId","collectionGroup","largestBatchId"],k9="globals",la="name",lb=[ki,kk,ks,kf,kB,kg,kK,kF,kN,kz,kL,kP,kR],lc=[...lb,k3],ld=[ki,kk,ks,kt,kB,kg,kK,kF,kN,kz,kL,kP,kR,k3],le=ld,lf=[...le,kT,kX,k_],lg=lf,lh=[...lf,k9],li=lh;function lj(a){return 18===a?li:17===a?lh:16===a?lg:15===a?lf:14===a?le:13===a?ld:12===a?lc:11===a?lb:void iA(60245)}class lk extends jN{constructor(a,b){super(),this.simpleDbTransaction=a,this.currentSequenceNumber=b}}function ll(a,b){let c=iD(a);return jT.getStore(c.simpleDbTransaction,b)}function lm(a){let b=0;for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}function ln(a,b){for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])}function lo(a,b){let c=[];for(let d in a)Object.prototype.hasOwnProperty.call(a,d)&&c.push(b(a[d],d,a));return c}function lp(a){for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}class lq{constructor(a,b){this.comparator=a,this.root=b||ls.EMPTY}insert(a,b){return new lq(this.comparator,this.root.insert(a,b,this.comparator).copy(null,null,ls.BLACK,null,null))}remove(a){return new lq(this.comparator,this.root.remove(a,this.comparator).copy(null,null,ls.BLACK,null,null))}get(a){let b=this.root;for(;!b.isEmpty();){let c=this.comparator(a,b.key);if(0===c)return b.value;c<0?b=b.left:c>0&&(b=b.right)}return null}indexOf(a){let b=0,c=this.root;for(;!c.isEmpty();){let d=this.comparator(a,c.key);if(0===d)return b+c.left.size;d<0?c=c.left:(b+=c.left.size+1,c=c.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(a){return this.root.inorderTraversal(a)}forEach(a){this.inorderTraversal((b,c)=>(a(b,c),!1))}toString(){let a=[];return this.inorderTraversal((b,c)=>(a.push(`${b}:${c}`),!1)),`{${a.join(", ")}}`}reverseTraversal(a){return this.root.reverseTraversal(a)}getIterator(){return new lr(this.root,null,this.comparator,!1)}getIteratorFrom(a){return new lr(this.root,a,this.comparator,!1)}getReverseIterator(){return new lr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(a){return new lr(this.root,a,this.comparator,!0)}}class lr{constructor(a,b,c,d){this.isReverse=d,this.nodeStack=[];let e=1;for(;!a.isEmpty();)if(e=b?c(a.key,b):1,b&&d&&(e*=-1),e<0)a=this.isReverse?a.left:a.right;else if(0===e){this.nodeStack.push(a);break}else this.nodeStack.push(a),a=this.isReverse?a.right:a.left}getNext(){let a=this.nodeStack.pop(),b={key:a.key,value:a.value};if(this.isReverse)for(a=a.left;!a.isEmpty();)this.nodeStack.push(a),a=a.right;else for(a=a.right;!a.isEmpty();)this.nodeStack.push(a),a=a.left;return b}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let a=this.nodeStack[this.nodeStack.length-1];return{key:a.key,value:a.value}}}class ls{constructor(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:ls.RED,this.left=null!=d?d:ls.EMPTY,this.right=null!=e?e:ls.EMPTY,this.size=this.left.size+1+this.right.size}copy(a,b,c,d,e){return new ls(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,b,c){let d=this,e=c(a,d.key);return(d=e<0?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c))).fixUp()}removeMin(){if(this.left.isEmpty())return ls.EMPTY;let a=this;return a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),(a=a.copy(null,null,null,a.left.removeMin(),null)).fixUp()}remove(a,b){let c,d=this;if(0>b(a,d.key))d.left.isEmpty()||d.left.isRed()||d.left.left.isRed()||(d=d.moveRedLeft()),d=d.copy(null,null,null,d.left.remove(a,b),null);else{if(d.left.isRed()&&(d=d.rotateRight()),d.right.isEmpty()||d.right.isRed()||d.right.left.isRed()||(d=d.moveRedRight()),0===b(a,d.key))if(d.right.isEmpty())return ls.EMPTY;else c=d.right.min(),d=d.copy(c.key,c.value,null,null,d.right.removeMin());d=d.copy(null,null,null,null,d.right.remove(a,b))}return d.fixUp()}isRed(){return this.color}fixUp(){let a=this;return a.right.isRed()&&!a.left.isRed()&&(a=a.rotateLeft()),a.left.isRed()&&a.left.left.isRed()&&(a=a.rotateRight()),a.left.isRed()&&a.right.isRed()&&(a=a.colorFlip()),a}moveRedLeft(){let a=this.colorFlip();return a.right.left.isRed()&&(a=(a=(a=a.copy(null,null,null,null,a.right.rotateRight())).rotateLeft()).colorFlip()),a}moveRedRight(){let a=this.colorFlip();return a.left.left.isRed()&&(a=(a=a.rotateRight()).colorFlip()),a}rotateLeft(){let a=this.copy(null,null,ls.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight(){let a=this.copy(null,null,ls.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip(){let a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw iA(43730,{key:this.key,value:this.value});if(this.right.isRed())throw iA(14113,{key:this.key,value:this.value});let a=this.left.check();if(a===this.right.check())return a+ +!this.isRed();throw iA(27949)}}ls.EMPTY=null,ls.RED=!0,ls.BLACK=!1;class lt{constructor(){this.size=0}get key(){throw iA(57766)}get value(){throw iA(16141)}get color(){throw iA(16727)}get left(){throw iA(29726)}get right(){throw iA(36894)}copy(a,b,c,d,e){return this}insert(a,b,c){return new ls(a,b)}remove(a,b){return this}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}ls.EMPTY=new lt;class lu{constructor(a){this.comparator=a,this.data=new lq(this.comparator)}has(a){return null!==this.data.get(a)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(a){return this.data.indexOf(a)}forEach(a){this.data.inorderTraversal((b,c)=>(a(b),!1))}forEachInRange(a,b){let c=this.data.getIteratorFrom(a[0]);for(;c.hasNext();){let d=c.getNext();if(this.comparator(d.key,a[1])>=0)return;b(d.key)}}forEachWhile(a,b){let c;for(c=void 0!==b?this.data.getIteratorFrom(b):this.data.getIterator();c.hasNext();)if(!a(c.getNext().key))return}firstAfterOrEqual(a){let b=this.data.getIteratorFrom(a);return b.hasNext()?b.getNext().key:null}getIterator(){return new lv(this.data.getIterator())}getIteratorFrom(a){return new lv(this.data.getIteratorFrom(a))}add(a){return this.copy(this.data.remove(a).insert(a,!0))}delete(a){return this.has(a)?this.copy(this.data.remove(a)):this}isEmpty(){return this.data.isEmpty()}unionWith(a){let b=this;return b.size<a.size&&(b=a,a=this),a.forEach(a=>{b=b.add(a)}),b}isEqual(a){if(!(a instanceof lu)||this.size!==a.size)return!1;let b=this.data.getIterator(),c=a.data.getIterator();for(;b.hasNext();){let a=b.getNext().key,d=c.getNext().key;if(0!==this.comparator(a,d))return!1}return!0}toArray(){let a=[];return this.forEach(b=>{a.push(b)}),a}toString(){let a=[];return this.forEach(b=>a.push(b)),"SortedSet("+a.toString()+")"}copy(a){let b=new lu(this.comparator);return b.data=a,b}}class lv{constructor(a){this.iter=a}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function lw(a,b,c,d,e){let f=a.getIterator(),g=b.getIterator(),h=lx(f),i=lx(g);for(;h||i;){let a=!1,b=!1;if(h&&i){let d=c(h,i);d<0?b=!0:d>0&&(a=!0)}else null!=h?b=!0:a=!0;a?(d(i),i=lx(g)):b?(e(h),h=lx(f)):(h=lx(f),i=lx(g))}}function lx(a){return a.hasNext()?a.getNext():void 0}class ly{constructor(a){this.fields=a,a.sort(jh.comparator)}static empty(){return new ly([])}unionWith(a){let b=new lu(jh.comparator);for(let a of this.fields)b=b.add(a);for(let c of a)b=b.add(c);return new ly(b.toArray())}covers(a){for(let b of this.fields)if(b.isPrefixOf(a))return!0;return!1}isEqual(a){return jb(this.fields,a.fields,(a,b)=>a.isEqual(b))}}function lz(a){return Buffer.from(a,"base64").toString("binary")}function lA(a){return Buffer.from(a,"binary").toString("base64")}class lB{constructor(a){this.binaryString=a}static fromBase64String(a){return new lB(lz(a))}static fromUint8Array(a){return new lB(lC(a))}[Symbol.iterator](){let a=0;return{next:()=>a<this.binaryString.length?{value:this.binaryString.charCodeAt(a++),done:!1}:{value:void 0,done:!0}}}toBase64(){return lA(this.binaryString)}toUint8Array(){return lD(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(a){return i6(this.binaryString,a.binaryString)}isEqual(a){return this.binaryString===a.binaryString}}function lC(a){let b="";for(let c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b}function lD(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}lB.EMPTY_BYTE_STRING=new lB("");let lE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lF(a){if(iC(!!a,39018),"string"==typeof a){let b=0,c=lE.exec(a);if(iC(!!c,46558,{timestamp:a}),c[1]){let a=c[1];b=Number(a=(a+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(a).getTime()/1e3),nanos:b}}return{seconds:lG(a.seconds),nanos:lG(a.nanos)}}function lG(a){return"number"==typeof a?a:"string"==typeof a?Number(a):0}function lH(a){return"string"==typeof a?lB.fromBase64String(a):lB.fromUint8Array(a)}let lI="server_timestamp",lJ="__type__",lK="__previous_value__",lL="__local_write_time__";function lM(a){return(a?.mapValue?.fields||{})[lJ]?.stringValue===lI}function lN(a,b){let c={fields:{[lJ]:{stringValue:lI},[lL]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return b&&lM(b)&&(b=lO(b)),b&&(c.fields[lK]=b),{mapValue:c}}function lO(a){let b=a.mapValue.fields[lK];return lM(b)?lO(b):b}function lP(a){let b=lF(a.mapValue.fields[lL].timestampValue);return new jv(b.seconds,b.nanos)}class lQ{constructor(a,b,c,d,e,f,g,h,i,j,k){this.databaseId=a,this.appId=b,this.persistenceKey=c,this.host=d,this.ssl=e,this.forceLongPolling=f,this.autoDetectLongPolling=g,this.longPollingOptions=h,this.useFetchStreams=i,this.isUsingEmulator=j,this.apiKey=k}}let lR="(default)";class lS{constructor(a,b){this.projectId=a,this.database=b||lR}static empty(){return new lS("","")}get isDefaultDatabase(){return this.database===lR}isEqual(a){return a instanceof lS&&a.projectId===this.projectId&&a.database===this.database}}function lT(a,b){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new iV(iH,'"projectId" not provided in firebase.initializeApp.');return new lS(a.options.projectId,b)}let lU=-1;function lV(a){return null==a}function lW(a){return 0===a&&1/a==-1/0}function lX(a){return"number"==typeof a&&Number.isInteger(a)&&!lW(a)&&a<=Number.MAX_SAFE_INTEGER&&a>=Number.MIN_SAFE_INTEGER}let lY="__type__",lZ="__max__",l$={mapValue:{fields:{__type__:{stringValue:lZ}}}},l_="__vector__",l0="value",l1={nullValue:"NULL_VALUE"};function l2(a){return"nullValue"in a?0:"booleanValue"in a?1:"integerValue"in a||"doubleValue"in a?2:"timestampValue"in a?3:"stringValue"in a?5:"bytesValue"in a?6:"referenceValue"in a?7:"geoPointValue"in a?8:"arrayValue"in a?9:"mapValue"in a?lM(a)?4:mE(a)?0x1fffffffffffff:mC(a)?10:11:iA(28295,{value:a})}function l3(a,b){if(a===b)return!0;let c=l2(a);if(c!==l2(b))return!1;switch(c){case 0:case 0x1fffffffffffff:return!0;case 1:return a.booleanValue===b.booleanValue;case 4:return lP(a).isEqual(lP(b));case 3:return l4(a,b);case 5:return a.stringValue===b.stringValue;case 6:return l6(a,b);case 7:return a.referenceValue===b.referenceValue;case 8:return l5(a,b);case 2:return l7(a,b);case 9:return jb(a.arrayValue.values||[],b.arrayValue.values||[],l3);case 10:case 11:return l8(a,b);default:return iA(52216,{left:a})}}function l4(a,b){if("string"==typeof a.timestampValue&&"string"==typeof b.timestampValue&&a.timestampValue.length===b.timestampValue.length)return a.timestampValue===b.timestampValue;let c=lF(a.timestampValue),d=lF(b.timestampValue);return c.seconds===d.seconds&&c.nanos===d.nanos}function l5(a,b){return lG(a.geoPointValue.latitude)===lG(b.geoPointValue.latitude)&&lG(a.geoPointValue.longitude)===lG(b.geoPointValue.longitude)}function l6(a,b){return lH(a.bytesValue).isEqual(lH(b.bytesValue))}function l7(a,b){if("integerValue"in a&&"integerValue"in b)return lG(a.integerValue)===lG(b.integerValue);if("doubleValue"in a&&"doubleValue"in b){let c=lG(a.doubleValue),d=lG(b.doubleValue);return c===d?lW(c)===lW(d):isNaN(c)&&isNaN(d)}return!1}function l8(a,b){let c=a.mapValue.fields||{},d=b.mapValue.fields||{};if(lm(c)!==lm(d))return!1;for(let a in c)if(c.hasOwnProperty(a)&&(void 0===d[a]||!l3(c[a],d[a])))return!1;return!0}function l9(a,b){return void 0!==(a.values||[]).find(a=>l3(a,b))}function ma(a,b){if(a===b)return 0;let c=l2(a),d=l2(b);if(c!==d)return i6(c,d);switch(c){case 0:case 0x1fffffffffffff:return 0;case 1:return i6(a.booleanValue,b.booleanValue);case 2:return mb(a,b);case 3:return mc(a.timestampValue,b.timestampValue);case 4:return mc(lP(a),lP(b));case 5:return i7(a.stringValue,b.stringValue);case 6:return mf(a.bytesValue,b.bytesValue);case 7:return md(a.referenceValue,b.referenceValue);case 8:return me(a.geoPointValue,b.geoPointValue);case 9:return mg(a.arrayValue,b.arrayValue);case 10:return mh(a.mapValue,b.mapValue);case 11:return mi(a.mapValue,b.mapValue);default:throw iA(23264,{leftType:c})}}function mb(a,b){let c=lG(a.integerValue||a.doubleValue),d=lG(b.integerValue||b.doubleValue);return c<d?-1:c>d?1:c===d?0:isNaN(c)?isNaN(d)?0:-1:1}function mc(a,b){if("string"==typeof a&&"string"==typeof b&&a.length===b.length)return i6(a,b);let c=lF(a),d=lF(b),e=i6(c.seconds,d.seconds);return 0!==e?e:i6(c.nanos,d.nanos)}function md(a,b){let c=a.split("/"),d=b.split("/");for(let a=0;a<c.length&&a<d.length;a++){let b=i6(c[a],d[a]);if(0!==b)return b}return i6(c.length,d.length)}function me(a,b){let c=i6(lG(a.latitude),lG(b.latitude));return 0!==c?c:i6(lG(a.longitude),lG(b.longitude))}function mf(a,b){let c=lH(a),d=lH(b);return c.compareTo(d)}function mg(a,b){let c=a.values||[],d=b.values||[];for(let a=0;a<c.length&&a<d.length;++a){let b=ma(c[a],d[a]);if(b)return b}return i6(c.length,d.length)}function mh(a,b){let c=a.fields||{},d=b.fields||{},e=c[l0]?.arrayValue,f=d[l0]?.arrayValue,g=i6(e?.values?.length||0,f?.values?.length||0);return 0!==g?g:mg(e,f)}function mi(a,b){if(a===l$.mapValue&&b===l$.mapValue)return 0;if(a===l$.mapValue)return 1;if(b===l$.mapValue)return -1;let c=a.fields||{},d=Object.keys(c),e=b.fields||{},f=Object.keys(e);d.sort(),f.sort();for(let a=0;a<d.length&&a<f.length;++a){let b=i7(d[a],f[a]);if(0!==b)return b;let g=ma(c[d[a]],e[f[a]]);if(0!==g)return g}return i6(d.length,f.length)}function mj(a){return mk(a)}function mk(a){if("nullValue"in a)return"null";if("booleanValue"in a)return""+a.booleanValue;if("integerValue"in a)return""+a.integerValue;if("doubleValue"in a)return""+a.doubleValue;if("timestampValue"in a)return mm(a.timestampValue);else if("stringValue"in a)return a.stringValue;else if("bytesValue"in a)return ml(a.bytesValue);else if("referenceValue"in a)return mo(a.referenceValue);else if("geoPointValue"in a)return mn(a.geoPointValue);else if("arrayValue"in a)return mq(a.arrayValue);else if("mapValue"in a)return mp(a.mapValue);else return iA(61005,{value:a})}function ml(a){return lH(a).toBase64()}function mm(a){let b=lF(a);return`time(${b.seconds},${b.nanos})`}function mn(a){return`geo(${a.latitude},${a.longitude})`}function mo(a){return ji.fromName(a).toString()}function mp(a){let b=Object.keys(a.fields||{}).sort(),c="{",d=!0;for(let e of b)d?d=!1:c+=",",c+=`${e}:${mk(a.fields[e])}`;return c+"}"}function mq(a){let b="[",c=!0;for(let d of a.values||[])c?c=!1:b+=",",b+=mk(d);return b+"]"}function mr(a){switch(l2(a)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let b=lO(a);return b?16+mr(b):16;case 5:return 2*a.stringValue.length;case 6:return lH(a.bytesValue).approximateByteSize();case 7:return a.referenceValue.length;case 9:return mt(a.arrayValue);case 10:case 11:return ms(a.mapValue);default:throw iA(13486,{value:a})}}function ms(a){let b=0;return ln(a.fields,(a,c)=>{b+=a.length+mr(c)}),b}function mt(a){return(a.values||[]).reduce((a,b)=>a+mr(b),0)}function mu(a,b){return{referenceValue:`projects/${a.projectId}/databases/${a.database}/documents/${b.path.canonicalString()}`}}function mv(a){return!!a&&"integerValue"in a}function mw(a){return!!a&&"doubleValue"in a}function mx(a){return mv(a)||mw(a)}function my(a){return!!a&&"arrayValue"in a}function mz(a){return!!a&&"nullValue"in a}function mA(a){return!!a&&"doubleValue"in a&&isNaN(Number(a.doubleValue))}function mB(a){return!!a&&"mapValue"in a}function mC(a){return(a?.mapValue?.fields||{})[lY]?.stringValue===l_}function mD(a){if(a.geoPointValue)return{geoPointValue:{...a.geoPointValue}};if(a.timestampValue&&"object"==typeof a.timestampValue)return{timestampValue:{...a.timestampValue}};if(a.mapValue){let b={mapValue:{fields:{}}};return ln(a.mapValue.fields,(a,c)=>b.mapValue.fields[a]=mD(c)),b}{if(!a.arrayValue)return{...a};let b={arrayValue:{values:[]}};for(let c=0;c<(a.arrayValue.values||[]).length;++c)b.arrayValue.values[c]=mD(a.arrayValue.values[c]);return b}}function mE(a){return(((a.mapValue||{}).fields||{}).__type__||{}).stringValue===lZ}let mF={mapValue:{fields:{[lY]:{stringValue:l_},[l0]:{arrayValue:{}}}}};function mG(a){if("nullValue"in a)return l1;if("booleanValue"in a)return{booleanValue:!1};if("integerValue"in a||"doubleValue"in a)return{doubleValue:NaN};if("timestampValue"in a)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in a)return{stringValue:""};else if("bytesValue"in a)return{bytesValue:""};else if("referenceValue"in a)return mu(lS.empty(),ji.empty());else if("geoPointValue"in a)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in a)return{arrayValue:{}};else if(!("mapValue"in a))return iA(35942,{value:a});else return mC(a)?mF:{mapValue:{}}}function mH(a){if("nullValue"in a)return{booleanValue:!1};if("booleanValue"in a)return{doubleValue:NaN};if("integerValue"in a||"doubleValue"in a)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in a)return{stringValue:""};if("stringValue"in a)return{bytesValue:""};else if("bytesValue"in a)return mu(lS.empty(),ji.empty());else if("referenceValue"in a)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in a)return{arrayValue:{}};else if("arrayValue"in a)return mF;else if(!("mapValue"in a))return iA(61959,{value:a});else return mC(a)?{mapValue:{}}:l$}function mI(a,b){let c=ma(a.value,b.value);return 0!==c?c:a.inclusive&&!b.inclusive?-1:!a.inclusive&&b.inclusive?1:0}function mJ(a,b){let c=ma(a.value,b.value);return 0!==c?c:a.inclusive&&!b.inclusive?1:!a.inclusive&&b.inclusive?-1:0}class mK{constructor(a){this.value=a}static empty(){return new mK({mapValue:{}})}field(a){if(a.isEmpty())return this.value;{let b=this.value;for(let c=0;c<a.length-1;++c)if(!mB(b=(b.mapValue.fields||{})[a.get(c)]))return null;return(b=(b.mapValue.fields||{})[a.lastSegment()])||null}}set(a,b){this.getFieldsMap(a.popLast())[a.lastSegment()]=mD(b)}setAll(a){let b=jh.emptyPath(),c={},d=[];a.forEach((a,e)=>{if(!b.isImmediateParentOf(e)){let a=this.getFieldsMap(b);this.applyChanges(a,c,d),c={},d=[],b=e.popLast()}a?c[e.lastSegment()]=mD(a):d.push(e.lastSegment())});let e=this.getFieldsMap(b);this.applyChanges(e,c,d)}delete(a){let b=this.field(a.popLast());mB(b)&&b.mapValue.fields&&delete b.mapValue.fields[a.lastSegment()]}isEqual(a){return l3(this.value,a.value)}getFieldsMap(a){let b=this.value;b.mapValue.fields||(b.mapValue={fields:{}});for(let c=0;c<a.length;++c){let d=b.mapValue.fields[a.get(c)];mB(d)&&d.mapValue.fields||(d={mapValue:{fields:{}}},b.mapValue.fields[a.get(c)]=d),b=d}return b.mapValue.fields}applyChanges(a,b,c){for(let d of(ln(b,(b,c)=>a[b]=c),c))delete a[d]}clone(){return new mK(mD(this.value))}}function mL(a){let b=[];return ln(a.fields,(a,c)=>{let d=new jh([a]);if(mB(c)){let a=mL(c.mapValue).fields;if(0===a.length)b.push(d);else for(let c of a)b.push(d.child(c))}else b.push(d)}),new ly(b)}class mM{constructor(a,b,c,d,e,f,g){this.key=a,this.documentType=b,this.version=c,this.readTime=d,this.createTime=e,this.data=f,this.documentState=g}static newInvalidDocument(a){return new mM(a,0,jw.min(),jw.min(),jw.min(),mK.empty(),0)}static newFoundDocument(a,b,c,d){return new mM(a,1,b,jw.min(),c,d,0)}static newNoDocument(a,b){return new mM(a,2,b,jw.min(),jw.min(),mK.empty(),0)}static newUnknownDocument(a,b){return new mM(a,3,b,jw.min(),jw.min(),mK.empty(),2)}convertToFoundDocument(a,b){return this.createTime.isEqual(jw.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=a),this.version=a,this.documentType=1,this.data=b,this.documentState=0,this}convertToNoDocument(a){return this.version=a,this.documentType=2,this.data=mK.empty(),this.documentState=0,this}convertToUnknownDocument(a){return this.version=a,this.documentType=3,this.data=mK.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=jw.min(),this}setReadTime(a){return this.readTime=a,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(a){return a instanceof mM&&this.key.isEqual(a.key)&&this.version.isEqual(a.version)&&this.documentType===a.documentType&&this.documentState===a.documentState&&this.data.isEqual(a.data)}mutableCopy(){return new mM(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function mN(a,b,c){let d=b.data.field(a),e=c.data.field(a);return null!==d&&null!==e?ma(d,e):iA(42886)}class mO{constructor(a,b){this.position=a,this.inclusive=b}}function mP(a,b,c){let d=0;for(let e=0;e<a.position.length;e++){let f=b[e],g=a.position[e];if(d=f.field.isKeyField()?ji.comparator(ji.fromName(g.referenceValue),c.key):ma(g,c.data.field(f.field)),"desc"===f.dir&&(d*=-1),0!==d)break}return d}function mQ(a,b,c){let d=mP(a,b,c);return a.inclusive?d>=0:d>0}function mR(a,b,c){let d=mP(a,b,c);return a.inclusive?d<=0:d<0}function mS(a,b){if(null===a)return null===b;if(null===b||a.inclusive!==b.inclusive||a.position.length!==b.position.length)return!1;for(let c=0;c<a.position.length;c++)if(!l3(a.position[c],b.position[c]))return!1;return!0}class mT{constructor(a,b="asc"){this.field=a,this.dir=b}}function mU(a){return a.field.canonicalString()+a.dir}function mV(a){return`${a.field.canonicalString()} (${a.dir})`}function mW(a,b){return a.dir===b.dir&&a.field.isEqual(b.field)}class mX{}class mY extends mX{constructor(a,b,c){super(),this.field=a,this.op=b,this.value=c}static create(a,b,c){if(a.isKeyField())if("in"===b||"not-in"===b)return this.createKeyFieldInFilter(a,b,c);else return new na(a,b,c);if("array-contains"===b)return new ne(a,c);if("in"===b)return new nf(a,c);if("not-in"===b)return new ng(a,c);if("array-contains-any"===b)return new nh(a,c);else return new mY(a,b,c)}static createKeyFieldInFilter(a,b,c){return"in"===b?new nb(a,c):new nc(a,c)}matches(a){let b=a.data.field(this.field);return"!="===this.op?null!==b&&void 0===b.nullValue&&this.matchesComparison(ma(b,this.value)):null!==b&&l2(this.value)===l2(b)&&this.matchesComparison(ma(b,this.value))}matchesComparison(a){switch(this.op){case"<":return a<0;case"<=":return a<=0;case"==":return 0===a;case"!=":return 0!==a;case">":return a>0;case">=":return a>=0;default:return iA(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class mZ extends mX{constructor(a,b){super(),this.filters=a,this.op=b,this.memoizedFlattenedFilters=null}static create(a,b){return new mZ(a,b)}matches(a){return m$(this)?void 0===this.filters.find(b=>!b.matches(a)):void 0!==this.filters.find(b=>b.matches(a))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((a,b)=>a.concat(b.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function m$(a){return"and"===a.op}function m_(a){return"or"===a.op}function m0(a){return m1(a)&&m$(a)}function m1(a){for(let b of a.filters)if(b instanceof mZ)return!1;return!0}function m2(a){if(a instanceof mY)return a.field.canonicalString()+a.op.toString()+mj(a.value);{if(m0(a))return a.filters.map(a=>m2(a)).join(",");let b=a.filters.map(a=>m2(a)).join(",");return`${a.op}(${b})`}}function m3(a,b){return a instanceof mY?m4(a,b):a instanceof mZ?m5(a,b):void iA(19439)}function m4(a,b){return b instanceof mY&&a.op===b.op&&a.field.isEqual(b.field)&&l3(a.value,b.value)}function m5(a,b){return b instanceof mZ&&a.op===b.op&&a.filters.length===b.filters.length&&a.filters.reduce((a,c,d)=>a&&m3(c,b.filters[d]),!0)}function m6(a,b){let c=a.filters.concat(b);return mZ.create(c,a.op)}function m7(a){return a instanceof mY?m9(a):a instanceof mZ?m8(a):"Filter"}function m8(a){return a.op.toString()+" {"+a.getFilters().map(m7).join(" ,")+"}"}function m9(a){return`${a.field.canonicalString()} ${a.op} ${mj(a.value)}`}class na extends mY{constructor(a,b,c){super(a,b,c),this.key=ji.fromName(c.referenceValue)}matches(a){let b=ji.comparator(a.key,this.key);return this.matchesComparison(b)}}class nb extends mY{constructor(a,b){super(a,"in",b),this.keys=nd("in",b)}matches(a){return this.keys.some(b=>b.isEqual(a.key))}}class nc extends mY{constructor(a,b){super(a,"not-in",b),this.keys=nd("not-in",b)}matches(a){return!this.keys.some(b=>b.isEqual(a.key))}}function nd(a,b){return(b.arrayValue?.values||[]).map(a=>ji.fromName(a.referenceValue))}class ne extends mY{constructor(a,b){super(a,"array-contains",b)}matches(a){let b=a.data.field(this.field);return my(b)&&l9(b.arrayValue,this.value)}}class nf extends mY{constructor(a,b){super(a,"in",b)}matches(a){let b=a.data.field(this.field);return null!==b&&l9(this.value.arrayValue,b)}}class ng extends mY{constructor(a,b){super(a,"not-in",b)}matches(a){if(l9(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let b=a.data.field(this.field);return null!==b&&void 0===b.nullValue&&!l9(this.value.arrayValue,b)}}class nh extends mY{constructor(a,b){super(a,"array-contains-any",b)}matches(a){let b=a.data.field(this.field);return!!my(b)&&!!b.arrayValue.values&&b.arrayValue.values.some(a=>l9(this.value.arrayValue,a))}}class ni{constructor(a,b=null,c=[],d=[],e=null,f=null,g=null){this.path=a,this.collectionGroup=b,this.orderBy=c,this.filters=d,this.limit=e,this.startAt=f,this.endAt=g,this.memoizedCanonicalId=null}}function nj(a,b=null,c=[],d=[],e=null,f=null,g=null){return new ni(a,b,c,d,e,f,g)}function nk(a){let b=iD(a);if(null===b.memoizedCanonicalId){let a=b.path.canonicalString();null!==b.collectionGroup&&(a+="|cg:"+b.collectionGroup),a+="|f:",a+=b.filters.map(a=>m2(a)).join(","),a+="|ob:",a+=b.orderBy.map(a=>mU(a)).join(","),lV(b.limit)||(a+="|l:",a+=b.limit),b.startAt&&(a+="|lb:",a+=b.startAt.inclusive?"b:":"a:",a+=b.startAt.position.map(a=>mj(a)).join(",")),b.endAt&&(a+="|ub:",a+=b.endAt.inclusive?"a:":"b:",a+=b.endAt.position.map(a=>mj(a)).join(",")),b.memoizedCanonicalId=a}return b.memoizedCanonicalId}function nl(a){let b=a.path.canonicalString();return null!==a.collectionGroup&&(b+=" collectionGroup="+a.collectionGroup),a.filters.length>0&&(b+=`, filters: [${a.filters.map(a=>m7(a)).join(", ")}]`),lV(a.limit)||(b+=", limit: "+a.limit),a.orderBy.length>0&&(b+=`, orderBy: [${a.orderBy.map(a=>mV(a)).join(", ")}]`),a.startAt&&(b+=", startAt: ",b+=a.startAt.inclusive?"b:":"a:",b+=a.startAt.position.map(a=>mj(a)).join(",")),a.endAt&&(b+=", endAt: ",b+=a.endAt.inclusive?"a:":"b:",b+=a.endAt.position.map(a=>mj(a)).join(",")),`Target(${b})`}function nm(a,b){if(a.limit!==b.limit||a.orderBy.length!==b.orderBy.length)return!1;for(let c=0;c<a.orderBy.length;c++)if(!mW(a.orderBy[c],b.orderBy[c]))return!1;if(a.filters.length!==b.filters.length)return!1;for(let c=0;c<a.filters.length;c++)if(!m3(a.filters[c],b.filters[c]))return!1;return a.collectionGroup===b.collectionGroup&&!!a.path.isEqual(b.path)&&!!mS(a.startAt,b.startAt)&&mS(a.endAt,b.endAt)}function nn(a){return ji.isDocumentKey(a.path)&&null===a.collectionGroup&&0===a.filters.length}function no(a,b){return a.filters.filter(a=>a instanceof mY&&a.field.isEqual(b))}function np(a,b){let c=jA(b);if(void 0===c)return null;for(let b of no(a,c.fieldPath))switch(b.op){case"array-contains-any":return b.value.arrayValue.values||[];case"array-contains":return[b.value]}return null}function nq(a,b){let c=new Map;for(let d of jB(b))for(let b of no(a,d.fieldPath))switch(b.op){case"==":case"in":c.set(d.fieldPath.canonicalString(),b.value);break;case"not-in":case"!=":return c.set(d.fieldPath.canonicalString(),b.value),Array.from(c.values())}return null}function nr(a,b){let c=[],d=!0;for(let e of jB(b)){let b=0===e.kind?nt(a,e.fieldPath,a.startAt):nu(a,e.fieldPath,a.startAt);c.push(b.value),d&&(d=b.inclusive)}return new mO(c,d)}function ns(a,b){let c=[],d=!0;for(let e of jB(b)){let b=0===e.kind?nu(a,e.fieldPath,a.endAt):nt(a,e.fieldPath,a.endAt);c.push(b.value),d&&(d=b.inclusive)}return new mO(c,d)}function nt(a,b,c){let d=l1,e=!0;for(let c of no(a,b)){let a=l1,b=!0;switch(c.op){case"<":case"<=":a=mG(c.value);break;case"==":case"in":case">=":a=c.value;break;case">":a=c.value,b=!1;break;case"!=":case"not-in":a=l1}0>mI({value:d,inclusive:e},{value:a,inclusive:b})&&(d=a,e=b)}if(null!==c){for(let f=0;f<a.orderBy.length;++f)if(a.orderBy[f].field.isEqual(b)){let a=c.position[f];0>mI({value:d,inclusive:e},{value:a,inclusive:c.inclusive})&&(d=a,e=c.inclusive);break}}return{value:d,inclusive:e}}function nu(a,b,c){let d=l$,e=!0;for(let c of no(a,b)){let a=l$,b=!0;switch(c.op){case">=":case">":a=mH(c.value),b=!1;break;case"==":case"in":case"<=":a=c.value;break;case"<":a=c.value,b=!1;break;case"!=":case"not-in":a=l$}mJ({value:d,inclusive:e},{value:a,inclusive:b})>0&&(d=a,e=b)}if(null!==c){for(let f=0;f<a.orderBy.length;++f)if(a.orderBy[f].field.isEqual(b)){let a=c.position[f];mJ({value:d,inclusive:e},{value:a,inclusive:c.inclusive})>0&&(d=a,e=c.inclusive);break}}return{value:d,inclusive:e}}function nv(a){let b=new lu(jh.comparator),c=!1;for(let d of a.filters)for(let a of d.getFlattenedFilters())a.field.isKeyField()||("array-contains"===a.op||"array-contains-any"===a.op?c=!0:b=b.add(a.field));for(let c of a.orderBy)c.field.isKeyField()||(b=b.add(c.field));return b.size+ +!!c}function nw(a){return null!==a.limit}class nx{constructor(a,b=null,c=[],d=[],e=null,f="F",g=null,h=null){this.path=a,this.collectionGroup=b,this.explicitOrderBy=c,this.filters=d,this.limit=e,this.limitType=f,this.startAt=g,this.endAt=h,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function ny(a,b,c,d,e,f,g,h){return new nx(a,b,c,d,e,f,g,h)}function nz(a){return new nx(a)}function nA(a,b){return new nx(b,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}function nB(a){return 0===a.filters.length&&null===a.limit&&null==a.startAt&&null==a.endAt&&(0===a.explicitOrderBy.length||1===a.explicitOrderBy.length&&a.explicitOrderBy[0].field.isKeyField())}function nC(a){let b=new lu(jh.comparator);return a.filters.forEach(a=>{a.getFlattenedFilters().forEach(a=>{a.isInequality()&&(b=b.add(a.field))})}),b}function nD(a){return ji.isDocumentKey(a.path)&&null===a.collectionGroup&&0===a.filters.length}function nE(a){return null!==a.collectionGroup}function nF(a){let b=iD(a);if(null===b.memoizedNormalizedOrderBy){b.memoizedNormalizedOrderBy=[];let a=new Set;for(let c of b.explicitOrderBy)b.memoizedNormalizedOrderBy.push(c),a.add(c.field.canonicalString());let c=b.explicitOrderBy.length>0?b.explicitOrderBy[b.explicitOrderBy.length-1].dir:"asc";nC(b).forEach(d=>{a.has(d.canonicalString())||d.isKeyField()||b.memoizedNormalizedOrderBy.push(new mT(d,c))}),a.has(jh.keyField().canonicalString())||b.memoizedNormalizedOrderBy.push(new mT(jh.keyField(),c))}return b.memoizedNormalizedOrderBy}function nG(a){let b=iD(a);return b.memoizedTarget||(b.memoizedTarget=nI(b,nF(a))),b.memoizedTarget}function nH(a){let b=iD(a);return b.memoizedAggregateTarget||(b.memoizedAggregateTarget=nI(b,a.explicitOrderBy)),b.memoizedAggregateTarget}function nI(a,b){if("F"===a.limitType)return nj(a.path,a.collectionGroup,b,a.filters,a.limit,a.startAt,a.endAt);{b=b.map(a=>{let b="desc"===a.dir?"asc":"desc";return new mT(a.field,b)});let c=a.endAt?new mO(a.endAt.position,a.endAt.inclusive):null,d=a.startAt?new mO(a.startAt.position,a.startAt.inclusive):null;return nj(a.path,a.collectionGroup,b,a.filters,a.limit,c,d)}}function nJ(a,b){let c=a.filters.concat([b]);return new nx(a.path,a.collectionGroup,a.explicitOrderBy.slice(),c,a.limit,a.limitType,a.startAt,a.endAt)}function nK(a,b){let c=a.explicitOrderBy.concat([b]);return new nx(a.path,a.collectionGroup,c,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}function nL(a,b,c){return new nx(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),b,c,a.startAt,a.endAt)}function nM(a,b){return new nx(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,b,a.endAt)}function nN(a,b){return new nx(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,b)}function nO(a,b){return nm(nG(a),nG(b))&&a.limitType===b.limitType}function nP(a){return`${nk(nG(a))}|lt:${a.limitType}`}function nQ(a){return`Query(target=${nl(nG(a))}; limitType=${a.limitType})`}function nR(a,b){return b.isFoundDocument()&&nS(a,b)&&nT(a,b)&&nU(a,b)&&nV(a,b)}function nS(a,b){let c=b.key.path;return null!==a.collectionGroup?b.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(c):ji.isDocumentKey(a.path)?a.path.isEqual(c):a.path.isImmediateParentOf(c)}function nT(a,b){for(let c of nF(a))if(!c.field.isKeyField()&&null===b.data.field(c.field))return!1;return!0}function nU(a,b){for(let c of a.filters)if(!c.matches(b))return!1;return!0}function nV(a,b){return(!a.startAt||!!mR(a.startAt,nF(a),b))&&(!a.endAt||!!mQ(a.endAt,nF(a),b))}function nW(a){return a.collectionGroup||(a.path.length%2==1?a.path.lastSegment():a.path.get(a.path.length-2))}function nX(a){return(b,c)=>{let d=!1;for(let e of nF(a)){let a=nY(e,b,c);if(0!==a)return a;d=d||e.field.isKeyField()}return 0}}function nY(a,b,c){let d=a.field.isKeyField()?ji.comparator(b.key,c.key):mN(a.field,b,c);switch(a.dir){case"asc":return d;case"desc":return -1*d;default:return iA(19790,{direction:a.dir})}}class nZ{constructor(a,b){this.mapKeyFn=a,this.equalsFn=b,this.inner={},this.innerSize=0}get(a){let b=this.mapKeyFn(a),c=this.inner[b];if(void 0!==c){for(let[b,d]of c)if(this.equalsFn(b,a))return d}}has(a){return void 0!==this.get(a)}set(a,b){let c=this.mapKeyFn(a),d=this.inner[c];if(void 0===d){this.inner[c]=[[a,b]],this.innerSize++;return}for(let c=0;c<d.length;c++)if(this.equalsFn(d[c][0],a)){d[c]=[a,b];return}d.push([a,b]),this.innerSize++}delete(a){let b=this.mapKeyFn(a),c=this.inner[b];if(void 0===c)return!1;for(let d=0;d<c.length;d++)if(this.equalsFn(c[d][0],a))return 1===c.length?delete this.inner[b]:c.splice(d,1),this.innerSize--,!0;return!1}forEach(a){ln(this.inner,(b,c)=>{for(let[b,d]of c)a(b,d)})}isEmpty(){return lp(this.inner)}size(){return this.innerSize}}let n$=new lq(ji.comparator);function n_(){return n$}let n0=new lq(ji.comparator);function n1(...a){let b=n0;for(let c of a)b=b.insert(c.key,c);return b}function n2(){return n6()}function n3(a){let b=n0;return a.forEach((a,c)=>b=b.insert(a,c.overlayedDocument)),b}function n4(){return n6()}function n5(){return n6()}function n6(){return new nZ(a=>a.toString(),(a,b)=>a.isEqual(b))}let n7=new lq(ji.comparator);function n8(){return n7}let n9=new lu(ji.comparator);function oa(...a){let b=n9;for(let c of a)b=b.add(c);return b}let ob=new lu(i6);function oc(){return ob}function od(a,b){if(a.useProto3Json){if(isNaN(b))return{doubleValue:"NaN"};else if(b===1/0)return{doubleValue:"Infinity"};else if(b===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:lW(b)?"-0":b}}function oe(a){return{integerValue:""+a}}function of(a,b){return lX(b)?oe(b):od(a,b)}class og{constructor(){this._=void 0}}function oh(a,b,c){return a instanceof ol?lN(c,b):a instanceof om?on(a,b):a instanceof oo?op(a,b):or(a,b)}function oi(a,b,c){return a instanceof om?on(a,b):a instanceof oo?op(a,b):c}function oj(a,b){return a instanceof oq?mx(b)?b:{integerValue:0}:null}function ok(a,b){return a instanceof om&&b instanceof om||a instanceof oo&&b instanceof oo?jb(a.elements,b.elements,l3):a instanceof oq&&b instanceof oq?l3(a.operand,b.operand):a instanceof ol&&b instanceof ol}class ol extends og{}class om extends og{constructor(a){super(),this.elements=a}}function on(a,b){let c=ot(b);for(let b of a.elements)c.some(a=>l3(a,b))||c.push(b);return{arrayValue:{values:c}}}class oo extends og{constructor(a){super(),this.elements=a}}function op(a,b){let c=ot(b);for(let b of a.elements)c=c.filter(a=>!l3(a,b));return{arrayValue:{values:c}}}class oq extends og{constructor(a,b){super(),this.serializer=a,this.operand=b}}function or(a,b){let c=oj(a,b),d=os(c)+os(a.operand);return mv(c)&&mv(a.operand)?oe(d):od(a.serializer,d)}function os(a){return lG(a.integerValue||a.doubleValue)}function ot(a){return my(a)&&a.arrayValue.values?a.arrayValue.values.slice():[]}class ou{constructor(a,b){this.field=a,this.transform=b}}function ov(a,b){return a.field.isEqual(b.field)&&ok(a.transform,b.transform)}function ow(a,b){return void 0===a&&void 0===b||!!a&&!!b&&jb(a,b,(a,b)=>ov(a,b))}class ox{constructor(a,b){this.version=a,this.transformResults=b}}class oy{constructor(a,b){this.updateTime=a,this.exists=b}static none(){return new oy}static exists(a){return new oy(void 0,a)}static updateTime(a){return new oy(a)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(a){return this.exists===a.exists&&(this.updateTime?!!a.updateTime&&this.updateTime.isEqual(a.updateTime):!a.updateTime)}}function oz(a,b){return void 0!==a.updateTime?b.isFoundDocument()&&b.version.isEqual(a.updateTime):void 0===a.exists||a.exists===b.isFoundDocument()}class oA{}function oB(a,b){if(!a.hasLocalMutations||b&&0===b.fields.length)return null;if(null===b)if(a.isNoDocument())return new oP(a.key,oy.none());else return new oG(a.key,a.data,oy.none());{let c=a.data,d=mK.empty(),e=new lu(jh.comparator);for(let a of b.fields)if(!e.has(a)){let b=c.field(a);null===b&&a.length>1&&(a=a.popLast(),b=c.field(a)),null===b?d.delete(a):d.set(a,b),e=e.add(a)}return new oJ(a.key,d,new ly(e.toArray()),oy.none())}}function oC(a,b,c){a instanceof oG?oH(a,b,c):a instanceof oJ?oK(a,b,c):oQ(a,b,c)}function oD(a,b,c,d){return a instanceof oG?oI(a,b,c,d):a instanceof oJ?oL(a,b,c,d):oR(a,b,c)}function oE(a,b){let c=null;for(let d of a.fieldTransforms){let a=b.data.field(d.field),e=oj(d.transform,a||null);null!=e&&(null===c&&(c=mK.empty()),c.set(d.field,e))}return c||null}function oF(a,b){return a.type===b.type&&!!a.key.isEqual(b.key)&&!!a.precondition.isEqual(b.precondition)&&!!ow(a.fieldTransforms,b.fieldTransforms)&&(0===a.type?a.value.isEqual(b.value):1!==a.type||a.data.isEqual(b.data)&&a.fieldMask.isEqual(b.fieldMask))}class oG extends oA{constructor(a,b,c,d=[]){super(),this.key=a,this.value=b,this.precondition=c,this.fieldTransforms=d,this.type=0}getFieldMask(){return null}}function oH(a,b,c){let d=a.value.clone(),e=oN(a.fieldTransforms,b,c.transformResults);d.setAll(e),b.convertToFoundDocument(c.version,d).setHasCommittedMutations()}function oI(a,b,c,d){if(!oz(a.precondition,b))return c;let e=a.value.clone(),f=oO(a.fieldTransforms,d,b);return e.setAll(f),b.convertToFoundDocument(b.version,e).setHasLocalMutations(),null}class oJ extends oA{constructor(a,b,c,d,e=[]){super(),this.key=a,this.data=b,this.fieldMask=c,this.precondition=d,this.fieldTransforms=e,this.type=1}getFieldMask(){return this.fieldMask}}function oK(a,b,c){if(!oz(a.precondition,b))return void b.convertToUnknownDocument(c.version);let d=oN(a.fieldTransforms,b,c.transformResults),e=b.data;e.setAll(oM(a)),e.setAll(d),b.convertToFoundDocument(c.version,e).setHasCommittedMutations()}function oL(a,b,c,d){if(!oz(a.precondition,b))return c;let e=oO(a.fieldTransforms,d,b),f=b.data;return(f.setAll(oM(a)),f.setAll(e),b.convertToFoundDocument(b.version,f).setHasLocalMutations(),null===c)?null:c.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(a=>a.field))}function oM(a){let b=new Map;return a.fieldMask.fields.forEach(c=>{if(!c.isEmpty()){let d=a.data.field(c);b.set(c,d)}}),b}function oN(a,b,c){let d=new Map;iC(a.length===c.length,32656,{serverTransformResultCount:c.length,fieldTransformCount:a.length});for(let e=0;e<c.length;e++){let f=a[e],g=f.transform,h=b.data.field(f.field);d.set(f.field,oi(g,h,c[e]))}return d}function oO(a,b,c){let d=new Map;for(let e of a){let a=e.transform,f=c.data.field(e.field);d.set(e.field,oh(a,f,b))}return d}class oP extends oA{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function oQ(a,b,c){b.convertToNoDocument(c.version).setHasCommittedMutations()}function oR(a,b,c){return oz(a.precondition,b)?(b.convertToNoDocument(b.version).setHasLocalMutations(),null):c}class oS extends oA{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class oT{constructor(a,b,c,d){this.batchId=a,this.localWriteTime=b,this.baseMutations=c,this.mutations=d}applyToRemoteDocument(a,b){let c=b.mutationResults;for(let b=0;b<this.mutations.length;b++){let d=this.mutations[b];d.key.isEqual(a.key)&&oC(d,a,c[b])}}applyToLocalView(a,b){for(let c of this.baseMutations)c.key.isEqual(a.key)&&(b=oD(c,a,b,this.localWriteTime));for(let c of this.mutations)c.key.isEqual(a.key)&&(b=oD(c,a,b,this.localWriteTime));return b}applyToLocalDocumentSet(a,b){let c=n5();return this.mutations.forEach(d=>{let e=a.get(d.key),f=e.overlayedDocument,g=this.applyToLocalView(f,e.mutatedFields),h=oB(f,g=b.has(d.key)?null:g);null!==h&&c.set(d.key,h),f.isValidDocument()||f.convertToNoDocument(jw.min())}),c}keys(){return this.mutations.reduce((a,b)=>a.add(b.key),oa())}isEqual(a){return this.batchId===a.batchId&&jb(this.mutations,a.mutations,(a,b)=>oF(a,b))&&jb(this.baseMutations,a.baseMutations,(a,b)=>oF(a,b))}}class oU{constructor(a,b,c,d){this.batch=a,this.commitVersion=b,this.mutationResults=c,this.docVersions=d}static from(a,b,c){iC(a.mutations.length===c.length,58842,{mutationsSent:a.mutations.length,resultsReceived:c.length});let d=n8(),e=a.mutations;for(let a=0;a<e.length;a++)d=d.insert(e[a].key,c[a].version);return new oU(a,b,c,d)}}class oV{constructor(a,b){this.largestBatchId=a,this.mutation=b}getKey(){return this.mutation.key}isEqual(a){return null!==a&&this.mutation===a.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class oW{constructor(a,b){this.count=a,this.unchangedNames=b}}function oX(a){switch(a){case iE:return iA(64938);case iF:case iG:case iI:case iN:case iS:case iT:case iM:return!1;case iH:case iJ:case iK:case iL:case iO:case iP:case iQ:case iR:case iU:return!0;default:return iA(15467,{code:a})}}function oY(a){return oX(a)&&a!==iP}function oZ(a){if(void 0===a)return ix("GRPC error has no .code"),iG;switch(a){case r.OK:return iE;case r.CANCELLED:return iF;case r.UNKNOWN:return iG;case r.DEADLINE_EXCEEDED:return iI;case r.RESOURCE_EXHAUSTED:return iN;case r.INTERNAL:return iS;case r.UNAVAILABLE:return iT;case r.UNAUTHENTICATED:return iM;case r.INVALID_ARGUMENT:return iH;case r.NOT_FOUND:return iJ;case r.ALREADY_EXISTS:return iK;case r.PERMISSION_DENIED:return iL;case r.FAILED_PRECONDITION:return iO;case r.ABORTED:return iP;case r.OUT_OF_RANGE:return iQ;case r.UNIMPLEMENTED:return iR;case r.DATA_LOSS:return iU;default:return iA(39323,{code:a})}}!function(a){a[a.OK=0]="OK",a[a.CANCELLED=1]="CANCELLED",a[a.UNKNOWN=2]="UNKNOWN",a[a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",a[a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",a[a.NOT_FOUND=5]="NOT_FOUND",a[a.ALREADY_EXISTS=6]="ALREADY_EXISTS",a[a.PERMISSION_DENIED=7]="PERMISSION_DENIED",a[a.UNAUTHENTICATED=16]="UNAUTHENTICATED",a[a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",a[a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",a[a.ABORTED=10]="ABORTED",a[a.OUT_OF_RANGE=11]="OUT_OF_RANGE",a[a.UNIMPLEMENTED=12]="UNIMPLEMENTED",a[a.INTERNAL=13]="INTERNAL",a[a.UNAVAILABLE=14]="UNAVAILABLE",a[a.DATA_LOSS=15]="DATA_LOSS"}(r||(r={}));class o$ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let o_=null;function o0(a){if(o_)throw Error("a TestingHooksSpi instance is already set");o_=a}function o1(){return new il.TextEncoder}function o2(){return new il.TextDecoder("utf-8")}let o3=new p([0xffffffff,0xffffffff],0);function o4(a){let b=o1().encode(a),c=new q;return c.update(b),new Uint8Array(c.digest())}function o5(a){let b=new DataView(a.buffer),c=b.getUint32(0,!0),d=b.getUint32(4,!0),e=b.getUint32(8,!0),f=b.getUint32(12,!0);return[new p([c,d],0),new p([e,f],0)]}class o6{constructor(a,b,c){if(this.bitmap=a,this.padding=b,this.hashCount=c,b<0||b>=8)throw new o7(`Invalid padding: ${b}`);if(c<0||a.length>0&&0===this.hashCount)throw new o7(`Invalid hash count: ${c}`);if(0===a.length&&0!==b)throw new o7(`Invalid padding when bitmap length is 0: ${b}`);this.bitCount=8*a.length-b,this.bitCountInInteger=p.fromNumber(this.bitCount)}getBitIndex(a,b,c){let d=a.add(b.multiply(p.fromNumber(c)));return 1===d.compare(o3)&&(d=new p([d.getBits(0),d.getBits(1)],0)),d.modulo(this.bitCountInInteger).toNumber()}isBitSet(a){return(this.bitmap[Math.floor(a/8)]&1<<a%8)!=0}mightContain(a){if(0===this.bitCount)return!1;let[b,c]=o5(o4(a));for(let a=0;a<this.hashCount;a++){let d=this.getBitIndex(b,c,a);if(!this.isBitSet(d))return!1}return!0}static create(a,b,c){let d=a%8==0?0:8-a%8,e=new o6(new Uint8Array(Math.ceil(a/8)),d,b);return c.forEach(a=>e.insert(a)),e}insert(a){if(0===this.bitCount)return;let[b,c]=o5(o4(a));for(let a=0;a<this.hashCount;a++){let d=this.getBitIndex(b,c,a);this.setBit(d)}}setBit(a){let b=Math.floor(a/8),c=a%8;this.bitmap[b]|=1<<c}}class o7 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class o8{constructor(a,b,c,d,e){this.snapshotVersion=a,this.targetChanges=b,this.targetMismatches=c,this.documentUpdates=d,this.resolvedLimboDocuments=e}static createSynthesizedRemoteEventForCurrentChange(a,b,c){let d=new Map;return d.set(a,o9.createSynthesizedTargetChangeForCurrentChange(a,b,c)),new o8(jw.min(),d,new lq(i6),n_(),oa())}}class o9{constructor(a,b,c,d,e){this.resumeToken=a,this.current=b,this.addedDocuments=c,this.modifiedDocuments=d,this.removedDocuments=e}static createSynthesizedTargetChangeForCurrentChange(a,b,c){return new o9(c,b,oa(),oa(),oa())}}class pa{constructor(a,b,c,d){this.updatedTargetIds=a,this.removedTargetIds=b,this.key=c,this.newDoc=d}}class pb{constructor(a,b){this.targetId=a,this.existenceFilter=b}}class pc{constructor(a,b,c=lB.EMPTY_BYTE_STRING,d=null){this.state=a,this.targetIds=b,this.resumeToken=c,this.cause=d}}class pd{constructor(){this.pendingResponses=0,this.documentChanges=ph(),this._resumeToken=lB.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(a){a.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=a)}toTargetChange(){let a=oa(),b=oa(),c=oa();return this.documentChanges.forEach((d,e)=>{switch(e){case 0:a=a.add(d);break;case 2:b=b.add(d);break;case 1:c=c.add(d);break;default:iA(38017,{changeType:e})}}),new o9(this._resumeToken,this._current,a,b,c)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=ph()}addDocumentChange(a,b){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(a,b)}removeDocumentChange(a){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(a)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,iC(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let pe="WatchChangeAggregator";class pf{constructor(a){this.metadataProvider=a,this.targetStates=new Map,this.pendingDocumentUpdates=n_(),this.pendingDocumentUpdatesByTarget=pg(),this.pendingDocumentTargetMapping=pg(),this.pendingTargetResets=new lq(i6)}handleDocumentChange(a){for(let b of a.updatedTargetIds)a.newDoc&&a.newDoc.isFoundDocument()?this.addDocumentToTarget(b,a.newDoc):this.removeDocumentFromTarget(b,a.key,a.newDoc);for(let b of a.removedTargetIds)this.removeDocumentFromTarget(b,a.key,a.newDoc)}handleTargetChange(a){this.forEachTarget(a,b=>{let c=this.ensureTargetState(b);switch(a.state){case 0:this.isActiveTarget(b)&&c.updateResumeToken(a.resumeToken);break;case 1:c.recordTargetResponse(),c.isPending||c.clearPendingChanges(),c.updateResumeToken(a.resumeToken);break;case 2:c.recordTargetResponse(),c.isPending||this.removeTarget(b);break;case 3:this.isActiveTarget(b)&&(c.markCurrent(),c.updateResumeToken(a.resumeToken));break;case 4:this.isActiveTarget(b)&&(this.resetTarget(b),c.updateResumeToken(a.resumeToken));break;default:iA(56790,{state:a.state})}})}forEachTarget(a,b){a.targetIds.length>0?a.targetIds.forEach(b):this.targetStates.forEach((a,c)=>{this.isActiveTarget(c)&&b(c)})}handleExistenceFilter(a){let b=a.targetId,c=a.existenceFilter.count,d=this.targetDataForActiveTarget(b);if(d){let e=d.target;if(nn(e))if(0===c){let a=new ji(e.path);this.removeDocumentFromTarget(b,a,mM.newNoDocument(a,jw.min()))}else iC(1===c,20013,{expectedCount:c});else{let d=this.getCurrentDocumentCountForTarget(b);if(d!==c){let c=this.parseBloomFilter(a),e=c?this.applyBloomFilter(c,a,d):1;if(0!==e){this.resetTarget(b);let a=2===e?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(b,a)}o_?.notifyOnExistenceFilterMismatch(pi(d,a.existenceFilter,this.metadataProvider.getDatabaseId(),c,e))}}}}parseBloomFilter(a){let b,c,d=a.existenceFilter.unchangedNames;if(!d||!d.bits)return null;let{bits:{bitmap:e="",padding:f=0},hashCount:g=0}=d;try{b=lH(e).toUint8Array()}catch(a){if(a instanceof o$)return iy("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{c=new o6(b,f,g)}catch(a){return a instanceof o7?iy("BloomFilter error: ",a):iy("Applying bloom filter failed: ",a),null}return 0===c.bitCount?null:c}applyBloomFilter(a,b,c){return 2*(b.existenceFilter.count!==c-this.filterRemovedDocuments(a,b.targetId))}filterRemovedDocuments(a,b){let c=this.metadataProvider.getRemoteKeysForTarget(b),d=0;return c.forEach(c=>{let e=this.metadataProvider.getDatabaseId(),f=`projects/${e.projectId}/databases/${e.database}/documents/${c.path.canonicalString()}`;!a.mightContain(f)&&(this.removeDocumentFromTarget(b,c,null),d++)}),d}createRemoteEvent(a){let b=new Map;this.targetStates.forEach((c,d)=>{let e=this.targetDataForActiveTarget(d);if(e){if(c.current&&nn(e.target)){let b=new ji(e.target.path);this.ensureDocumentUpdateByTarget(b).has(d)||this.targetContainsDocument(d,b)||this.removeDocumentFromTarget(d,b,mM.newNoDocument(b,a))}c.hasPendingChanges&&(b.set(d,c.toTargetChange()),c.clearPendingChanges())}});let c=oa();this.pendingDocumentTargetMapping.forEach((a,b)=>{let d=!0;b.forEachWhile(a=>{let b=this.targetDataForActiveTarget(a);return!b||"TargetPurposeLimboResolution"===b.purpose||(d=!1,!1)}),d&&(c=c.add(a))}),this.pendingDocumentUpdates.forEach((b,c)=>c.setReadTime(a));let d=new o8(a,b,this.pendingTargetResets,this.pendingDocumentUpdates,c);return this.pendingDocumentUpdates=n_(),this.pendingDocumentUpdatesByTarget=pg(),this.pendingDocumentTargetMapping=pg(),this.pendingTargetResets=new lq(i6),d}addDocumentToTarget(a,b){if(!this.isActiveTarget(a))return;let c=2*!!this.targetContainsDocument(a,b.key);this.ensureTargetState(a).addDocumentChange(b.key,c),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(b.key,b),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(b.key,this.ensureDocumentUpdateByTarget(b.key).add(a)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b.key,this.ensureDocumentTargetMapping(b.key).add(a))}removeDocumentFromTarget(a,b,c){if(!this.isActiveTarget(a))return;let d=this.ensureTargetState(a);this.targetContainsDocument(a,b)?d.addDocumentChange(b,1):d.removeDocumentChange(b),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b,this.ensureDocumentTargetMapping(b).delete(a)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b,this.ensureDocumentTargetMapping(b).add(a)),c&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(b,c))}removeTarget(a){this.targetStates.delete(a)}getCurrentDocumentCountForTarget(a){let b=this.ensureTargetState(a).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(a).size+b.addedDocuments.size-b.removedDocuments.size}recordPendingTargetRequest(a){this.ensureTargetState(a).recordPendingTargetRequest()}ensureTargetState(a){let b=this.targetStates.get(a);return b||(b=new pd,this.targetStates.set(a,b)),b}ensureDocumentTargetMapping(a){let b=this.pendingDocumentTargetMapping.get(a);return b||(b=new lu(i6),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(a,b)),b}ensureDocumentUpdateByTarget(a){let b=this.pendingDocumentUpdatesByTarget.get(a);return b||(b=new lu(i6),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(a,b)),b}isActiveTarget(a){let b=null!==this.targetDataForActiveTarget(a);return b||iw(pe,"Detected inactive target",a),b}targetDataForActiveTarget(a){let b=this.targetStates.get(a);return b&&b.isPending?null:this.metadataProvider.getTargetDataForTarget(a)}resetTarget(a){this.targetStates.set(a,new pd),this.metadataProvider.getRemoteKeysForTarget(a).forEach(b=>{this.removeDocumentFromTarget(a,b,null)})}targetContainsDocument(a,b){return this.metadataProvider.getRemoteKeysForTarget(a).has(b)}}function pg(){return new lq(ji.comparator)}function ph(){return new lq(ji.comparator)}function pi(a,b,c,d,e){let f={localCacheCount:a,existenceFilterCount:b.count,databaseId:c.database,projectId:c.projectId},g=b.unchangedNames;return g&&(f.bloomFilter={applied:0===e,hashCount:g?.hashCount??0,bitmapLength:g?.bits?.bitmap?.length??0,padding:g?.bits?.padding??0,mightContain:a=>d?.mightContain(a)??!1}),f}let pj=(()=>{let a={};return a.asc="ASCENDING",a.desc="DESCENDING",a})(),pk=(()=>{let a={};return a["<"]="LESS_THAN",a["<="]="LESS_THAN_OR_EQUAL",a[">"]="GREATER_THAN",a[">="]="GREATER_THAN_OR_EQUAL",a["=="]="EQUAL",a["!="]="NOT_EQUAL",a["array-contains"]="ARRAY_CONTAINS",a.in="IN",a["not-in"]="NOT_IN",a["array-contains-any"]="ARRAY_CONTAINS_ANY",a})(),pl=(()=>{let a={};return a.and="AND",a.or="OR",a})();function pm(a,b){}class pn{constructor(a,b){this.databaseId=a,this.useProto3Json=b}}function po(a){return new iV(void 0===a.code?iG:oZ(a.code),a.message||"")}function pp(a,b){return a.useProto3Json||lV(b)?b:{value:b}}function pq(a){let b;return lV(b="object"==typeof a?a.value:a)?null:b}function pr(a,b){if(!a.useProto3Json)return{seconds:""+b.seconds,nanos:b.nanoseconds};{let a=new Date(1e3*b.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),c=("000000000"+b.nanoseconds).slice(-9);return`${a}.${c}Z`}}function ps(a){let b=lF(a);return new jv(b.seconds,b.nanos)}function pt(a,b){return a.useProto3Json?b.toBase64():b.toUint8Array()}function pu(a,b){return a.useProto3Json?(iC(void 0===b||"string"==typeof b,58123),lB.fromBase64String(b||"")):(iC(void 0===b||b instanceof Buffer||b instanceof Uint8Array,16193),lB.fromUint8Array(b||new Uint8Array))}function pv(a,b){return pr(a,b.toTimestamp())}function pw(a){return iC(!!a,49232),jw.fromTimestamp(ps(a))}function px(a,b){return py(a,b).canonicalString()}function py(a,b){let c=pF(a).child("documents");return void 0===b?c:c.child(b)}function pz(a){let b=jf.fromString(a);return iC(qw(b),10190,{key:b.toString()}),b}function pA(a,b){return px(a.databaseId,b.path)}function pB(a,b){let c=pz(b);if(c.get(1)!==a.databaseId.projectId)throw new iV(iH,"Tried to deserialize key from different project: "+c.get(1)+" vs "+a.databaseId.projectId);if(c.get(3)!==a.databaseId.database)throw new iV(iH,"Tried to deserialize key from different database: "+c.get(3)+" vs "+a.databaseId.database);return new ji(pG(c))}function pC(a,b){return px(a.databaseId,b)}function pD(a){let b=pz(a);return 4===b.length?jf.emptyPath():pG(b)}function pE(a){return new jf(["projects",a.databaseId.projectId,"databases",a.databaseId.database]).canonicalString()}function pF(a){return new jf(["projects",a.projectId,"databases",a.database])}function pG(a){return iC(a.length>4&&"documents"===a.get(4),29091,{key:a.toString()}),a.popFirst(5)}function pH(a,b,c){return{name:pA(a,b),fields:c.value.mapValue.fields}}function pI(a,b){return{name:pA(a,b.key),fields:b.data.value.mapValue.fields,updateTime:pr(a,b.version.toTimestamp()),createTime:pr(a,b.createTime.toTimestamp())}}function pJ(a,b,c){let d=pB(a,b.name),e=pw(b.updateTime),f=b.createTime?pw(b.createTime):jw.min(),g=new mK({mapValue:{fields:b.fields}}),h=mM.newFoundDocument(d,e,f,g);return c&&h.setHasCommittedMutations(),c?h.setHasCommittedMutations():h}function pK(a,b){iC(!!b.found,43571),pm(b.found.name),pm(b.found.updateTime);let c=pB(a,b.found.name),d=pw(b.found.updateTime),e=b.found.createTime?pw(b.found.createTime):jw.min(),f=new mK({mapValue:{fields:b.found.fields}});return mM.newFoundDocument(c,d,e,f)}function pL(a,b){iC(!!b.missing,3894),iC(!!b.readTime,22933);let c=pB(a,b.missing),d=pw(b.readTime);return mM.newNoDocument(c,d)}function pM(a,b){return"found"in b?pK(a,b):"missing"in b?pL(a,b):iA(7234,{result:b})}function pN(a,b){let c;if("targetChange"in b){pm(b.targetChange);let d=pO(b.targetChange.targetChangeType||"NO_CHANGE"),e=b.targetChange.targetIds||[],f=pu(a,b.targetChange.resumeToken),g=b.targetChange.cause;c=new pc(d,e,f,g&&po(g)||null)}else if("documentChange"in b){pm(b.documentChange);let d=b.documentChange;pm(d.document),pm(d.document.name),pm(d.document.updateTime);let e=pB(a,d.document.name),f=pw(d.document.updateTime),g=d.document.createTime?pw(d.document.createTime):jw.min(),h=new mK({mapValue:{fields:d.document.fields}}),i=mM.newFoundDocument(e,f,g,h);c=new pa(d.targetIds||[],d.removedTargetIds||[],i.key,i)}else if("documentDelete"in b){pm(b.documentDelete);let d=b.documentDelete;pm(d.document);let e=pB(a,d.document),f=d.readTime?pw(d.readTime):jw.min(),g=mM.newNoDocument(e,f);c=new pa([],d.removedTargetIds||[],g.key,g)}else if("documentRemove"in b){pm(b.documentRemove);let d=b.documentRemove;pm(d.document);let e=pB(a,d.document);c=new pa([],d.removedTargetIds||[],e,null)}else{if(!("filter"in b))return iA(11601,{change:b});pm(b.filter);let a=b.filter;pm(a.targetId);let{count:d=0,unchangedNames:e}=a,f=new oW(d,e);c=new pb(a.targetId,f)}return c}function pO(a){if("NO_CHANGE"===a)return 0;if("ADD"===a)return 1;if("REMOVE"===a)return 2;if("CURRENT"===a)return 3;if("RESET"===a)return 4;else return iA(39313,{state:a})}function pP(a){if(!("targetChange"in a))return jw.min();let b=a.targetChange;return b.targetIds&&b.targetIds.length||!b.readTime?jw.min():pw(b.readTime)}function pQ(a,b){let c;if(b instanceof oG)c={update:pH(a,b.key,b.value)};else if(b instanceof oP)c={delete:pA(a,b.key)};else if(b instanceof oJ)c={update:pH(a,b.key,b.data),updateMask:qu(b.fieldMask)};else{if(!(b instanceof oS))return iA(16599,{mutationType:b.type});c={verify:pA(a,b.key)}}return b.fieldTransforms.length>0&&(c.updateTransforms=b.fieldTransforms.map(b=>pW(a,b))),b.precondition.isNone||(c.currentDocument=pS(a,b.precondition)),c}function pR(a,b){let c=b.currentDocument?pT(b.currentDocument):oy.none(),d=b.updateTransforms?b.updateTransforms.map(b=>pX(a,b)):[];if(b.update){pm(b.update.name);let e=pB(a,b.update.name),f=new mK({mapValue:{fields:b.update.fields}});return b.updateMask?new oJ(e,f,qv(b.updateMask),c,d):new oG(e,f,c,d)}return b.delete?new oP(pB(a,b.delete),c):b.verify?new oS(pB(a,b.verify),c):iA(1463,{proto:b})}function pS(a,b){return void 0!==b.updateTime?{updateTime:pv(a,b.updateTime)}:void 0!==b.exists?{exists:b.exists}:iA(27497)}function pT(a){return void 0!==a.updateTime?oy.updateTime(pw(a.updateTime)):void 0!==a.exists?oy.exists(a.exists):oy.none()}function pU(a,b){let c=a.updateTime?pw(a.updateTime):pw(b);return c.isEqual(jw.min())&&(c=pw(b)),new ox(c,a.transformResults||[])}function pV(a,b){return a&&a.length>0?(iC(void 0!==b,14353),a.map(a=>pU(a,b))):[]}function pW(a,b){let c=b.transform;if(c instanceof ol)return{fieldPath:b.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof om)return{fieldPath:b.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof oo)return{fieldPath:b.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof oq)return{fieldPath:b.field.canonicalString(),increment:c.operand};throw iA(20930,{transform:b.transform})}function pX(a,b){let c=null;return"setToServerValue"in b?(iC("REQUEST_TIME"===b.setToServerValue,16630,{proto:b}),c=new ol):"appendMissingElements"in b?c=new om(b.appendMissingElements.values||[]):"removeAllFromArray"in b?c=new oo(b.removeAllFromArray.values||[]):"increment"in b?c=new oq(a,b.increment):iA(16584,{proto:b}),new ou(jh.fromServerFormat(b.fieldPath),c)}function pY(a,b){return{documents:[pC(a,b.path)]}}function pZ(a){let b=a.documents.length;return iC(1===b,1966,{count:b}),nG(nz(pD(a.documents[0])))}function p$(a,b){let c,d={structuredQuery:{}},e=b.path;null!==b.collectionGroup?(c=e,d.structuredQuery.from=[{collectionId:b.collectionGroup,allDescendants:!0}]):(c=e.popLast(),d.structuredQuery.from=[{collectionId:e.lastSegment()}]),d.parent=pC(a,c);let f=p5(b.filters);f&&(d.structuredQuery.where=f);let g=p8(b.orderBy);g&&(d.structuredQuery.orderBy=g);let h=pp(a,b.limit);return null!==h&&(d.structuredQuery.limit=h),b.startAt&&(d.structuredQuery.startAt=qa(b.startAt)),b.endAt&&(d.structuredQuery.endAt=qb(b.endAt)),{queryTarget:d,parent:c}}function p_(a,b,c,d){let{queryTarget:e,parent:f}=p$(a,b),g={},h=[],i=0;return c.forEach(a=>{let b=d?a.alias:`aggregate_${i++}`;g[b]=a.alias,"count"===a.aggregateType?h.push({alias:b,count:{}}):"avg"===a.aggregateType?h.push({alias:b,avg:{field:qk(a.fieldPath)}}):"sum"===a.aggregateType&&h.push({alias:b,sum:{field:qk(a.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:h,structuredQuery:e.structuredQuery},parent:e.parent},aliasMap:g,parent:f}}function p0(a){let b=pD(a.parent),c=a.structuredQuery,d=c.from?c.from.length:0,e=null;if(d>0){iC(1===d,65062);let a=c.from[0];a.allDescendants?e=a.collectionId:b=b.child(a.collectionId)}let f=[];c.where&&(f=p6(c.where));let g=[];c.orderBy&&(g=p9(c.orderBy));let h=null;c.limit&&(h=pq(c.limit));let i=null;c.startAt&&(i=qc(c.startAt));let j=null;return c.endAt&&(j=qd(c.endAt)),ny(b,e,g,f,h,"F",i,j)}function p1(a){return nG(p0(a))}function p2(a,b){let c=p3(b.purpose);return null==c?null:{"goog-listen-tags":c}}function p3(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return iA(28987,{purpose:a})}}function p4(a,b){let c,d=b.target;if((c=nn(d)?{documents:pY(a,d)}:{query:p$(a,d).queryTarget}).targetId=b.targetId,b.resumeToken.approximateByteSize()>0){c.resumeToken=pt(a,b.resumeToken);let d=pp(a,b.expectedCount);null!==d&&(c.expectedCount=d)}else if(b.snapshotVersion.compareTo(jw.min())>0){c.readTime=pr(a,b.snapshotVersion.toTimestamp());let d=pp(a,b.expectedCount);null!==d&&(c.expectedCount=d)}return c}function p5(a){if(0!==a.length)return qo(mZ.create(a,"and"))}function p6(a){let b=p7(a);return b instanceof mZ&&m0(b)?b.getFilters():[b]}function p7(a){return void 0!==a.unaryFilter?qr(a):void 0!==a.fieldFilter?qs(a):void 0!==a.compositeFilter?qt(a):iA(30097,{filter:a})}function p8(a){if(0!==a.length)return a.map(a=>qm(a))}function p9(a){return a.map(a=>qn(a))}function qa(a){return{before:a.inclusive,values:a.position}}function qb(a){return{before:!a.inclusive,values:a.position}}function qc(a){let b=!!a.before;return new mO(a.values||[],b)}function qd(a){let b=!a.before;return new mO(a.values||[],b)}function qe(a){return pj[a]}function qf(a){switch(a){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function qg(a){return pk[a]}function qh(a){return pl[a]}function qi(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return iA(58110);default:return iA(50506)}}function qj(a){switch(a){case"AND":return"and";case"OR":return"or";default:return iA(1026)}}function qk(a){return{fieldPath:a.canonicalString()}}function ql(a){return jh.fromServerFormat(a.fieldPath)}function qm(a){return{field:qk(a.field),direction:qe(a.dir)}}function qn(a){return new mT(ql(a.field),qf(a.direction))}function qo(a){return a instanceof mY?qq(a):a instanceof mZ?qp(a):iA(54877,{filter:a})}function qp(a){let b=a.getFilters().map(a=>qo(a));return 1===b.length?b[0]:{compositeFilter:{op:qh(a.op),filters:b}}}function qq(a){if("=="===a.op){if(mA(a.value))return{unaryFilter:{field:qk(a.field),op:"IS_NAN"}};else if(mz(a.value))return{unaryFilter:{field:qk(a.field),op:"IS_NULL"}}}else if("!="===a.op){if(mA(a.value))return{unaryFilter:{field:qk(a.field),op:"IS_NOT_NAN"}};else if(mz(a.value))return{unaryFilter:{field:qk(a.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qk(a.field),op:qg(a.op),value:a.value}}}function qr(a){switch(a.unaryFilter.op){case"IS_NAN":let b=ql(a.unaryFilter.field);return mY.create(b,"==",{doubleValue:NaN});case"IS_NULL":let c=ql(a.unaryFilter.field);return mY.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let d=ql(a.unaryFilter.field);return mY.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let e=ql(a.unaryFilter.field);return mY.create(e,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return iA(61313);default:return iA(60726)}}function qs(a){return mY.create(ql(a.fieldFilter.field),qi(a.fieldFilter.op),a.fieldFilter.value)}function qt(a){return mZ.create(a.compositeFilter.filters.map(a=>p7(a)),qj(a.compositeFilter.op))}function qu(a){let b=[];return a.fields.forEach(a=>b.push(a.canonicalString())),{fieldPaths:b}}function qv(a){return new ly((a.fieldPaths||[]).map(a=>jh.fromServerFormat(a)))}function qw(a){return a.length>=4&&"projects"===a.get(0)&&"databases"===a.get(2)}function qx(a){return!!a&&"function"==typeof a._toProto&&"ProtoValue"===a._protoValueType}class qy{constructor(a,b,c,d,e=jw.min(),f=jw.min(),g=lB.EMPTY_BYTE_STRING,h=null){this.target=a,this.targetId=b,this.purpose=c,this.sequenceNumber=d,this.snapshotVersion=e,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=g,this.expectedCount=h}withSequenceNumber(a){return new qy(this.target,this.targetId,this.purpose,a,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(a,b){return new qy(this.target,this.targetId,this.purpose,this.sequenceNumber,b,this.lastLimboFreeSnapshotVersion,a,null)}withExpectedCount(a){return new qy(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,a)}withLastLimboFreeSnapshotVersion(a){return new qy(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,a,this.resumeToken,this.expectedCount)}}class qz{constructor(a){this.remoteSerializer=a}}function qA(a,b){let c;if(b.document)c=pJ(a.remoteSerializer,b.document,!!b.hasCommittedMutations);else if(b.noDocument){let a=ji.fromSegments(b.noDocument.path),d=qF(b.noDocument.readTime);c=mM.newNoDocument(a,d),b.hasCommittedMutations&&c.setHasCommittedMutations()}else{if(!b.unknownDocument)return iA(56709);let a=ji.fromSegments(b.unknownDocument.path),d=qF(b.unknownDocument.version);c=mM.newUnknownDocument(a,d)}return b.readTime&&c.setReadTime(qD(b.readTime)),c}function qB(a,b){let c=b.key,d={prefixPath:c.getCollectionPath().popLast().toArray(),collectionGroup:c.collectionGroup,documentId:c.path.lastSegment(),readTime:qC(b.readTime),hasCommittedMutations:b.hasCommittedMutations};if(b.isFoundDocument())d.document=pI(a.remoteSerializer,b);else if(b.isNoDocument())d.noDocument={path:c.path.toArray(),readTime:qE(b.version)};else{if(!b.isUnknownDocument())return iA(57904,{document:b});d.unknownDocument={path:c.path.toArray(),version:qE(b.version)}}return d}function qC(a){let b=a.toTimestamp();return[b.seconds,b.nanoseconds]}function qD(a){let b=new jv(a[0],a[1]);return jw.fromTimestamp(b)}function qE(a){let b=a.toTimestamp();return{seconds:b.seconds,nanoseconds:b.nanoseconds}}function qF(a){let b=new jv(a.seconds,a.nanoseconds);return jw.fromTimestamp(b)}function qG(a,b,c){let d=c.baseMutations.map(b=>pQ(a.remoteSerializer,b)),e=c.mutations.map(b=>pQ(a.remoteSerializer,b));return{userId:b,batchId:c.batchId,localWriteTimeMs:c.localWriteTime.toMillis(),baseMutations:d,mutations:e}}function qH(a,b){let c=(b.baseMutations||[]).map(b=>pR(a.remoteSerializer,b));for(let a=0;a<b.mutations.length-1;++a){let c=b.mutations[a];a+1<b.mutations.length&&void 0!==b.mutations[a+1].transform&&(c.updateTransforms=b.mutations[a+1].transform.fieldTransforms,b.mutations.splice(a+1,1),++a)}let d=b.mutations.map(b=>pR(a.remoteSerializer,b)),e=jv.fromMillis(b.localWriteTimeMs);return new oT(b.batchId,e,c,d)}function qI(a){let b,c=qF(a.readTime),d=void 0!==a.lastLimboFreeSnapshotVersion?qF(a.lastLimboFreeSnapshotVersion):jw.min();return new qy(b=qK(a.query)?pZ(a.query):p1(a.query),a.targetId,"TargetPurposeListen",a.lastListenSequenceNumber,c,d,lB.fromBase64String(a.resumeToken))}function qJ(a,b){let c,d=qE(b.snapshotVersion),e=qE(b.lastLimboFreeSnapshotVersion);c=nn(b.target)?pY(a.remoteSerializer,b.target):p$(a.remoteSerializer,b.target).queryTarget;let f=b.resumeToken.toBase64();return{targetId:b.targetId,canonicalId:nk(b.target),readTime:d,resumeToken:f,lastListenSequenceNumber:b.sequenceNumber,lastLimboFreeSnapshotVersion:e,query:c}}function qK(a){return void 0!==a.documents}function qL(a){return{id:a.bundleId,createTime:qF(a.createTime),version:a.version}}function qM(a){return{bundleId:a.id,createTime:qE(pw(a.createTime)),version:a.version}}function qN(a){return{name:a.name,query:qP(a.bundledQuery),readTime:qF(a.readTime)}}function qO(a){return{name:a.name,readTime:qE(pw(a.readTime)),bundledQuery:a.bundledQuery}}function qP(a){let b=p0({parent:a.parent,structuredQuery:a.structuredQuery});return"LAST"===a.limitType?nL(b,b.limit,"L"):b}function qQ(a){return{name:a.name,query:qP(a.bundledQuery),readTime:pw(a.readTime)}}function qR(a){return{id:a.id,version:a.version,createTime:pw(a.createTime)}}function qS(a,b){return new oV(b.largestBatchId,pR(a.remoteSerializer,b.overlayMutation))}function qT(a,b,c){let[d,e,f]=qU(b,c.mutation.key);return{userId:b,collectionPath:e,documentId:f,collectionGroup:c.mutation.key.getCollectionGroup(),largestBatchId:c.largestBatchId,overlayMutation:pQ(a.remoteSerializer,c.mutation)}}function qU(a,b){let c=b.path.lastSegment();return[a,kb(b.path.popLast()),c]}function qV(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])}}function qW(a,b){let c=b?new jH(b.sequenceNumber,new jK(qF(b.readTime),new ji(ke(b.documentKey)),b.largestBatchId)):jH.empty(),d=a.fields.map(([a,b])=>new jF(jh.fromServerFormat(a),b));return new jz(a.indexId,a.collectionGroup,d,c)}function qX(a,b,c,d){return{indexId:a,uid:b,sequenceNumber:c,readTime:qE(d.readTime),documentKey:kb(d.documentKey.path),largestBatchId:d.largestBatchId}}class qY{getBundleMetadata(a,b){return qZ(a).get(b).next(a=>{if(a)return qL(a)})}saveBundleMetadata(a,b){return qZ(a).put(qM(b))}getNamedQuery(a,b){return q$(a).get(b).next(a=>{if(a)return qN(a)})}saveNamedQuery(a,b){return q$(a).put(qO(b))}}function qZ(a){return ll(a,kP)}function q$(a){return ll(a,kR)}class q_{constructor(a,b){this.serializer=a,this.userId=b}static forUser(a,b){return new q_(a,b.uid||"")}getOverlay(a,b){return q0(a).get(qU(this.userId,b)).next(a=>a?qS(this.serializer,a):null)}getOverlays(a,b){let c=n4();return jP.forEach(b,b=>this.getOverlay(a,b).next(a=>{null!==a&&c.set(b,a)})).next(()=>c)}saveOverlays(a,b,c){let d=[];return c.forEach((c,e)=>{let f=new oV(b,e);d.push(this.saveOverlay(a,f))}),jP.waitFor(d)}removeOverlaysForBatchId(a,b,c){let d=new Set;b.forEach(a=>d.add(kb(a.getCollectionPath())));let e=[];return d.forEach(b=>{let d=IDBKeyRange.bound([this.userId,b,c],[this.userId,b,c+1],!1,!0);e.push(q0(a).deleteAll(k5,d))}),jP.waitFor(e)}getOverlaysForCollection(a,b,c){let d=n4(),e=kb(b),f=IDBKeyRange.bound([this.userId,e,c],[this.userId,e,1/0],!0);return q0(a).loadAll(k5,f).next(a=>{for(let b of a){let a=qS(this.serializer,b);d.set(a.getKey(),a)}return d})}getOverlaysForCollectionGroup(a,b,c,d){let e,f=n4(),g=IDBKeyRange.bound([this.userId,b,c],[this.userId,b,1/0],!0);return q0(a).iterate({index:k7,range:g},(a,b,c)=>{let g=qS(this.serializer,b);f.size()<d||g.largestBatchId===e?(f.set(g.getKey(),g),e=g.largestBatchId):c.done()}).next(()=>f)}saveOverlay(a,b){return q0(a).put(qT(this.serializer,this.userId,b))}}function q0(a){return ll(a,k3)}class q1{globalsStore(a){return ll(a,k9)}getSessionToken(a){return this.globalsStore(a).get("sessionToken").next(a=>{let b=a?.value;return b?lB.fromUint8Array(b):lB.EMPTY_BYTE_STRING})}setSessionToken(a,b){return this.globalsStore(a).put({name:"sessionToken",value:b.toUint8Array()})}}let q2=5,q3=10,q4=13,q5=15,q6=20,q7=25,q8=30,q9=37,ra=45,rb=50,rc=53,rd=55,re=60,rf=2;class rg{writeIndexValue(a,b){this.writeIndexValueAux(a,b),b.writeInfinity()}writeIndexValueAux(a,b){if("nullValue"in a)this.writeValueTypeLabel(b,q2);else if("booleanValue"in a)this.writeValueTypeLabel(b,q3),b.writeNumber(+!!a.booleanValue);else if("integerValue"in a)this.writeValueTypeLabel(b,q5),b.writeNumber(lG(a.integerValue));else if("doubleValue"in a){let c=lG(a.doubleValue);isNaN(c)?this.writeValueTypeLabel(b,q4):(this.writeValueTypeLabel(b,q5),lW(c)?b.writeNumber(0):b.writeNumber(c))}else if("timestampValue"in a){let c=a.timestampValue;this.writeValueTypeLabel(b,q6),"string"==typeof c&&(c=lF(c)),b.writeString(`${c.seconds||""}`),b.writeNumber(c.nanos||0)}else if("stringValue"in a)this.writeIndexString(a.stringValue,b),this.writeTruncationMarker(b);else if("bytesValue"in a)this.writeValueTypeLabel(b,q8),b.writeBytes(lH(a.bytesValue)),this.writeTruncationMarker(b);else if("referenceValue"in a)this.writeIndexEntityRef(a.referenceValue,b);else if("geoPointValue"in a){let c=a.geoPointValue;this.writeValueTypeLabel(b,ra),b.writeNumber(c.latitude||0),b.writeNumber(c.longitude||0)}else"mapValue"in a?mE(a)?this.writeValueTypeLabel(b,Number.MAX_SAFE_INTEGER):mC(a)?this.writeIndexVector(a.mapValue,b):(this.writeIndexMap(a.mapValue,b),this.writeTruncationMarker(b)):"arrayValue"in a?(this.writeIndexArray(a.arrayValue,b),this.writeTruncationMarker(b)):iA(19022,{indexValue:a})}writeIndexString(a,b){this.writeValueTypeLabel(b,q7),this.writeUnlabeledIndexString(a,b)}writeUnlabeledIndexString(a,b){b.writeString(a)}writeIndexMap(a,b){let c=a.fields||{};for(let a of(this.writeValueTypeLabel(b,rd),Object.keys(c)))this.writeIndexString(a,b),this.writeIndexValueAux(c[a],b)}writeIndexVector(a,b){let c=a.fields||{};this.writeValueTypeLabel(b,rc);let d=l0,e=c[d].arrayValue?.values?.length||0;this.writeValueTypeLabel(b,q5),b.writeNumber(lG(e)),this.writeIndexString(d,b),this.writeIndexValueAux(c[d],b)}writeIndexArray(a,b){let c=a.values||[];for(let a of(this.writeValueTypeLabel(b,rb),c))this.writeIndexValueAux(a,b)}writeIndexEntityRef(a,b){this.writeValueTypeLabel(b,q9),ji.fromName(a).path.forEach(a=>{this.writeValueTypeLabel(b,re),this.writeUnlabeledIndexString(a,b)})}writeValueTypeLabel(a,b){a.writeNumber(b)}writeTruncationMarker(a){a.writeNumber(rf)}}rg.INSTANCE=new rg;let rh="\uD800",ri="\uDBFF",rj=0,rk=255,rl=1,rm=255,rn=255,ro=0,rp=64,rq=8,rr=1024;function rs(a){let b=new DataView(new ArrayBuffer(8));return b.setFloat64(0,a,!1),new Uint8Array(b.buffer)}function rt(a){if(0===a)return 8;let b=0;return a>>4==0&&(b+=4,a<<=4),a>>6==0&&(b+=2,a<<=2),a>>7==0&&(b+=1),b}function ru(a){let b=0;for(let c=0;c<8;++c){let d=rt(255&a[c]);if(b+=d,8!==d)break}return b}function rv(a){return Math.ceil((rp-ru(a))/rq)}class rw{constructor(){this.buffer=new Uint8Array(rr),this.position=0}writeBytesAscending(a){let b=a[Symbol.iterator](),c=b.next();for(;!c.done;)this.writeByteAscending(c.value),c=b.next();this.writeSeparatorAscending()}writeBytesDescending(a){let b=a[Symbol.iterator](),c=b.next();for(;!c.done;)this.writeByteDescending(c.value),c=b.next();this.writeSeparatorDescending()}writeUtf8Ascending(a){for(let b of a){let a=b.charCodeAt(0);if(a<128)this.writeByteAscending(a);else if(a<2048)this.writeByteAscending(960|a>>>6),this.writeByteAscending(128|63&a);else if(b<rh||ri<b)this.writeByteAscending(480|a>>>12),this.writeByteAscending(128|63&a>>>6),this.writeByteAscending(128|63&a);else{let a=b.codePointAt(0);this.writeByteAscending(240|a>>>18),this.writeByteAscending(128|63&a>>>12),this.writeByteAscending(128|63&a>>>6),this.writeByteAscending(128|63&a)}}this.writeSeparatorAscending()}writeUtf8Descending(a){for(let b of a){let a=b.charCodeAt(0);if(a<128)this.writeByteDescending(a);else if(a<2048)this.writeByteDescending(960|a>>>6),this.writeByteDescending(128|63&a);else if(b<rh||ri<b)this.writeByteDescending(480|a>>>12),this.writeByteDescending(128|63&a>>>6),this.writeByteDescending(128|63&a);else{let a=b.codePointAt(0);this.writeByteDescending(240|a>>>18),this.writeByteDescending(128|63&a>>>12),this.writeByteDescending(128|63&a>>>6),this.writeByteDescending(128|63&a)}}this.writeSeparatorDescending()}writeNumberAscending(a){let b=this.toOrderedBits(a),c=rv(b);this.ensureAvailable(1+c),this.buffer[this.position++]=255&c;for(let a=b.length-c;a<b.length;++a)this.buffer[this.position++]=255&b[a]}writeNumberDescending(a){let b=this.toOrderedBits(a),c=rv(b);this.ensureAvailable(1+c),this.buffer[this.position++]=~(255&c);for(let a=b.length-c;a<b.length;++a)this.buffer[this.position++]=~(255&b[a])}writeInfinityAscending(){this.writeEscapedByteAscending(rm),this.writeEscapedByteAscending(rn)}writeInfinityDescending(){this.writeEscapedByteDescending(rm),this.writeEscapedByteDescending(rn)}reset(){this.position=0}seed(a){this.ensureAvailable(a.length),this.buffer.set(a,this.position),this.position+=a.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(a){let b=rs(a),c=(128&b[0])!=0;b[0]^=c?255:128;for(let a=1;a<b.length;++a)b[a]^=255*!!c;return b}writeByteAscending(a){let b=255&a;b===rj?(this.writeEscapedByteAscending(rj),this.writeEscapedByteAscending(rk)):b===rm?(this.writeEscapedByteAscending(rm),this.writeEscapedByteAscending(ro)):this.writeEscapedByteAscending(b)}writeByteDescending(a){let b=255&a;b===rj?(this.writeEscapedByteDescending(rj),this.writeEscapedByteDescending(rk)):b===rm?(this.writeEscapedByteDescending(rm),this.writeEscapedByteDescending(ro)):this.writeEscapedByteDescending(a)}writeSeparatorAscending(){this.writeEscapedByteAscending(rj),this.writeEscapedByteAscending(rl)}writeSeparatorDescending(){this.writeEscapedByteDescending(rj),this.writeEscapedByteDescending(rl)}writeEscapedByteAscending(a){this.ensureAvailable(1),this.buffer[this.position++]=a}writeEscapedByteDescending(a){this.ensureAvailable(1),this.buffer[this.position++]=~a}ensureAvailable(a){let b=a+this.position;if(b<=this.buffer.length)return;let c=2*this.buffer.length;c<b&&(c=b);let d=new Uint8Array(c);d.set(this.buffer),this.buffer=d}}class rx{constructor(a){this.orderedCode=a}writeBytes(a){this.orderedCode.writeBytesAscending(a)}writeString(a){this.orderedCode.writeUtf8Ascending(a)}writeNumber(a){this.orderedCode.writeNumberAscending(a)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class ry{constructor(a){this.orderedCode=a}writeBytes(a){this.orderedCode.writeBytesDescending(a)}writeString(a){this.orderedCode.writeUtf8Descending(a)}writeNumber(a){this.orderedCode.writeNumberDescending(a)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class rz{constructor(){this.orderedCode=new rw,this.ascending=new rx(this.orderedCode),this.descending=new ry(this.orderedCode)}seed(a){this.orderedCode.seed(a)}forKind(a){return 0===a?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class rA{constructor(a,b,c,d){this._indexId=a,this._documentKey=b,this._arrayValue=c,this._directionalValue=d}successor(){let a=this._directionalValue.length,b=0===a||255===this._directionalValue[a-1]?a+1:a,c=new Uint8Array(b);return c.set(this._directionalValue,0),b!==a?c.set([0],this._directionalValue.length):++c[c.length-1],new rA(this._indexId,this._documentKey,this._arrayValue,c)}dbIndexEntry(a,b,c){return{indexId:this._indexId,uid:a,arrayValue:rD(this._arrayValue),directionalValue:rD(this._directionalValue),orderedDocumentKey:rD(b),documentKey:c.path.toArray()}}dbIndexEntryKey(a,b,c){let d=this.dbIndexEntry(a,b,c);return[d.indexId,d.uid,d.arrayValue,d.directionalValue,d.orderedDocumentKey,d.documentKey]}}function rB(a,b){let c=a._indexId-b._indexId;return 0!==c||0!==(c=rC(a._arrayValue,b._arrayValue))||0!==(c=rC(a._directionalValue,b._directionalValue))?c:ji.comparator(a._documentKey,b._documentKey)}function rC(a,b){for(let c=0;c<a.length&&c<b.length;++c){let d=a[c]-b[c];if(0!==d)return d}return a.length-b.length}function rD(a){return ad()?rF(a):a}function rE(a){return"string"!=typeof a?a:rG(a)}function rF(a){let b="";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b}function rG(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}class rH{constructor(a){for(const b of(this.inequalityFilters=new lu((a,b)=>jh.comparator(a.field,b.field)),this.collectionId=null!=a.collectionGroup?a.collectionGroup:a.path.lastSegment(),this.orderBys=a.orderBy,this.equalityFilters=[],a.filters)){const a=b;a.isInequality()?this.inequalityFilters=this.inequalityFilters.add(a):this.equalityFilters.push(a)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(a){if(iC(a.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let b=jA(a);if(void 0!==b&&!this.hasMatchingEqualityFilter(b))return!1;let c=jB(a),d=new Set,e=0,f=0;for(;e<c.length;++e)if(this.hasMatchingEqualityFilter(c[e]))d=d.add(c[e].fieldPath.canonicalString());else break;if(e===c.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!d.has(a.field.canonicalString())){let b=c[e];if(!this.matchesFilter(a,b)||!this.matchesOrderBy(this.orderBys[f++],b))return!1}++e}for(;e<c.length;++e){let a=c[e];if(f>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[f++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let a=new lu(jh.comparator),b=[];for(let c of this.equalityFilters)if(!c.field.isKeyField())if("array-contains"===c.op||"array-contains-any"===c.op)b.push(new jF(c.field,2));else{if(a.has(c.field))continue;a=a.add(c.field),b.push(new jF(c.field,0))}for(let c of this.orderBys)!c.field.isKeyField()&&(a.has(c.field)||(a=a.add(c.field),b.push(new jF(c.field,+("asc"!==c.dir)))));return new jz(jz.UNKNOWN_ID,this.collectionId,b,jH.empty())}hasMatchingEqualityFilter(a){for(let b of this.equalityFilters)if(this.matchesFilter(b,a))return!0;return!1}matchesFilter(a,b){if(void 0===a||!a.field.isEqual(b.fieldPath))return!1;let c="array-contains"===a.op||"array-contains-any"===a.op;return 2===b.kind===c}matchesOrderBy(a,b){return!!a.field.isEqual(b.fieldPath)&&(0===b.kind&&"asc"===a.dir||1===b.kind&&"desc"===a.dir)}}function rI(a){if(iC(a instanceof mY||a instanceof mZ,20012),a instanceof mY)if(!(a instanceof nf))return a;else{let b=a.value.arrayValue?.values?.map(b=>mY.create(a.field,"==",b))||[];return mZ.create(b,"or")}let b=a.filters.map(a=>rI(a));return mZ.create(b,a.op)}function rJ(a){if(0===a.getFilters().length)return[];let b=rO(rI(a));return(iC(rM(b),7391),rK(b)||rL(b))?[b]:b.getFilters()}function rK(a){return a instanceof mY}function rL(a){return a instanceof mZ&&m0(a)}function rM(a){return rK(a)||rL(a)||rN(a)}function rN(a){if(a instanceof mZ&&m_(a)){for(let b of a.getFilters())if(!rK(b)&&!rL(b))return!1;return!0}return!1}function rO(a){if(iC(a instanceof mY||a instanceof mZ,34018),a instanceof mY)return a;if(1===a.filters.length)return rO(a.filters[0]);let b=a.filters.map(a=>rO(a)),c=mZ.create(b,a.op);return rM(c=rT(c))?c:(iC(c instanceof mZ,64498),iC(m$(c),40251),iC(c.filters.length>1,57927),c.filters.reduce((a,b)=>rP(a,b)))}function rP(a,b){let c;return iC(a instanceof mY||a instanceof mZ,38388),iC(b instanceof mY||b instanceof mZ,25473),rT(c=a instanceof mY?b instanceof mY?rQ(a,b):rS(a,b):b instanceof mY?rS(b,a):rR(a,b))}function rQ(a,b){return mZ.create([a,b],"and")}function rR(a,b){if(iC(a.filters.length>0&&b.filters.length>0,48005),m$(a)&&m$(b))return m6(a,b.getFilters());let c=m_(a)?a:b,d=m_(a)?b:a,e=c.filters.map(a=>rP(a,d));return mZ.create(e,"or")}function rS(a,b){if(m$(b))return m6(b,a.getFilters());{let c=b.filters.map(b=>rP(a,b));return mZ.create(c,"or")}}function rT(a){if(iC(a instanceof mY||a instanceof mZ,11850),a instanceof mY)return a;let b=a.getFilters();if(1===b.length)return rT(b[0]);if(m1(a))return a;let c=b.map(a=>rT(a)),d=[];return(c.forEach(b=>{b instanceof mY?d.push(b):b instanceof mZ&&(b.op===a.op?d.push(...b.filters):d.push(b))}),1===d.length)?d[0]:mZ.create(d,a.op)}class rU{constructor(){this.collectionParentIndex=new rV}addToCollectionParentIndex(a,b){return this.collectionParentIndex.add(b),jP.resolve()}getCollectionParents(a,b){return jP.resolve(this.collectionParentIndex.getEntries(b))}addFieldIndex(a,b){return jP.resolve()}deleteFieldIndex(a,b){return jP.resolve()}deleteAllFieldIndexes(a){return jP.resolve()}createTargetIndexes(a,b){return jP.resolve()}getDocumentsMatchingTarget(a,b){return jP.resolve(null)}getIndexType(a,b){return jP.resolve(0)}getFieldIndexes(a,b){return jP.resolve([])}getNextCollectionGroupToUpdate(a){return jP.resolve(null)}getMinOffset(a,b){return jP.resolve(jK.min())}getMinOffsetFromCollectionGroup(a,b){return jP.resolve(jK.min())}updateCollectionGroup(a,b,c){return jP.resolve()}updateIndexEntries(a,b){return jP.resolve()}}class rV{constructor(){this.index={}}add(a){let b=a.lastSegment(),c=a.popLast(),d=this.index[b]||new lu(jf.comparator),e=!d.has(c);return this.index[b]=d.add(c),e}has(a){let b=a.lastSegment(),c=a.popLast(),d=this.index[b];return d&&d.has(c)}getEntries(a){return(this.index[a]||new lu(jf.comparator)).toArray()}}let rW="IndexedDbIndexManager",rX=new Uint8Array(0);class rY{constructor(a,b){this.databaseId=b,this.collectionParentsCache=new rV,this.targetToDnfSubTargets=new nZ(a=>nk(a),(a,b)=>nm(a,b)),this.uid=a.uid||""}addToCollectionParentIndex(a,b){if(!this.collectionParentsCache.has(b)){let c=b.lastSegment(),d=b.popLast();a.addOnCommittedListener(()=>{this.collectionParentsCache.add(b)});let e={collectionId:c,parent:kb(d)};return rZ(a).put(e)}return jP.resolve()}getCollectionParents(a,b){let c=[],d=IDBKeyRange.bound([b,""],[jc(b),""],!1,!0);return rZ(a).loadAll(d).next(a=>{for(let d of a){if(d.collectionId!==b)break;c.push(ke(d.parent))}return c})}addFieldIndex(a,b){let c=r_(a),d=qV(b);delete d.indexId;let e=c.add(d);if(!b.indexState)return e.next();{let c=r0(a);return e.next(a=>{c.put(qX(a,this.uid,b.indexState.sequenceNumber,b.indexState.offset))})}}deleteFieldIndex(a,b){let c=r_(a),d=r0(a),e=r$(a);return c.delete(b.indexId).next(()=>d.delete(IDBKeyRange.bound([b.indexId],[b.indexId+1],!1,!0))).next(()=>e.delete(IDBKeyRange.bound([b.indexId],[b.indexId+1],!1,!0)))}deleteAllFieldIndexes(a){let b=r_(a),c=r$(a),d=r0(a);return b.deleteAll().next(()=>c.deleteAll()).next(()=>d.deleteAll())}createTargetIndexes(a,b){return jP.forEach(this.getSubTargets(b),b=>this.getIndexType(a,b).next(c=>{if(0===c||1===c){let c=new rH(b).buildTargetIndex();if(null!=c)return this.addFieldIndex(a,c)}}))}getDocumentsMatchingTarget(a,b){let c=r$(a),d=!0,e=new Map;return jP.forEach(this.getSubTargets(b),b=>this.getFieldIndex(a,b).next(a=>{d&&(d=!!a),e.set(b,a)})).next(()=>{if(!d)return jP.resolve(null);{let a=oa(),d=[];return jP.forEach(e,(e,f)=>{iw(rW,`Using index ${jE(e)} to execute ${nk(b)}`);let g=np(f,e),h=nq(f,e),i=nr(f,e),j=ns(f,e),k=this.encodeBound(e,f,i),l=this.encodeBound(e,f,j),m=this.encodeValues(e,f,h),n=this.generateIndexRanges(e.indexId,g,k,i.inclusive,l,j.inclusive,m);return jP.forEach(n,e=>c.loadFirst(e,b.limit).next(b=>{b.forEach(b=>{let c=ji.fromSegments(b.documentKey);a.has(c)||(a=a.add(c),d.push(c))})}))}).next(()=>d)}})}getSubTargets(a){let b=this.targetToDnfSubTargets.get(a);return b||(b=0===a.filters.length?[a]:rJ(mZ.create(a.filters,"and")).map(b=>nj(a.path,a.collectionGroup,a.orderBy,b.getFilters(),a.limit,a.startAt,a.endAt)),this.targetToDnfSubTargets.set(a,b)),b}generateIndexRanges(a,b,c,d,e,f,g){let h=(null!=b?b.length:1)*Math.max(c.length,e.length),i=h/(null!=b?b.length:1),j=[];for(let k=0;k<h;++k){let h=b?this.encodeSingleElement(b[k/i]):rX,l=this.generateLowerBound(a,h,c[k%i],d),m=this.generateUpperBound(a,h,e[k%i],f),n=g.map(b=>this.generateLowerBound(a,h,b,!0));j.push(...this.createRange(l,m,n))}return j}generateLowerBound(a,b,c,d){let e=new rA(a,ji.empty(),b,c);return d?e:e.successor()}generateUpperBound(a,b,c,d){let e=new rA(a,ji.empty(),b,c);return d?e.successor():e}getFieldIndex(a,b){let c=new rH(b),d=null!=b.collectionGroup?b.collectionGroup:b.path.lastSegment();return this.getFieldIndexes(a,d).next(a=>{let b=null;for(let d of a)c.servedByIndex(d)&&(!b||d.fields.length>b.fields.length)&&(b=d);return b})}getIndexType(a,b){let c=2,d=this.getSubTargets(b);return jP.forEach(d,b=>this.getFieldIndex(a,b).next(a=>{a?0!==c&&a.fields.length<nv(b)&&(c=1):c=0})).next(()=>nw(b)&&d.length>1&&2===c?1:c)}encodeDirectionalElements(a,b){let c=new rz;for(let d of jB(a)){let a=b.data.field(d.fieldPath);if(null==a)return null;let e=c.forKind(d.kind);rg.INSTANCE.writeIndexValue(a,e)}return c.encodedBytes()}encodeSingleElement(a){let b=new rz;return rg.INSTANCE.writeIndexValue(a,b.forKind(0)),b.encodedBytes()}encodeDirectionalKey(a,b){let c=new rz;return rg.INSTANCE.writeIndexValue(mu(this.databaseId,b),c.forKind(jC(a))),c.encodedBytes()}encodeValues(a,b,c){if(null===c)return[];let d=[];d.push(new rz);let e=0;for(let f of jB(a)){let a=c[e++];for(let c of d)if(this.isInFilter(b,f.fieldPath)&&my(a))d=this.expandIndexValues(d,f,a);else{let b=c.forKind(f.kind);rg.INSTANCE.writeIndexValue(a,b)}}return this.getEncodedBytes(d)}encodeBound(a,b,c){return this.encodeValues(a,b,c.position)}getEncodedBytes(a){let b=[];for(let c=0;c<a.length;++c)b[c]=a[c].encodedBytes();return b}expandIndexValues(a,b,c){let d=[...a],e=[];for(let a of c.arrayValue.values||[])for(let c of d){let d=new rz;d.seed(c.encodedBytes()),rg.INSTANCE.writeIndexValue(a,d.forKind(b.kind)),e.push(d)}return e}isInFilter(a,b){return!!a.filters.find(a=>a instanceof mY&&a.field.isEqual(b)&&("in"===a.op||"not-in"===a.op))}getFieldIndexes(a,b){let c=r_(a),d=r0(a);return(b?c.loadAll(kV,IDBKeyRange.bound(b,b)):c.loadAll()).next(a=>{let b=[];return jP.forEach(a,a=>d.get([a.indexId,this.uid]).next(c=>{b.push(qW(a,c))})).next(()=>b)})}getNextCollectionGroupToUpdate(a){return this.getFieldIndexes(a).next(a=>0===a.length?null:(a.sort((a,b)=>{let c=a.indexState.sequenceNumber-b.indexState.sequenceNumber;return 0!==c?c:i6(a.collectionGroup,b.collectionGroup)}),a[0].collectionGroup))}updateCollectionGroup(a,b,c){let d=r_(a),e=r0(a);return this.getNextSequenceNumber(a).next(a=>d.loadAll(kV,IDBKeyRange.bound(b,b)).next(b=>jP.forEach(b,b=>e.put(qX(b.indexId,this.uid,a,c)))))}updateIndexEntries(a,b){let c=new Map;return jP.forEach(b,(b,d)=>{let e=c.get(b.collectionGroup);return(e?jP.resolve(e):this.getFieldIndexes(a,b.collectionGroup)).next(e=>(c.set(b.collectionGroup,e),jP.forEach(e,c=>this.getExistingIndexEntries(a,b,c).next(b=>{let e=this.computeIndexEntries(d,c);return b.isEqual(e)?jP.resolve():this.updateEntries(a,d,c,b,e)}))))})}addIndexEntry(a,b,c,d){return r$(a).put(d.dbIndexEntry(this.uid,this.encodeDirectionalKey(c,b.key),b.key))}deleteIndexEntry(a,b,c,d){return r$(a).delete(d.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(c,b.key),b.key))}getExistingIndexEntries(a,b,c){let d=r$(a),e=new lu(rB);return d.iterate({index:k1,range:IDBKeyRange.only([c.indexId,this.uid,rD(this.encodeDirectionalKey(c,b))])},(a,d)=>{e=e.add(new rA(c.indexId,b,rE(d.arrayValue),rE(d.directionalValue)))}).next(()=>e)}computeIndexEntries(a,b){let c=new lu(rB),d=this.encodeDirectionalElements(b,a);if(null==d)return c;let e=jA(b);if(null!=e){let f=a.data.field(e.fieldPath);if(my(f))for(let e of f.arrayValue.values||[])c=c.add(new rA(b.indexId,a.key,this.encodeSingleElement(e),d))}else c=c.add(new rA(b.indexId,a.key,rX,d));return c}updateEntries(a,b,c,d,e){iw(rW,"Updating index entries for document '%s'",b.key);let f=[];return lw(d,e,rB,d=>{f.push(this.addIndexEntry(a,b,c,d))},d=>{f.push(this.deleteIndexEntry(a,b,c,d))}),jP.waitFor(f)}getNextSequenceNumber(a){let b=1;return r0(a).iterate({index:kZ,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(a,c,d)=>{d.done(),b=c.sequenceNumber+1}).next(()=>b)}createRange(a,b,c){c=c.sort((a,b)=>rB(a,b)).filter((a,b,c)=>!b||0!==rB(a,c[b-1]));let d=[];for(let e of(d.push(a),c)){let c=rB(e,a),f=rB(e,b);if(0===c)d[0]=a.successor();else if(c>0&&f<0)d.push(e),d.push(e.successor());else if(f>0)break}d.push(b);let e=[];for(let a=0;a<d.length;a+=2){if(this.isRangeMatchable(d[a],d[a+1]))return[];let b=d[a].dbIndexEntryKey(this.uid,rX,ji.empty()),c=d[a+1].dbIndexEntryKey(this.uid,rX,ji.empty());e.push(IDBKeyRange.bound(b,c))}return e}isRangeMatchable(a,b){return rB(a,b)>0}getMinOffsetFromCollectionGroup(a,b){return this.getFieldIndexes(a,b).next(r1)}getMinOffset(a,b){return jP.mapArray(this.getSubTargets(b),b=>this.getFieldIndex(a,b).next(a=>a||iA(44426))).next(r1)}}function rZ(a){return ll(a,kL)}function r$(a){return ll(a,k_)}function r_(a){return ll(a,kT)}function r0(a){return ll(a,kX)}function r1(a){iC(0!==a.length,28825);let b=a[0].indexState.offset,c=b.largestBatchId;for(let d=1;d<a.length;d++){let e=a[d].indexState.offset;0>jL(e,b)&&(b=e),c<e.largestBatchId&&(c=e.largestBatchId)}return new jK(b.readTime,b.documentKey,c)}function r2(a,b,c){let d=a.store(kk),e=a.store(ks),f=[],g=IDBKeyRange.only(c.batchId),h=0,i=d.iterate({range:g},(a,b,c)=>(h++,c.delete()));f.push(i.next(()=>{iC(1===h,47070,{batchId:c.batchId})}));let j=[];for(let a of c.mutations){let d=kq(b,a.key.path,c.batchId);f.push(e.delete(d)),j.push(a.key)}return jP.waitFor(f).next(()=>j)}function r3(a){let b;if(!a)return 0;if(a.document)b=a.document;else if(a.unknownDocument)b=a.unknownDocument;else if(a.noDocument)b=a.noDocument;else throw iA(14731);return JSON.stringify(b).length}class r4{constructor(a,b,c,d){this.userId=a,this.serializer=b,this.indexManager=c,this.referenceDelegate=d,this.documentKeysByBatchId={}}static forUser(a,b,c,d){return iC(""!==a.uid,64387),new r4(a.isAuthenticated()?a.uid:"",b,c,d)}checkEmpty(a){let b=!0,c=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return r7(a).iterate({index:km,range:c},(a,c,d)=>{b=!1,d.done()}).next(()=>b)}addMutationBatch(a,b,c,d){let e=r8(a),f=r7(a);return f.add({}).next(g=>{iC("number"==typeof g,49019);let h=new oT(g,b,c,d),i=qG(this.serializer,this.userId,h),j=[],k=new lu((a,b)=>i6(a.canonicalString(),b.canonicalString()));for(let a of d){let b=kq(this.userId,a.key.path,g);k=k.add(a.key.path.popLast()),j.push(f.put(i)),j.push(e.put(b,kr))}return k.forEach(b=>{j.push(this.indexManager.addToCollectionParentIndex(a,b))}),a.addOnCommittedListener(()=>{this.documentKeysByBatchId[g]=h.keys()}),jP.waitFor(j).next(()=>h)})}lookupMutationBatch(a,b){return r7(a).get(b).next(a=>a?(iC(a.userId===this.userId,48,"Unexpected user for mutation batch",{userId:a.userId,batchId:b}),qH(this.serializer,a)):null)}lookupMutationKeys(a,b){return this.documentKeysByBatchId[b]?jP.resolve(this.documentKeysByBatchId[b]):this.lookupMutationBatch(a,b).next(a=>{if(!a)return null;{let c=a.keys();return this.documentKeysByBatchId[b]=c,c}})}getNextMutationBatchAfterBatchId(a,b){let c=b+1,d=IDBKeyRange.lowerBound([this.userId,c]),e=null;return r7(a).iterate({index:km,range:d},(a,b,d)=>{b.userId===this.userId&&(iC(b.batchId>=c,47524,{nextBatchId:c}),e=qH(this.serializer,b)),d.done()}).next(()=>e)}getHighestUnacknowledgedBatchId(a){let b=IDBKeyRange.upperBound([this.userId,1/0]),c=lU;return r7(a).iterate({index:km,range:b,reverse:!0},(a,b,d)=>{c=b.batchId,d.done()}).next(()=>c)}getAllMutationBatches(a){let b=IDBKeyRange.bound([this.userId,lU],[this.userId,1/0]);return r7(a).loadAll(km,b).next(a=>a.map(a=>qH(this.serializer,a)))}getAllMutationBatchesAffectingDocumentKey(a,b){let c=kp(this.userId,b.path),d=IDBKeyRange.lowerBound(c),e=[];return r8(a).iterate({range:d},(c,d,f)=>{let[g,h,i]=c,j=ke(h);return g===this.userId&&b.path.isEqual(j)?r7(a).get(i).next(a=>{if(!a)throw iA(61480,{indexKey:c,batchId:i});iC(a.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),e.push(qH(this.serializer,a))}):void f.done()}).next(()=>e)}getAllMutationBatchesAffectingDocumentKeys(a,b){let c=new lu(i6),d=[];return b.forEach(b=>{let e=kp(this.userId,b.path),f=IDBKeyRange.lowerBound(e),g=r8(a).iterate({range:f},(a,d,e)=>{let[f,g,h]=a,i=ke(g);f===this.userId&&b.path.isEqual(i)?c=c.add(h):e.done()});d.push(g)}),jP.waitFor(d).next(()=>this.lookupMutationBatches(a,c))}getAllMutationBatchesAffectingQuery(a,b){let c=b.path,d=c.length+1,e=kp(this.userId,c),f=IDBKeyRange.lowerBound(e),g=new lu(i6);return r8(a).iterate({range:f},(a,b,e)=>{let[f,h,i]=a,j=ke(h);f===this.userId&&c.isPrefixOf(j)?j.length===d&&(g=g.add(i)):e.done()}).next(()=>this.lookupMutationBatches(a,g))}lookupMutationBatches(a,b){let c=[],d=[];return b.forEach(b=>{d.push(r7(a).get(b).next(a=>{if(null===a)throw iA(35274,{batchId:b});iC(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:b}),c.push(qH(this.serializer,a))}))}),jP.waitFor(d).next(()=>c)}removeMutationBatch(a,b){return r2(a.simpleDbTransaction,this.userId,b).next(c=>(a.addOnCommittedListener(()=>{this.removeCachedMutationKeys(b.batchId)}),jP.forEach(c,b=>this.referenceDelegate.markPotentiallyOrphaned(a,b))))}removeCachedMutationKeys(a){delete this.documentKeysByBatchId[a]}performConsistencyCheck(a){return this.checkEmpty(a).next(b=>{if(!b)return jP.resolve();let c=IDBKeyRange.lowerBound(ko(this.userId)),d=[];return r8(a).iterate({range:c},(a,b,c)=>{if(a[0]!==this.userId)return void c.done();{let b=ke(a[1]);d.push(b)}}).next(()=>{iC(0===d.length,56720,{danglingKeys:d.map(a=>a.canonicalString())})})})}containsKey(a,b){return r5(a,this.userId,b)}getMutationQueueMetadata(a){return r9(a).get(this.userId).next(a=>a||{userId:this.userId,lastAcknowledgedBatchId:lU,lastStreamToken:""})}}function r5(a,b,c){let d=kp(b,c.path),e=d[1],f=IDBKeyRange.lowerBound(d),g=!1;return r8(a).iterate({range:f,keysOnly:!0},(a,c,d)=>{let[f,h,i]=a;f===b&&h===e&&(g=!0),d.done()}).next(()=>g)}function r6(a,b){let c=!1;return r9(a).iterateSerial(d=>r5(a,d,b).next(a=>(a&&(c=!0),jP.resolve(!a)))).next(()=>c)}function r7(a){return ll(a,kk)}function r8(a){return ll(a,ks)}function r9(a){return ll(a,ki)}let sa=2;class sb{constructor(a){this.lastId=a}next(){return this.lastId+=sa,this.lastId}static forTargetCache(){return new sb(2-sa)}static forSyncEngine(){return new sb(1-sa)}}class sc{constructor(a,b){this.referenceDelegate=a,this.serializer=b}allocateTargetId(a){return this.retrieveMetadata(a).next(b=>{let c=new sb(b.highestTargetId);return b.highestTargetId=c.next(),this.saveMetadata(a,b).next(()=>b.highestTargetId)})}getLastRemoteSnapshotVersion(a){return this.retrieveMetadata(a).next(a=>jw.fromTimestamp(new jv(a.lastRemoteSnapshotVersion.seconds,a.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(a){return this.retrieveMetadata(a).next(a=>a.highestListenSequenceNumber)}setTargetsMetadata(a,b,c){return this.retrieveMetadata(a).next(d=>(d.highestListenSequenceNumber=b,c&&(d.lastRemoteSnapshotVersion=c.toTimestamp()),b>d.highestListenSequenceNumber&&(d.highestListenSequenceNumber=b),this.saveMetadata(a,d)))}addTargetData(a,b){return this.saveTargetData(a,b).next(()=>this.retrieveMetadata(a).next(c=>(c.targetCount+=1,this.updateMetadataFromTargetData(b,c),this.saveMetadata(a,c))))}updateTargetData(a,b){return this.saveTargetData(a,b)}removeTargetData(a,b){return this.removeMatchingKeysForTargetId(a,b.targetId).next(()=>sd(a).delete(b.targetId)).next(()=>this.retrieveMetadata(a)).next(b=>(iC(b.targetCount>0,8065),b.targetCount-=1,this.saveMetadata(a,b)))}removeTargets(a,b,c){let d=0,e=[];return sd(a).iterate((f,g)=>{let h=qI(g);h.sequenceNumber<=b&&null===c.get(h.targetId)&&(d++,e.push(this.removeTargetData(a,h)))}).next(()=>jP.waitFor(e)).next(()=>d)}forEachTarget(a,b){return sd(a).iterate((a,c)=>{b(qI(c))})}retrieveMetadata(a){return se(a).get(kJ).next(a=>(iC(null!==a,2888),a))}saveMetadata(a,b){return se(a).put(kJ,b)}saveTargetData(a,b){return sd(a).put(qJ(this.serializer,b))}updateMetadataFromTargetData(a,b){let c=!1;return a.targetId>b.highestTargetId&&(b.highestTargetId=a.targetId,c=!0),a.sequenceNumber>b.highestListenSequenceNumber&&(b.highestListenSequenceNumber=a.sequenceNumber,c=!0),c}getTargetCount(a){return this.retrieveMetadata(a).next(a=>a.targetCount)}getTargetData(a,b){let c=nk(b),d=IDBKeyRange.bound([c,-1/0],[c,1/0]),e=null;return sd(a).iterate({range:d,index:kD},(a,c,d)=>{let f=qI(c);nm(b,f.target)&&(e=f,d.done())}).next(()=>e)}addMatchingKeys(a,b,c){let d=[],e=sf(a);return b.forEach(b=>{let f=kb(b.path);d.push(e.put({targetId:c,path:f})),d.push(this.referenceDelegate.addReference(a,c,b))}),jP.waitFor(d)}removeMatchingKeys(a,b,c){let d=sf(a);return jP.forEach(b,b=>{let e=kb(b.path);return jP.waitFor([d.delete([c,e]),this.referenceDelegate.removeReference(a,c,b)])})}removeMatchingKeysForTargetId(a,b){let c=sf(a),d=IDBKeyRange.bound([b],[b+1],!1,!0);return c.delete(d)}getMatchingKeysForTargetId(a,b){let c=IDBKeyRange.bound([b],[b+1],!1,!0),d=sf(a),e=oa();return d.iterate({range:c,keysOnly:!0},(a,b,c)=>{let d=new ji(ke(a[1]));e=e.add(d)}).next(()=>e)}containsKey(a,b){let c=kb(b.path),d=IDBKeyRange.bound([c],[jc(c)],!1,!0),e=0;return sf(a).iterate({index:kH,keysOnly:!0,range:d},([a,b],c,d)=>{0!==a&&(e++,d.done())}).next(()=>e>0)}getTargetDataForTarget(a,b){return sd(a).get(b).next(a=>a?qI(a):null)}}function sd(a){return ll(a,kB)}function se(a){return ll(a,kK)}function sf(a){return ll(a,kF)}let sg={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},sh=-1,si=0x2800000;class sj{static withCacheSize(a){return new sj(a,sj.DEFAULT_COLLECTION_PERCENTILE,sj.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(a,b,c){this.cacheSizeCollectionThreshold=a,this.percentileToCollect=b,this.maximumSequenceNumbersToCollect=c}}sj.DEFAULT_COLLECTION_PERCENTILE=10,sj.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sj.DEFAULT=new sj(si,sj.DEFAULT_COLLECTION_PERCENTILE,sj.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sj.DISABLED=new sj(sh,0,0);let sk="LruGarbageCollector",sl=1048576,sm=6e4,sn=3e5;function so([a,b],[c,d]){let e=i6(a,c);return 0===e?i6(b,d):e}class sp{constructor(a){this.maxElements=a,this.buffer=new lu(so),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(a){let b=[a,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(b);else{let a=this.buffer.last();0>so(b,a)&&(this.buffer=this.buffer.delete(a).add(b))}}get maxValue(){return this.buffer.last()[0]}}class sq{constructor(a,b,c){this.garbageCollector=a,this.asyncQueue=b,this.localStore=c,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==sh&&this.scheduleGC(sm)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(a){iw(sk,`Garbage collection scheduled in ${a}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",a,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(a){jX(a)?iw(sk,"Ignoring IndexedDB error during garbage collection: ",a):await jO(a)}await this.scheduleGC(sn)})}}class sr{constructor(a,b){this.delegate=a,this.params=b}calculateTargetCount(a,b){return this.delegate.getSequenceNumberCount(a).next(a=>Math.floor(b/100*a))}nthSequenceNumber(a,b){if(0===b)return jP.resolve(j6.INVALID);let c=new sp(b);return this.delegate.forEachTarget(a,a=>c.addElement(a.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(a,a=>c.addElement(a))).next(()=>c.maxValue)}removeTargets(a,b,c){return this.delegate.removeTargets(a,b,c)}removeOrphanedDocuments(a,b){return this.delegate.removeOrphanedDocuments(a,b)}collect(a,b){return this.params.cacheSizeCollectionThreshold===sh?(iw("LruGarbageCollector","Garbage collection skipped; disabled"),jP.resolve(sg)):this.getCacheSize(a).next(c=>c<this.params.cacheSizeCollectionThreshold?(iw("LruGarbageCollector",`Garbage collection skipped; Cache size ${c} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sg):this.runGarbageCollection(a,b))}getCacheSize(a){return this.delegate.getCacheSize(a)}runGarbageCollection(a,b){let c,d,e,f,g,h,i,j=Date.now();return this.calculateTargetCount(a,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(iw("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),d=this.params.maximumSequenceNumbersToCollect):d=b,f=Date.now(),this.nthSequenceNumber(a,d))).next(d=>(c=d,g=Date.now(),this.removeTargets(a,c,b))).next(b=>(e=b,h=Date.now(),this.removeOrphanedDocuments(a,c))).next(a=>(i=Date.now(),iv()<=n.DEBUG&&iw("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-j}ms
	Determined least recently used ${d} in ${g-f}ms
	Removed ${e} targets in ${h-g}ms
	Removed ${a} documents in ${i-h}ms
Total Duration: ${i-j}ms`),jP.resolve({didRun:!0,sequenceNumbersCollected:d,targetsRemoved:e,documentsRemoved:a})))}}function ss(a,b){return new sr(a,b)}class st{constructor(a,b){this.db=a,this.garbageCollector=ss(this,b)}getSequenceNumberCount(a){let b=this.orphanedDocumentCount(a);return this.db.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}orphanedDocumentCount(a){let b=0;return this.forEachOrphanedDocumentSequenceNumber(a,a=>{b++}).next(()=>b)}forEachTarget(a,b){return this.db.getTargetCache().forEachTarget(a,b)}forEachOrphanedDocumentSequenceNumber(a,b){return this.forEachOrphanedDocument(a,(a,c)=>b(c))}addReference(a,b,c){return sw(a,c)}removeReference(a,b,c){return sw(a,c)}removeTargets(a,b,c){return this.db.getTargetCache().removeTargets(a,b,c)}markPotentiallyOrphaned(a,b){return sw(a,b)}isPinned(a,b){return r6(a,b)}removeOrphanedDocuments(a,b){let c=this.db.getRemoteDocumentCache().newChangeBuffer(),d=[],e=0;return this.forEachOrphanedDocument(a,(f,g)=>{if(g<=b){let b=this.isPinned(a,f).next(b=>{if(!b)return e++,c.getEntry(a,f).next(()=>(c.removeEntry(f,jw.min()),sf(a).delete(su(f))))});d.push(b)}}).next(()=>jP.waitFor(d)).next(()=>c.apply(a)).next(()=>e)}removeTarget(a,b){let c=b.withSequenceNumber(a.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(a,c)}updateLimboDocument(a,b){return sw(a,b)}forEachOrphanedDocument(a,b){let c,d=sf(a),e=j6.INVALID;return d.iterate({index:kH},([a,d],{path:f,sequenceNumber:g})=>{0===a?(e!==j6.INVALID&&b(new ji(ke(c)),e),e=g,c=f):e=j6.INVALID}).next(()=>{e!==j6.INVALID&&b(new ji(ke(c)),e)})}getCacheSize(a){return this.db.getRemoteDocumentCache().getSize(a)}}function su(a){return[0,kb(a.path)]}function sv(a,b){return{targetId:0,path:kb(a.path),sequenceNumber:b}}function sw(a,b){return sf(a).put(sv(b,a.currentSequenceNumber))}class sx{constructor(){this.changes=new nZ(a=>a.toString(),(a,b)=>a.isEqual(b)),this.changesApplied=!1}addEntry(a){this.assertNotApplied(),this.changes.set(a.key,a)}removeEntry(a,b){this.assertNotApplied(),this.changes.set(a,mM.newInvalidDocument(a).setReadTime(b))}getEntry(a,b){this.assertNotApplied();let c=this.changes.get(b);return void 0!==c?jP.resolve(c):this.getFromCache(a,b)}getEntries(a,b){return this.getAllFromCache(a,b)}apply(a){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(a)}assertNotApplied(){}}class sy{constructor(a){this.serializer=a}setIndexManager(a){this.indexManager=a}addEntry(a,b,c){return sC(a).put(c)}removeEntry(a,b,c){return sC(a).delete(sE(b,c))}updateMetadata(a,b){return this.getMetadata(a).next(c=>(c.byteSize+=b,this.setMetadata(a,c)))}getEntry(a,b){let c=mM.newInvalidDocument(b);return sC(a).iterate({index:kv,range:IDBKeyRange.only(sD(b))},(a,d)=>{c=this.maybeDecodeDocument(b,d)}).next(()=>c)}getSizedEntry(a,b){let c={size:0,document:mM.newInvalidDocument(b)};return sC(a).iterate({index:kv,range:IDBKeyRange.only(sD(b))},(a,d)=>{c={document:this.maybeDecodeDocument(b,d),size:r3(d)}}).next(()=>c)}getEntries(a,b){let c=n_();return this.forEachDbEntry(a,b,(a,b)=>{let d=this.maybeDecodeDocument(a,b);c=c.insert(a,d)}).next(()=>c)}getSizedEntries(a,b){let c=n_(),d=new lq(ji.comparator);return this.forEachDbEntry(a,b,(a,b)=>{let e=this.maybeDecodeDocument(a,b);c=c.insert(a,e),d=d.insert(a,r3(b))}).next(()=>({documents:c,sizeMap:d}))}forEachDbEntry(a,b,c){if(b.isEmpty())return jP.resolve();let d=new lu(sG);b.forEach(a=>d=d.add(a));let e=IDBKeyRange.bound(sD(d.first()),sD(d.last())),f=d.getIterator(),g=f.getNext();return sC(a).iterate({index:kv,range:e},(a,b,d)=>{let e=ji.fromSegments([...b.prefixPath,b.collectionGroup,b.documentId]);for(;g&&0>sG(g,e);)c(g,null),g=f.getNext();g&&g.isEqual(e)&&(c(g,b),g=f.hasNext()?f.getNext():null),g?d.skip(sD(g)):d.done()}).next(()=>{for(;g;)c(g,null),g=f.hasNext()?f.getNext():null})}getDocumentsMatchingQuery(a,b,c,d,e){let f=b.path,g=[f.popLast().toArray(),f.lastSegment(),qC(c.readTime),c.documentKey.path.isEmpty()?"":c.documentKey.path.lastSegment()],h=[f.popLast().toArray(),f.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return sC(a).loadAll(IDBKeyRange.bound(g,h,!0)).next(a=>{e?.incrementDocumentReadCount(a.length);let c=n_();for(let e of a){let a=this.maybeDecodeDocument(ji.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);a.isFoundDocument()&&(nR(b,a)||d.has(a.key))&&(c=c.insert(a.key,a))}return c})}getAllFromCollectionGroup(a,b,c,d){let e=n_(),f=sF(b,c),g=sF(b,jK.max());return sC(a).iterate({index:kx,range:IDBKeyRange.bound(f,g,!0)},(a,b,c)=>{let f=this.maybeDecodeDocument(ji.fromSegments(b.prefixPath.concat(b.collectionGroup,b.documentId)),b);(e=e.insert(f.key,f)).size===d&&c.done()}).next(()=>e)}newChangeBuffer(a){return new sA(this,!!a&&a.trackRemovals)}getSize(a){return this.getMetadata(a).next(a=>a.byteSize)}getMetadata(a){return sB(a).get(kA).next(a=>(iC(!!a,20021),a))}setMetadata(a,b){return sB(a).put(kA,b)}maybeDecodeDocument(a,b){if(b){let a=qA(this.serializer,b);if(!(a.isNoDocument()&&a.version.isEqual(jw.min())))return a}return mM.newInvalidDocument(a)}}function sz(a){return new sy(a)}class sA extends sx{constructor(a,b){super(),this.documentCache=a,this.trackRemovals=b,this.documentStates=new nZ(a=>a.toString(),(a,b)=>a.isEqual(b))}applyChanges(a){let b=[],c=0,d=new lu((a,b)=>i6(a.canonicalString(),b.canonicalString()));return this.changes.forEach((e,f)=>{let g=this.documentStates.get(e);if(b.push(this.documentCache.removeEntry(a,e,g.readTime)),f.isValidDocument()){let h=qB(this.documentCache.serializer,f);d=d.add(e.path.popLast());let i=r3(h);c+=i-g.size,b.push(this.documentCache.addEntry(a,e,h))}else if(c-=g.size,this.trackRemovals){let c=qB(this.documentCache.serializer,f.convertToNoDocument(jw.min()));b.push(this.documentCache.addEntry(a,e,c))}}),d.forEach(c=>{b.push(this.documentCache.indexManager.addToCollectionParentIndex(a,c))}),b.push(this.documentCache.updateMetadata(a,c)),jP.waitFor(b)}getFromCache(a,b){return this.documentCache.getSizedEntry(a,b).next(a=>(this.documentStates.set(b,{size:a.size,readTime:a.document.readTime}),a.document))}getAllFromCache(a,b){return this.documentCache.getSizedEntries(a,b).next(({documents:a,sizeMap:b})=>(b.forEach((b,c)=>{this.documentStates.set(b,{size:c,readTime:a.get(b).readTime})}),a))}}function sB(a){return ll(a,kz)}function sC(a){return ll(a,kt)}function sD(a){let b=a.path.toArray();return[b.slice(0,b.length-2),b[b.length-2],b[b.length-1]]}function sE(a,b){let c=a.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],qC(b),c[c.length-1]]}function sF(a,b){let c=b.documentKey.path.toArray();return[a,qC(b.readTime),c.slice(0,c.length-2),c.length>0?c[c.length-1]:""]}function sG(a,b){let c=a.path.toArray(),d=b.path.toArray(),e=0;for(let a=0;a<c.length-2&&a<d.length-2;++a)if(e=i6(c[a],d[a]))return e;return(e=i6(c.length,d.length))||(e=i6(c[c.length-2],d[d.length-2]))?e:i6(c[c.length-1],d[d.length-1])}let sH=18;class sI{constructor(a,b){this.overlayedDocument=a,this.mutatedFields=b}}class sJ{constructor(a,b,c,d){this.remoteDocumentCache=a,this.mutationQueue=b,this.documentOverlayCache=c,this.indexManager=d}getDocument(a,b){let c=null;return this.documentOverlayCache.getOverlay(a,b).next(d=>(c=d,this.remoteDocumentCache.getEntry(a,b))).next(a=>(null!==c&&oD(c.mutation,a,ly.empty(),jv.now()),a))}getDocuments(a,b){return this.remoteDocumentCache.getEntries(a,b).next(b=>this.getLocalViewOfDocuments(a,b,oa()).next(()=>b))}getLocalViewOfDocuments(a,b,c=oa()){let d=n4();return this.populateOverlays(a,d,b).next(()=>this.computeViews(a,b,d,c).next(a=>{let b=n1();return a.forEach((a,c)=>{b=b.insert(a,c.overlayedDocument)}),b}))}getOverlayedDocuments(a,b){let c=n4();return this.populateOverlays(a,c,b).next(()=>this.computeViews(a,b,c,oa()))}populateOverlays(a,b,c){let d=[];return c.forEach(a=>{b.has(a)||d.push(a)}),this.documentOverlayCache.getOverlays(a,d).next(a=>{a.forEach((a,c)=>{b.set(a,c)})})}computeViews(a,b,c,d){let e=n_(),f=n6(),g=n2();return b.forEach((a,b)=>{let g=c.get(b.key);d.has(b.key)&&(void 0===g||g.mutation instanceof oJ)?e=e.insert(b.key,b):void 0!==g?(f.set(b.key,g.mutation.getFieldMask()),oD(g.mutation,b,g.mutation.getFieldMask(),jv.now())):f.set(b.key,ly.empty())}),this.recalculateAndSaveOverlays(a,e).next(a=>(a.forEach((a,b)=>f.set(a,b)),b.forEach((a,b)=>g.set(a,new sI(b,f.get(a)??null))),g))}recalculateAndSaveOverlays(a,b){let c=n6(),d=new lq((a,b)=>a-b),e=oa();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(a,b).next(a=>{for(let e of a)e.keys().forEach(a=>{let f=b.get(a);if(null===f)return;let g=c.get(a)||ly.empty();g=e.applyToLocalView(f,g),c.set(a,g);let h=(d.get(e.batchId)||oa()).add(a);d=d.insert(e.batchId,h)})}).next(()=>{let f=[],g=d.getReverseIterator();for(;g.hasNext();){let d=g.getNext(),h=d.key,i=d.value,j=n5();i.forEach(a=>{if(!e.has(a)){let d=oB(b.get(a),c.get(a));null!==d&&j.set(a,d),e=e.add(a)}}),f.push(this.documentOverlayCache.saveOverlays(a,h,j))}return jP.waitFor(f)}).next(()=>c)}recalculateAndSaveOverlaysForDocumentKeys(a,b){return this.remoteDocumentCache.getEntries(a,b).next(b=>this.recalculateAndSaveOverlays(a,b))}getDocumentsMatchingQuery(a,b,c,d){return nD(b)?this.getDocumentsMatchingDocumentQuery(a,b.path):nE(b)?this.getDocumentsMatchingCollectionGroupQuery(a,b,c,d):this.getDocumentsMatchingCollectionQuery(a,b,c,d)}getNextDocuments(a,b,c,d){return this.remoteDocumentCache.getAllFromCollectionGroup(a,b,c,d).next(e=>{let f=d-e.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(a,b,c.largestBatchId,d-e.size):jP.resolve(n4()),g=jx,h=e;return f.next(b=>jP.forEach(b,(b,c)=>(g<c.largestBatchId&&(g=c.largestBatchId),e.get(b))?jP.resolve():this.remoteDocumentCache.getEntry(a,b).next(a=>{h=h.insert(b,a)})).next(()=>this.populateOverlays(a,b,e)).next(()=>this.computeViews(a,h,b,oa())).next(a=>({batchId:g,changes:n3(a)})))})}getDocumentsMatchingDocumentQuery(a,b){return this.getDocument(a,new ji(b)).next(a=>{let b=n1();return a.isFoundDocument()&&(b=b.insert(a.key,a)),b})}getDocumentsMatchingCollectionGroupQuery(a,b,c,d){let e=b.collectionGroup,f=n1();return this.indexManager.getCollectionParents(a,e).next(g=>jP.forEach(g,g=>{let h=nA(b,g.child(e));return this.getDocumentsMatchingCollectionQuery(a,h,c,d).next(a=>{a.forEach((a,b)=>{f=f.insert(a,b)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(a,b,c,d){let e;return this.documentOverlayCache.getOverlaysForCollection(a,b.path,c.largestBatchId).next(f=>(e=f,this.remoteDocumentCache.getDocumentsMatchingQuery(a,b,c,e,d))).next(a=>{e.forEach((b,c)=>{let d=c.getKey();null===a.get(d)&&(a=a.insert(d,mM.newInvalidDocument(d)))});let c=n1();return a.forEach((a,d)=>{let f=e.get(a);void 0!==f&&oD(f.mutation,d,ly.empty(),jv.now()),nR(b,d)&&(c=c.insert(a,d))}),c})}}class sK{constructor(a){this.serializer=a,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(a,b){return jP.resolve(this.bundles.get(b))}saveBundleMetadata(a,b){return this.bundles.set(b.id,qR(b)),jP.resolve()}getNamedQuery(a,b){return jP.resolve(this.namedQueries.get(b))}saveNamedQuery(a,b){return this.namedQueries.set(b.name,qQ(b)),jP.resolve()}}class sL{constructor(){this.overlays=new lq(ji.comparator),this.overlayByBatchId=new Map}getOverlay(a,b){return jP.resolve(this.overlays.get(b))}getOverlays(a,b){let c=n4();return jP.forEach(b,b=>this.getOverlay(a,b).next(a=>{null!==a&&c.set(b,a)})).next(()=>c)}saveOverlays(a,b,c){return c.forEach((c,d)=>{this.saveOverlay(a,b,d)}),jP.resolve()}removeOverlaysForBatchId(a,b,c){let d=this.overlayByBatchId.get(c);return void 0!==d&&(d.forEach(a=>this.overlays=this.overlays.remove(a)),this.overlayByBatchId.delete(c)),jP.resolve()}getOverlaysForCollection(a,b,c){let d=n4(),e=b.length+1,f=new ji(b.child("")),g=this.overlays.getIteratorFrom(f);for(;g.hasNext();){let a=g.getNext().value,f=a.getKey();if(!b.isPrefixOf(f.path))break;f.path.length===e&&a.largestBatchId>c&&d.set(a.getKey(),a)}return jP.resolve(d)}getOverlaysForCollectionGroup(a,b,c,d){let e=new lq((a,b)=>a-b),f=this.overlays.getIterator();for(;f.hasNext();){let a=f.getNext().value;if(a.getKey().getCollectionGroup()===b&&a.largestBatchId>c){let b=e.get(a.largestBatchId);null===b&&(b=n4(),e=e.insert(a.largestBatchId,b)),b.set(a.getKey(),a)}}let g=n4(),h=e.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((a,b)=>g.set(a,b)),!(g.size()>=d)););return jP.resolve(g)}saveOverlay(a,b,c){let d=this.overlays.get(c.key);if(null!==d){let a=this.overlayByBatchId.get(d.largestBatchId).delete(c.key);this.overlayByBatchId.set(d.largestBatchId,a)}this.overlays=this.overlays.insert(c.key,new oV(b,c));let e=this.overlayByBatchId.get(b);void 0===e&&(e=oa(),this.overlayByBatchId.set(b,e)),this.overlayByBatchId.set(b,e.add(c.key))}}class sM{constructor(){this.sessionToken=lB.EMPTY_BYTE_STRING}getSessionToken(a){return jP.resolve(this.sessionToken)}setSessionToken(a,b){return this.sessionToken=b,jP.resolve()}}class sN{constructor(){this.refsByKey=new lu(sO.compareByKey),this.refsByTarget=new lu(sO.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(a,b){let c=new sO(a,b);this.refsByKey=this.refsByKey.add(c),this.refsByTarget=this.refsByTarget.add(c)}addReferences(a,b){a.forEach(a=>this.addReference(a,b))}removeReference(a,b){this.removeRef(new sO(a,b))}removeReferences(a,b){a.forEach(a=>this.removeReference(a,b))}removeReferencesForId(a){let b=new ji(new jf([])),c=new sO(b,a),d=new sO(b,a+1),e=[];return this.refsByTarget.forEachInRange([c,d],a=>{this.removeRef(a),e.push(a.key)}),e}removeAllReferences(){this.refsByKey.forEach(a=>this.removeRef(a))}removeRef(a){this.refsByKey=this.refsByKey.delete(a),this.refsByTarget=this.refsByTarget.delete(a)}referencesForId(a){let b=new ji(new jf([])),c=new sO(b,a),d=new sO(b,a+1),e=oa();return this.refsByTarget.forEachInRange([c,d],a=>{e=e.add(a.key)}),e}containsKey(a){let b=new sO(a,0),c=this.refsByKey.firstAfterOrEqual(b);return null!==c&&a.isEqual(c.key)}}class sO{constructor(a,b){this.key=a,this.targetOrBatchId=b}static compareByKey(a,b){return ji.comparator(a.key,b.key)||i6(a.targetOrBatchId,b.targetOrBatchId)}static compareByTargetId(a,b){return i6(a.targetOrBatchId,b.targetOrBatchId)||ji.comparator(a.key,b.key)}}class sP{constructor(a,b){this.indexManager=a,this.referenceDelegate=b,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new lu(sO.compareByKey)}checkEmpty(a){return jP.resolve(0===this.mutationQueue.length)}addMutationBatch(a,b,c,d){let e=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let f=new oT(e,b,c,d);for(let b of(this.mutationQueue.push(f),d))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new sO(b.key,e)),this.indexManager.addToCollectionParentIndex(a,b.key.path.popLast());return jP.resolve(f)}lookupMutationBatch(a,b){return jP.resolve(this.findMutationBatch(b))}getNextMutationBatchAfterBatchId(a,b){let c=b+1,d=this.indexOfBatchId(c),e=d<0?0:d;return jP.resolve(this.mutationQueue.length>e?this.mutationQueue[e]:null)}getHighestUnacknowledgedBatchId(){return jP.resolve(0===this.mutationQueue.length?lU:this.nextBatchId-1)}getAllMutationBatches(a){return jP.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(a,b){let c=new sO(b,0),d=new sO(b,1/0),e=[];return this.batchesByDocumentKey.forEachInRange([c,d],a=>{let b=this.findMutationBatch(a.targetOrBatchId);e.push(b)}),jP.resolve(e)}getAllMutationBatchesAffectingDocumentKeys(a,b){let c=new lu(i6);return b.forEach(a=>{let b=new sO(a,0),d=new sO(a,1/0);this.batchesByDocumentKey.forEachInRange([b,d],a=>{c=c.add(a.targetOrBatchId)})}),jP.resolve(this.findMutationBatches(c))}getAllMutationBatchesAffectingQuery(a,b){let c=b.path,d=c.length+1,e=c;ji.isDocumentKey(e)||(e=e.child(""));let f=new sO(new ji(e),0),g=new lu(i6);return this.batchesByDocumentKey.forEachWhile(a=>{let b=a.key.path;return!!c.isPrefixOf(b)&&(b.length===d&&(g=g.add(a.targetOrBatchId)),!0)},f),jP.resolve(this.findMutationBatches(g))}findMutationBatches(a){let b=[];return a.forEach(a=>{let c=this.findMutationBatch(a);null!==c&&b.push(c)}),b}removeMutationBatch(a,b){iC(0===this.indexOfExistingBatchId(b.batchId,"removed"),55003),this.mutationQueue.shift();let c=this.batchesByDocumentKey;return jP.forEach(b.mutations,d=>{let e=new sO(d.key,b.batchId);return c=c.delete(e),this.referenceDelegate.markPotentiallyOrphaned(a,d.key)}).next(()=>{this.batchesByDocumentKey=c})}removeCachedMutationKeys(a){}containsKey(a,b){let c=new sO(b,0),d=this.batchesByDocumentKey.firstAfterOrEqual(c);return jP.resolve(b.isEqual(d&&d.key))}performConsistencyCheck(a){return this.mutationQueue.length,jP.resolve()}indexOfExistingBatchId(a,b){return this.indexOfBatchId(a)}indexOfBatchId(a){return 0===this.mutationQueue.length?0:a-this.mutationQueue[0].batchId}findMutationBatch(a){let b=this.indexOfBatchId(a);return b<0||b>=this.mutationQueue.length?null:this.mutationQueue[b]}}let sQ="-9223372036854775808";function sR(){return new lq(ji.comparator)}class sS{constructor(a){this.sizer=a,this.docs=sR(),this.size=0}setIndexManager(a){this.indexManager=a}addEntry(a,b){let c=b.key,d=this.docs.get(c),e=d?d.size:0,f=this.sizer(b);return this.docs=this.docs.insert(c,{document:b.mutableCopy(),size:f}),this.size+=f-e,this.indexManager.addToCollectionParentIndex(a,c.path.popLast())}removeEntry(a){let b=this.docs.get(a);b&&(this.docs=this.docs.remove(a),this.size-=b.size)}getEntry(a,b){let c=this.docs.get(b);return jP.resolve(c?c.document.mutableCopy():mM.newInvalidDocument(b))}getEntries(a,b){let c=n_();return b.forEach(a=>{let b=this.docs.get(a);c=c.insert(a,b?b.document.mutableCopy():mM.newInvalidDocument(a))}),jP.resolve(c)}getDocumentsMatchingQuery(a,b,c,d){let e=n_(),f=b.path,g=new ji(f.child("__id"+sQ+"__")),h=this.docs.getIteratorFrom(g);for(;h.hasNext();){let{key:a,value:{document:g}}=h.getNext();if(!f.isPrefixOf(a.path))break;!(a.path.length>f.length+1||0>=jL(jJ(g),c))&&(d.has(g.key)||nR(b,g))&&(e=e.insert(g.key,g.mutableCopy()))}return jP.resolve(e)}getAllFromCollectionGroup(a,b,c,d){iA(9500)}forEachDocumentKey(a,b){return jP.forEach(this.docs,a=>b(a))}newChangeBuffer(a){return new sU(this)}getSize(a){return jP.resolve(this.size)}}function sT(a){return new sS(a)}class sU extends sx{constructor(a){super(),this.documentCache=a}applyChanges(a){let b=[];return this.changes.forEach((c,d)=>{d.isValidDocument()?b.push(this.documentCache.addEntry(a,d)):this.documentCache.removeEntry(c)}),jP.waitFor(b)}getFromCache(a,b){return this.documentCache.getEntry(a,b)}getAllFromCache(a,b){return this.documentCache.getEntries(a,b)}}class sV{constructor(a){this.persistence=a,this.targets=new nZ(a=>nk(a),nm),this.lastRemoteSnapshotVersion=jw.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new sN,this.targetCount=0,this.targetIdGenerator=sb.forTargetCache()}forEachTarget(a,b){return this.targets.forEach((a,c)=>b(c)),jP.resolve()}getLastRemoteSnapshotVersion(a){return jP.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(a){return jP.resolve(this.highestSequenceNumber)}allocateTargetId(a){return this.highestTargetId=this.targetIdGenerator.next(),jP.resolve(this.highestTargetId)}setTargetsMetadata(a,b,c){return c&&(this.lastRemoteSnapshotVersion=c),b>this.highestSequenceNumber&&(this.highestSequenceNumber=b),jP.resolve()}saveTargetData(a){this.targets.set(a.target,a);let b=a.targetId;b>this.highestTargetId&&(this.targetIdGenerator=new sb(b),this.highestTargetId=b),a.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=a.sequenceNumber)}addTargetData(a,b){return this.saveTargetData(b),this.targetCount+=1,jP.resolve()}updateTargetData(a,b){return this.saveTargetData(b),jP.resolve()}removeTargetData(a,b){return this.targets.delete(b.target),this.references.removeReferencesForId(b.targetId),this.targetCount-=1,jP.resolve()}removeTargets(a,b,c){let d=0,e=[];return this.targets.forEach((f,g)=>{g.sequenceNumber<=b&&null===c.get(g.targetId)&&(this.targets.delete(f),e.push(this.removeMatchingKeysForTargetId(a,g.targetId)),d++)}),jP.waitFor(e).next(()=>d)}getTargetCount(a){return jP.resolve(this.targetCount)}getTargetData(a,b){let c=this.targets.get(b)||null;return jP.resolve(c)}addMatchingKeys(a,b,c){return this.references.addReferences(b,c),jP.resolve()}removeMatchingKeys(a,b,c){this.references.removeReferences(b,c);let d=this.persistence.referenceDelegate,e=[];return d&&b.forEach(b=>{e.push(d.markPotentiallyOrphaned(a,b))}),jP.waitFor(e)}removeMatchingKeysForTargetId(a,b){return this.references.removeReferencesForId(b),jP.resolve()}getMatchingKeysForTargetId(a,b){let c=this.references.referencesForId(b);return jP.resolve(c)}containsKey(a,b){return jP.resolve(this.references.containsKey(b))}}let sW="MemoryPersistence";class sX{constructor(a,b){this.mutationQueues={},this.overlays={},this.listenSequence=new j6(0),this._started=!1,this._started=!0,this.globalsCache=new sM,this.referenceDelegate=a(this),this.targetCache=new sV(this);const c=a=>this.referenceDelegate.documentSize(a);this.indexManager=new rU,this.remoteDocumentCache=sT(c),this.serializer=new qz(b),this.bundleCache=new sK(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(a){return this.indexManager}getDocumentOverlayCache(a){let b=this.overlays[a.toKey()];return b||(b=new sL,this.overlays[a.toKey()]=b),b}getMutationQueue(a,b){let c=this.mutationQueues[a.toKey()];return c||(c=new sP(b,this.referenceDelegate),this.mutationQueues[a.toKey()]=c),c}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(a,b,c){iw(sW,"Starting transaction:",a);let d=new sY(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),c(d).next(a=>this.referenceDelegate.onTransactionCommitted(d).next(()=>a)).toPromise().then(a=>(d.raiseOnCommittedEvent(),a))}mutationQueuesContainKey(a,b){return jP.or(Object.values(this.mutationQueues).map(c=>()=>c.containsKey(a,b)))}}class sY extends jN{constructor(a){super(),this.currentSequenceNumber=a}}class sZ{constructor(a){this.persistence=a,this.localViewReferences=new sN,this._orphanedDocuments=null}static factory(a){return new sZ(a)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw iA(60996)}addReference(a,b,c){return this.localViewReferences.addReference(c,b),this.orphanedDocuments.delete(c.toString()),jP.resolve()}removeReference(a,b,c){return this.localViewReferences.removeReference(c,b),this.orphanedDocuments.add(c.toString()),jP.resolve()}markPotentiallyOrphaned(a,b){return this.orphanedDocuments.add(b.toString()),jP.resolve()}removeTarget(a,b){this.localViewReferences.removeReferencesForId(b.targetId).forEach(a=>this.orphanedDocuments.add(a.toString()));let c=this.persistence.getTargetCache();return c.getMatchingKeysForTargetId(a,b.targetId).next(a=>{a.forEach(a=>this.orphanedDocuments.add(a.toString()))}).next(()=>c.removeTargetData(a,b))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(a){let b=this.persistence.getRemoteDocumentCache().newChangeBuffer();return jP.forEach(this.orphanedDocuments,c=>{let d=ji.fromPath(c);return this.isReferenced(a,d).next(a=>{a||b.removeEntry(d,jw.min())})}).next(()=>(this._orphanedDocuments=null,b.apply(a)))}updateLimboDocument(a,b){return this.isReferenced(a,b).next(a=>{a?this.orphanedDocuments.delete(b.toString()):this.orphanedDocuments.add(b.toString())})}documentSize(a){return 0}isReferenced(a,b){return jP.or([()=>jP.resolve(this.localViewReferences.containsKey(b)),()=>this.persistence.getTargetCache().containsKey(a,b),()=>this.persistence.mutationQueuesContainKey(a,b)])}}class s${constructor(a,b){this.persistence=a,this.orphanedSequenceNumbers=new nZ(a=>kb(a.path),(a,b)=>a.isEqual(b)),this.garbageCollector=ss(this,b)}static factory(a,b){return new s$(a,b)}onTransactionStarted(){}onTransactionCommitted(a){return jP.resolve()}forEachTarget(a,b){return this.persistence.getTargetCache().forEachTarget(a,b)}getSequenceNumberCount(a){let b=this.orphanedDocumentCount(a);return this.persistence.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}orphanedDocumentCount(a){let b=0;return this.forEachOrphanedDocumentSequenceNumber(a,a=>{b++}).next(()=>b)}forEachOrphanedDocumentSequenceNumber(a,b){return jP.forEach(this.orphanedSequenceNumbers,(c,d)=>this.isPinned(a,c,d).next(a=>a?jP.resolve():b(d)))}removeTargets(a,b,c){return this.persistence.getTargetCache().removeTargets(a,b,c)}removeOrphanedDocuments(a,b){let c=0,d=this.persistence.getRemoteDocumentCache(),e=d.newChangeBuffer();return d.forEachDocumentKey(a,d=>this.isPinned(a,d,b).next(a=>{a||(c++,e.removeEntry(d,jw.min()))})).next(()=>e.apply(a)).next(()=>c)}markPotentiallyOrphaned(a,b){return this.orphanedSequenceNumbers.set(b,a.currentSequenceNumber),jP.resolve()}removeTarget(a,b){let c=b.withSequenceNumber(a.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(a,c)}addReference(a,b,c){return this.orphanedSequenceNumbers.set(c,a.currentSequenceNumber),jP.resolve()}removeReference(a,b,c){return this.orphanedSequenceNumbers.set(c,a.currentSequenceNumber),jP.resolve()}updateLimboDocument(a,b){return this.orphanedSequenceNumbers.set(b,a.currentSequenceNumber),jP.resolve()}documentSize(a){let b=a.key.toString().length;return a.isFoundDocument()&&(b+=mr(a.data.value)),b}isPinned(a,b,c){return jP.or([()=>this.persistence.mutationQueuesContainKey(a,b),()=>this.persistence.getTargetCache().containsKey(a,b),()=>{let a=this.orphanedSequenceNumbers.get(b);return jP.resolve(void 0!==a&&a>c)}])}getCacheSize(a){return this.persistence.getRemoteDocumentCache().getSize(a)}}class s_{constructor(a){this.serializer=a}createOrUpgrade(a,b,c,d){let e=new jS("createOrUpgrade",b);c<1&&d>=1&&(s1(a),s2(a),s7(a),s4(a));let f=jP.resolve();return c<3&&d>=3&&(0!==c&&(s8(a),s7(a)),f=f.next(()=>ta(e))),c<4&&d>=4&&(0!==c&&(f=f.next(()=>s3(a,e))),f=f.next(()=>{tb(a)})),c<5&&d>=5&&(f=f.next(()=>this.removeAcknowledgedMutations(e))),c<6&&d>=6&&(f=f.next(()=>(s6(a),this.addDocumentGlobal(e)))),c<7&&d>=7&&(f=f.next(()=>this.ensureSequenceNumbers(e))),c<8&&d>=8&&(f=f.next(()=>this.createCollectionParentIndex(a,e))),c<9&&d>=9&&(f=f.next(()=>{s9(a)})),c<10&&d>=10&&(f=f.next(()=>this.rewriteCanonicalIds(e))),c<11&&d>=11&&(f=f.next(()=>{tc(a),td(a)})),c<12&&d>=12&&(f=f.next(()=>{tf(a)})),c<13&&d>=13&&(f=f.next(()=>s5(a)).next(()=>this.rewriteRemoteDocumentCache(a,e)).next(()=>a.deleteObjectStore(kf))),c<14&&d>=14&&(f=f.next(()=>this.runOverlayMigration(a,e))),c<15&&d>=15&&(f=f.next(()=>te(a))),c<16&&d>=16&&(f=f.next(()=>{b.objectStore(kX).clear()}).next(()=>{b.objectStore(k_).clear()})),c<17&&d>=17&&(f=f.next(()=>{tg(a)})),c<18&&d>=18&&ad()&&(f=f.next(()=>{b.objectStore(kX).clear()}).next(()=>{b.objectStore(k_).clear()})),f}addDocumentGlobal(a){let b=0;return a.store(kf).iterate((a,c)=>{b+=r3(c)}).next(()=>{let c={byteSize:b};return a.store(kz).put(kA,c)})}removeAcknowledgedMutations(a){let b=a.store(ki),c=a.store(kk);return b.loadAll().next(b=>jP.forEach(b,b=>{let d=IDBKeyRange.bound([b.userId,lU],[b.userId,b.lastAcknowledgedBatchId]);return c.loadAll(km,d).next(c=>jP.forEach(c,c=>{iC(c.userId===b.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});let d=qH(this.serializer,c);return r2(a,b.userId,d).next(()=>{})}))}))}ensureSequenceNumbers(a){let b=a.store(kF),c=a.store(kf);return a.store(kK).get(kJ).next(a=>{let d=c=>b.put({targetId:0,path:kb(c),sequenceNumber:a.highestListenSequenceNumber}),e=[];return c.iterate((a,c)=>{let f=new jf(a),g=s0(f);e.push(b.get(g).next(a=>a?jP.resolve():d(f)))}).next(()=>jP.waitFor(e))})}createCollectionParentIndex(a,b){a.createObjectStore(kL,{keyPath:kM});let c=b.store(kL),d=new rV,e=a=>{if(d.add(a)){let b=a.lastSegment(),d=a.popLast();return c.put({collectionId:b,parent:kb(d)})}};return b.store(kf).iterate({keysOnly:!0},(a,b)=>e(new jf(a).popLast())).next(()=>b.store(ks).iterate({keysOnly:!0},([a,b,c],d)=>e(ke(b).popLast())))}rewriteCanonicalIds(a){let b=a.store(kB);return b.iterate((a,c)=>{let d=qI(c),e=qJ(this.serializer,d);return b.put(e)})}rewriteRemoteDocumentCache(a,b){let c=b.store(kf),d=[];return c.iterate((a,c)=>{let e=b.store(kt),f=th(c).path.toArray(),g={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:c.readTime||[0,0],unknownDocument:c.unknownDocument,noDocument:c.noDocument,document:c.document,hasCommittedMutations:!!c.hasCommittedMutations};d.push(e.put(g))}).next(()=>jP.waitFor(d))}runOverlayMigration(a,b){let c=b.store(kk),d=sz(this.serializer),e=new sX(sZ.factory,this.serializer.remoteSerializer);return c.loadAll().next(a=>{let c=new Map;return a.forEach(a=>{let b=c.get(a.userId)??oa();qH(this.serializer,a).keys().forEach(a=>b=b.add(a)),c.set(a.userId,b)}),jP.forEach(c,(a,c)=>{let f=new iq(c),g=q_.forUser(this.serializer,f),h=e.getIndexManager(f);return new sJ(d,r4.forUser(f,this.serializer,h,e.referenceDelegate),g,h).recalculateAndSaveOverlaysForDocumentKeys(new lk(b,j6.INVALID),a).next()})})}}function s0(a){return[0,kb(a)]}function s1(a){a.createObjectStore(kg)}function s2(a){a.createObjectStore(ki,{keyPath:kj}),a.createObjectStore(kk,{keyPath:kl,autoIncrement:!0}).createIndex(km,kn,{unique:!0}),a.createObjectStore(ks)}function s3(a,b){return b.store(kk).loadAll().next(c=>{a.deleteObjectStore(kk),a.createObjectStore(kk,{keyPath:kl,autoIncrement:!0}).createIndex(km,kn,{unique:!0});let d=b.store(kk),e=c.map(a=>d.put(a));return jP.waitFor(e)})}function s4(a){a.createObjectStore(kf)}function s5(a){let b=a.createObjectStore(kt,{keyPath:ku});b.createIndex(kv,kw),b.createIndex(kx,ky)}function s6(a){a.createObjectStore(kz)}function s7(a){a.createObjectStore(kF,{keyPath:kG}).createIndex(kH,kI,{unique:!0}),a.createObjectStore(kB,{keyPath:kC}).createIndex(kD,kE,{unique:!0}),a.createObjectStore(kK)}function s8(a){a.deleteObjectStore(kF),a.deleteObjectStore(kB),a.deleteObjectStore(kK)}function s9(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}function ta(a){let b=a.store(kK),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:jw.min().toTimestamp(),targetCount:0};return b.put(kJ,c)}function tb(a){a.createObjectStore(kN,{keyPath:kO})}function tc(a){a.createObjectStore(kP,{keyPath:kQ})}function td(a){a.createObjectStore(kR,{keyPath:kS})}function te(a){a.createObjectStore(kT,{keyPath:kU,autoIncrement:!0}).createIndex(kV,kW,{unique:!1}),a.createObjectStore(kX,{keyPath:kY}).createIndex(kZ,k$,{unique:!1}),a.createObjectStore(k_,{keyPath:k0}).createIndex(k1,k2,{unique:!1})}function tf(a){let b=a.createObjectStore(k3,{keyPath:k4});b.createIndex(k5,k6,{unique:!1}),b.createIndex(k7,k8,{unique:!1})}function tg(a){a.createObjectStore(k9,{keyPath:la})}function th(a){return a.document?new ji(jf.fromString(a.document.name).popFirst(5)):a.noDocument?ji.fromSegments(a.noDocument.path):a.unknownDocument?ji.fromSegments(a.unknownDocument.path):iA(36783)}let ti="IndexedDbPersistence",tj=18e5,tk=5e3,tl=4e3,tm="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",tn="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",to="firestore_zombie",tp="main";class tq{constructor(a,b,c,d,e,f,g,h,i,j,k=sH){if(this.allowTabSynchronization=a,this.persistenceKey=b,this.clientId=c,this.queue=e,this.window=f,this.document=g,this.sequenceNumberSyncer=i,this.forceOwningTab=j,this.schemaVersion=k,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=-1/0,this.primaryStateListener=a=>Promise.resolve(),!tq.isAvailable())throw new iV(iR,tn);this.referenceDelegate=new st(this,d),this.dbName=b+tp,this.serializer=new qz(h),this.simpleDb=new jT(this.dbName,this.schemaVersion,new s_(this.serializer)),this.globalsCache=new q1,this.targetCache=new sc(this.referenceDelegate,this.serializer),this.remoteDocumentCache=sz(this.serializer),this.bundleCache=new qY,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===j&&ix(ti,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new iV(iO,tm);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",a=>this.targetCache.getHighestSequenceNumber(a))}).then(a=>{this.listenSequence=new j6(a,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(a=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(a)))}setPrimaryStateListener(a){return this.primaryStateListener=async b=>{if(this.started)return a(b)},a(this.isPrimary)}setDatabaseDeletedListener(a){this.simpleDb.setVersionChangeListener(async b=>{null===b.newVersion&&await a()})}setNetworkEnabled(a){this.networkEnabled!==a&&(this.networkEnabled=a,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",a=>ts(a).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(a).next(a=>{a||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(a)).next(b=>this.isPrimary&&!b?this.releasePrimaryLeaseIfHeld(a).next(()=>!1):!!b&&this.acquireOrExtendPrimaryLease(a).next(()=>!0))).catch(a=>{if(jX(a))return iw(ti,"Failed to extend owner lease: ",a),this.isPrimary;if(!this.allowTabSynchronization)throw a;return iw(ti,"Releasing owner lease after error during lease refresh",a),!1}).then(a=>{this.isPrimary!==a&&this.queue.enqueueRetryable(()=>this.primaryStateListener(a)),this.isPrimary=a})}verifyPrimaryLease(a){return tr(a).get(kh).next(a=>jP.resolve(this.isLocalClient(a)))}removeClientMetadata(a){return ts(a).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,tj)){this.lastGarbageCollectionTime=Date.now();let a=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",a=>{let b=ll(a,kN);return b.loadAll().next(a=>{let c=this.filterActiveClients(a,tj),d=a.filter(a=>-1===c.indexOf(a));return jP.forEach(d,a=>b.delete(a.clientId)).next(()=>d)})}).catch(()=>[]);if(this.webStorage)for(let b of a)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(b.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",tl,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(a){return!!a&&a.ownerId===this.clientId}canActAsPrimary(a){return this.forceOwningTab?jP.resolve(!0):tr(a).get(kh).next(b=>{if(null!==b&&this.isWithinAge(b.leaseTimestampMs,tk)&&!this.isClientZombied(b.ownerId)){if(this.isLocalClient(b)&&this.networkEnabled)return!0;if(!this.isLocalClient(b)){if(!b.allowTabSynchronization)throw new iV(iO,tm);return!1}}return!!this.networkEnabled&&!!this.inForeground||ts(a).loadAll().next(a=>void 0===this.filterActiveClients(a,tk).find(a=>{if(this.clientId!==a.clientId){let b=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,d=this.networkEnabled===a.networkEnabled;if(b||c&&d)return!0}return!1}))}).next(a=>(this.isPrimary!==a&&iw(ti,`Client ${a?"is":"is not"} eligible for a primary lease.`),a))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[kg,kN],a=>{let b=new lk(a,j6.INVALID);return this.releasePrimaryLeaseIfHeld(b).next(()=>this.removeClientMetadata(b))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(a,b){return a.filter(a=>this.isWithinAge(a.updateTimeMs,b)&&!this.isClientZombied(a.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",a=>ts(a).loadAll().next(a=>this.filterActiveClients(a,tj).map(a=>a.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(a,b){return r4.forUser(a,this.serializer,b,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(a){return new rY(a,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(a){return q_.forUser(this.serializer,a)}getBundleCache(){return this.bundleCache}runTransaction(a,b,c){let d;iw(ti,"Starting transaction:",a);let e="readonly"===b?"readonly":"readwrite",f=lj(this.schemaVersion);return this.simpleDb.runTransaction(a,e,f,e=>(d=new lk(e,this.listenSequence?this.listenSequence.next():j6.INVALID),"readwrite-primary"===b)?this.verifyPrimaryLease(d).next(a=>!!a||this.canActAsPrimary(d)).next(b=>{if(!b)throw ix(`Failed to obtain primary lease for action '${a}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new iV(iO,jM);return c(d)}).next(a=>this.acquireOrExtendPrimaryLease(d).next(()=>a)):this.verifyAllowTabSynchronization(d).next(()=>c(d))).then(a=>(d.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(a){return tr(a).get(kh).next(a=>{if(null!==a&&this.isWithinAge(a.leaseTimestampMs,tk)&&!this.isClientZombied(a.ownerId)&&!this.isLocalClient(a)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!a.allowTabSynchronization))throw new iV(iO,tm)})}acquireOrExtendPrimaryLease(a){let b={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return tr(a).put(kh,b)}static isAvailable(){return jT.isAvailable()}releasePrimaryLeaseIfHeld(a){let b=tr(a);return b.get(kh).next(a=>this.isLocalClient(a)?(iw(ti,"Releasing primary lease."),b.delete(kh)):jP.resolve())}isWithinAge(a,b){let c=Date.now(),d=c-b,e=c;return!(a<d)&&(!(a>e)||(ix(`Detected an update time that is in the future: ${a} > ${e}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){"function"==typeof this.window?.addEventListener&&(this.windowUnloadHandler=()=>{this.markClientZombied();let a=/(?:Version|Mobile)\/1[456]/;ac()&&(navigator.appVersion.match(a)||navigator.userAgent.match(a))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(a){try{let b=this.webStorage?.getItem(this.zombiedClientLocalStorageKey(a))!==null;return iw(ti,`Client '${a}' ${b?"is":"is not"} zombied in LocalStorage`),b}catch(a){return ix(ti,"Failed to get zombied client id.",a),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(a){ix("Failed to set zombie client id.",a)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(a){}}zombiedClientLocalStorageKey(a){return`${to}_${this.persistenceKey}_${a}`}}function tr(a){return ll(a,kg)}function ts(a){return ll(a,kN)}function tt(a,b){let c=a.projectId;return a.isDefaultDatabase||(c+="."+a.database),"firestore/"+b+"/"+c+"/"}function tu(a,b,c,d,e){b=[...b],(a=[...a]).sort(c),b.sort(c);let f=a.length,g=b.length,h=0,i=0;for(;h<g&&i<f;){let f=c(a[i],b[h]);f<0?e(a[i++]):f>0?d(b[h++]):(h++,i++)}for(;h<g;)d(b[h++]);for(;i<f;)e(a[i++])}function tv(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}let tw="LocalStore",tx=3e8;class ty{constructor(a,b,c,d){this.persistence=a,this.queryEngine=b,this.serializer=d,this.targetDataByTarget=new lq(i6),this.targetIdByTarget=new nZ(a=>nk(a),nm),this.collectionGroupReadTime=new Map,this.remoteDocuments=a.getRemoteDocumentCache(),this.targetCache=a.getTargetCache(),this.bundleCache=a.getBundleCache(),this.initializeUserComponents(c)}initializeUserComponents(a){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(a),this.indexManager=this.persistence.getIndexManager(a),this.mutationQueue=this.persistence.getMutationQueue(a,this.indexManager),this.localDocuments=new sJ(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(a){return this.persistence.runTransaction("Collect garbage","readwrite-primary",b=>a.collect(b,this.targetDataByTarget))}}function tz(a,b,c,d){return new ty(a,b,c,d)}async function tA(a,b){let c=iD(a);return await c.persistence.runTransaction("Handle user change","readonly",a=>{let d;return c.mutationQueue.getAllMutationBatches(a).next(e=>(d=e,c.initializeUserComponents(b),c.mutationQueue.getAllMutationBatches(a))).next(b=>{let e=[],f=[],g=oa();for(let a of d)for(let b of(e.push(a.batchId),a.mutations))g=g.add(b.key);for(let a of b)for(let b of(f.push(a.batchId),a.mutations))g=g.add(b.key);return c.localDocuments.getDocuments(a,g).next(a=>({affectedDocuments:a,removedBatchIds:e,addedBatchIds:f}))})})}function tB(a,b){let c,d,e=iD(a),f=jv.now(),g=b.reduce((a,b)=>a.add(b.key),oa());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let h=n_(),i=oa();return e.remoteDocuments.getEntries(a,g).next(a=>{(h=a).forEach((a,b)=>{b.isValidDocument()||(i=i.add(a))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,h)).next(d=>{c=d;let g=[];for(let a of b){let b=oE(a,c.get(a.key).overlayedDocument);null!=b&&g.push(new oJ(a.key,b,mL(b.value.mapValue),oy.exists(!0)))}return e.mutationQueue.addMutationBatch(a,f,g,b)}).next(b=>{d=b;let f=b.applyToLocalDocumentSet(c,i);return e.documentOverlayCache.saveOverlays(a,b.batchId,f)})}).then(()=>({batchId:d.batchId,changes:n3(c)}))}function tC(a,b){let c=iD(a);return c.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{let d=b.batch.keys(),e=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});return tQ(c,a,b,e).next(()=>e.apply(a)).next(()=>c.mutationQueue.performConsistencyCheck(a)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(a,d,b.batch.batchId)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,tD(b))).next(()=>c.localDocuments.getDocuments(a,d))})}function tD(a){let b=oa();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(b=b.add(a.batch.mutations[c].key));return b}function tE(a,b){let c=iD(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",a=>{let d;return c.mutationQueue.lookupMutationBatch(a,b).next(b=>(iC(null!==b,37113),d=b.keys(),c.mutationQueue.removeMutationBatch(a,b))).next(()=>c.mutationQueue.performConsistencyCheck(a)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(a,d,b)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,d)).next(()=>c.localDocuments.getDocuments(a,d))})}function tF(a){let b=iD(a);return b.persistence.runTransaction("Get last remote snapshot version","readonly",a=>b.targetCache.getLastRemoteSnapshotVersion(a))}function tG(a,b){let c=iD(a),d=b.snapshotVersion,e=c.targetDataByTarget;return c.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{let f=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});e=c.targetDataByTarget;let g=[];b.targetChanges.forEach((f,h)=>{let i=e.get(h);if(!i)return;g.push(c.targetCache.removeMatchingKeys(a,f.removedDocuments,h).next(()=>c.targetCache.addMatchingKeys(a,f.addedDocuments,h)));let j=i.withSequenceNumber(a.currentSequenceNumber);null!==b.targetMismatches.get(h)?j=j.withResumeToken(lB.EMPTY_BYTE_STRING,jw.min()).withLastLimboFreeSnapshotVersion(jw.min()):f.resumeToken.approximateByteSize()>0&&(j=j.withResumeToken(f.resumeToken,d)),e=e.insert(h,j),tI(i,j,f)&&g.push(c.targetCache.updateTargetData(a,j))});let h=n_(),i=oa();if(b.documentUpdates.forEach(d=>{b.resolvedLimboDocuments.has(d)&&g.push(c.persistence.referenceDelegate.updateLimboDocument(a,d))}),g.push(tH(a,f,b.documentUpdates).next(a=>{h=a.changedDocuments,i=a.existenceChangedKeys})),!d.isEqual(jw.min())){let b=c.targetCache.getLastRemoteSnapshotVersion(a).next(b=>c.targetCache.setTargetsMetadata(a,a.currentSequenceNumber,d));g.push(b)}return jP.waitFor(g).next(()=>f.apply(a)).next(()=>c.localDocuments.getLocalViewOfDocuments(a,h,i)).next(()=>h)}).then(a=>(c.targetDataByTarget=e,a))}function tH(a,b,c){let d=oa(),e=oa();return c.forEach(a=>d=d.add(a)),b.getEntries(a,d).next(a=>{let d=n_();return c.forEach((c,f)=>{let g=a.get(c);f.isFoundDocument()!==g.isFoundDocument()&&(e=e.add(c)),f.isNoDocument()&&f.version.isEqual(jw.min())?(b.removeEntry(c,f.readTime),d=d.insert(c,f)):!g.isValidDocument()||f.version.compareTo(g.version)>0||0===f.version.compareTo(g.version)&&g.hasPendingWrites?(b.addEntry(f),d=d.insert(c,f)):iw(tw,"Ignoring outdated watch update for ",c,". Current version:",g.version," Watch version:",f.version)}),{changedDocuments:d,existenceChangedKeys:e}})}function tI(a,b,c){return!!(0===a.resumeToken.approximateByteSize()||b.snapshotVersion.toMicroseconds()-a.snapshotVersion.toMicroseconds()>=tx)||c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size>0}async function tJ(a,b){let c=iD(a);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",a=>jP.forEach(b,b=>jP.forEach(b.addedKeys,d=>c.persistence.referenceDelegate.addReference(a,b.targetId,d)).next(()=>jP.forEach(b.removedKeys,d=>c.persistence.referenceDelegate.removeReference(a,b.targetId,d)))))}catch(a){if(jX(a))iw(tw,"Failed to update sequence numbers: "+a);else throw a}for(let a of b){let b=a.targetId;if(!a.fromCache){let a=c.targetDataByTarget.get(b),d=a.snapshotVersion,e=a.withLastLimboFreeSnapshotVersion(d);c.targetDataByTarget=c.targetDataByTarget.insert(b,e)}}}function tK(a,b){let c=iD(a);return c.persistence.runTransaction("Get next mutation batch","readonly",a=>(void 0===b&&(b=lU),c.mutationQueue.getNextMutationBatchAfterBatchId(a,b)))}function tL(a,b){let c=iD(a);return c.persistence.runTransaction("read document","readonly",a=>c.localDocuments.getDocument(a,b))}function tM(a,b){let c=iD(a);return c.persistence.runTransaction("Allocate target","readwrite",a=>{let d;return c.targetCache.getTargetData(a,b).next(e=>e?(d=e,jP.resolve(d)):c.targetCache.allocateTargetId(a).next(e=>(d=new qy(b,e,"TargetPurposeListen",a.currentSequenceNumber),c.targetCache.addTargetData(a,d).next(()=>d))))}).then(a=>{let d=c.targetDataByTarget.get(a.targetId);return(null===d||a.snapshotVersion.compareTo(d.snapshotVersion)>0)&&(c.targetDataByTarget=c.targetDataByTarget.insert(a.targetId,a),c.targetIdByTarget.set(b,a.targetId)),a})}function tN(a,b,c){let d=iD(a),e=d.targetIdByTarget.get(c);return void 0!==e?jP.resolve(d.targetDataByTarget.get(e)):d.targetCache.getTargetData(b,c)}async function tO(a,b,c){let d=iD(a),e=d.targetDataByTarget.get(b),f=c?"readwrite":"readwrite-primary";try{c||await d.persistence.runTransaction("Release target",f,a=>d.persistence.referenceDelegate.removeTarget(a,e))}catch(a){if(jX(a))iw(tw,`Failed to update sequence numbers for target ${b}: ${a}`);else throw a}d.targetDataByTarget=d.targetDataByTarget.remove(b),d.targetIdByTarget.delete(e.target)}function tP(a,b,c){let d=iD(a),e=jw.min(),f=oa();return d.persistence.runTransaction("Execute query","readwrite",a=>tN(d,a,nG(b)).next(b=>{if(b)return e=b.lastLimboFreeSnapshotVersion,d.targetCache.getMatchingKeysForTargetId(a,b.targetId).next(a=>{f=a})}).next(()=>d.queryEngine.getDocumentsMatchingQuery(a,b,c?e:jw.min(),c?f:oa())).next(a=>(tW(d,nW(b),a),{documents:a,remoteKeys:f})))}function tQ(a,b,c,d){let e=c.batch,f=e.keys(),g=jP.resolve();return f.forEach(a=>{g=g.next(()=>d.getEntry(b,a)).next(b=>{let f=c.docVersions.get(a);iC(null!==f,48541),0>b.version.compareTo(f)&&(e.applyToRemoteDocument(b,c),b.isValidDocument()&&(b.setReadTime(c.commitVersion),d.addEntry(b)))})}),g.next(()=>a.mutationQueue.removeMutationBatch(b,e))}function tR(a,b){let c=iD(a),d=iD(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",a=>d.lookupMutationKeys(a,b).next(b=>b?c.localDocuments.getDocuments(a,b):jP.resolve(null)))}function tS(a,b){iD(iD(a,ty).mutationQueue).removeCachedMutationKeys(b)}function tT(a){return iD(iD(a,ty).persistence).getActiveClients()}function tU(a,b){let c=iD(a),d=iD(c.targetCache),e=c.targetDataByTarget.get(b);return e?Promise.resolve(e.target):c.persistence.runTransaction("Get target data","readonly",a=>d.getTargetDataForTarget(a,b).next(a=>a?a.target:null))}function tV(a,b){let c=iD(a),d=c.collectionGroupReadTime.get(b)||jw.min();return c.persistence.runTransaction("Get new document changes","readonly",a=>c.remoteDocuments.getAllFromCollectionGroup(a,b,jI(d,jx),Number.MAX_SAFE_INTEGER)).then(a=>(tW(c,b,a),a))}function tW(a,b,c){let d=a.collectionGroupReadTime.get(b)||jw.min();c.forEach((a,b)=>{b.readTime.compareTo(d)>0&&(d=b.readTime)}),a.collectionGroupReadTime.set(b,d)}function tX(a){return nG(nz(jf.fromString(`__bundle__/docs/${a}`)))}async function tY(a,b,c,d){let e=iD(a),f=oa(),g=n_();for(let a of c){let c=b.toDocumentKey(a.metadata.name);a.document&&(f=f.add(c));let d=b.toMutableDocument(a);d.setReadTime(b.toSnapshotVersion(a.metadata.readTime)),g=g.insert(c,d)}let h=e.remoteDocuments.newChangeBuffer({trackRemovals:!0}),i=await tM(e,tX(d));return e.persistence.runTransaction("Apply bundle documents","readwrite",a=>tH(a,h,g).next(b=>(h.apply(a),b)).next(b=>e.targetCache.removeMatchingKeysForTargetId(a,i.targetId).next(()=>e.targetCache.addMatchingKeys(a,f,i.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(a,b.changedDocuments,b.existenceChangedKeys)).next(()=>b.changedDocuments)))}function tZ(a,b){let c=iD(a),d=pw(b.createTime);return c.persistence.runTransaction("hasNewerBundle","readonly",a=>c.bundleCache.getBundleMetadata(a,b.id)).then(a=>!!a&&a.createTime.compareTo(d)>=0)}function t$(a,b){let c=iD(a);return c.persistence.runTransaction("Save bundle","readwrite",a=>c.bundleCache.saveBundleMetadata(a,b))}function t_(a,b){let c=iD(a);return c.persistence.runTransaction("Get named query","readonly",a=>c.bundleCache.getNamedQuery(a,b))}async function t0(a,b,c=oa()){let d=await tM(a,nG(qP(b.bundledQuery))),e=iD(a);return e.persistence.runTransaction("Save named query","readwrite",a=>{let f=pw(b.readTime);if(d.snapshotVersion.compareTo(f)>=0)return e.bundleCache.saveNamedQuery(a,b);let g=d.withResumeToken(lB.EMPTY_BYTE_STRING,f);return e.targetDataByTarget=e.targetDataByTarget.insert(g.targetId,g),e.targetCache.updateTargetData(a,g).next(()=>e.targetCache.removeMatchingKeysForTargetId(a,d.targetId)).next(()=>e.targetCache.addMatchingKeys(a,c,d.targetId)).next(()=>e.bundleCache.saveNamedQuery(a,b))})}async function t1(a,b){let c=iD(a),d=c.indexManager,e=[];return c.persistence.runTransaction("Configure indexes","readwrite",a=>d.getFieldIndexes(a).next(c=>tu(c,b,jD,b=>{e.push(d.addFieldIndex(a,b))},b=>{e.push(d.deleteFieldIndex(a,b))})).next(()=>jP.waitFor(e)))}function t2(a,b){iD(a).queryEngine.indexAutoCreationEnabled=b}function t3(a){let b=iD(a),c=b.indexManager;return b.persistence.runTransaction("Delete All Indexes","readwrite",a=>c.deleteAllFieldIndexes(a))}class t4{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(a){this._documentReadCount+=a}}let t5=100;function t6(){return ac()?8:jU(X())>0?6:4}class t7{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=t5,this.relativeIndexReadCostPerDocument=t6()}initialize(a,b){this.localDocumentsView=a,this.indexManager=b,this.initialized=!0}getDocumentsMatchingQuery(a,b,c,d){let e={result:null};return this.performQueryUsingIndex(a,b).next(a=>{e.result=a}).next(()=>{if(!e.result)return this.performQueryUsingRemoteKeys(a,b,d,c).next(a=>{e.result=a})}).next(()=>{if(e.result)return;let c=new t4;return this.executeFullCollectionScan(a,b,c).next(d=>{if(e.result=d,this.indexAutoCreationEnabled)return this.createCacheIndexes(a,b,c,d.size)})}).next(()=>e.result)}createCacheIndexes(a,b,c,d){return c.documentReadCount<this.indexAutoCreationMinCollectionSize?(iv()<=n.DEBUG&&iw("QueryEngine","SDK will not create cache indexes for query:",nQ(b),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),jP.resolve()):(iv()<=n.DEBUG&&iw("QueryEngine","Query:",nQ(b),"scans",c.documentReadCount,"local documents and returns",d,"documents as results."),c.documentReadCount>this.relativeIndexReadCostPerDocument*d)?(iv()<=n.DEBUG&&iw("QueryEngine","The SDK decides to create cache indexes for query:",nQ(b),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(a,nG(b))):jP.resolve()}performQueryUsingIndex(a,b){if(nB(b))return jP.resolve(null);let c=nG(b);return this.indexManager.getIndexType(a,c).next(d=>0===d?null:(null!==b.limit&&1===d&&(c=nG(b=nL(b,null,"F"))),this.indexManager.getDocumentsMatchingTarget(a,c).next(d=>{let e=oa(...d);return this.localDocumentsView.getDocuments(a,e).next(d=>this.indexManager.getMinOffset(a,c).next(c=>{let f=this.applyQuery(b,d);return this.needsRefill(b,f,e,c.readTime)?this.performQueryUsingIndex(a,nL(b,null,"F")):this.appendRemainingResults(a,f,b,c)}))})))}performQueryUsingRemoteKeys(a,b,c,d){return nB(b)||d.isEqual(jw.min())?jP.resolve(null):this.localDocumentsView.getDocuments(a,c).next(e=>{let f=this.applyQuery(b,e);return this.needsRefill(b,f,c,d)?jP.resolve(null):(iv()<=n.DEBUG&&iw("QueryEngine","Re-using previous result from %s to execute query: %s",d.toString(),nQ(b)),this.appendRemainingResults(a,f,b,jI(d,jx)).next(a=>a))})}applyQuery(a,b){let c=new lu(nX(a));return b.forEach((b,d)=>{nR(a,d)&&(c=c.add(d))}),c}needsRefill(a,b,c,d){if(null===a.limit)return!1;if(c.size!==b.size)return!0;let e="F"===a.limitType?b.last():b.first();return!!e&&(e.hasPendingWrites||e.version.compareTo(d)>0)}executeFullCollectionScan(a,b,c){return iv()<=n.DEBUG&&iw("QueryEngine","Using full collection scan to execute query:",nQ(b)),this.localDocumentsView.getDocumentsMatchingQuery(a,b,jK.min(),c)}appendRemainingResults(a,b,c,d){return this.localDocumentsView.getDocumentsMatchingQuery(a,c,d).next(a=>(b.forEach(b=>{a=a.insert(b.key,b)}),a))}}let t8="firestore_clients";function t9(a,b){return`${t8}_${a}_${b}`}let ua="firestore_mutations";function ub(a,b,c){let d=`${ua}_${a}_${c}`;return b.isAuthenticated()&&(d+=`_${b.uid}`),d}let uc="firestore_targets";function ud(a,b){return`${uc}_${a}_${b}`}let ue="firestore_online_state";function uf(a){return`${ue}_${a}`}let ug="firestore_bundle_loaded_v2";function uh(a){return`${ug}_${a}`}let ui="firestore_sequence_number";function uj(a){return`${ui}_${a}`}let uk="SharedClientState";class ul{constructor(a,b,c,d){this.user=a,this.batchId=b,this.state=c,this.error=d}static fromWebStorageEntry(a,b,c){let d,e=JSON.parse(c),f="object"==typeof e&&-1!==["pending","acknowledged","rejected"].indexOf(e.state)&&(void 0===e.error||"object"==typeof e.error);return(f&&e.error&&(f="string"==typeof e.error.message&&"string"==typeof e.error.code)&&(d=new iV(e.error.code,e.error.message)),f)?new ul(a,b,e.state,d):(ix(uk,`Failed to parse mutation state for ID '${b}': ${c}`),null)}toWebStorageJSON(){let a={state:this.state,updateTimeMs:Date.now()};return this.error&&(a.error={code:this.error.code,message:this.error.message}),JSON.stringify(a)}}class um{constructor(a,b,c){this.targetId=a,this.state=b,this.error=c}static fromWebStorageEntry(a,b){let c,d=JSON.parse(b),e="object"==typeof d&&-1!==["not-current","current","rejected"].indexOf(d.state)&&(void 0===d.error||"object"==typeof d.error);return(e&&d.error&&(e="string"==typeof d.error.message&&"string"==typeof d.error.code)&&(c=new iV(d.error.code,d.error.message)),e)?new um(a,d.state,c):(ix(uk,`Failed to parse target state for ID '${a}': ${b}`),null)}toWebStorageJSON(){let a={state:this.state,updateTimeMs:Date.now()};return this.error&&(a.error={code:this.error.code,message:this.error.message}),JSON.stringify(a)}}class un{constructor(a,b){this.clientId=a,this.activeTargetIds=b}static fromWebStorageEntry(a,b){let c=JSON.parse(b),d="object"==typeof c&&c.activeTargetIds instanceof Array,e=oc();for(let a=0;d&&a<c.activeTargetIds.length;++a)d=lX(c.activeTargetIds[a]),e=e.add(c.activeTargetIds[a]);return d?new un(a,e):(ix(uk,`Failed to parse client data for instance '${a}': ${b}`),null)}}class uo{constructor(a,b){this.clientId=a,this.onlineState=b}static fromWebStorageEntry(a){let b=JSON.parse(a);return"object"==typeof b&&-1!==["Unknown","Online","Offline"].indexOf(b.onlineState)&&"string"==typeof b.clientId?new uo(b.clientId,b.onlineState):(ix(uk,`Failed to parse online state: ${a}`),null)}}class up{constructor(){this.activeTargetIds=oc()}addQueryTarget(a){this.activeTargetIds=this.activeTargetIds.add(a)}removeQueryTarget(a){this.activeTargetIds=this.activeTargetIds.delete(a)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class uq{constructor(a,b,c,d,e){this.window=a,this.queue=b,this.persistenceKey=c,this.localClientId=d,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new lq(i6),this.started=!1,this.earlyEvents=[];const f=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=e,this.localClientStorageKey=t9(this.persistenceKey,this.localClientId),this.sequenceNumberKey=uj(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new up),this.clientStateKeyRe=RegExp(`^${t8}_${f}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${ua}_${f}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${uc}_${f}_(\\d+)$`),this.onlineStateKey=uf(this.persistenceKey),this.bundleLoadedKey=uh(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(a){return!!(a&&a.localStorage)}async start(){for(let a of(await this.syncEngine.getActiveClients())){if(a===this.localClientId)continue;let b=this.getItem(t9(this.persistenceKey,a));if(b){let c=un.fromWebStorageEntry(a,b);c&&(this.activeClients=this.activeClients.insert(c.clientId,c))}}this.persistClientState();let a=this.storage.getItem(this.onlineStateKey);if(a){let b=this.fromWebStorageOnlineState(a);b&&this.handleOnlineStateEvent(b)}for(let a of this.earlyEvents)this.handleWebStorageEvent(a);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(a){this.setItem(this.sequenceNumberKey,JSON.stringify(a))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(a){let b=!1;return this.activeClients.forEach((c,d)=>{d.activeTargetIds.has(a)&&(b=!0)}),b}addPendingMutation(a){this.persistMutationState(a,"pending")}updateMutationState(a,b,c){this.persistMutationState(a,b,c),this.removeMutationState(a)}addLocalQueryTarget(a,b=!0){let c="not-current";if(this.isActiveQueryTarget(a)){let b=this.storage.getItem(ud(this.persistenceKey,a));if(b){let d=um.fromWebStorageEntry(a,b);d&&(c=d.state)}}return b&&this.localClientState.addQueryTarget(a),this.persistClientState(),c}removeLocalQueryTarget(a){this.localClientState.removeQueryTarget(a),this.persistClientState()}isLocalQueryTarget(a){return this.localClientState.activeTargetIds.has(a)}clearQueryState(a){this.removeItem(ud(this.persistenceKey,a))}updateQueryState(a,b,c){this.persistQueryTargetState(a,b,c)}handleUserChange(a,b,c){b.forEach(a=>{this.removeMutationState(a)}),this.currentUser=a,c.forEach(a=>{this.addPendingMutation(a)})}setOnlineState(a){this.persistOnlineState(a)}notifyBundleLoaded(a){this.persistBundleLoadedState(a)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(a){let b=this.storage.getItem(a);return iw(uk,"READ",a,b),b}setItem(a,b){iw(uk,"SET",a,b),this.storage.setItem(a,b)}removeItem(a){iw(uk,"REMOVE",a),this.storage.removeItem(a)}handleWebStorageEvent(a){let b=a;if(b.storageArea===this.storage){if(iw(uk,"EVENT",b.key,b.newValue),b.key===this.localClientStorageKey)return void ix("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueRetryable(async()=>{if(!this.started)return void this.earlyEvents.push(b);if(null!==b.key){if(this.clientStateKeyRe.test(b.key))if(null!=b.newValue){let a=this.fromWebStorageClientState(b.key,b.newValue);if(a)return this.handleClientStateEvent(a.clientId,a)}else{let a=this.fromWebStorageClientStateKey(b.key);return this.handleClientStateEvent(a,null)}else if(this.mutationBatchKeyRe.test(b.key)){if(null!==b.newValue){let a=this.fromWebStorageMutationMetadata(b.key,b.newValue);if(a)return this.handleMutationBatchEvent(a)}}else if(this.queryTargetKeyRe.test(b.key)){if(null!==b.newValue){let a=this.fromWebStorageQueryTargetMetadata(b.key,b.newValue);if(a)return this.handleQueryTargetEvent(a)}}else if(b.key===this.onlineStateKey){if(null!==b.newValue){let a=this.fromWebStorageOnlineState(b.newValue);if(a)return this.handleOnlineStateEvent(a)}}else if(b.key===this.sequenceNumberKey){let a=ur(b.newValue);a!==j6.INVALID&&this.sequenceNumberHandler(a)}else if(b.key===this.bundleLoadedKey){let a=this.fromWebStoreBundleLoadedState(b.newValue);await Promise.all(a.map(a=>this.syncEngine.synchronizeWithChangedDocuments(a)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(a,b,c){let d=new ul(this.currentUser,a,b,c),e=ub(this.persistenceKey,this.currentUser,a);this.setItem(e,d.toWebStorageJSON())}removeMutationState(a){let b=ub(this.persistenceKey,this.currentUser,a);this.removeItem(b)}persistOnlineState(a){let b={clientId:this.localClientId,onlineState:a};this.storage.setItem(this.onlineStateKey,JSON.stringify(b))}persistQueryTargetState(a,b,c){let d=ud(this.persistenceKey,a),e=new um(a,b,c);this.setItem(d,e.toWebStorageJSON())}persistBundleLoadedState(a){let b=JSON.stringify(Array.from(a));this.setItem(this.bundleLoadedKey,b)}fromWebStorageClientStateKey(a){let b=this.clientStateKeyRe.exec(a);return b?b[1]:null}fromWebStorageClientState(a,b){let c=this.fromWebStorageClientStateKey(a);return un.fromWebStorageEntry(c,b)}fromWebStorageMutationMetadata(a,b){let c=this.mutationBatchKeyRe.exec(a),d=Number(c[1]),e=void 0!==c[2]?c[2]:null;return ul.fromWebStorageEntry(new iq(e),d,b)}fromWebStorageQueryTargetMetadata(a,b){let c=Number(this.queryTargetKeyRe.exec(a)[1]);return um.fromWebStorageEntry(c,b)}fromWebStorageOnlineState(a){return uo.fromWebStorageEntry(a)}fromWebStoreBundleLoadedState(a){return JSON.parse(a)}async handleMutationBatchEvent(a){return a.user.uid!==this.currentUser.uid?void iw(uk,`Ignoring mutation for non-active user ${a.user.uid}`):this.syncEngine.applyBatchState(a.batchId,a.state,a.error)}handleQueryTargetEvent(a){return this.syncEngine.applyTargetState(a.targetId,a.state,a.error)}handleClientStateEvent(a,b){let c=b?this.activeClients.insert(a,b):this.activeClients.remove(a),d=this.extractActiveQueryTargets(this.activeClients),e=this.extractActiveQueryTargets(c),f=[],g=[];return e.forEach(a=>{d.has(a)||f.push(a)}),d.forEach(a=>{e.has(a)||g.push(a)}),this.syncEngine.applyActiveTargetsChange(f,g).then(()=>{this.activeClients=c})}handleOnlineStateEvent(a){this.activeClients.get(a.clientId)&&this.onlineStateHandler(a.onlineState)}extractActiveQueryTargets(a){let b=oc();return a.forEach((a,c)=>{b=b.unionWith(c.activeTargetIds)}),b}}function ur(a){let b=j6.INVALID;if(null!=a)try{let c=JSON.parse(a);iC("number"==typeof c,30636,{seqString:a}),b=c}catch(a){ix(uk,"Failed to read sequence number from WebStorage",a)}return b}class us{constructor(){this.localState=new up,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(a){}updateMutationState(a,b,c){}addLocalQueryTarget(a,b=!0){return b&&this.localState.addQueryTarget(a),this.queryState[a]||"not-current"}updateQueryState(a,b,c){this.queryState[a]=b}removeLocalQueryTarget(a){this.localState.removeQueryTarget(a)}isLocalQueryTarget(a){return this.localState.activeTargetIds.has(a)}clearQueryState(a){delete this.queryState[a]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(a){return this.localState.activeTargetIds.has(a)}start(){return this.localState=new up,Promise.resolve()}handleUserChange(a,b,c){}setOnlineState(a){}shutdown(){}writeSequenceNumber(a){}notifyBundleLoaded(a){}}class ut{addCallback(a){}shutdown(){}}class uu{constructor(a){this.sendFn=a.sendFn,this.closeFn=a.closeFn}onConnected(a){this.wrappedOnConnected=a}onOpen(a){this.wrappedOnOpen=a}onClose(a){this.wrappedOnClose=a}onMessage(a){this.wrappedOnMessage=a}close(){this.closeFn()}send(a){this.sendFn(a)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(a){this.wrappedOnClose(a)}callOnMessage(a){this.wrappedOnMessage(a)}}let uv=null;function uw(){return 0x10000000+Math.round(0x80000000*Math.random())}function ux(){return null===uv?uv=uw():uv++,"0x"+uv.toString(16)}function uy(a){return new Promise((b,c)=>{a((a,d)=>{a?c(a):b(d)})})}let uz="1.9.15",uA="GrpcConnection",uB=`gl-node/${process.versions.node} fire/${ir} grpc/${uz}`;function uC(a,b,c,d,e){iC(null===b||"OAuth"===b.type,36936);let f=new io.Metadata;return b&&b.headers.forEach((a,b)=>f.set(b,a)),c&&c.headers.forEach((a,b)=>f.set(b,a)),d&&f.set("X-Firebase-GMPID",d),f.set("X-Goog-Api-Client",uB),f.set("Google-Cloud-Resource-Prefix",a),f.set("x-goog-request-params",a),e&&f.set("X-Goog-Api-Key",e),f}class uD{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(a,b){this.databaseInfo=b,this.cachedStub=null,this.firestore=a.google.firestore.v1,this.databasePath=`projects/${b.databaseId.projectId}/databases/${b.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){iw(uA,"Creating Firestore stub.");let a=this.databaseInfo.ssl?io.credentials.createSsl():io.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,a)}return this.cachedStub}invokeRPC(a,b,c,d,e){let f=ux(),g=this.ensureActiveStub(),h=uC(this.databasePath,d,e,this.databaseInfo.appId,this.databaseInfo.apiKey),i={database:this.databasePath,...c};return uy(b=>(iw(uA,`RPC '${a}' ${f} invoked with request:`,c),g[a](i,h,(c,d)=>{c?(iw(uA,`RPC '${a}' ${f} failed with error:`,c),b(new iV(oZ(c.code),c.message))):(iw(uA,`RPC '${a}' ${f} completed with response:`,d),b(void 0,d))})))}invokeStreamingRPC(a,b,c,d,e,f){let g=ux(),h=[],i=new iW;iw(uA,`RPC '${a}' ${g} invoked (streaming) with request:`,c);let j=this.ensureActiveStub(),k=uC(this.databasePath,d,e,this.databaseInfo.appId,this.databaseInfo.apiKey),l={...c,database:this.databasePath},m=j[a](l,k),n=!1;return m.on("data",b=>{iw(uA,`RPC ${a} ${g} received result:`,b),h.push(b),void 0!==f&&h.length===f&&(n=!0,i.resolve(h))}),m.on("end",()=>{iw(uA,`RPC '${a}' ${g} completed.`),n||(n=!0,i.resolve(h))}),m.on("error",b=>{iw(uA,`RPC '${a}' ${g} failed with error:`,b);let c=oZ(b.code);i.reject(new iV(c,b.message))}),i.promise}openStream(a,b,c){let d=ux(),e=this.ensureActiveStub(),f=uC(this.databasePath,b,c,this.databaseInfo.appId,this.databaseInfo.apiKey),g=e[a](f),h=!1,i=a=>{h||(h=!0,j.callOnClose(a),g.end())},j=new uu({sendFn:b=>{if(h)iw(uA,`RPC '${a}' stream ${d} not sending because gRPC stream is closed:`,b);else{iw(uA,`RPC '${a}' stream ${d} sending:`,b);try{g.write(b)}catch(a){throw ix("Failure sending:",b),ix("Error:",a),a}}},closeFn:()=>{iw(uA,`RPC '${a}' stream ${d} closed locally via close().`),i()}}),k=!1;return g.on("data",b=>{h||(iw(uA,`RPC '${a}' stream ${d} received:`,b),k||(j.callOnConnected(),k=!0),j.callOnMessage(b))}),g.on("end",()=>{iw(uA,`RPC '${a}' stream ${d} ended.`),i()}),g.on("error",b=>{h||(iy(uA,`RPC '${a}' stream ${d} error. Code:`,b.code,"Message:",b.message),i(new iV(oZ(b.code),b.message)))}),iw(uA,`Opening RPC '${a}' stream ${d} to ${this.databaseInfo.host}`),setTimeout(()=>{j.callOnOpen()},0),j}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let uE={google:{nested:{protobuf:{options:{go_package:"github.com/golang/protobuf/protoc-gen-go/descriptor;descriptor",java_package:"com.google.protobuf",java_outer_classname:"DescriptorProtos",csharp_namespace:"Google.Protobuf.Reflection",objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2},options:{type:"ExtensionRangeOptions",id:3}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},ExtensionRangeOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3},reservedRange:{rule:"repeated",type:"EnumReservedRange",id:4},reservedName:{rule:"repeated",type:"string",id:5}},nested:{EnumReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5,options:{default:!1}},serverStreaming:{type:"bool",id:6,options:{default:!1}}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10,options:{default:!1}},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27,options:{default:!1}},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16,options:{default:!1}},javaGenericServices:{type:"bool",id:17,options:{default:!1}},pyGenericServices:{type:"bool",id:18,options:{default:!1}},phpGenericServices:{type:"bool",id:42,options:{default:!1}},deprecated:{type:"bool",id:23,options:{default:!1}},ccEnableArenas:{type:"bool",id:31,options:{default:!1}},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},swiftPrefix:{type:"string",id:39},phpClassPrefix:{type:"string",id:40},phpNamespace:{type:"string",id:41},phpMetadataNamespace:{type:"string",id:44},rubyPackage:{type:"string",id:45},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1,options:{default:!1}},noStandardDescriptorAccessor:{type:"bool",id:2,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8],[9,9]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},weak:{type:"bool",id:10,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[5,5]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},idempotencyLevel:{type:"IdempotencyLevel",id:34,options:{default:"IDEMPOTENCY_UNKNOWN"}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],nested:{IdempotencyLevel:{values:{IDEMPOTENCY_UNKNOWN:0,NO_SIDE_EFFECTS:1,IDEMPOTENT:2}}}},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Empty:{fields:{}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},Duration:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"cloud.google.com/go/firestore/apiv1/firestorepb;firestorepb",java_multiple_files:!0,java_outer_classname:"QueryProfileProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue","fieldReferenceValue","functionValue","pipelineValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6},fieldReferenceValue:{type:"string",id:19},functionValue:{type:"Function",id:20},pipelineValue:{type:"Pipeline",id:21}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Function:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}},Pipeline:{fields:{stages:{rule:"repeated",type:"Stage",id:1}},nested:{Stage:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},ExecutePipeline:{requestType:"ExecutePipelineRequest",responseType:"ExecutePipelineResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:executePipeline","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:executePipeline",body:"*"}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},ExecutePipelineRequest:{oneofs:{pipelineType:{oneof:["structuredPipeline"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredPipeline:{type:"StructuredPipeline",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},ExecutePipelineResponse:{fields:{transaction:{type:"bytes",id:1},results:{rule:"repeated",type:"Document",id:2},executionTime:{type:"google.protobuf.Timestamp",id:3}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredPipeline:{fields:{pipeline:{type:"Pipeline",id:1},options:{keyType:"string",type:"Value",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}},Avg:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}},ExplainOptions:{fields:{analyze:{type:"bool",id:1,options:{"(google.api.field_behavior)":"OPTIONAL"}}}},ExplainMetrics:{fields:{planSummary:{type:"PlanSummary",id:1},executionStats:{type:"ExecutionStats",id:2}}},PlanSummary:{fields:{indexesUsed:{rule:"repeated",type:"google.protobuf.Struct",id:1}}},ExecutionStats:{fields:{resultsReturned:{type:"int64",id:1},executionDuration:{type:"google.protobuf.Duration",id:3},readOperations:{type:"int64",id:4},debugStats:{type:"google.protobuf.Struct",id:5}}}}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api;api",java_multiple_files:!0,java_outer_classname:"LaunchStageProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1},fullyDecodeReservedExpansion:{type:"bool",id:2}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{selector:{type:"string",id:1},get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},body:{type:"string",id:7},responseBody:{type:"string",id:12},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}},LaunchStage:{values:{LAUNCH_STAGE_UNSPECIFIED:0,UNIMPLEMENTED:6,PRELAUNCH:7,EARLY_ACCESS:1,ALPHA:2,BETA:3,GA:4,DEPRECATED:5}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var uF={nested:uE},uG=Object.freeze({__proto__:null,nested:uE,default:uF});let uH={longs:String,enums:String,defaults:!0,oneofs:!1};function uI(){let a=ip.fromJSON(uG,uH);return io.loadPackageDefinition(a)}function uJ(a){return new uD(uI(),a)}function uK(){return new ut}function uL(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function uM(){return null}function uN(a){return new pn(a,!1)}let uO="ExponentialBackoff",uP=1e3,uQ=1.5,uR=6e4;class uS{constructor(a,b,c=uP,d=uQ,e=uR){this.queue=a,this.timerId=b,this.initialDelayMs=c,this.backoffFactor=d,this.maxDelayMs=e,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(a){this.cancel();let b=Math.floor(this.currentBaseMs+this.jitterDelayMs()),c=Math.max(0,Date.now()-this.lastAttemptTime),d=Math.max(0,b-c);d>0&&iw(uO,`Backing off for ${d} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${b} ms, last attempt: ${c} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,d,()=>(this.lastAttemptTime=Date.now(),a())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let uT="PersistentStream",uU=6e4,uV=1e4;class uW{constructor(a,b,c,d,e,f,g,h){this.queue=a,this.idleTimerId=c,this.healthTimerId=d,this.connection=e,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=g,this.listener=h,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new uS(a,b)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){(this.responseCount=0,4===this.state)?this.performBackoff():this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,uU,()=>this.handleIdleCloseTimer()))}sendRequest(a){this.cancelIdleCheck(),this.stream.send(a)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(a,b){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==a?this.backoff.reset():b&&b.code===iN?(ix(b.toString()),ix("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):b&&b.code===iM&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=a,await this.listener.onClose(b)}tearDown(){}auth(){this.state=1;let a=this.getCloseGuardedDispatcher(this.closeCount),b=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,c])=>{this.closeCount===b&&this.startStream(a,c)},b=>{a(()=>{let a=new iV(iG,"Fetching auth token failed: "+b.message);return this.handleStreamClose(a)})})}startStream(a,b){let c=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(a,b),this.stream.onConnected(()=>{c(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{c(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,uV,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(a=>{c(()=>this.handleStreamClose(a))}),this.stream.onMessage(a=>{c(()=>1==++this.responseCount?this.onFirst(a):this.onNext(a))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(a){return iw(uT,`close with error: ${a}`),this.stream=null,this.close(4,a)}getCloseGuardedDispatcher(a){return b=>{this.queue.enqueueAndForget(()=>this.closeCount===a?b():(iw(uT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class uX extends uW{constructor(a,b,c,d,e,f){super(a,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",b,c,d,f),this.serializer=e}startRpc(a,b){return this.connection.openStream("Listen",a,b)}onFirst(a){return this.onNext(a)}onNext(a){this.backoff.reset();let b=pN(this.serializer,a),c=pP(a);return this.listener.onWatchChange(b,c)}watch(a){let b={};b.database=pE(this.serializer),b.addTarget=p4(this.serializer,a);let c=p2(this.serializer,a);c&&(b.labels=c),this.sendRequest(b)}unwatch(a){let b={};b.database=pE(this.serializer),b.removeTarget=a,this.sendRequest(b)}}class uY extends uW{constructor(a,b,c,d,e,f){super(a,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",b,c,d,f),this.serializer=e}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(a,b){return this.connection.openStream("Write",a,b)}onFirst(a){return iC(!!a.streamToken,31322),this.lastStreamToken=a.streamToken,iC(!a.writeResults||0===a.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(a){iC(!!a.streamToken,12678),this.lastStreamToken=a.streamToken,this.backoff.reset();let b=pV(a.writeResults,a.commitTime),c=pw(a.commitTime);return this.listener.onMutationResult(c,b)}writeHandshake(){let a={};a.database=pE(this.serializer),this.sendRequest(a)}writeMutations(a){let b={streamToken:this.lastStreamToken,writes:a.map(a=>pQ(this.serializer,a))};this.sendRequest(b)}}class uZ{}class u$ extends uZ{constructor(a,b,c,d){super(),this.authCredentials=a,this.appCheckCredentials=b,this.connection=c,this.serializer=d,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new iV(iO,"The client has already been terminated.")}invokeRPC(a,b,c,d){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,f])=>this.connection.invokeRPC(a,py(b,c),d,e,f)).catch(a=>{if("FirebaseError"===a.name)throw a.code===iM&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a;throw new iV(iG,a.toString())})}invokeStreamingRPC(a,b,c,d,e){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,g])=>this.connection.invokeStreamingRPC(a,py(b,c),d,f,g,e)).catch(a=>{if("FirebaseError"===a.name)throw a.code===iM&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a;throw new iV(iG,a.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function u_(a,b,c,d){return new u$(a,b,c,d)}async function u0(a,b){let c=iD(a),d={writes:b.map(a=>pQ(c.serializer,a))};await c.invokeRPC("Commit",c.serializer.databaseId,jf.emptyPath(),d)}async function u1(a,b){let c=iD(a),d={documents:b.map(a=>pA(c.serializer,a))},e=await c.invokeStreamingRPC("BatchGetDocuments",c.serializer.databaseId,jf.emptyPath(),d,b.length),f=new Map;e.forEach(a=>{let b=pM(c.serializer,a);f.set(b.key.toString(),b)});let g=[];return b.forEach(a=>{let b=f.get(a.toString());iC(!!b,55234,{key:a}),g.push(b)}),g}async function u2(a,b,c){let d=iD(a),{request:e,aliasMap:f,parent:g}=p_(d.serializer,nH(b),c);d.connection.shouldResourcePathBeIncludedInRequest||delete e.parent;let h=(await d.invokeStreamingRPC("RunAggregationQuery",d.serializer.databaseId,g,e,1)).filter(a=>!!a.result);iC(1===h.length,64727);let i=h[0].result?.aggregateFields;return Object.keys(i).reduce((a,b)=>(a[f[b]]=i[b],a),{})}function u3(a,b,c){let d=iD(a);return d.verifyInitialized(),new uY(b,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}function u4(a,b,c){let d=iD(a);return d.verifyInitialized(),new uX(b,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}let u5="OnlineStateTracker",u6=1,u7=1e4;class u8{constructor(a,b){this.asyncQueue=a,this.onlineStateHandler=b,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",u7,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${u7/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(a){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=u6&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${u6} times. Most recent error: ${a.toString()}`),this.setAndBroadcast("Offline")))}set(a){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===a&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(a)}setAndBroadcast(a){a!==this.state&&(this.state=a,this.onlineStateHandler(a))}logClientOfflineWarningIfNecessary(a){let b=`Could not reach Cloud Firestore backend. ${a}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(ix(b),this.shouldWarnClientIsOffline=!1):iw(u5,b)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let u9="RemoteStore",va=10;class vb{constructor(a,b,c,d,e){this.localStore=a,this.datastore=b,this.asyncQueue=c,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=e,this.connectivityMonitor.addCallback(a=>{c.enqueueAndForget(async()=>{vm(this)&&(iw(u9,"Restarting streams for network reachability change."),await vG(this))})}),this.onlineStateTracker=new u8(c,d)}}function vc(a,b,c,d,e){return new vb(a,b,c,d,e)}async function vd(a){if(vm(a))for(let b of a.onNetworkStatusChange)await b(!0)}async function ve(a){for(let b of a.onNetworkStatusChange)await b(!1)}async function vf(a){let b=iD(a);iw(u9,"RemoteStore shutting down."),b.offlineCauses.add(5),await ve(b),b.connectivityMonitor.shutdown(),b.onlineStateTracker.set("Unknown")}function vg(a,b){let c=iD(a);!c.listenTargets.has(b.targetId)&&(c.listenTargets.set(b.targetId,b),vl(c)?vk(c):vJ(c).isOpen()&&vi(c,b))}function vh(a,b){let c=iD(a),d=vJ(c);c.listenTargets.delete(b),d.isOpen()&&vj(c,b),0===c.listenTargets.size&&(d.isOpen()?d.markIdle():vm(c)&&c.onlineStateTracker.set("Unknown"))}function vi(a,b){if(a.watchChangeAggregator.recordPendingTargetRequest(b.targetId),b.resumeToken.approximateByteSize()>0||b.snapshotVersion.compareTo(jw.min())>0){let c=a.remoteSyncer.getRemoteKeysForTarget(b.targetId).size;b=b.withExpectedCount(c)}vJ(a).watch(b)}function vj(a,b){a.watchChangeAggregator.recordPendingTargetRequest(b),vJ(a).unwatch(b)}function vk(a){a.watchChangeAggregator=new pf({getRemoteKeysForTarget:b=>a.remoteSyncer.getRemoteKeysForTarget(b),getTargetDataForTarget:b=>a.listenTargets.get(b)||null,getDatabaseId:()=>a.datastore.serializer.databaseId}),vJ(a).start(),a.onlineStateTracker.handleWatchStreamStart()}function vl(a){return vm(a)&&!vJ(a).isStarted()&&a.listenTargets.size>0}function vm(a){return 0===iD(a).offlineCauses.size}function vn(a){a.watchChangeAggregator=void 0}async function vo(a){a.onlineStateTracker.set("Online")}async function vp(a){a.listenTargets.forEach((b,c)=>{vi(a,b)})}async function vq(a,b){vn(a),vl(a)?(a.onlineStateTracker.handleWatchStreamFailure(b),vk(a)):a.onlineStateTracker.set("Unknown")}async function vr(a,b,c){if(a.onlineStateTracker.set("Online"),b instanceof pc&&2===b.state&&b.cause){try{await vv(a,b)}catch(c){iw(u9,"Failed to remove targets %s: %s ",b.targetIds.join(","),c),await vs(a,c)}return}if(b instanceof pa?a.watchChangeAggregator.handleDocumentChange(b):b instanceof pb?a.watchChangeAggregator.handleExistenceFilter(b):a.watchChangeAggregator.handleTargetChange(b),!c.isEqual(jw.min()))try{let b=await tF(a.localStore);c.compareTo(b)>=0&&await vu(a,c)}catch(b){iw(u9,"Failed to raise snapshot:",b),await vs(a,b)}}async function vs(a,b,c){if(jX(b))a.offlineCauses.add(1),await ve(a),a.onlineStateTracker.set("Offline"),c||(c=()=>tF(a.localStore)),a.asyncQueue.enqueueRetryable(async()=>{iw(u9,"Retrying IndexedDB access"),await c(),a.offlineCauses.delete(1),await vd(a)});else throw b}function vt(a,b){return b().catch(c=>vs(a,c,b))}function vu(a,b){let c=a.watchChangeAggregator.createRemoteEvent(b);return c.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){let e=a.listenTargets.get(d);e&&a.listenTargets.set(d,e.withResumeToken(c.resumeToken,b))}}),c.targetMismatches.forEach((b,c)=>{let d=a.listenTargets.get(b);d&&(a.listenTargets.set(b,d.withResumeToken(lB.EMPTY_BYTE_STRING,d.snapshotVersion)),vj(a,b),vi(a,new qy(d.target,b,c,d.sequenceNumber)))}),a.remoteSyncer.applyRemoteEvent(c)}async function vv(a,b){let c=b.cause;for(let d of b.targetIds)a.listenTargets.has(d)&&(await a.remoteSyncer.rejectListen(d,c),a.listenTargets.delete(d),a.watchChangeAggregator.removeTarget(d))}async function vw(a){let b=iD(a),c=vK(b),d=b.writePipeline.length>0?b.writePipeline[b.writePipeline.length-1].batchId:lU;for(;vx(b);)try{let a=await tK(b.localStore,d);if(null===a){0===b.writePipeline.length&&c.markIdle();break}d=a.batchId,vy(b,a)}catch(a){await vs(b,a)}vz(b)&&vA(b)}function vx(a){return vm(a)&&a.writePipeline.length<va}function vy(a,b){a.writePipeline.push(b);let c=vK(a);c.isOpen()&&c.handshakeComplete&&c.writeMutations(b.mutations)}function vz(a){return vm(a)&&!vK(a).isStarted()&&a.writePipeline.length>0}function vA(a){vK(a).start()}async function vB(a){vK(a).writeHandshake()}async function vC(a){let b=vK(a);for(let c of a.writePipeline)b.writeMutations(c.mutations)}async function vD(a,b,c){let d=a.writePipeline.shift(),e=oU.from(d,b,c);await vt(a,()=>a.remoteSyncer.applySuccessfulWrite(e)),await vw(a)}async function vE(a,b){b&&vK(a).handshakeComplete&&await vF(a,b),vz(a)&&vA(a)}async function vF(a,b){if(oY(b.code)){let c=a.writePipeline.shift();vK(a).inhibitBackoff(),await vt(a,()=>a.remoteSyncer.rejectFailedWrite(c.batchId,b)),await vw(a)}}async function vG(a){let b=iD(a);b.offlineCauses.add(4),await ve(b),b.onlineStateTracker.set("Unknown"),b.offlineCauses.delete(4),await vd(b)}async function vH(a,b){let c=iD(a);c.asyncQueue.verifyOperationInProgress(),iw(u9,"RemoteStore received new credentials");let d=vm(c);c.offlineCauses.add(3),await ve(c),d&&c.onlineStateTracker.set("Unknown"),await c.remoteSyncer.handleCredentialChange(b),c.offlineCauses.delete(3),await vd(c)}async function vI(a,b){let c=iD(a);b?(c.offlineCauses.delete(2),await vd(c)):b||(c.offlineCauses.add(2),await ve(c),c.onlineStateTracker.set("Unknown"))}function vJ(a){return a.watchStream||(a.watchStream=u4(a.datastore,a.asyncQueue,{onConnected:vo.bind(null,a),onOpen:vp.bind(null,a),onClose:vq.bind(null,a),onWatchChange:vr.bind(null,a)}),a.onNetworkStatusChange.push(async b=>{b?(a.watchStream.inhibitBackoff(),vl(a)?vk(a):a.onlineStateTracker.set("Unknown")):(await a.watchStream.stop(),vn(a))})),a.watchStream}function vK(a){return a.writeStream||(a.writeStream=u3(a.datastore,a.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:vB.bind(null,a),onClose:vE.bind(null,a),onHandshakeComplete:vC.bind(null,a),onMutationResult:vD.bind(null,a)}),a.onNetworkStatusChange.push(async b=>{b?(a.writeStream.inhibitBackoff(),await vw(a)):(await a.writeStream.stop(),a.writePipeline.length>0&&(iw(u9,`Stopping write stream with ${a.writePipeline.length} pending writes`),a.writePipeline=[]))})),a.writeStream}let vL="AsyncQueue";class vM{constructor(a,b,c,d,e){this.asyncQueue=a,this.timerId=b,this.targetTimeMs=c,this.op=d,this.removalCallback=e,this.deferred=new iW,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(a,b,c,d,e){let f=new vM(a,b,Date.now()+c,d,e);return f.start(c),f}start(a){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),a)}skipDelay(){return this.handleDelayElapsed()}cancel(a){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new iV(iF,"Operation cancelled"+(a?": "+a:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(a=>this.deferred.resolve(a))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function vN(a,b){if(ix(vL,`${b}: ${a}`),jX(a))return new iV(iT,`${b}: ${a}`);throw a}class vO{static emptySet(a){return new vO(a.comparator)}constructor(a){a?this.comparator=(b,c)=>a(b,c)||ji.comparator(b.key,c.key):this.comparator=(a,b)=>ji.comparator(a.key,b.key),this.keyedMap=n1(),this.sortedSet=new lq(this.comparator)}has(a){return null!=this.keyedMap.get(a)}get(a){return this.keyedMap.get(a)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(a){let b=this.keyedMap.get(a);return b?this.sortedSet.indexOf(b):-1}get size(){return this.sortedSet.size}forEach(a){this.sortedSet.inorderTraversal((b,c)=>(a(b),!1))}add(a){let b=this.delete(a.key);return b.copy(b.keyedMap.insert(a.key,a),b.sortedSet.insert(a,null))}delete(a){let b=this.get(a);return b?this.copy(this.keyedMap.remove(a),this.sortedSet.remove(b)):this}isEqual(a){if(!(a instanceof vO)||this.size!==a.size)return!1;let b=this.sortedSet.getIterator(),c=a.sortedSet.getIterator();for(;b.hasNext();){let a=b.getNext().key,d=c.getNext().key;if(!a.isEqual(d))return!1}return!0}toString(){let a=[];return(this.forEach(b=>{a.push(b.toString())}),0===a.length)?"DocumentSet ()":"DocumentSet (\n  "+a.join("  \n")+"\n)"}copy(a,b){let c=new vO;return c.comparator=this.comparator,c.keyedMap=a,c.sortedSet=b,c}}class vP{constructor(){this.changeMap=new lq(ji.comparator)}track(a){let b=a.doc.key,c=this.changeMap.get(b);if(!c){this.changeMap=this.changeMap.insert(b,a);return}0!==a.type&&3===c.type?this.changeMap=this.changeMap.insert(b,a):3===a.type&&1!==c.type?this.changeMap=this.changeMap.insert(b,{type:c.type,doc:a.doc}):2===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):2===a.type&&0===c.type?this.changeMap=this.changeMap.insert(b,{type:0,doc:a.doc}):1===a.type&&0===c.type?this.changeMap=this.changeMap.remove(b):1===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,{type:1,doc:c.doc}):0===a.type&&1===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):iA(63341,{change:a,oldChange:c})}getChanges(){let a=[];return this.changeMap.inorderTraversal((b,c)=>{a.push(c)}),a}}class vQ{constructor(a,b,c,d,e,f,g,h,i){this.query=a,this.docs=b,this.oldDocs=c,this.docChanges=d,this.mutatedKeys=e,this.fromCache=f,this.syncStateChanged=g,this.excludesMetadataChanges=h,this.hasCachedResults=i}static fromInitialDocuments(a,b,c,d,e){let f=[];return b.forEach(a=>{f.push({type:0,doc:a})}),new vQ(a,b,vO.emptySet(b),f,c,d,!0,!1,e)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(a){if(this.fromCache!==a.fromCache||this.hasCachedResults!==a.hasCachedResults||this.syncStateChanged!==a.syncStateChanged||!this.mutatedKeys.isEqual(a.mutatedKeys)||!nO(this.query,a.query)||!this.docs.isEqual(a.docs)||!this.oldDocs.isEqual(a.oldDocs))return!1;let b=this.docChanges,c=a.docChanges;if(b.length!==c.length)return!1;for(let a=0;a<b.length;a++)if(b[a].type!==c[a].type||!b[a].doc.isEqual(c[a].doc))return!1;return!0}}class vR{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(a=>a.listensToRemoteStore())}}function vS(){return new vT}class vT{constructor(){this.queries=vU(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){v0(this,new iV(iP,"Firestore shutting down"))}}function vU(){return new nZ(a=>nP(a),nO)}async function vV(a,b){let c=iD(a),d=3,e=b.query,f=c.queries.get(e);f?!f.hasRemoteListeners()&&b.listensToRemoteStore()&&(d=2):(f=new vR,d=+!b.listensToRemoteStore());try{switch(d){case 0:f.viewSnap=await c.onListen(e,!0);break;case 1:f.viewSnap=await c.onListen(e,!1);break;case 2:await c.onFirstRemoteStoreListen(e)}}catch(c){let a=vN(c,`Initialization of query '${nQ(b.query)}' failed`);b.onError(a);return}c.queries.set(e,f),f.listeners.push(b),b.applyOnlineStateChange(c.onlineState),f.viewSnap&&b.onViewSnapshot(f.viewSnap)&&v1(c)}async function vW(a,b){let c=iD(a),d=b.query,e=3,f=c.queries.get(d);if(f){let a=f.listeners.indexOf(b);a>=0&&(f.listeners.splice(a,1),0===f.listeners.length?e=+!b.listensToRemoteStore():!f.hasRemoteListeners()&&b.listensToRemoteStore()&&(e=2))}switch(e){case 0:return c.queries.delete(d),c.onUnlisten(d,!0);case 1:return c.queries.delete(d),c.onUnlisten(d,!1);case 2:return c.onLastRemoteStoreUnlisten(d);default:return}}function vX(a,b){let c=iD(a),d=!1;for(let a of b){let b=a.query,e=c.queries.get(b);if(e){for(let b of e.listeners)b.onViewSnapshot(a)&&(d=!0);e.viewSnap=a}}d&&v1(c)}function vY(a,b,c){let d=iD(a),e=d.queries.get(b);if(e)for(let a of e.listeners)a.onError(c);d.queries.delete(b)}function vZ(a,b){let c=iD(a);c.onlineState=b;let d=!1;c.queries.forEach((a,c)=>{for(let a of c.listeners)a.applyOnlineStateChange(b)&&(d=!0)}),d&&v1(c)}function v$(a,b){iD(a).snapshotsInSyncListeners.add(b),b.next()}function v_(a,b){iD(a).snapshotsInSyncListeners.delete(b)}function v0(a,b){let c=iD(a),d=c.queries;c.queries=vU(),d.forEach((a,c)=>{for(let a of c.listeners)a.onError(b)})}function v1(a){a.snapshotsInSyncListeners.forEach(a=>{a.next()})}!function(a){a.Default="default",a.Cache="cache"}(s||(s={}));class v2{constructor(a,b,c){this.query=a,this.queryObserver=b,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=c||{}}onViewSnapshot(a){if(!this.options.includeMetadataChanges){let b=[];for(let c of a.docChanges)3!==c.type&&b.push(c);a=new vQ(a.query,a.docs,a.oldDocs,b,a.mutatedKeys,a.fromCache,a.syncStateChanged,!0,a.hasCachedResults)}let b=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(a)&&(this.queryObserver.next(a),b=!0):this.shouldRaiseInitialEvent(a,this.onlineState)&&(this.raiseInitialEvent(a),b=!0),this.snap=a,b}onError(a){this.queryObserver.error(a)}applyOnlineStateChange(a){this.onlineState=a;let b=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,a)&&(this.raiseInitialEvent(this.snap),b=!0),b}shouldRaiseInitialEvent(a,b){if(!a.fromCache||!this.listensToRemoteStore())return!0;let c="Offline"!==b;return(!this.options.waitForSyncWhenOnline||!c)&&(!a.docs.isEmpty()||a.hasCachedResults||"Offline"===b)}shouldRaiseEvent(a){if(a.docChanges.length>0)return!0;let b=this.snap&&this.snap.hasPendingWrites!==a.hasPendingWrites;return(!!a.syncStateChanged||!!b)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(a){a=vQ.fromInitialDocuments(a.query,a.docs,a.mutatedKeys,a.fromCache,a.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(a)}listensToRemoteStore(){return this.options.source!==s.Cache}}class v3{constructor(a,b,c,d){this.targetId=a,this.fromCache=b,this.addedKeys=c,this.removedKeys=d}static fromSnapshot(a,b){let c=oa(),d=oa();for(let a of b.docChanges)switch(a.type){case 0:c=c.add(a.doc.key);break;case 1:d=d.add(a.doc.key)}return new v3(a,b.fromCache,c,d)}}class v4{constructor(a){this.serializer=a}toDocumentKey(a){return pB(this.serializer,a)}toMutableDocument(a){return a.metadata.exists?pJ(this.serializer,a.document,!1):mM.newNoDocument(this.toDocumentKey(a.metadata.name),this.toSnapshotVersion(a.metadata.readTime))}toSnapshotVersion(a){return pw(a)}}class v5{constructor(a,b){this.bundleMetadata=a,this.serializer=b,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=v6(a)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(a){this.progress.bytesLoaded+=a.byteLength;let b=this.progress.documentsLoaded;if(a.payload.namedQuery)this._queries.push(a.payload.namedQuery);else if(a.payload.documentMetadata){this._documents.push({metadata:a.payload.documentMetadata}),!a.payload.documentMetadata.exists&&++b;let c=jf.fromString(a.payload.documentMetadata.name);this.collectionGroups.add(c.get(c.length-2))}else a.payload.document&&(this._documents[this._documents.length-1].document=a.payload.document,++b);return b!==this.progress.documentsLoaded?(this.progress.documentsLoaded=b,{...this.progress}):null}getQueryDocumentMapping(a){let b=new Map,c=new v4(this.serializer);for(let d of a)if(d.metadata.queries){let a=c.toDocumentKey(d.metadata.name);for(let c of d.metadata.queries){let d=(b.get(c)||oa()).add(a);b.set(c,d)}}return b}async completeAndStoreAsync(a){let b=await tY(a,new v4(this.serializer),this._documents,this.bundleMetadata.id),c=this.getQueryDocumentMapping(this.documents);for(let b of this._queries)await t0(a,b,c.get(b.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:b}}}function v6(a){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}}function v7(a){return{taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}}class v8{constructor(a){this.key=a}}class v9{constructor(a){this.key=a}}class wa{constructor(a,b){this.query=a,this._syncedDocuments=b,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=oa(),this.mutatedKeys=oa(),this.docComparator=nX(a),this.documentSet=new vO(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(a,b){let c=b?b.changeSet:new vP,d=b?b.documentSet:this.documentSet,e=b?b.mutatedKeys:this.mutatedKeys,f=d,g=!1,h="F"===this.query.limitType&&d.size===this.query.limit?d.last():null,i="L"===this.query.limitType&&d.size===this.query.limit?d.first():null;if(a.inorderTraversal((a,b)=>{let j=d.get(a),k=nR(this.query,b)?b:null,l=!!j&&this.mutatedKeys.has(j.key),m=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations),n=!1;j&&k?j.data.isEqual(k.data)?l!==m&&(c.track({type:3,doc:k}),n=!0):!this.shouldWaitForSyncedDocument(j,k)&&(c.track({type:2,doc:k}),n=!0,(h&&this.docComparator(k,h)>0||i&&0>this.docComparator(k,i))&&(g=!0)):!j&&k?(c.track({type:0,doc:k}),n=!0):j&&!k&&(c.track({type:1,doc:j}),n=!0,(h||i)&&(g=!0)),n&&(k?(f=f.add(k),e=m?e.add(a):e.delete(a)):(f=f.delete(a),e=e.delete(a)))}),null!==this.query.limit)for(;f.size>this.query.limit;){let a="F"===this.query.limitType?f.last():f.first();f=f.delete(a.key),e=e.delete(a.key),c.track({type:1,doc:a})}return{documentSet:f,changeSet:c,needsRefill:g,mutatedKeys:e}}shouldWaitForSyncedDocument(a,b){return a.hasLocalMutations&&b.hasCommittedMutations&&!b.hasLocalMutations}applyChanges(a,b,c,d){let e=this.documentSet;this.documentSet=a.documentSet,this.mutatedKeys=a.mutatedKeys;let f=a.changeSet.getChanges();f.sort((a,b)=>wb(a.type,b.type)||this.docComparator(a.doc,b.doc)),this.applyTargetChange(c),d=d??!1;let g=b&&!d?this.updateLimboDocuments():[],h=+!!(0===this.limboDocuments.size&&this.current&&!d),i=h!==this.syncState;return(this.syncState=h,0!==f.length||i)?{snapshot:new vQ(this.query,a.documentSet,e,f,a.mutatedKeys,0===h,i,!1,!!c&&c.resumeToken.approximateByteSize()>0),limboChanges:g}:{limboChanges:g}}applyOnlineStateChange(a){return this.current&&"Offline"===a?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new vP,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(a){return!this._syncedDocuments.has(a)&&!!this.documentSet.has(a)&&!this.documentSet.get(a).hasLocalMutations}applyTargetChange(a){a&&(a.addedDocuments.forEach(a=>this._syncedDocuments=this._syncedDocuments.add(a)),a.modifiedDocuments.forEach(a=>{}),a.removedDocuments.forEach(a=>this._syncedDocuments=this._syncedDocuments.delete(a)),this.current=a.current)}updateLimboDocuments(){if(!this.current)return[];let a=this.limboDocuments;this.limboDocuments=oa(),this.documentSet.forEach(a=>{this.shouldBeInLimbo(a.key)&&(this.limboDocuments=this.limboDocuments.add(a.key))});let b=[];return a.forEach(a=>{this.limboDocuments.has(a)||b.push(new v9(a))}),this.limboDocuments.forEach(c=>{a.has(c)||b.push(new v8(c))}),b}synchronizeWithPersistedState(a){this._syncedDocuments=a.remoteKeys,this.limboDocuments=oa();let b=this.computeDocChanges(a.documents);return this.applyChanges(b,!0)}computeInitialSnapshot(){return vQ.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function wb(a,b){let c=a=>{switch(a){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return iA(20277,{change:a})}};return c(a)-c(b)}let wc="SyncEngine";class wd{constructor(a,b,c){this.query=a,this.targetId=b,this.view=c}}class we{constructor(a){this.key=a,this.receivedDocument=!1}}class wf{constructor(a,b,c,d,e,f){this.localStore=a,this.remoteStore=b,this.eventManager=c,this.sharedClientState=d,this.currentUser=e,this.maxConcurrentLimboResolutions=f,this.syncEngineListener={},this.queryViewsByQuery=new nZ(a=>nP(a),nO),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new lq(ji.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new sN,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=sb.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function wg(a,b,c,d,e,f,g){let h=new wf(a,b,c,d,e,f);return g&&(h._isPrimaryClient=!0),h}async function wh(a,b,c=!0){let d,e=wQ(a),f=e.queryViewsByQuery.get(b);return f?(e.sharedClientState.addLocalQueryTarget(f.targetId),d=f.view.computeInitialSnapshot()):d=await wj(e,b,c,!0),d}async function wi(a,b){let c=wQ(a);await wj(c,b,!0,!1)}async function wj(a,b,c,d){let e,f=await tM(a.localStore,nG(b)),g=f.targetId,h=a.sharedClientState.addLocalQueryTarget(g,c);return d&&(e=await wk(a,b,g,"current"===h,f.resumeToken)),a.isPrimaryClient&&c&&vg(a.remoteStore,f),e}async function wk(a,b,c,d,e){a.applyDocChanges=(b,c,d)=>wD(a,b,c,d);let f=await tP(a.localStore,b,!0),g=new wa(b,f.remoteKeys),h=g.computeDocChanges(f.documents),i=o9.createSynthesizedTargetChangeForCurrentChange(c,d&&"Offline"!==a.onlineState,e),j=g.applyChanges(h,a.isPrimaryClient,i);wz(a,c,j.limboChanges);let k=new wd(b,c,g);return a.queryViewsByQuery.set(b,k),a.queriesByTarget.has(c)?a.queriesByTarget.get(c).push(b):a.queriesByTarget.set(c,[b]),j.snapshot}async function wl(a,b,c){let d=iD(a),e=d.queryViewsByQuery.get(b),f=d.queriesByTarget.get(e.targetId);if(f.length>1){d.queriesByTarget.set(e.targetId,f.filter(a=>!nO(a,b))),d.queryViewsByQuery.delete(b);return}d.isPrimaryClient?(d.sharedClientState.removeLocalQueryTarget(e.targetId),d.sharedClientState.isActiveQueryTarget(e.targetId)||await tO(d.localStore,e.targetId,!1).then(()=>{d.sharedClientState.clearQueryState(e.targetId),c&&vh(d.remoteStore,e.targetId),wx(d,e.targetId)}).catch(jO)):(wx(d,e.targetId),await tO(d.localStore,e.targetId,!0))}async function wm(a,b){let c=iD(a),d=c.queryViewsByQuery.get(b),e=c.queriesByTarget.get(d.targetId);c.isPrimaryClient&&1===e.length&&(c.sharedClientState.removeLocalQueryTarget(d.targetId),vh(c.remoteStore,d.targetId))}async function wn(a,b,c){let d=wR(a);try{let a=await tB(d.localStore,b);d.sharedClientState.addPendingMutation(a.batchId),wv(d,a.batchId,c),await wC(d,a.changes),await vw(d.remoteStore)}catch(b){let a=vN(b,"Failed to persist write");c.reject(a)}}async function wo(a,b){let c=iD(a);try{let a=await tG(c.localStore,b);b.targetChanges.forEach((a,b)=>{let d=c.activeLimboResolutionsByTarget.get(b);d&&(iC(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?d.receivedDocument=!0:a.modifiedDocuments.size>0?iC(d.receivedDocument,14607):a.removedDocuments.size>0&&(iC(d.receivedDocument,42227),d.receivedDocument=!1))}),await wC(c,a,b)}catch(a){await jO(a)}}function wp(a,b,c){let d=iD(a);if(d.isPrimaryClient&&0===c||!d.isPrimaryClient&&1===c){let a=[];d.queryViewsByQuery.forEach((c,d)=>{let e=d.view.applyOnlineStateChange(b);e.snapshot&&a.push(e.snapshot)}),vZ(d.eventManager,b),a.length&&d.syncEngineListener.onWatchChange(a),d.onlineState=b,d.isPrimaryClient&&d.sharedClientState.setOnlineState(b)}}async function wq(a,b,c){let d=iD(a);d.sharedClientState.updateQueryState(b,"rejected",c);let e=d.activeLimboResolutionsByTarget.get(b),f=e&&e.key;if(f){let a=new lq(ji.comparator);a=a.insert(f,mM.newNoDocument(f,jw.min()));let c=oa().add(f),e=new o8(jw.min(),new Map,new lq(i6),a,c);await wo(d,e),d.activeLimboTargetsByKey=d.activeLimboTargetsByKey.remove(f),d.activeLimboResolutionsByTarget.delete(b),wB(d)}else await tO(d.localStore,b,!1).then(()=>wx(d,b,c)).catch(jO)}async function wr(a,b){let c=iD(a),d=b.batch.batchId;try{let a=await tC(c.localStore,b);ww(c,d,null),wt(c,d),c.sharedClientState.updateMutationState(d,"acknowledged"),await wC(c,a)}catch(a){await jO(a)}}async function ws(a,b,c){let d=iD(a);try{let a=await tE(d.localStore,b);ww(d,b,c),wt(d,b),d.sharedClientState.updateMutationState(b,"rejected",c),await wC(d,a)}catch(a){await jO(a)}}function wt(a,b){(a.pendingWritesCallbacks.get(b)||[]).forEach(a=>{a.resolve()}),a.pendingWritesCallbacks.delete(b)}function wu(a,b){a.pendingWritesCallbacks.forEach(a=>{a.forEach(a=>{a.reject(new iV(iF,b))})}),a.pendingWritesCallbacks.clear()}function wv(a,b,c){let d=a.mutationUserCallbacks[a.currentUser.toKey()];d||(d=new lq(i6)),d=d.insert(b,c),a.mutationUserCallbacks[a.currentUser.toKey()]=d}function ww(a,b,c){let d=iD(a),e=d.mutationUserCallbacks[d.currentUser.toKey()];if(e){let a=e.get(b);a&&(c?a.reject(c):a.resolve(),e=e.remove(b)),d.mutationUserCallbacks[d.currentUser.toKey()]=e}}function wx(a,b,c=null){for(let d of(a.sharedClientState.removeLocalQueryTarget(b),a.queriesByTarget.get(b)))a.queryViewsByQuery.delete(d),c&&a.syncEngineListener.onWatchError(d,c);a.queriesByTarget.delete(b),a.isPrimaryClient&&a.limboDocumentRefs.removeReferencesForId(b).forEach(b=>{a.limboDocumentRefs.containsKey(b)||wy(a,b)})}function wy(a,b){a.enqueuedLimboResolutions.delete(b.path.canonicalString());let c=a.activeLimboTargetsByKey.get(b);null!==c&&(vh(a.remoteStore,c),a.activeLimboTargetsByKey=a.activeLimboTargetsByKey.remove(b),a.activeLimboResolutionsByTarget.delete(c),wB(a))}function wz(a,b,c){for(let d of c)d instanceof v8?(a.limboDocumentRefs.addReference(d.key,b),wA(a,d)):d instanceof v9?(iw(wc,"Document no longer in limbo: "+d.key),a.limboDocumentRefs.removeReference(d.key,b),a.limboDocumentRefs.containsKey(d.key)||wy(a,d.key)):iA(19791,{limboChange:d})}function wA(a,b){let c=b.key,d=c.path.canonicalString();a.activeLimboTargetsByKey.get(c)||a.enqueuedLimboResolutions.has(d)||(iw(wc,"New document in limbo: "+c),a.enqueuedLimboResolutions.add(d),wB(a))}function wB(a){for(;a.enqueuedLimboResolutions.size>0&&a.activeLimboTargetsByKey.size<a.maxConcurrentLimboResolutions;){let b=a.enqueuedLimboResolutions.values().next().value;a.enqueuedLimboResolutions.delete(b);let c=new ji(jf.fromString(b)),d=a.limboTargetIdGenerator.next();a.activeLimboResolutionsByTarget.set(d,new we(c)),a.activeLimboTargetsByKey=a.activeLimboTargetsByKey.insert(c,d),vg(a.remoteStore,new qy(nG(nz(c.path)),d,"TargetPurposeLimboResolution",j6.INVALID))}}async function wC(a,b,c){let d=iD(a),e=[],f=[],g=[];d.queryViewsByQuery.isEmpty()||(d.queryViewsByQuery.forEach((a,h)=>{g.push(d.applyDocChanges(h,b,c).then(a=>{if((a||c)&&d.isPrimaryClient){let b=a?!a.fromCache:c?.targetChanges.get(h.targetId)?.current;d.sharedClientState.updateQueryState(h.targetId,b?"current":"not-current")}if(a){e.push(a);let b=v3.fromSnapshot(h.targetId,a);f.push(b)}}))}),await Promise.all(g),d.syncEngineListener.onWatchChange(e),await tJ(d.localStore,f))}async function wD(a,b,c,d){let e=b.view.computeDocChanges(c);e.needsRefill&&(e=await tP(a.localStore,b.query,!1).then(({documents:a})=>b.view.computeDocChanges(a,e)));let f=d&&d.targetChanges.get(b.targetId),g=d&&null!=d.targetMismatches.get(b.targetId),h=b.view.applyChanges(e,a.isPrimaryClient,f,g);return wz(a,b.targetId,h.limboChanges),h.snapshot}async function wE(a,b){let c=iD(a);if(!c.currentUser.isEqual(b)){iw(wc,"User change. New user:",b.toKey());let a=await tA(c.localStore,b);c.currentUser=b,wu(c,"'waitForPendingWrites' promise is rejected due to a user change."),c.sharedClientState.handleUserChange(b,a.removedBatchIds,a.addedBatchIds),await wC(c,a.affectedDocuments)}}function wF(a,b){let c=iD(a),d=c.activeLimboResolutionsByTarget.get(b);if(d&&d.receivedDocument)return oa().add(d.key);{let a=oa(),d=c.queriesByTarget.get(b);if(!d)return a;for(let b of d){let d=c.queryViewsByQuery.get(b);a=a.unionWith(d.view.syncedDocuments)}return a}}async function wG(a,b){let c=iD(a),d=await tP(c.localStore,b.query,!0),e=b.view.synchronizeWithPersistedState(d);return c.isPrimaryClient&&wz(c,b.targetId,e.limboChanges),e}async function wH(a,b){let c=iD(a);return tV(c.localStore,b).then(a=>wC(c,a))}async function wI(a,b,c,d){let e=iD(a),f=await tR(e.localStore,b);null===f?iw(wc,"Cannot apply mutation batch with id: "+b):("pending"===c?await vw(e.remoteStore):"acknowledged"===c||"rejected"===c?(ww(e,b,d||null),wt(e,b),tS(e.localStore,b)):iA(6720,"Unknown batchState",{batchState:c}),await wC(e,f))}async function wJ(a,b){let c=iD(a);if(wQ(c),wR(c),!0===b&&!0!==c._isPrimaryClient){let a=c.sharedClientState.getAllActiveQueryTargets(),b=await wL(c,a.toArray());for(let a of(c._isPrimaryClient=!0,await vI(c.remoteStore,!0),b))vg(c.remoteStore,a)}else if(!1===b&&!1!==c._isPrimaryClient){let a=[],b=Promise.resolve();c.queriesByTarget.forEach((d,e)=>{c.sharedClientState.isLocalQueryTarget(e)?a.push(e):b=b.then(()=>(wx(c,e),tO(c.localStore,e,!0))),vh(c.remoteStore,e)}),await b,await wL(c,a),wK(c),c._isPrimaryClient=!1,await vI(c.remoteStore,!1)}}function wK(a){let b=iD(a);b.activeLimboResolutionsByTarget.forEach((a,c)=>{vh(b.remoteStore,c)}),b.limboDocumentRefs.removeAllReferences(),b.activeLimboResolutionsByTarget=new Map,b.activeLimboTargetsByKey=new lq(ji.comparator)}async function wL(a,b,c){let d=iD(a),e=[],f=[];for(let a of b){let b,c=d.queriesByTarget.get(a);if(c&&0!==c.length)for(let a of(b=await tM(d.localStore,nG(c[0])),c)){let b=d.queryViewsByQuery.get(a),c=await wG(d,b);c.snapshot&&f.push(c.snapshot)}else{let c=await tU(d.localStore,a);b=await tM(d.localStore,c),await wk(d,wM(c),a,!1,b.resumeToken)}e.push(b)}return d.syncEngineListener.onWatchChange(f),e}function wM(a){return ny(a.path,a.collectionGroup,a.orderBy,a.filters,a.limit,"F",a.startAt,a.endAt)}function wN(a){return tT(iD(a).localStore)}async function wO(a,b,c,d){let e=iD(a);if(e._isPrimaryClient)return void iw(wc,"Ignoring unexpected query state notification.");let f=e.queriesByTarget.get(b);if(f&&f.length>0)switch(c){case"current":case"not-current":{let a=await tV(e.localStore,nW(f[0])),d=o8.createSynthesizedRemoteEventForCurrentChange(b,"current"===c,lB.EMPTY_BYTE_STRING);await wC(e,a,d);break}case"rejected":await tO(e.localStore,b,!0),wx(e,b,d);break;default:iA(64155,c)}}async function wP(a,b,c){let d=wQ(a);if(d._isPrimaryClient){for(let a of b){if(d.queriesByTarget.has(a)&&d.sharedClientState.isActiveQueryTarget(a)){iw(wc,"Adding an already active target "+a);continue}let b=await tU(d.localStore,a),c=await tM(d.localStore,b);await wk(d,wM(b),c.targetId,!1,c.resumeToken),vg(d.remoteStore,c)}for(let a of c)d.queriesByTarget.has(a)&&await tO(d.localStore,a,!1).then(()=>{vh(d.remoteStore,a),wx(d,a)}).catch(jO)}}function wQ(a){let b=iD(a);return b.remoteStore.remoteSyncer.applyRemoteEvent=wo.bind(null,b),b.remoteStore.remoteSyncer.getRemoteKeysForTarget=wF.bind(null,b),b.remoteStore.remoteSyncer.rejectListen=wq.bind(null,b),b.syncEngineListener.onWatchChange=vX.bind(null,b.eventManager),b.syncEngineListener.onWatchError=vY.bind(null,b.eventManager),b}function wR(a){let b=iD(a);return b.remoteStore.remoteSyncer.applySuccessfulWrite=wr.bind(null,b),b.remoteStore.remoteSyncer.rejectFailedWrite=ws.bind(null,b),b}function wS(a,b,c){let d=iD(a);wT(d,b,c).then(a=>{d.sharedClientState.notifyBundleLoaded(a)})}async function wT(a,b,c){try{let d=await b.getMetadata();if(await tZ(a.localStore,d))return await b.close(),c._completeWith(v7(d)),Promise.resolve(new Set);c._updateProgress(v6(d));let e=new v5(d,b.serializer),f=await b.nextElement();for(;f;){let a=await e.addSizedElement(f);a&&c._updateProgress(a),f=await b.nextElement()}let g=await e.completeAndStoreAsync(a.localStore);return await wC(a,g.changedDocs,void 0),await t$(a.localStore,d),c._completeWith(g.progress),Promise.resolve(g.changedCollectionGroups)}catch(a){return iy(wc,`Loading bundle failed with ${a}`),c._failWith(a),Promise.resolve(new Set)}}class wU{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(a){this.serializer=uN(a.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(a),this.persistence=this.createPersistence(a),await this.persistence.start(),this.localStore=this.createLocalStore(a),this.gcScheduler=this.createGarbageCollectionScheduler(a,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(a,this.localStore)}createGarbageCollectionScheduler(a,b){return null}createIndexBackfillerScheduler(a,b){return null}createLocalStore(a){return tz(this.persistence,new t7,a.initialUser,this.serializer)}createPersistence(a){return new sX(sZ.factory,this.serializer)}createSharedClientState(a){return new us}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}wU.provider={build:()=>new wU};class wV extends wU{constructor(a){super(),this.cacheSizeBytes=a}createGarbageCollectionScheduler(a,b){return iC(this.persistence.referenceDelegate instanceof s$,46915),new sq(this.persistence.referenceDelegate.garbageCollector,a.asyncQueue,b)}createPersistence(a){let b=void 0!==this.cacheSizeBytes?sj.withCacheSize(this.cacheSizeBytes):sj.DEFAULT;return new sX(a=>s$.factory(a,b),this.serializer)}}class wW extends wU{constructor(a,b,c){super(),this.onlineComponentProvider=a,this.cacheSizeBytes=b,this.forceOwnership=c,this.kind="persistent",this.synchronizeTabs=!1}async initialize(a){await super.initialize(a),await this.onlineComponentProvider.initialize(this,a),await wR(this.onlineComponentProvider.syncEngine),await vw(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(a){return tz(this.persistence,new t7,a.initialUser,this.serializer)}createGarbageCollectionScheduler(a,b){return new sq(this.persistence.referenceDelegate.garbageCollector,a.asyncQueue,b)}createIndexBackfillerScheduler(a,b){let c=new j5(b,this.persistence);return new j4(a.asyncQueue,c)}createPersistence(a){let b=tt(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey),c=void 0!==this.cacheSizeBytes?sj.withCacheSize(this.cacheSizeBytes):sj.DEFAULT;return new tq(this.synchronizeTabs,b,a.clientId,c,a.asyncQueue,uL(),uM(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(a){return new us}}class wX extends wW{constructor(a,b){super(a,b,!1),this.onlineComponentProvider=a,this.cacheSizeBytes=b,this.synchronizeTabs=!0}async initialize(a){await super.initialize(a);let b=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof uq&&(this.sharedClientState.syncEngine={applyBatchState:wI.bind(null,b),applyTargetState:wO.bind(null,b),applyActiveTargetsChange:wP.bind(null,b),getActiveClients:wN.bind(null,b),synchronizeWithChangedDocuments:wH.bind(null,b)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async a=>{await wJ(this.onlineComponentProvider.syncEngine,a),this.gcScheduler&&(a&&!this.gcScheduler.started?this.gcScheduler.start():a||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(a&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():a||this.indexBackfillerScheduler.stop())})}createSharedClientState(a){let b=uL();if(!uq.isAvailable(b))throw new iV(iR,"IndexedDB persistence is only available on platforms that support LocalStorage.");let c=tt(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey);return new uq(b,a.asyncQueue,c,a.clientId,a.initialUser)}}class wY{async initialize(a,b){this.localStore||(this.localStore=a.localStore,this.sharedClientState=a.sharedClientState,this.datastore=this.createDatastore(b),this.remoteStore=this.createRemoteStore(b),this.eventManager=this.createEventManager(b),this.syncEngine=this.createSyncEngine(b,!a.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>wp(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=wE.bind(null,this.syncEngine),await vI(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(a){return vS()}createDatastore(a){let b=uN(a.databaseInfo.databaseId),c=uJ(a.databaseInfo);return u_(a.authCredentials,a.appCheckCredentials,c,b)}createRemoteStore(a){return vc(this.localStore,this.datastore,a.asyncQueue,a=>wp(this.syncEngine,a,0),uK())}createSyncEngine(a,b){return wg(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,a.initialUser,a.maxConcurrentLimboResolutions,b)}async terminate(){await vf(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}wY.provider={build:()=>new wY};let wZ=10240;function w$(a,b=wZ){let c=0;return{async read(){if(c<a.byteLength){let d={value:a.slice(c,c+b),done:!1};return c+=b,d}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function w_(a,b){if(!(a instanceof Uint8Array))throw new iV(iH,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${jn(a)}`);return w$(a,b)}class w0{constructor(a){this.observer=a,this.muted=!1}next(a){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,a)}error(a){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,a):ix("Uncaught Error in snapshot listener:",a.toString()))}mute(){this.muted=!0}scheduleEvent(a,b){setTimeout(()=>{this.muted||a(b)},0)}}class w1{constructor(a,b){this.payload=a,this.byteLength=b}isBundleMetadata(){return"metadata"in this.payload}}class w2{constructor(a,b){this.reader=a,this.serializer=b,this.metadata=new iW,this.buffer=new Uint8Array,this.textDecoder=o2(),this.nextElementImpl().then(a=>{a&&a.isBundleMetadata()?this.metadata.resolve(a.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(a?.payload)}`))},a=>this.metadata.reject(a))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let a=await this.readLength();if(null===a)return null;let b=this.textDecoder.decode(a),c=Number(b);return isNaN(c)&&this.raiseError(`length string (${b}) is not valid number`),new w1(JSON.parse(await this.readJsonString(c)),a.length+c)}indexOfOpenBracket(){return this.buffer.findIndex(a=>123===a)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let a=this.indexOfOpenBracket();a<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let b=this.buffer.slice(0,a);return this.buffer=this.buffer.slice(a),b}async readJsonString(a){for(;this.buffer.length<a;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let b=this.textDecoder.decode(this.buffer.slice(0,a));return this.buffer=this.buffer.slice(a),b}raiseError(a){throw this.reader.cancel(),Error(`Invalid bundle format: ${a}`)}async pullMoreDataToBuffer(){let a=await this.reader.read();if(!a.done){let b=new Uint8Array(this.buffer.length+a.value.length);b.set(this.buffer),b.set(a.value,this.buffer.length),this.buffer=b}return a.done}}function w3(a,b){return new w2(a,b)}class w4{constructor(a,b){this.bundleData=a,this.serializer=b,this.cursor=0,this.elements=[];let c=this.nextElement();if(c&&c.isBundleMetadata())this.metadata=c;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(c?.payload)}`);do null!==(c=this.nextElement())&&this.elements.push(c);while(null!==c)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let a=this.readLength();return new w1(JSON.parse(this.readJsonString(a)),a)}readJsonString(a){if(this.cursor+a>this.bundleData.length)throw new iV(iS,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=a)}readLength(){let a=this.cursor,b=this.cursor;for(;b<this.bundleData.length;){if("{"===this.bundleData[b]){if(b===a)throw Error("First character is a bracket and not a number");return this.cursor=b,Number(this.bundleData.slice(a,b))}b++}throw Error("Reached the end of bundle when more is expected.")}}function w5(a,b){return new w4(a,b)}class w6{constructor(a){this.datastore=a,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(a){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new iV(iH,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let b=await u1(this.datastore,a);return b.forEach(a=>this.recordVersion(a)),b}set(a,b){this.write(b.toMutation(a,this.precondition(a))),this.writtenDocs.add(a.toString())}update(a,b){try{this.write(b.toMutation(a,this.preconditionForUpdate(a)))}catch(a){this.lastTransactionError=a}this.writtenDocs.add(a.toString())}delete(a){this.write(new oP(a,this.precondition(a))),this.writtenDocs.add(a.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let a=this.readVersions;this.mutations.forEach(b=>{a.delete(b.key.toString())}),a.forEach((a,b)=>{let c=ji.fromPath(b);this.mutations.push(new oS(c,this.precondition(c)))}),await u0(this.datastore,this.mutations),this.committed=!0}recordVersion(a){let b;if(a.isFoundDocument())b=a.version;else if(a.isNoDocument())b=jw.min();else throw iA(50498,{documentName:a.constructor.name});let c=this.readVersions.get(a.key.toString());if(c){if(!b.isEqual(c))throw new iV(iP,"Document version changed between two reads.")}else this.readVersions.set(a.key.toString(),b)}precondition(a){let b=this.readVersions.get(a.toString());return this.writtenDocs.has(a.toString())||!b?oy.none():b.isEqual(jw.min())?oy.exists(!1):oy.updateTime(b)}preconditionForUpdate(a){let b=this.readVersions.get(a.toString());if(this.writtenDocs.has(a.toString())||!b)return oy.exists(!0);if(b.isEqual(jw.min()))throw new iV(iH,"Can't update a document that doesn't exist.");return oy.updateTime(b)}write(a){this.ensureCommitNotCalled(),this.mutations.push(a)}ensureCommitNotCalled(){}}class w7{constructor(a,b,c,d,e){this.asyncQueue=a,this.datastore=b,this.options=c,this.updateFunction=d,this.deferred=e,this.attemptsRemaining=c.maxAttempts,this.backoff=new uS(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(async()=>{let a=new w6(this.datastore),b=this.tryRunUpdateFunction(a);b&&b.then(b=>{this.asyncQueue.enqueueAndForget(()=>a.commit().then(()=>{this.deferred.resolve(b)}).catch(a=>{this.handleTransactionError(a)}))}).catch(a=>{this.handleTransactionError(a)})})}tryRunUpdateFunction(a){try{let b=this.updateFunction(a);if(lV(b)||!b.catch||!b.then)return this.deferred.reject(Error("Transaction callback must return a Promise")),null;return b}catch(a){return this.deferred.reject(a),null}}handleTransactionError(a){this.attemptsRemaining>0&&this.isRetryableTransactionError(a)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(a)}isRetryableTransactionError(a){if(a?.name==="FirebaseError"){let b=a.code;return"aborted"===b||"failed-precondition"===b||"already-exists"===b||!oX(b)}return!1}}let w8="FirestoreClient",w9=100,xa=11,xb=20,xc=22;class xd{constructor(a,b,c,d,e){this.authCredentials=a,this.appCheckCredentials=b,this.asyncQueue=c,this._databaseInfo=d,this.user=iq.UNAUTHENTICATED,this.clientId=i5.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=e,this.authCredentials.start(c,async a=>{iw(w8,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(c,a=>(iw(w8,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:w9}}setCredentialChangeListener(a){this.authCredentialListener=a}setAppCheckTokenChangeListener(a){this.appCheckCredentialListener=a}terminate(){this.asyncQueue.enterRestrictedMode();let a=new iW;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),a.resolve()}catch(c){let b=vN(c,"Failed to shutdown persistence");a.reject(b)}}),a.promise}}async function xe(a,b){a.asyncQueue.verifyOperationInProgress(),iw(w8,"Initializing OfflineComponentProvider");let c=a.configuration;await b.initialize(c);let d=c.initialUser;a.setCredentialChangeListener(async a=>{d.isEqual(a)||(await tA(b.localStore,a),d=a)}),b.persistence.setDatabaseDeletedListener(()=>a.terminate()),a._offlineComponents=b}async function xf(a,b){a.asyncQueue.verifyOperationInProgress();let c=await xh(a);iw(w8,"Initializing OnlineComponentProvider"),await b.initialize(c,a.configuration),a.setCredentialChangeListener(a=>vH(b.remoteStore,a)),a.setAppCheckTokenChangeListener((a,c)=>vH(b.remoteStore,c)),a._onlineComponents=b}function xg(a){return"FirebaseError"===a.name?a.code===iO||a.code===iR:!("u">typeof DOMException&&a instanceof DOMException)||a.code===xc||a.code===xb||a.code===xa}async function xh(a){if(!a._offlineComponents)if(a._uninitializedComponentsProvider){iw(w8,"Using user provided OfflineComponentProvider");try{await xe(a,a._uninitializedComponentsProvider._offline)}catch(c){let b=c;if(!xg(b))throw b;iy("Error using user provided cache. Falling back to memory cache: "+b),await xe(a,new wU)}}else iw(w8,"Using default OfflineComponentProvider"),await xe(a,new wV(void 0));return a._offlineComponents}async function xi(a){return a._onlineComponents||(a._uninitializedComponentsProvider?(iw(w8,"Using user provided OnlineComponentProvider"),await xf(a,a._uninitializedComponentsProvider._online)):(iw(w8,"Using default OnlineComponentProvider"),await xf(a,new wY))),a._onlineComponents}function xj(a){return xh(a).then(a=>a.localStore)}function xk(a){return xi(a).then(a=>a.syncEngine)}function xl(a){return xi(a).then(a=>a.datastore)}async function xm(a){let b=await xi(a),c=b.eventManager;return c.onListen=wh.bind(null,b.syncEngine),c.onUnlisten=wl.bind(null,b.syncEngine),c.onFirstRemoteStoreListen=wi.bind(null,b.syncEngine),c.onLastRemoteStoreUnlisten=wm.bind(null,b.syncEngine),c}function xn(a,b,c,d){let e=new w0(d),f=new v2(b,e,c);return a.asyncQueue.enqueueAndForget(async()=>vV(await xm(a),f)),()=>{e.mute(),a.asyncQueue.enqueueAndForget(async()=>vW(await xm(a),f))}}function xo(a,b){let c=new iW;return a.asyncQueue.enqueueAndForget(async()=>xw(await xj(a),b,c)),c.promise}function xp(a,b,c={}){let d=new iW;return a.asyncQueue.enqueueAndForget(async()=>xx(await xm(a),a.asyncQueue,b,c,d)),d.promise}function xq(a,b){let c=new iW;return a.asyncQueue.enqueueAndForget(async()=>xy(await xj(a),b,c)),c.promise}function xr(a,b,c={}){let d=new iW;return a.asyncQueue.enqueueAndForget(async()=>xz(await xm(a),a.asyncQueue,b,c,d)),d.promise}function xs(a,b,c){let d=new iW;return a.asyncQueue.enqueueAndForget(async()=>{try{let e=await xl(a);d.resolve(u2(e,b,c))}catch(a){d.reject(a)}}),d.promise}function xt(a,b){let c=new iW;return a.asyncQueue.enqueueAndForget(async()=>wn(await xk(a),b,c)),c.promise}function xu(a,b){let c=new w0(b);return a.asyncQueue.enqueueAndForget(async()=>v$(await xm(a),c)),()=>{c.mute(),a.asyncQueue.enqueueAndForget(async()=>v_(await xm(a),c))}}function xv(a,b,c){let d=new iW;return a.asyncQueue.enqueueAndForget(async()=>{let e=await xl(a);new w7(a.asyncQueue,e,c,b,d).run()}),d.promise}async function xw(a,b,c){try{let d=await tL(a,b);d.isFoundDocument()?c.resolve(d):d.isNoDocument()?c.resolve(null):c.reject(new iV(iT,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(d){let a=vN(d,`Failed to get document '${b} from cache`);c.reject(a)}}function xx(a,b,c,d,e){let f=new w0({next:h=>{f.mute(),b.enqueueAndForget(()=>vW(a,g));let i=h.docs.has(c);!i&&h.fromCache?e.reject(new iV(iT,"Failed to get document because the client is offline.")):i&&h.fromCache&&d&&"server"===d.source?e.reject(new iV(iT,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e.resolve(h)},error:a=>e.reject(a)}),g=new v2(nz(c.path),f,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return vV(a,g)}async function xy(a,b,c){try{let d=await tP(a,b,!0),e=new wa(b,d.remoteKeys),f=e.computeDocChanges(d.documents),g=e.applyChanges(f,!1);c.resolve(g.snapshot)}catch(d){let a=vN(d,`Failed to execute query '${b} against cache`);c.reject(a)}}function xz(a,b,c,d,e){let f=new w0({next:c=>{f.mute(),b.enqueueAndForget(()=>vW(a,g)),c.fromCache&&"server"===d.source?e.reject(new iV(iT,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e.resolve(c)},error:a=>e.reject(a)}),g=new v2(c,f,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return vV(a,g)}function xA(a,b,c,d){let e=xC(c,uN(b));a.asyncQueue.enqueueAndForget(async()=>{wS(await xk(a),e,d)})}function xB(a,b){return a.asyncQueue.enqueue(async()=>t_(await xj(a),b))}function xC(a,b){let c;return w3(w_(c="string"==typeof a?o1().encode(a):a),b)}function xD(a,b){return w5(a,b)}function xE(a,b){return a.asyncQueue.enqueue(async()=>t1(await xj(a),b))}function xF(a,b){return a.asyncQueue.enqueue(async()=>t2(await xj(a),b))}function xG(a){return a.asyncQueue.enqueue(async()=>t3(await xj(a)))}function xH(a,b){return a.timeoutSeconds===b.timeoutSeconds}function xI(a){let b={};return void 0!==a.timeoutSeconds&&(b.timeoutSeconds=a.timeoutSeconds),b}let xJ="ComponentProvider",xK=new Map;function xL(a){let b=xK.get(a);b&&(iw(xJ,"Removing Datastore"),xK.delete(a),b.terminate())}function xM(a,b,c,d,e){return new lQ(a,b,c,e.host,e.ssl,e.experimentalForceLongPolling,e.experimentalAutoDetectLongPolling,xI(e.experimentalLongPollingOptions),e.useFetchStreams,e.isUsingEmulator,d)}let xN="firestore.googleapis.com",xO=!0,xP=5,xQ=30,xR=!0;class xS{constructor(a){if(void 0===a.host){if(void 0!==a.ssl)throw new iV(iH,"Can't provide ssl option if host option is not set");this.host=xN,this.ssl=xO}else this.host=a.host,this.ssl=a.ssl??xO;if(this.isUsingEmulator=void 0!==a.emulatorOptions,this.credentials=a.credentials,this.ignoreUndefinedProperties=!!a.ignoreUndefinedProperties,this.localCache=a.localCache,void 0===a.cacheSizeBytes)this.cacheSizeBytes=si;else if(a.cacheSizeBytes!==sh&&a.cacheSizeBytes<sl)throw new iV(iH,`cacheSizeBytes must be at least ${sl}`);else this.cacheSizeBytes=a.cacheSizeBytes;jk("experimentalForceLongPolling",a.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",a.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!a.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===a.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=xR:this.experimentalAutoDetectLongPolling=!!a.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=xI(a.experimentalLongPollingOptions??{}),xT(this.experimentalLongPollingOptions),this.useFetchStreams=!!a.useFetchStreams}isEqual(a){return this.host===a.host&&this.ssl===a.ssl&&this.credentials===a.credentials&&this.cacheSizeBytes===a.cacheSizeBytes&&this.experimentalForceLongPolling===a.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===a.experimentalAutoDetectLongPolling&&xH(this.experimentalLongPollingOptions,a.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===a.ignoreUndefinedProperties&&this.useFetchStreams===a.useFetchStreams}}function xT(a){if(void 0!==a.timeoutSeconds){if(isNaN(a.timeoutSeconds))throw new iV(iH,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<xP)throw new iV(iH,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is ${xP})`);if(a.timeoutSeconds>xQ)throw new iV(iH,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is ${xQ})`)}}class xU{constructor(a,b,c,d){this._authCredentials=a,this._appCheckCredentials=b,this._databaseId=c,this._app=d,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new iV(iO,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(a){if(this._settingsFrozen)throw new iV(iO,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xS(a),this._emulatorOptions=a.emulatorOptions||{},void 0!==a.credentials&&(this._authCredentials=i3(a.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return xL(this),Promise.resolve()}}function xV(a,b,c,d={}){a=jp(a,xU);let e=T(b),f=a._getSettings(),g={...f,emulatorOptions:a._getEmulatorOptions()},h=`${b}:${c}`;e&&(U(`https://${h}`),W("Firestore",!0)),f.host!==xN&&f.host!==h&&iy("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let i={...f,host:h,ssl:e,emulatorOptions:d};if(!au(i,g)&&(a._setSettings(i),d.mockUserToken)){let b,c;if("string"==typeof d.mockUserToken)b=d.mockUserToken,c=iq.MOCK_USER;else{b=V(d.mockUserToken,a._app?.options.projectId);let e=d.mockUserToken.sub||d.mockUserToken.user_id;if(!e)throw new iV(iH,"mockUserToken must contain 'sub' or 'user_id' field!");c=new iq(e)}a._authCredentials=new iZ(new iX(b,c))}}class xW{constructor(a,b,c){this.converter=b,this._query=c,this.type="query",this.firestore=a}withConverter(a){return new xW(this.firestore,a,this._query)}}class xX{constructor(a,b,c){this.converter=b,this._key=c,this.type="document",this.firestore=a}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xY(this.firestore,this.converter,this._key.path.popLast())}withConverter(a){return new xX(this.firestore,a,this._key)}toJSON(){return{type:xX._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(a,b,c){if(js(b,xX._jsonSchema))return new xX(a,c||null,new ji(jf.fromString(b.referencePath)))}}xX._jsonSchemaVersion="firestore/documentReference/1.0",xX._jsonSchema={type:jr("string",xX._jsonSchemaVersion),referencePath:jr("string")};class xY extends xW{constructor(a,b,c){super(a,b,nz(c)),this._path=c,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let a=this._path.popLast();return a.isEmpty()?null:new xX(this.firestore,null,new ji(a))}withConverter(a){return new xY(this.firestore,a,this._path)}}function xZ(a,b,...c){if(a=aB(a),1==arguments.length&&(b=i5.newId()),jj("doc","path",b),a instanceof xU){let d=jf.fromString(b,...c);return jl(d),new xX(a,null,new ji(d))}{if(!(a instanceof xX)&&!(a instanceof xY))throw new iV(iH,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let d=a._path.child(jf.fromString(b,...c));return jl(d),new xX(a.firestore,a instanceof xY?a.converter:null,new ji(d))}}function x$(a,b){return a=aB(a),b=aB(b),a instanceof xW&&b instanceof xW&&a.firestore===b.firestore&&nO(a._query,b._query)&&a.converter===b.converter}let x_="AsyncQueue";class x0{constructor(a=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new uS(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=a}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(a){this.enqueue(a)}enqueueAndForgetEvenWhileRestricted(a){this.verifyNotFailed(),this.enqueueInternal(a)}enterRestrictedMode(a){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=a||!1)}enqueue(a){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let b=new iW;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(a().then(b.resolve,b.reject),b.promise)).then(()=>b.promise)}enqueueRetryable(a){this.enqueueAndForget(()=>(this.retryableOps.push(a),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(a){if(jX(a))iw(x_,"Operation failed with retryable error: "+a);else throw a}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(a){let b=this.tail.then(()=>(this.operationInProgress=!0,a().catch(a=>{throw this.failure=a,this.operationInProgress=!1,ix("INTERNAL UNHANDLED ERROR: ",x1(a)),a}).then(a=>(this.operationInProgress=!1,a))));return this.tail=b,b}enqueueAfterDelay(a,b,c){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(a)>-1&&(b=0);let d=vM.createAndSchedule(this,a,b,c,a=>this.removeDelayedOperation(a));return this.delayedOperations.push(d),d}verifyNotFailed(){this.failure&&iA(47125,{messageOrStack:x1(this.failure)})}verifyOperationInProgress(){}async drain(){let a;do a=this.tail,await a;while(a!==this.tail)}containsDelayedOperation(a){for(let b of this.delayedOperations)if(b.timerId===a)return!0;return!1}runAllDelayedOperationsUntil(a){return this.drain().then(()=>{for(let b of(this.delayedOperations.sort((a,b)=>a.targetTimeMs-b.targetTimeMs),this.delayedOperations))if(b.skipDelay(),"all"!==a&&b.timerId===a)break;return this.drain()})}skipDelaysForTimerId(a){this.timerIdsToSkip.push(a)}removeDelayedOperation(a){let b=this.delayedOperations.indexOf(a);this.delayedOperations.splice(b,1)}}function x1(a){let b=a.message||"";return a.stack&&(b=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),b}class x2{constructor(){this._progressObserver={},this._taskCompletionResolver=new iW,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(a,b,c){this._progressObserver={next:a,error:b,complete:c}}catch(a){return this._taskCompletionResolver.promise.catch(a)}then(a,b){return this._taskCompletionResolver.promise.then(a,b)}_completeWith(a){this._updateProgress(a),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(a)}_failWith(a){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(a),this._taskCompletionResolver.reject(a)}_updateProgress(a){this._lastProgress=a,this._progressObserver.next&&this._progressObserver.next(a)}}class x3 extends xU{constructor(a,b,c,d){super(a,b,c,d),this.type="firestore",this._queue=new x0,this._persistenceKey=d?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let a=this._firestoreClient.terminate();this._queue=new x0(a),this._firestoreClient=void 0,await a}}}function x4(a,b){let c="object"==typeof a?a:bA(),d="string"==typeof a?a:b||lR,e=bn(c,"firestore").getImmediate({identifier:d});if(!e._initialized){let a=Q("firestore");a&&xV(e,...a)}return e}function x5(a){if(a._terminated)throw new iV(iO,"The client has already been terminated.");return a._firestoreClient||x6(a),a._firestoreClient}function x6(a){let b=a._freezeSettings(),c=xM(a._databaseId,a._app?.options.appId||"",a._persistenceKey,a._app?.options.apiKey,b);!a._componentsProvider&&b.localCache?._offlineComponentProvider&&b.localCache?._onlineComponentProvider&&(a._componentsProvider={_offline:b.localCache._offlineComponentProvider,_online:b.localCache._onlineComponentProvider}),a._firestoreClient=new xd(a._authCredentials,a._appCheckCredentials,a._queue,c,a._componentsProvider&&x7(a._componentsProvider))}function x7(a){let b=a?._online.build();return{_offline:a?._offline.build(b),_online:b}}function x8(a,b){let c=x5(a=jp(a,x3)),d=new x2;return xA(c,a._databaseId,b,d),d}function x9(a,b){return xB(x5(a=jp(a,x3)),b).then(b=>b?new xW(a,null,b.query):null)}class ya{constructor(a,b,c){this.alias=a,this.aggregateType=b,this.fieldPath=c}}class yb{constructor(a){this._byteString=a}static fromBase64String(a){try{return new yb(lB.fromBase64String(a))}catch(a){throw new iV(iH,"Failed to construct data from Base64 string: "+a)}}static fromUint8Array(a){return new yb(lB.fromUint8Array(a))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(a){return this._byteString.isEqual(a._byteString)}toJSON(){return{type:yb._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(a){if(js(a,yb._jsonSchema))return yb.fromBase64String(a.bytes)}}yb._jsonSchemaVersion="firestore/bytes/1.0",yb._jsonSchema={type:jr("string",yb._jsonSchemaVersion),bytes:jr("string")};class yc{constructor(...a){for(let b=0;b<a.length;++b)if(0===a[b].length)throw new iV(iH,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new jh(a)}isEqual(a){return this._internalPath.isEqual(a._internalPath)}}class yd{constructor(a){this._methodName=a}}class ye{constructor(a,b){if(!isFinite(a)||a<-90||a>90)throw new iV(iH,"Latitude must be a number between -90 and 90, but was: "+a);if(!isFinite(b)||b<-180||b>180)throw new iV(iH,"Longitude must be a number between -180 and 180, but was: "+b);this._lat=a,this._long=b}get latitude(){return this._lat}get longitude(){return this._long}isEqual(a){return this._lat===a._lat&&this._long===a._long}_compareTo(a){return i6(this._lat,a._lat)||i6(this._long,a._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ye._jsonSchemaVersion}}static fromJSON(a){if(js(a,ye._jsonSchema))return new ye(a.latitude,a.longitude)}}ye._jsonSchemaVersion="firestore/geoPoint/1.0",ye._jsonSchema={type:jr("string",ye._jsonSchemaVersion),latitude:jr("number"),longitude:jr("number")};class yf{constructor(a){this._values=(a||[]).map(a=>a)}toArray(){return this._values.map(a=>a)}isEqual(a){return tv(this._values,a._values)}toJSON(){return{type:yf._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(a){if(js(a,yf._jsonSchema)){if(Array.isArray(a.vectorValues)&&a.vectorValues.every(a=>"number"==typeof a))return new yf(a.vectorValues);throw new iV(iH,"Expected 'vectorValues' field to be a number array")}}}yf._jsonSchemaVersion="firestore/vectorValue/1.0",yf._jsonSchema={type:jr("string",yf._jsonSchemaVersion),vectorValues:jr("object")};let yg=/^__.*__$/;class yh{constructor(a,b,c){this.data=a,this.fieldMask=b,this.fieldTransforms=c}toMutation(a,b){return null!==this.fieldMask?new oJ(a,this.data,this.fieldMask,b,this.fieldTransforms):new oG(a,this.data,b,this.fieldTransforms)}}class yi{constructor(a,b,c){this.data=a,this.fieldMask=b,this.fieldTransforms=c}toMutation(a,b){return new oJ(a,this.data,this.fieldMask,b,this.fieldTransforms)}}function yj(a){switch(a){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw iA(40011,{dataSource:a})}}class yk{constructor(a,b,c,d,e,f){this.settings=a,this.databaseId=b,this.serializer=c,this.ignoreUndefinedProperties=d,void 0===e&&this.validatePath(),this.fieldTransforms=e||[],this.fieldMask=f||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(a){return new yk({...this.settings,...a},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(a){let b=this.path?.child(a),c=this.contextWith({path:b,arrayElement:!1});return c.validatePathSegment(a),c}childContextForFieldPath(a){let b=this.path?.child(a),c=this.contextWith({path:b,arrayElement:!1});return c.validatePath(),c}childContextForArray(a){return this.contextWith({path:void 0,arrayElement:!0})}createError(a){return yD(a,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(a){return void 0!==this.fieldMask.find(b=>a.isPrefixOf(b))||void 0!==this.fieldTransforms.find(b=>a.isPrefixOf(b.field))}validatePath(){if(this.path)for(let a=0;a<this.path.length;a++)this.validatePathSegment(this.path.get(a))}validatePathSegment(a){if(0===a.length)throw this.createError("Document fields must not be empty");if(yj(this.dataSource)&&yg.test(a))throw this.createError('Document fields cannot begin and end with "__"')}}class yl{constructor(a,b,c){this.databaseId=a,this.ignoreUndefinedProperties=b,this.serializer=c||uN(a)}createContext(a,b,c,d=!1){return new yk({dataSource:a,methodName:b,targetDoc:c,path:jh.emptyPath(),arrayElement:!1,hasConverter:d},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ym(a){let b=a._freezeSettings(),c=uN(a._databaseId);return new yl(a._databaseId,!!b.ignoreUndefinedProperties,c)}function yn(a,b,c,d,e,f={}){let g,h,i=a.createContext(f.merge||f.mergeFields?2:0,b,c,e);yz("Data must be an object, but it was:",i,d);let j=yt(d,i);if(f.merge)g=new ly(i.fieldMask),h=i.fieldTransforms;else if(f.mergeFields){let a=[];for(let d of f.mergeFields){let e=yA(b,d,c);if(!i.contains(e))throw new iV(iH,`Field '${e}' is specified in your field mask but missing from your input data.`);yE(a,e)||a.push(e)}g=new ly(a),h=i.fieldTransforms.filter(a=>g.covers(a.field))}else g=null,h=i.fieldTransforms;return new yh(new mK(j),g,h)}class yo extends yd{_toFieldTransform(a){if(2===a.dataSource)a.fieldMask.push(a.path);else if(1===a.dataSource)throw a.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw a.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(a){return a instanceof yo}}function yp(a,b,c,d){let e=a.createContext(1,b,c);yz("Data must be an object, but it was:",e,d);let f=[],g=mK.empty();return ln(d,(a,d)=>{let h=yC(b,a,c);d=aB(d);let i=e.childContextForFieldPath(h);if(d instanceof yo)f.push(h);else{let a=ys(d,i);null!=a&&(f.push(h),g.set(h,a))}}),new yi(g,new ly(f),e.fieldTransforms)}function yq(a,b,c,d,e,f){let g=a.createContext(1,b,c),h=[yA(b,d,c)],i=[e];if(f.length%2!=0)throw new iV(iH,`Function ${b}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let a=0;a<f.length;a+=2)h.push(yA(b,f[a])),i.push(f[a+1]);let j=[],k=mK.empty();for(let a=h.length-1;a>=0;--a)if(!yE(j,h[a])){let b=h[a],c=i[a];c=aB(c);let d=g.childContextForFieldPath(b);if(c instanceof yo)j.push(b);else{let a=ys(c,d);null!=a&&(j.push(b),k.set(b,a))}}return new yi(k,new ly(j),g.fieldTransforms)}function yr(a,b,c,d=!1){return ys(c,a.createContext(d?4:3,b))}function ys(a,b){if(yy(a=aB(a)))return yz("Unsupported field value:",b,a),yt(a,b);if(a instanceof yd)return yv(a,b),null;if(void 0===a&&b.ignoreUndefinedProperties)return null;if(b.path&&b.fieldMask.push(b.path),!(a instanceof Array))return yw(a,b);if(b.settings.arrayElement&&4!==b.dataSource)throw b.createError("Nested arrays are not supported");return yu(a,b)}function yt(a,b){let c={};return lp(a)?b.path&&b.path.length>0&&b.fieldMask.push(b.path):ln(a,(a,d)=>{let e=ys(d,b.childContextForField(a));null!=e&&(c[a]=e)}),{mapValue:{fields:c}}}function yu(a,b){let c=[],d=0;for(let e of a){let a=ys(e,b.childContextForArray(d));null==a&&(a={nullValue:"NULL_VALUE"}),c.push(a),d++}return{arrayValue:{values:c}}}function yv(a,b){if(!yj(b.dataSource))throw b.createError(`${a._methodName}() can only be used with update() and set()`);if(!b.path)throw b.createError(`${a._methodName}() is not currently supported inside arrays`);let c=a._toFieldTransform(b);c&&b.fieldTransforms.push(c)}function yw(a,b){if(null===(a=aB(a)))return{nullValue:"NULL_VALUE"};if("number"==typeof a)return of(b.serializer,a);if("boolean"==typeof a)return{booleanValue:a};if("string"==typeof a)return{stringValue:a};if(a instanceof Date){let c=jv.fromDate(a);return{timestampValue:pr(b.serializer,c)}}else if(a instanceof jv){let c=new jv(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:pr(b.serializer,c)}}else if(a instanceof ye)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};else if(a instanceof yb)return{bytesValue:pt(b.serializer,a._byteString)};else if(a instanceof xX){let c=b.databaseId,d=a.firestore._databaseId;if(!d.isEqual(c))throw b.createError(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:px(a.firestore._databaseId||b.databaseId,a._key.path)}}else if(a instanceof yf)return yx(a,b);else if(qx(a))return a._toProto(b.serializer);else throw b.createError(`Unsupported field value: ${jn(a)}`)}function yx(a,b){return{mapValue:{fields:{[lY]:{stringValue:l_},[l0]:{arrayValue:{values:(a instanceof yf?a.toArray():a).map(a=>{if("number"!=typeof a)throw b.createError("VectorValues must only contain numeric values.");return od(b.serializer,a)})}}}}}}function yy(a){return"object"==typeof a&&null!==a&&!(a instanceof Array)&&!(a instanceof Date)&&!(a instanceof jv)&&!(a instanceof ye)&&!(a instanceof yb)&&!(a instanceof xX)&&!(a instanceof yd)&&!(a instanceof yf)&&!qx(a)}function yz(a,b,c){if(!yy(c)||!jm(c)){let d=jn(c);if("an object"===d)throw b.createError(a+" a custom object");throw b.createError(a+" "+d)}}function yA(a,b,c){if((b=aB(b))instanceof yc)return b._internalPath;if("string"==typeof b)return yC(a,b);throw yD("Field path arguments must be of type string or ",a,!1,void 0,c)}let yB=RegExp("[~\\*/\\[\\]]");function yC(a,b,c){if(b.search(yB)>=0)throw yD(`Invalid field path (${b}). Paths must not contain '~', '*', '/', '[', or ']'`,a,!1,void 0,c);try{return new yc(...b.split("."))._internalPath}catch(d){throw yD(`Invalid field path (${b}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,a,!1,void 0,c)}}function yD(a,b,c,d,e){let f=d&&!d.isEmpty(),g=void 0!==e,h=`Function ${b}() called with invalid data`;c&&(h+=" (via `toFirestore()`)"),h+=". ";let i="";return(f||g)&&(i+=" (found",f&&(i+=` in field ${d}`),g&&(i+=` in document ${e}`),i+=")"),new iV(iH,h+a+i)}function yE(a,b){return a.some(a=>a.isEqual(b))}class yF{convertValue(a,b="none"){switch(l2(a)){case 0:return null;case 1:return a.booleanValue;case 2:return lG(a.integerValue||a.doubleValue);case 3:return this.convertTimestamp(a.timestampValue);case 4:return this.convertServerTimestamp(a,b);case 5:return a.stringValue;case 6:return this.convertBytes(lH(a.bytesValue));case 7:return this.convertReference(a.referenceValue);case 8:return this.convertGeoPoint(a.geoPointValue);case 9:return this.convertArray(a.arrayValue,b);case 11:return this.convertObject(a.mapValue,b);case 10:return this.convertVectorValue(a.mapValue);default:throw iA(62114,{value:a})}}convertObject(a,b){return this.convertObjectMap(a.fields,b)}convertObjectMap(a,b="none"){let c={};return ln(a,(a,d)=>{c[a]=this.convertValue(d,b)}),c}convertVectorValue(a){return new yf(a.fields?.[l0].arrayValue?.values?.map(a=>lG(a.doubleValue)))}convertGeoPoint(a){return new ye(lG(a.latitude),lG(a.longitude))}convertArray(a,b){return(a.values||[]).map(a=>this.convertValue(a,b))}convertServerTimestamp(a,b){switch(b){case"previous":let c=lO(a);if(null==c)return null;return this.convertValue(c,b);case"estimate":return this.convertTimestamp(lP(a));default:return null}}convertTimestamp(a){let b=lF(a);return new jv(b.seconds,b.nanos)}convertDocumentKey(a,b){let c=jf.fromString(a);iC(qw(c),9688,{name:a});let d=new lS(c.get(1),c.get(3)),e=new ji(c.popFirst(5));return d.isEqual(b)||ix(`Document ${e} contains a document reference within a different database (${d.projectId}/${d.database}) which is not supported. It will be treated as a reference in the current database (${b.projectId}/${b.database}) instead.`),e}}class yG extends yF{constructor(a){super(),this.firestore=a}convertBytes(a){return new yb(a)}convertReference(a){let b=this.convertDocumentKey(a,this.firestore._databaseId);return new xX(this.firestore,null,b)}}let yH="@firebase/firestore",yI="4.10.0";function yJ(a,b=!0){is(bx),bm(new aK("firestore",(a,{instanceIdentifier:c,options:d})=>{let e=a.getProvider("app").getImmediate(),f=new x3(new i$(a.getProvider("auth-internal")),new i2(e,a.getProvider("app-check-internal")),lT(e,c),e);return d={useFetchStreams:b,...d},f._setSettings(d),f},"PUBLIC").setMultipleInstances(!0)),bD(yH,yI,a),bD(yH,yI,"esm2020")}class yK{constructor(a="count",b){this._internalFieldPath=b,this.type="AggregateField",this.aggregateType=a}}class yL{constructor(a,b,c){this._userDataWriter=b,this._data=c,this.type="AggregateQuerySnapshot",this.query=a}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new mK({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class yM{constructor(a,b,c,d,e){this._firestore=a,this._userDataWriter=b,this._key=c,this._document=d,this._converter=e}get id(){return this._key.path.lastSegment()}get ref(){return new xX(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let a=new yN(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(a)}}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(a){if(this._document){let b=this._document.data.field(yA("DocumentSnapshot.get",a));if(null!==b)return this._userDataWriter.convertValue(b)}}}class yN extends yM{data(){return super.data()}}function yO(a){if("L"===a.limitType&&0===a.explicitOrderBy.length)throw new iV(iR,"limitToLast() queries require specifying at least one orderBy() clause")}class yP{}class yQ extends yP{}function yR(a,b,...c){let d=[];for(let e of(b instanceof yP&&d.push(b),zi(d=d.concat(c)),d))a=e._apply(a);return a}class yS extends yQ{constructor(a,b,c){super(),this._field=a,this._op=b,this._value=c,this.type="where"}static _create(a,b,c){return new yS(a,b,c)}_apply(a){let b=this._parse(a);return ze(a._query,b),new xW(a.firestore,a.converter,nJ(a._query,b))}_parse(a){let b=ym(a.firestore);return y7(a._query,"where",b,a.firestore._databaseId,this._field,this._op,this._value)}}function yT(a,b,c){let d=b,e=yA("where",a);return yS._create(e,d,c)}class yU extends yP{constructor(a,b){super(),this.type=a,this._queryConstraints=b}static _create(a,b){return new yU(a,b)}_parse(a){let b=this._queryConstraints.map(b=>b._parse(a)).filter(a=>a.getFilters().length>0);return 1===b.length?b[0]:mZ.create(b,this._getOperator())}_apply(a){let b=this._parse(a);return 0===b.getFilters().length?a:(zf(a._query,b),new xW(a.firestore,a.converter,nJ(a._query,b)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function yV(...a){return a.forEach(a=>zh("or",a)),yU._create("or",a)}function yW(...a){return a.forEach(a=>zh("and",a)),yU._create("and",a)}class yX extends yQ{constructor(a,b){super(),this._field=a,this._direction=b,this.type="orderBy"}static _create(a,b){return new yX(a,b)}_apply(a){let b=y8(a._query,this._field,this._direction);return new xW(a.firestore,a.converter,nK(a._query,b))}}function yY(a,b="asc"){let c=b,d=yA("orderBy",a);return yX._create(d,c)}class yZ extends yQ{constructor(a,b,c){super(),this.type=a,this._limit=b,this._limitType=c}static _create(a,b,c){return new yZ(a,b,c)}_apply(a){return new xW(a.firestore,a.converter,nL(a._query,this._limit,this._limitType))}}function y$(a){return jq("limit",a),yZ._create("limit",a,"F")}function y_(a){return jq("limitToLast",a),yZ._create("limitToLast",a,"L")}class y0 extends yQ{constructor(a,b,c){super(),this.type=a,this._docOrFields=b,this._inclusive=c}static _create(a,b,c){return new y0(a,b,c)}_apply(a){let b=y6(a,this.type,this._docOrFields,this._inclusive);return new xW(a.firestore,a.converter,nM(a._query,b))}}function y1(...a){return y0._create("startAt",a,!0)}function y2(...a){return y0._create("startAfter",a,!1)}class y3 extends yQ{constructor(a,b,c){super(),this.type=a,this._docOrFields=b,this._inclusive=c}static _create(a,b,c){return new y3(a,b,c)}_apply(a){let b=y6(a,this.type,this._docOrFields,this._inclusive);return new xW(a.firestore,a.converter,nN(a._query,b))}}function y4(...a){return y3._create("endBefore",a,!1)}function y5(...a){return y3._create("endAt",a,!0)}function y6(a,b,c,d){if(c[0]=aB(c[0]),c[0]instanceof yM)return y9(a._query,a.firestore._databaseId,b,c[0]._document,d);{let e=ym(a.firestore);return za(a._query,a.firestore._databaseId,e,b,c,d)}}function y7(a,b,c,d,e,f,g){let h;if(e.isKeyField())if("array-contains"===f||"array-contains-any"===f)throw new iV(iH,`Invalid Query. You can't perform '${f}' queries on documentId().`);else if("in"===f||"not-in"===f){zc(g,f);let b=[];for(let c of g)b.push(zb(d,a,c));h={arrayValue:{values:b}}}else h=zb(d,a,g);else("in"===f||"not-in"===f||"array-contains-any"===f)&&zc(g,f),h=yr(c,b,g,"in"===f||"not-in"===f);return mY.create(e,f,h)}function y8(a,b,c){if(null!==a.startAt)throw new iV(iH,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==a.endAt)throw new iV(iH,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new mT(b,c)}function y9(a,b,c,d,e){if(!d)throw new iV(iJ,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let f=[];for(let c of nF(a))if(c.field.isKeyField())f.push(mu(b,d.key));else{let a=d.data.field(c.field);if(lM(a))throw new iV(iH,'Invalid query. You are trying to start or end a query using a document for which the field "'+c.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==a)f.push(a);else{let a=c.field.canonicalString();throw new iV(iH,`Invalid query. You are trying to start or end a query using a document for which the field '${a}' (used as the orderBy) does not exist.`)}}return new mO(f,e)}function za(a,b,c,d,e,f){let g=a.explicitOrderBy;if(e.length>g.length)throw new iV(iH,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let h=[];for(let f=0;f<e.length;f++){let i=e[f];if(g[f].field.isKeyField()){if("string"!=typeof i)throw new iV(iH,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof i}`);if(!nE(a)&&-1!==i.indexOf("/"))throw new iV(iH,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${i}' contains a slash.`);let c=a.path.child(jf.fromString(i));if(!ji.isDocumentKey(c))throw new iV(iH,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${c}' is not because it contains an odd number of segments.`);let e=new ji(c);h.push(mu(b,e))}else{let a=yr(c,d,i);h.push(a)}}return new mO(h,f)}function zb(a,b,c){if("string"==typeof(c=aB(c))){if(""===c)throw new iV(iH,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!nE(b)&&-1!==c.indexOf("/"))throw new iV(iH,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${c}' contains a '/' character.`);let d=b.path.child(jf.fromString(c));if(!ji.isDocumentKey(d))throw new iV(iH,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${d}' is not because it has an odd number of segments (${d.length}).`);return mu(a,new ji(d))}if(c instanceof xX)return mu(a,c._key);throw new iV(iH,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${jn(c)}.`)}function zc(a,b){if(!Array.isArray(a)||0===a.length)throw new iV(iH,`Invalid Query. A non-empty array is required for '${b.toString()}' filters.`)}function zd(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function ze(a,b){let c=zg(a.filters,zd(b.op));if(null!==c)if(c===b.op)throw new iV(iH,`Invalid query. You cannot use more than one '${b.op.toString()}' filter.`);else throw new iV(iH,`Invalid query. You cannot use '${b.op.toString()}' filters with '${c.toString()}' filters.`)}function zf(a,b){let c=a;for(let a of b.getFlattenedFilters())ze(c,a),c=nJ(c,a)}function zg(a,b){for(let c of a)for(let a of c.getFlattenedFilters())if(b.indexOf(a.op)>=0)return a.op;return null}function zh(a,b){if(!(b instanceof yS)&&!(b instanceof yU))throw new iV(iH,`Function ${a}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function zi(a){let b=a.filter(a=>a instanceof yU).length,c=a.filter(a=>a instanceof yS).length;if(b>1||b>0&&c>0)throw new iV(iH,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}function zj(a,b,c){return a?c&&(c.merge||c.mergeFields)?a.toFirestore(b,c):a.toFirestore(b):b}class zk extends yF{constructor(a){super(),this.firestore=a}convertBytes(a){return new yb(a)}convertReference(a){let b=this.convertDocumentKey(a,this.firestore._databaseId);return new xX(this.firestore,null,b)}}function zl(a){return new yK("sum",yA("sum",a))}function zm(a){return new yK("avg",yA("average",a))}function zn(){return new yK("count")}function zo(a,b){return a instanceof yK&&b instanceof yK&&a.aggregateType===b.aggregateType&&a._internalFieldPath?.canonicalString()===b._internalFieldPath?.canonicalString()}function zp(a,b){return x$(a.query,b.query)&&au(a.data(),b.data())}function zq(a){return zr(a,{count:zn()})}function zr(a,b){let c=jp(a.firestore,x3),d=x5(c),e=lo(b,(a,b)=>new ya(b,a.aggregateType,a._internalFieldPath));return xs(d,a._query,e).then(b=>zs(c,a,b))}function zs(a,b,c){return new yL(b,new yG(a),c)}class zt{constructor(a){this.kind="memory",this._onlineComponentProvider=wY.provider,a?.garbageCollector?this._offlineComponentProvider=a.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new wV(void 0)}}toJSON(){return{kind:this.kind}}}class zu{constructor(a){let b;this.kind="persistent",a?.tabManager?(a.tabManager._initialize(a),b=a.tabManager):(b=zD(void 0))._initialize(a),this._onlineComponentProvider=b._onlineComponentProvider,this._offlineComponentProvider=b._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class zv{constructor(){this.kind="memoryEager",this._offlineComponentProvider=wU.provider}toJSON(){return{kind:this.kind}}}class zw{constructor(a){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new wV(a)}}toJSON(){return{kind:this.kind}}}function zx(){return new zv}function zy(a){return new zw(a?.cacheSizeBytes)}function zz(a){return new zt(a)}function zA(a){return new zu(a)}class zB{constructor(a){this.forceOwnership=a,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(a){this._onlineComponentProvider=wY.provider,this._offlineComponentProvider={build:b=>new wW(b,a?.cacheSizeBytes,this.forceOwnership)}}}class zC{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(a){this._onlineComponentProvider=wY.provider,this._offlineComponentProvider={build:b=>new wX(b,a?.cacheSizeBytes)}}}function zD(a){return new zB(a?.forceOwnership)}function zE(){return new zC}let zF=o1();function zG(a){let b=JSON.stringify(a),c=zF.encode(b).byteLength;return`${c}${b}`}zG({metadata:{id:"test-bundle",createTime:{seconds:0x5e0be105,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),zG({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),zG({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),zG({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),zG({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),zG({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),zG({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:0x5ec5a5f3,nanos:191164e3}}}),zG({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:0x5ec5a5f3,nanos:543063e3}}});let zH=1;class zI{constructor(a,b){this.firestore=a,this.bundleId=b,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new jv(0,0),this.databaseId=a._databaseId,this.serializer=new pn(this.databaseId,!0),this.userDataReader=new yl(this.databaseId,!0,this.serializer)}addBundleDocument(a,b){let c=this.documents.get(a.documentPath),d=c?.metadata.queries,e=a.readTime,f=c?.metadata.readTime?ps(c.metadata.readTime):null,g=!e&&null==f,h=void 0!==e&&(null==f||f<e);if((g||h)&&this.documents.set(a.documentPath,{document:this.toBundleDocument(a),metadata:{name:pA(this.serializer,a.documentKey),readTime:e?pr(this.serializer,e):void 0,exists:a.documentExists}}),e&&e>this.latestReadTime&&(this.latestReadTime=e),b){let c=this.documents.get(a.documentPath);c.metadata.queries=d||[],c.metadata.queries.push(b)}}addBundleQuery(a){if(this.namedQueries.has(a.name))throw Error(`Query name conflict: ${name} has already been added.`);let b=new jv(0,0);for(let c of a.docBundleDataArray)this.addBundleDocument(c,a.name),c.readTime&&c.readTime>b&&(b=c.readTime);let c=p$(this.serializer,nG(a.query)),d={parent:a.parent,structuredQuery:c.queryTarget.structuredQuery};this.namedQueries.set(a.name,{name:a.name,bundledQuery:d,readTime:pr(this.serializer,b)})}toBundleDocument(a){let b=this.userDataReader.createContext(4,"internal toBundledDocument"),c=yt(a.documentData,b);return{name:pA(this.serializer,a.documentKey),fields:c.mapValue.fields,updateTime:pr(this.serializer,a.versionTime),createTime:pr(this.serializer,a.createdTime)}}lengthPrefixedString(a){let b=JSON.stringify(a),c=zF.encode(b).byteLength;return`${c}${b}`}build(){let a="";for(let b of this.namedQueries.values())a+=this.lengthPrefixedString({namedQuery:b});for(let b of this.documents.values()){let c=b.metadata;a+=this.lengthPrefixedString({documentMetadata:c});let d=b.document;d&&(a+=this.lengthPrefixedString({document:d}))}let b={id:this.bundleId,createTime:pr(this.serializer,this.latestReadTime),version:zH,totalDocuments:this.documents.size,totalBytes:zF.encode(a).length};return this.lengthPrefixedString({metadata:b})+a}}function zJ(a,b,c,d){let e=new zI(a,i5.newId());return e.addBundleDocument(zL(d,c,b)),e.build()}function zK(a,b,c,d,e,f,g){let h=[];for(let a=0;a<f.length;a++)h.push(zL(e[a],g[a],f[a]));let i={name:c,query:b,parent:d,docBundleDataArray:h},j=new zI(a,c);return j.addBundleQuery(i),j.build()}function zL(a,b,c){return{documentData:b,documentKey:c.mutableCopy().key,documentPath:a,documentExists:!0,createdTime:c.createTime.toTimestamp(),readTime:c.readTime.toTimestamp(),versionTime:c.version.toTimestamp()}}let zM="NOT SUPPORTED";class zN{constructor(a,b){this.hasPendingWrites=a,this.fromCache=b}isEqual(a){return this.hasPendingWrites===a.hasPendingWrites&&this.fromCache===a.fromCache}}class zO extends yM{constructor(a,b,c,d,e,f){super(a,b,c,d,f),this._firestore=a,this._firestoreImpl=a,this.metadata=e}exists(){return super.exists()}data(a={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,a.serverTimestamps);{let b=new zQ(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(b,a)}}}get(a,b={}){if(this._document){let c=this._document.data.field(yA("DocumentSnapshot.get",a));if(null!==c)return this._userDataWriter.convertValue(c,b.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new iV(iO,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let a=this._document,b={};if(b.type=zO._jsonSchemaVersion,b.bundle="",b.bundleSource="DocumentSnapshot",b.bundleName=this._key.toString(),!a||!a.isValidDocument()||!a.isFoundDocument())return b;let c=this._userDataWriter.convertObjectMap(a.data.value.mapValue.fields,"previous");return b.bundle=zJ(this._firestore,a,c,this.ref.path),b}}function zP(a,b,c){if(js(b,zO._jsonSchema)){if(b.bundle===zM)throw new iV(iH,"The provided JSON object was created in a client environment, which is not supported.");let d=uN(a._databaseId),e=xD(b.bundle,d),f=e.getElements(),g=new v5(e.getMetadata(),d);for(let a of f)g.addSizedElement(a);let h=g.documents;if(1!==h.length)throw new iV(iH,`Expected bundle data to contain 1 document, but it contains ${h.length} documents.`);let i=pJ(d,h[0].document),j=new ji(jf.fromString(b.bundleName));return new zO(a,new zk(a),j,i,new zN(!1,!1),c||null)}}zO._jsonSchemaVersion="firestore/documentSnapshot/1.0",zO._jsonSchema={type:jr("string",zO._jsonSchemaVersion),bundleSource:jr("string","DocumentSnapshot"),bundleName:jr("string"),bundle:jr("string")};class zQ extends zO{data(a={}){return super.data(a)}}class zR{constructor(a,b,c,d){this._firestore=a,this._userDataWriter=b,this._snapshot=d,this.metadata=new zN(d.hasPendingWrites,d.fromCache),this.query=c}get docs(){let a=[];return this.forEach(b=>a.push(b)),a}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(a,b){this._snapshot.docs.forEach(c=>{a.call(b,new zQ(this._firestore,this._userDataWriter,c.key,c,new zN(this._snapshot.mutatedKeys.has(c.key),this._snapshot.fromCache),this.query.converter))})}docChanges(a={}){let b=!!a.includeMetadataChanges;if(b&&this._snapshot.excludesMetadataChanges)throw new iV(iH,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===b||(this._cachedChanges=zT(this,b),this._cachedChangesIncludeMetadataChanges=b),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new iV(iO,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let a={};a.type=zR._jsonSchemaVersion,a.bundleSource="QuerySnapshot",a.bundleName=i5.newId();let b=this._firestore._databaseId.database,c=this._firestore._databaseId.projectId,d=`projects/${c}/databases/${b}/documents`,e=[],f=[],g=[];return this.docs.forEach(a=>{null!==a._document&&(e.push(a._document),f.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),g.push(a.ref.path))}),a.bundle=zK(this._firestore,this.query._query,a.bundleName,d,g,e,f),a}}function zS(a,b,c){if(js(b,zR._jsonSchema)){if(b.bundle===zM)throw new iV(iH,"The provided JSON object was created in a client environment, which is not supported.");let d=uN(a._databaseId),e=xD(b.bundle,d),f=e.getElements(),g=new v5(e.getMetadata(),d);for(let a of f)g.addSizedElement(a);if(1!==g.queries.length)throw new iV(iH,`Snapshot data expected 1 query but found ${g.queries.length} queries.`);let h=qP(g.queries[0].bundledQuery),i=g.documents,j=new vO;i.map(a=>{let b=pJ(d,a.document);j=j.add(b)});let k=vQ.fromInitialDocuments(h,j,oa(),!1,!1),l=new xW(a,c||null,h);return new zR(a,new zk(a),l,k)}}function zT(a,b){if(a._snapshot.oldDocs.isEmpty()){let b=0;return a._snapshot.docChanges.map(c=>{let d=new zQ(a._firestore,a._userDataWriter,c.doc.key,c.doc,new zN(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);return c.doc,{type:"added",doc:d,oldIndex:-1,newIndex:b++}})}{let c=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(a=>b||3!==a.type).map(b=>{let d=new zQ(a._firestore,a._userDataWriter,b.doc.key,b.doc,new zN(a._snapshot.mutatedKeys.has(b.doc.key),a._snapshot.fromCache),a.query.converter),e=-1,f=-1;return 0!==b.type&&(e=c.indexOf(b.doc.key),c=c.delete(b.doc.key)),1!==b.type&&(f=(c=c.add(b.doc)).indexOf(b.doc.key)),{type:zU(b.type),doc:d,oldIndex:e,newIndex:f}})}}function zU(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return iA(61501,{type:a})}}function zV(a,b){return a instanceof zO&&b instanceof zO?a._firestore===b._firestore&&a._key.isEqual(b._key)&&(null===a._document?null===b._document:a._document.isEqual(b._document))&&a._converter===b._converter:a instanceof zR&&b instanceof zR&&a._firestore===b._firestore&&x$(a.query,b.query)&&a.metadata.isEqual(b.metadata)&&a._snapshot.isEqual(b._snapshot)}zR._jsonSchemaVersion="firestore/querySnapshot/1.0",zR._jsonSchema={type:jr("string",zR._jsonSchemaVersion),bundleSource:jr("string","QuerySnapshot"),bundleName:jr("string"),bundle:jr("string")};let zW={maxAttempts:5};function zX(a){if(a.maxAttempts<1)throw new iV(iH,"Max attempts must be at least 1")}class zY{constructor(a,b){this._firestore=a,this._commitHandler=b,this._mutations=[],this._committed=!1,this._dataReader=ym(a)}set(a,b,c){this._verifyNotCommitted();let d=zZ(a,this._firestore),e=zj(d.converter,b,c),f=yn(this._dataReader,"WriteBatch.set",d._key,e,null!==d.converter,c);return this._mutations.push(f.toMutation(d._key,oy.none())),this}update(a,b,c,...d){let e;this._verifyNotCommitted();let f=zZ(a,this._firestore);return e="string"==typeof(b=aB(b))||b instanceof yc?yq(this._dataReader,"WriteBatch.update",f._key,b,c,d):yp(this._dataReader,"WriteBatch.update",f._key,b),this._mutations.push(e.toMutation(f._key,oy.exists(!0))),this}delete(a){this._verifyNotCommitted();let b=zZ(a,this._firestore);return this._mutations=this._mutations.concat(new oP(b._key,oy.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new iV(iO,"A write batch can no longer be used after commit() has been called.")}}function zZ(a,b){if((a=aB(a)).firestore===b)return a;throw new iV(iH,"Provided document reference is from a different Firestore instance.")}class z${constructor(a,b){this._firestore=a,this._transaction=b,this._dataReader=ym(a)}get(a){let b=zZ(a,this._firestore),c=new zk(this._firestore);return this._transaction.lookup([b._key]).then(a=>{if(!a||1!==a.length)return iA(24041);let d=a[0];if(d.isFoundDocument())return new yM(this._firestore,c,d.key,d,b.converter);if(d.isNoDocument())return new yM(this._firestore,c,b._key,null,b.converter);throw iA(18433,{doc:d})})}set(a,b,c){let d=zZ(a,this._firestore),e=zj(d.converter,b,c),f=yn(this._dataReader,"Transaction.set",d._key,e,null!==d.converter,c);return this._transaction.set(d._key,f),this}update(a,b,c,...d){let e,f=zZ(a,this._firestore);return e="string"==typeof(b=aB(b))||b instanceof yc?yq(this._dataReader,"Transaction.update",f._key,b,c,d):yp(this._dataReader,"Transaction.update",f._key,b),this._transaction.update(f._key,e),this}delete(a){let b=zZ(a,this._firestore);return this._transaction.delete(b._key),this}}class z_ extends z${constructor(a,b){super(a,b),this._firestore=a}get(a){let b=zZ(a,this._firestore),c=new yG(this._firestore);return super.get(a).then(a=>new zO(this._firestore,c,b._key,a._document,new zN(!1,!1),b.converter))}}function z0(a,b,c){a=jp(a,x3);let d={...zW,...c};return zX(d),xv(x5(a),c=>b(new z_(a,c)),d)}function z1(a){return z2(a,["next","error","complete"])}function z2(a,b){if("object"!=typeof a||null===a)return!1;let c=a;for(let a of b)if(a in c&&"function"==typeof c[a])return!0;return!1}function z3(a){a=jp(a,xX);let b=jp(a.firestore,x3);return xp(x5(b),a._key).then(c=>Ah(b,a,c))}function z4(a){a=jp(a,xX);let b=jp(a.firestore,x3),c=x5(b),d=new yG(b);return xo(c,a._key).then(c=>new zO(b,d,a._key,c,new zN(null!==c&&c.hasLocalMutations,!0),a.converter))}function z5(a){a=jp(a,xX);let b=jp(a.firestore,x3);return xp(x5(b),a._key,{source:"server"}).then(c=>Ah(b,a,c))}function z6(a){a=jp(a,xW);let b=jp(a.firestore,x3),c=x5(b),d=new yG(b);return yO(a._query),xr(c,a._query).then(c=>new zR(b,d,a,c))}function z7(a){a=jp(a,xW);let b=jp(a.firestore,x3),c=x5(b),d=new yG(b);return xq(c,a._query).then(c=>new zR(b,d,a,c))}function z8(a){a=jp(a,xW);let b=jp(a.firestore,x3),c=x5(b),d=new yG(b);return xr(c,a._query,{source:"server"}).then(c=>new zR(b,d,a,c))}function z9(a,b,c){a=jp(a,xX);let d=jp(a.firestore,x3),e=zj(a.converter,b,c),f=yn(ym(d),"setDoc",a._key,e,null!==a.converter,c).toMutation(a._key,oy.none());return Ag(d,[f])}function Aa(a,b,c,...d){let e;a=jp(a,xX);let f=jp(a.firestore,x3),g=ym(f);return Ag(f,[(e="string"==typeof(b=aB(b))||b instanceof yc?yq(g,"updateDoc",a._key,b,c,d):yp(g,"updateDoc",a._key,b)).toMutation(a._key,oy.exists(!0))])}function Ab(a){return Ag(jp(a.firestore,x3),[new oP(a._key,oy.none())])}function Ac(a,b){let c=jp(a.firestore,x3),d=xZ(a),e=zj(a.converter,b);return Ag(c,[yn(ym(a.firestore),"addDoc",d._key,e,null!==a.converter,{}).toMutation(d._key,oy.exists(!1))]).then(()=>d)}function Ad(a,...b){let c,d,e;a=aB(a);let f={includeMetadataChanges:!1,source:"default"},g=0;"object"!=typeof b[0]||z1(b[g])||(f=b[g++]);let h={includeMetadataChanges:f.includeMetadataChanges,source:f.source};if(z1(b[g])){let a=b[g];b[g]=a.next?.bind(a),b[g+1]=a.error?.bind(a),b[g+2]=a.complete?.bind(a)}if(a instanceof xX)d=jp(a.firestore,x3),e=nz(a._key.path),c={next:c=>{b[g]&&b[g](Ah(d,a,c))},error:b[g+1],complete:b[g+2]};else{let f=jp(a,xW);d=jp(f.firestore,x3),e=f._query;let h=new yG(d);c={next:a=>{b[g]&&b[g](new zR(d,h,f,a))},error:b[g+1],complete:b[g+2]},yO(a._query)}return xn(x5(d),e,h,c)}function Ae(a,b,...c){let d,e=aB(a),f=Ai(b);if(f.error)throw new iV(iH,f.error);let g=0;if("object"!=typeof c[0]||z1(c[g])||(d=c[g++]),"QuerySnapshot"===f.bundleSource){let a=null;if("object"==typeof c[g]&&z1(c[g])){let b=c[g++];a={next:b.next,error:b.error,complete:b.complete}}else a={next:c[g++],error:c[g++],complete:c[g++]};return Ak(e,f,d,a,c[g])}if("DocumentSnapshot"===f.bundleSource){let a=null;if("object"==typeof c[g]&&z1(c[g])){let b=c[g++];a={next:b.next,error:b.error,complete:b.complete}}else a={next:c[g++],error:c[g++],complete:c[g++]};return Aj(e,f,d,a,c[g])}throw new iV(iH,`unsupported bundle source: ${f.bundleSource}`)}function Af(a,b){return xu(x5(a=jp(a,x3)),z1(b)?b:{next:b})}function Ag(a,b){return xt(x5(a),b)}function Ah(a,b,c){let d=c.docs.get(b._key),e=new yG(a);return new zO(a,e,b._key,d,new zN(c.hasPendingWrites,c.fromCache),b.converter)}function Ai(a){let b={bundle:"",bundleName:"",bundleSource:""};for(let c of["bundle","bundleName","bundleSource"]){if(!(c in a)){b.error=`snapshotJson missing required field: ${c}`;break}let d=a[c];if("string"!=typeof d){b.error=`snapshotJson field '${c}' must be a string.`;break}if(0===d.length){b.error=`snapshotJson field '${c}' cannot be an empty string.`;break}"bundle"===c?b.bundle=d:"bundleName"===c?b.bundleName=d:"bundleSource"===c&&(b.bundleSource=d)}return b}function Aj(a,b,c,d,e){let f,g=!1;return x8(a,b.bundle).then(()=>{g||(f=Ad(new xX(a,e||null,ji.fromPath(b.bundleName)),c||{},d))}).catch(a=>(d.error&&d.error(a),()=>{})),()=>{!g&&(g=!0,f&&f())}}function Ak(a,b,c,d,e){let f,g=!1;return x8(a,b.bundle).then(()=>x9(a,b.bundleName)).then(a=>{if(a&&!g){let b=a;e&&b.withConverter(e),f=Ad(a,c||{},d)}}).catch(a=>(d.error&&d.error(a),()=>{})),()=>{!g&&(g=!0,f&&f())}}function Al(a){return x5(a=jp(a,x3)),new zY(a,b=>Ag(a,b))}function Am(a,b){let c=x5(a=jp(a,x3));return c._uninitializedComponentsProvider&&"memory"!==c._uninitializedComponentsProvider._offline.kind?xE(c,An(b)):(iy("Cannot enable indexes when persistence is disabled"),Promise.resolve())}function An(a){let b="string"==typeof a?Ao(a):a,c=[];if(Array.isArray(b.indexes))for(let a of b.indexes){let b=Ap(a,"collectionGroup"),d=[];if(Array.isArray(a.fields))for(let b of a.fields){let a=yC("setIndexConfiguration",Ap(b,"fieldPath"));"CONTAINS"===b.arrayConfig?d.push(new jF(a,2)):"ASCENDING"===b.order?d.push(new jF(a,0)):"DESCENDING"===b.order&&d.push(new jF(a,1))}c.push(new jz(jz.UNKNOWN_ID,b,d,jH.empty()))}return c}function Ao(a){try{return JSON.parse(a)}catch(a){throw new iV(iH,"Failed to parse JSON: "+a?.message)}}function Ap(a,b){if("string"!=typeof a[b])throw new iV(iH,"Missing string value for: "+b);return a[b]}class Aq{constructor(a){this._firestore=a,this.type="PersistentCacheIndexManager"}}function Ar(a){a=jp(a,x3);let b=Aw.get(a);if(b)return b;let c=x5(a);if(c._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;let d=new Aq(a);return Aw.set(a,d),d}function As(a){Av(a,!0)}function At(a){Av(a,!1)}function Au(a){xG(x5(a._firestore)).then(a=>iw("deleting all persistent cache indexes succeeded")).catch(a=>iy("deleting all persistent cache indexes failed",a))}function Av(a,b){xF(x5(a._firestore),b).then(a=>iw(`setting persistent cache index auto creation isEnabled=${b} succeeded`)).catch(a=>iy(`setting persistent cache index auto creation isEnabled=${b} failed`,a))}let Aw=new WeakMap;class Ax{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(a){return Ay.instance.onExistenceFilterMismatch(a)}}class Ay{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return Az||o0(Az=new Ay),Az}notifyOnExistenceFilterMismatch(a){this.existenceFilterMismatchCallbacksById.forEach(b=>b(a))}onExistenceFilterMismatch(a){let b=Symbol(),c=this.existenceFilterMismatchCallbacksById;return c.set(b,a),()=>c.delete(b)}}let Az=null;yJ("node"),a.s(["AggregateField",()=>yK,"AggregateQuerySnapshot",()=>yL,"DocumentSnapshot",()=>zO,"PersistentCacheIndexManager",()=>Aq,"QueryCompositeFilterConstraint",()=>yU,"QueryConstraint",()=>yQ,"QueryDocumentSnapshot",()=>zQ,"QueryEndAtConstraint",()=>y3,"QueryFieldFilterConstraint",()=>yS,"QueryLimitConstraint",()=>yZ,"QueryOrderByConstraint",()=>yX,"QuerySnapshot",()=>zR,"QueryStartAtConstraint",()=>y0,"SnapshotMetadata",()=>zN,"Transaction",()=>z_,"WriteBatch",()=>zY,"_TestingHooks",()=>Ax,"addDoc",()=>Ac,"aggregateFieldEqual",()=>zo,"aggregateQuerySnapshotEqual",()=>zp,"and",()=>yW,"average",()=>zm,"count",()=>zn,"deleteAllPersistentCacheIndexes",()=>Au,"deleteDoc",()=>Ab,"disablePersistentCacheIndexAutoCreation",()=>At,"documentSnapshotFromJSON",()=>zP,"enablePersistentCacheIndexAutoCreation",()=>As,"endAt",()=>y5,"endBefore",()=>y4,"executeWrite",()=>Ag,"getAggregateFromServer",()=>zr,"getCountFromServer",()=>zq,"getDoc",()=>z3,"getDocFromCache",()=>z4,"getDocFromServer",()=>z5,"getDocs",()=>z6,"getDocsFromCache",()=>z7,"getDocsFromServer",()=>z8,"getPersistentCacheIndexManager",()=>Ar,"limit",()=>y$,"limitToLast",()=>y_,"memoryEagerGarbageCollector",()=>zx,"memoryLocalCache",()=>zz,"memoryLruGarbageCollector",()=>zy,"onSnapshot",()=>Ad,"onSnapshotResume",()=>Ae,"onSnapshotsInSync",()=>Af,"or",()=>yV,"orderBy",()=>yY,"persistentLocalCache",()=>zA,"persistentMultipleTabManager",()=>zE,"persistentSingleTabManager",()=>zD,"query",()=>yR,"querySnapshotFromJSON",()=>zS,"runTransaction",()=>z0,"setDoc",()=>z9,"setIndexConfiguration",()=>Am,"snapshotEqual",()=>zV,"startAfter",()=>y2,"startAt",()=>y1,"sum",()=>zl,"updateDoc",()=>Aa,"where",()=>yT,"writeBatch",()=>Al],23719),a.i(23719);let AA={apiKey:"AIzaSyDhwxaI0Bx_AGF1K1E342nY8bwOX_DImA8",authDomain:"gps-tracker-8376c.firebaseapp.com",projectId:"gps-tracker-8376c",storageBucket:"gps-tracker-8376c.firebasestorage.app",messagingSenderId:"650884354501",appId:"1:650884354501:web:92843965d0b7c4e241bbac",databaseURL:"https://gps-tracker-8376c-default-rtdb.asia-southeast1.firebasedatabase.app"},AB=0===bB().length?by(AA):bB()[0];x4(AB);let AC=ig(AB);function AD(){let[a,b]=(0,u.useState)([]),[c,d]=(0,u.useState)(!0);return(0,u.useEffect)(()=>{let a=h6(h1(AC,"devices"),a=>{let c=a.val();if(c){let a=Object.values(c);a.sort((a,b)=>(b.lastUpdated||0)-(a.lastUpdated||0)),b(a)}else b([]);d(!1)});return()=>a()},[]),(0,t.jsxs)("main",{className:"container",children:[(0,t.jsx)("h1",{children:"ESP32 Tracker Grid"}),(0,t.jsx)("div",{className:"dashboard-card",children:c?(0,t.jsx)("div",{className:"loading",children:"Connecting to Satellite..."}):(0,t.jsx)("div",{style:{overflowX:"auto"},children:(0,t.jsxs)("table",{className:"device-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Device ID"}),(0,t.jsx)("th",{children:"Last Seen"}),(0,t.jsx)("th",{children:"Coordinates"}),(0,t.jsx)("th",{children:"Status"}),(0,t.jsx)("th",{children:"Data Payload"})]})}),(0,t.jsxs)("tbody",{children:[a.map(a=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{style:{fontWeight:600,color:"var(--foreground)"},children:a.deviceId}),(0,t.jsx)("td",{style:{color:"#a1a1aa"},children:a.lastUpdated?new Date(a.lastUpdated).toLocaleTimeString():"Just now"}),(0,t.jsx)("td",{style:{fontFamily:"monospace"},children:a.lat&&a.lng?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{style:{color:"var(--primary)"},children:Number(a.lat).toFixed(4)}),(0,t.jsx)("span",{style:{margin:"0 0.5rem",opacity:.3},children:"|"}),(0,t.jsx)("span",{style:{color:"var(--secondary)"},children:Number(a.lng).toFixed(4)})]}):(0,t.jsx)("span",{style:{opacity:.3},children:"N/A"})}),(0,t.jsx)("td",{children:(0,t.jsxs)("span",{className:"status-badge active",children:[(0,t.jsx)("span",{className:"animate-pulse",style:{marginRight:"6px",width:"6px",height:"6px",borderRadius:"50%",background:"currentColor"}}),"ONLINE"]})}),(0,t.jsx)("td",{style:{maxWidth:"300px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",opacity:.7,fontSize:"0.85rem"},children:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([a])=>!["deviceId","lastUpdated","lat","lng"].includes(a))))})]},a.deviceId)),0===a.length&&(0,t.jsx)("tr",{children:(0,t.jsxs)("td",{colSpan:5,style:{textAlign:"center",padding:"4rem",color:"#52525b"},children:["No devices detected.",(0,t.jsx)("br",{}),(0,t.jsx)("small",{children:"Send a POST request to /api/track to start."})]})})]})]})})})]})}a.s(["default",()=>AD],37119)}];

//# sourceMappingURL=Desktop_gps-tracker_3eeb3473._.js.map