module.exports=[89220,(e,t,r)=>{"use strict";var n,i,s;Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=r.DEFAULT_MAX_SEND_MESSAGE_LENGTH=r.Propagate=r.LogVerbosity=r.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(n||(r.Status=n={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(i||(r.LogVerbosity=i={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(s||(r.Propagate=s={})),r.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,r.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},95763,(e,t,r)=>{"use strict";var n,i,s,a;Object.defineProperty(r,"__esModule",{value:!0}),r.isTracerEnabled=r.trace=r.log=r.setLoggerVerbosity=r.setLogger=r.getLogger=void 0;let o=e.r(89220),l=e.r(5365),u=e.r(6235).version,c={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},h=o.LogVerbosity.ERROR;switch((null!=(i=null!=(n=process.env.GRPC_NODE_VERBOSITY)?n:process.env.GRPC_VERBOSITY)?i:"").toUpperCase()){case"DEBUG":h=o.LogVerbosity.DEBUG;break;case"INFO":h=o.LogVerbosity.INFO;break;case"ERROR":h=o.LogVerbosity.ERROR;break;case"NONE":h=o.LogVerbosity.NONE}r.getLogger=()=>c,r.setLogger=e=>{c=e},r.setLoggerVerbosity=e=>{h=e},r.log=(e,...t)=>{let r;if(e>=h){switch(e){case o.LogVerbosity.DEBUG:r=c.debug;break;case o.LogVerbosity.INFO:r=c.info;break;case o.LogVerbosity.ERROR:r=c.error}r||(r=c.error),r&&r.bind(c)(...t)}};let d=null!=(a=null!=(s=process.env.GRPC_NODE_TRACE)?s:process.env.GRPC_TRACE)?a:"",f=new Set,p=new Set;for(let e of d.split(","))e.startsWith("-")?p.add(e.substring(1)):f.add(e);let g=f.has("all");function m(e,t,n){y(t)&&(0,r.log)(e,new Date().toISOString()+" | v"+u+" "+l.pid+" | "+t+" | "+n)}function y(e){return!p.has(e)&&(g||f.has(e))}r.trace=m,r.isTracerEnabled=y},30810,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getErrorCode=r.getErrorMessage=void 0,r.getErrorMessage=function(e){return e instanceof Error?e.message:String(e)},r.getErrorCode=function(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.code?e.code:null}},63878,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Metadata=void 0;let n=e.r(95763),i=e.r(89220),s=e.r(30810),a=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function l(e){return a.test(e)}function u(e){return o.test(e)}function c(e){return e.endsWith("-bin")}function h(e){return!e.startsWith("grpc-")}function d(e){return e.toLowerCase()}function f(e,t){if(!l(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t)if(c(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!u(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}class p{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){f(e=d(e),t),this.internalRepr.set(e,[t])}add(e,t){f(e=d(e),t);let r=this.internalRepr.get(e);void 0===r?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=d(e),this.internalRepr.delete(e)}get(e){return e=d(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let n=r[0];e[t]=Buffer.isBuffer(n)?Buffer.from(n):n}return e}clone(){let e=new p(this.options),t=e.internalRepr;for(let[e,r]of this.internalRepr){let n=r.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,n)}return e}merge(e){for(let[t,r]of e.internalRepr){let e=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(g);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new p;for(let r of Object.keys(e)){if(":"===r.charAt(0))continue;let a=e[r];try{c(r)?Array.isArray(a)?a.forEach(e=>{t.add(r,Buffer.from(e,"base64"))}):void 0!==a&&(h(r)?a.split(",").forEach(e=>{t.add(r,Buffer.from(e.trim(),"base64"))}):t.add(r,Buffer.from(a,"base64"))):Array.isArray(a)?a.forEach(e=>{t.add(r,e)}):void 0!==a&&t.add(r,a)}catch(t){let e=`Failed to add metadata entry ${r}: ${a}. ${(0,s.getErrorMessage)(t)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,n.log)(i.LogVerbosity.ERROR,e)}}return t}}r.Metadata=p;let g=e=>Buffer.isBuffer(e)?e.toString("base64"):e},17418,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CallCredentials=void 0;let n=e.r(63878);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new o(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,r)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((r,n)=>{e.getRequestMetadata(t.service_url,(e,t)=>{e?n(e):t?r(t):n(Error("Headers not set by metadata plugin"))})})).then(e=>{let t=new n.Metadata;for(let r of Object.keys(e))t.add(r,e[r]);r(null,t)},e=>{r(e)})})}static createEmpty(){return new l}}r.CallCredentials=s;class a extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new n.Metadata;for(let r of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(r);return t}compose(e){return new a(this.creds.concat([e]))}_equals(e){return this===e||e instanceof a&&this.creds.every((t,r)=>t._equals(e.creds[r]))}}class o extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(e,n)=>{void 0!==n?t(n):r(e)})})}compose(e){return new a([this,e])}_equals(e){return this===e||e instanceof o&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new n.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},26406,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getDefaultRootsData=r.CIPHER_SUITES=void 0;let n=e.r(22734);r.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;r.getDefaultRootsData=function(){return i?(null===s&&(s=n.readFileSync(i)),s):null}},9553,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChannelCredentials=void 0;let n=e.r(55004),i=e.r(17418),s=e.r(26406);function a(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class o{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var o;if(a(e,"Root certificate"),a(t,"Private key"),a(r,"Certificate chain"),t&&!r)throw Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw Error("Certificate chain must be given with accompanying private key");return new u((0,n.createSecureContext)({ca:null!=(o=null!=e?e:(0,s.getDefaultRootsData)())?o:void 0,key:null!=t?t:void 0,cert:null!=r?r:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new u(e,null!=t?t:{})}static createInsecure(){return new l}}r.ChannelCredentials=o;class l extends o{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class u extends o{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new c(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class c extends o{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new c(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},10579,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.validateLoadBalancingConfig=r.getFirstUsableConfig=r.isLoadBalancerNameRegistered=r.createLoadBalancer=r.registerDefaultLoadBalancerType=r.registerLoadBalancerType=r.createChildChannelControlHelper=void 0,r.createChildChannelControlHelper=function(e,t){var r,n,i,s,a,o,l,u,c,h;return{createSubchannel:null!=(n=null==(r=t.createSubchannel)?void 0:r.bind(t))?n:e.createSubchannel.bind(e),updateState:null!=(s=null==(i=t.updateState)?void 0:i.bind(t))?s:e.updateState.bind(e),requestReresolution:null!=(o=null==(a=t.requestReresolution)?void 0:a.bind(t))?o:e.requestReresolution.bind(e),addChannelzChild:null!=(u=null==(l=t.addChannelzChild)?void 0:l.bind(t))?u:e.addChannelzChild.bind(e),removeChannelzChild:null!=(h=null==(c=t.removeChannelzChild)?void 0:c.bind(t))?h:e.removeChannelzChild.bind(e)}};let n={},i=null;r.registerLoadBalancerType=function(e,t,r){n[e]={LoadBalancer:t,LoadBalancingConfig:r}},r.registerDefaultLoadBalancerType=function(e){i=e},r.createLoadBalancer=function(e,t){let r=e.getLoadBalancerName();return r in n?new n[r].LoadBalancer(t):null},r.isLoadBalancerNameRegistered=function(e){return e in n},r.getFirstUsableConfig=function(e,t=!1){for(let t of e)if(t.getLoadBalancerName()in n)return t;return t&&i?new n[i].LoadBalancingConfig:null},r.validateLoadBalancingConfig=function(e){if(null===e||"object"!=typeof e)throw Error("Load balancing config must be an object");let t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");let r=t[0];if(r in n)return n[r].LoadBalancingConfig.createFromJson(e[r]);throw Error(`Unrecognized load balancing config name ${r}`)}},14177,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractAndSelectServiceConfig=r.validateServiceConfig=r.validateRetryThrottling=void 0;let n=e.r(46786),i=e.r(89220),s=e.r(10579),a=/^\d+(\.\d{1,9})?s$/,o="node";function l(e){if("service"in e&&""!==e.service){if("string"!=typeof e.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof e.service}`);if(!("method"in e)||""===e.method)return{service:e.service};if("string"!=typeof e.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof e.service}`);return{service:e.service,method:e.method}}if("method"in e&&void 0!==e.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function u(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in e)||"string"!=typeof e.initialBackoff||!a.test(e.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in e)||"string"!=typeof e.maxBackoff||!a.test(e.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in e)||"number"!=typeof e.backoffMultiplier||e.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in e&&Array.isArray(e.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===e.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let t of e.retryableStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:e.maxAttempts,initialBackoff:e.initialBackoff,maxBackoff:e.maxBackoff,backoffMultiplier:e.backoffMultiplier,retryableStatusCodes:e.retryableStatusCodes}}function c(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in e&&("string"!=typeof e.hedgingDelay||!a.test(e.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in e&&Array.isArray(e.nonFatalStatusCodes))for(let t of e.nonFatalStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let t={maxAttempts:e.maxAttempts};return e.hedgingDelay&&(t.hedgingDelay=e.hedgingDelay),e.nonFatalStatusCodes&&(t.nonFatalStatusCodes=e.nonFatalStatusCodes),t}function h(e){var t;let r={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(let t of e.name)r.name.push(l(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");r.waitForReady=e.waitForReady}if("timeout"in e)if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");r.timeout=e.timeout}else if("string"==typeof e.timeout&&a.test(e.timeout)){let n=e.timeout.substring(0,e.timeout.length-1).split(".");r.timeout={seconds:0|n[0],nanos:(null!=(t=n[1])?t:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxResponseBytes=e.maxResponseBytes}if("retryPolicy"in e)if("hedgingPolicy"in e)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else r.retryPolicy=u(e.retryPolicy);else"hedgingPolicy"in e&&(r.hedgingPolicy=c(e.hedgingPolicy));return r}function d(e){if(!("maxTokens"in e)||"number"!=typeof e.maxTokens||e.maxTokens<=0||e.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in e)||"number"!=typeof e.tokenRatio||e.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+e.maxTokens.toFixed(3),tokenRatio:+e.tokenRatio.toFixed(3)}}function f(e){let t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e)if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in e)if(Array.isArray(e.loadBalancingConfig))for(let r of e.loadBalancingConfig)t.loadBalancingConfig.push((0,s.validateLoadBalancingConfig)(r));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in e&&Array.isArray(e.methodConfig))for(let r of e.methodConfig)t.methodConfig.push(h(r));"retryThrottling"in e&&(t.retryThrottling=d(e.retryThrottling));let r=[];for(let e of t.methodConfig)for(let t of e.name){for(let e of r)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);r.push(t)}return t}function p(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");let t={serviceConfig:f(e.serviceConfig)};if("clientLanguage"in e)if(Array.isArray(e.clientLanguage))for(let r of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof r)t.clientLanguage.push(r);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in e)if(Array.isArray(e.clientHostname))for(let r of(t.clientHostname=[],e.clientHostname))if("string"==typeof r)t.clientHostname.push(r);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in e)if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage");let r=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let t in e)if(!r.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function g(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(let r of e){let e=p(r);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(let r of e.clientHostname)r===n.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(let r of e.clientLanguage)r===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}r.validateRetryThrottling=d,r.validateServiceConfig=f,r.extractAndSelectServiceConfig=function(e,t){for(let r of e)if(r.length>0&&r[0].startsWith("grpc_config="))return g(JSON.parse(r.join("").substring(12)),t);return null}},51195,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(n||(r.ConnectivityState=n={}))},1602,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.uriToString=r.splitHostPort=r.parseUri=void 0;let n=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;r.parseUri=function(e){let t=n.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}};let i=/^\d+$/;r.splitHostPort=function(e){if(e.startsWith("[")){let t=e.indexOf("]");if(-1===t)return null;let r=e.substring(1,t);if(-1===r.indexOf(":"))return null;if(!(e.length>t+1))return{host:r};if(":"!==e[t+1])return null;{let n=e.substring(t+2);return i.test(n)?{host:r,port:+n}:null}}{let t=e.split(":");return 2!==t.length?{host:e}:i.test(t[1])?{host:t[0],port:+t[1]}:null}},r.uriToString=function(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}},17927,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.mapUriDefaultScheme=r.getDefaultAuthority=r.createResolver=r.registerDefaultScheme=r.registerResolver=void 0;let n=e.r(1602),i={},s=null;r.registerResolver=function(e,t){i[e]=t},r.registerDefaultScheme=function(e){s=e},r.createResolver=function(e,t,r){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,r);throw Error(`No resolver could be created for target ${(0,n.uriToString)(e)}`)},r.getDefaultAuthority=function(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${(0,n.uriToString)(e)}`)},r.mapUriDefaultScheme=function(e){if(void 0===e.scheme||!(e.scheme in i))if(null!==s)return{scheme:s,authority:void 0,path:(0,n.uriToString)(e)};else return null;return e}},36891,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.QueuePicker=r.UnavailablePicker=r.PickResultType=void 0;let i=e.r(63878),s=e.r(89220);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(n||(r.PickResultType=n={}));class a{constructor(e){this.status=Object.assign({code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata},e)}pick(e){return{pickResultType:n.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}r.UnavailablePicker=a;class o{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:n.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}r.QueuePicker=o},44943,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BackoffTimeout=void 0;let n=1e3,i=1.6,s=12e4,a=.2;function o(e,t){return Math.random()*(t-e)+e}class l{constructor(e,t){this.callback=e,this.initialDelay=n,this.multiplier=i,this.maxDelay=s,this.jitter=a,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null==(r=(t=this.timerId).unref)||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+o(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,null==(t=(e=this.timerId).ref)||t.call(e)}unref(){var e,t;this.hasRef=!1,null==(t=(e=this.timerId).unref)||t.call(e)}getEndTime(){return this.endTime}}r.BackoffTimeout=l},79548,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChildLoadBalancerHandler=void 0;let n=e.r(10579),i=e.r(51195),s="child_load_balancer_helper";class a{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){var r;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null==(r=this.parent.currentChild)||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){var e;let t=null!=(e=this.parent.pendingChild)?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let e=new this.ChildPolicyHelper(this),r=(0,n.createLoadBalancer)(t,e);e.setChild(r),null===this.currentChild?(this.currentChild=r,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=r,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}r.ChildLoadBalancerHandler=a},68631,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ResolvingLoadBalancer=void 0;let n=e.r(10579),i=e.r(14177),s=e.r(51195),a=e.r(17927),o=e.r(36891),l=e.r(44943),u=e.r(89220),c=e.r(63878),h=e.r(95763),d=e.r(89220),f=e.r(1602),p=e.r(79548),g="resolving_load_balancer";function m(e){h.trace(d.LogVerbosity.DEBUG,g,e)}let y=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function v(e,t,r,n){for(let i of r.name)switch(n){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===e&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===e&&i.method===t)return!0}return!1}function _(e,t,r,n){for(let i of r)if(v(e,t,i,n))return i;return null}function b(e){return function(t,r){var n,i;let s=t.split("/").filter(e=>e.length>0),a=null!=(n=s[0])?n:"",o=null!=(i=s[1])?i:"";if(e&&e.methodConfig)for(let t of y){let r=_(a,o,e.methodConfig,t);if(r)return{methodConfig:r,pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}}class S{constructor(e,t,r,h,d){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=h,this.onFailedResolution=d,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,i.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new o.QueuePicker(this)),this.childLoadBalancer=new p.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(m("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,a.createResolver)(e,{onSuccessfulResolution:(e,t,r,i,s)=>{var a;this.backoffTimeout.stop(),this.backoffTimeout.reset();let o=null;null===t?null===r?(this.previousServiceConfig=null,o=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(r):o=this.previousServiceConfig:(o=t,this.previousServiceConfig=t);let l=null!=(a=null==o?void 0:o.loadBalancingConfig)?a:[],h=(0,n.getFirstUsableConfig)(l,!0);if(null===h)return void this.handleResolutionFailure({code:u.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new c.Metadata});this.childLoadBalancer.updateAddressList(e,h,s);let d=null!=o?o:this.defaultServiceConfig;this.onSuccessfulResolution(d,null!=i?i:b(d))},onError:e=>{this.handleResolutionFailure(e)}},r);const f={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},f),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new o.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){m((0,f.uriToString)(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new o.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new o.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}r.ResolvingLoadBalancer=S},21255,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.channelOptionsEqual=r.recognizedOptions=void 0,r.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},r.channelOptionsEqual=function(e,t){let r=Object.keys(e).sort(),n=Object.keys(t).sort();if(r.length!==n.length)return!1;for(let i=0;i<r.length;i+=1)if(r[i]!==n[i]||e[r[i]]!==t[n[i]])return!1;return!0}},21800,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.stringToSubchannelAddress=r.subchannelAddressToString=r.subchannelAddressEqual=r.isTcpSubchannelAddress=void 0;let n=e.r(4446);function i(e){return"port"in e}r.isTcpSubchannelAddress=i,r.subchannelAddressEqual=function(e,t){return!e&&!t||!!e&&!!t&&(i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path)},r.subchannelAddressToString=function(e){return i(e)?e.host+":"+e.port:e.path};let s=443;r.stringToSubchannelAddress=function(e,t){return(0,n.isIP)(e)?{host:e,port:null!=t?t:s}:{path:e}}},61295,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addAdminServicesToServer=r.registerAdminService=void 0;let n=[];r.registerAdminService=function(e,t){n.push({getServiceDefinition:e,getHandlers:t})},r.addAdminServicesToServer=function(e){for(let{getServiceDefinition:t,getHandlers:r}of n)e.addService(t(),r())}},21628,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ClientDuplexStreamImpl=r.ClientWritableStreamImpl=r.ClientReadableStreamImpl=r.ClientUnaryCallImpl=r.callErrorFromStatus=void 0;let n=e.r(27699),i=e.r(88947),s=e.r(89220);r.callErrorFromStatus=function(e,t){let r=`${e.code} ${s.Status[e.code]}: ${e.details}`,n=Error(r),i=`${n.stack}
for call at
${t}`;return Object.assign(Error(r),e,{stack:i})};class a extends n.EventEmitter{constructor(){super()}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}}r.ClientUnaryCallImpl=a;class o extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}}r.ClientReadableStreamImpl=o;class l extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(n=this.call)||n.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}r.ClientWritableStreamImpl=l;class u extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(n=this.call)||n.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}r.ClientDuplexStreamImpl=u},81522,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InterceptingListenerImpl=r.isInterceptingListener=void 0,r.isInterceptingListener=function(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length};class n{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}r.InterceptingListenerImpl=n},79170,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getInterceptingCall=r.InterceptingCall=r.RequesterBuilder=r.ListenerBuilder=r.InterceptorConfigurationError=void 0;let n=e.r(63878),i=e.r(81522),s=e.r(89220),a=e.r(30810);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}r.InterceptorConfigurationError=o;class l{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}r.ListenerBuilder=l;class u{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}r.RequesterBuilder=u;let c=(e,t)=>{t(e)},h=(e,t)=>{t(e)},d=(e,t)=>{t(e)},f={start:(e,t,r)=>{r(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class p{constructor(e,t){var r,n,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!=(r=t.start)?r:f.start,sendMessage:null!=(n=t.sendMessage)?n:f.sendMessage,halfClose:null!=(i=t.halfClose)?i:f.halfClose,cancel:null!=(s=t.cancel)?s:f.cancel}:this.requester=f}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,n,s,a,o,l;let u={onReceiveMetadata:null!=(n=null==(r=null==t?void 0:t.onReceiveMetadata)?void 0:r.bind(t))?n:e=>{},onReceiveMessage:null!=(a=null==(s=null==t?void 0:t.onReceiveMessage)?void 0:s.bind(t))?a:e=>{},onReceiveStatus:null!=(l=null==(o=null==t?void 0:t.onReceiveStatus)?void 0:o.bind(t))?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,u,(e,t)=>{var r,n,s;let a;if(this.processingMetadata=!1,(0,i.isInterceptingListener)(t))a=t;else{let e={onReceiveMetadata:null!=(r=t.onReceiveMetadata)?r:c,onReceiveMessage:null!=(n=t.onReceiveMessage)?n:h,onReceiveStatus:null!=(s=t.onReceiveStatus)?s:d};a=new i.InterceptingListenerImpl(e,u)}this.nextCall.start(e,a),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function g(e,t,r){var n,i;let s=null!=(n=r.deadline)?n:1/0,a=r.host,o=null!=(i=r.parent)?i:null,l=r.propagate_flags,u=r.credentials,c=e.createCall(t,s,a,o,l);return u&&c.setCredentials(u),c}r.InterceptingCall=p;class m{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${(0,a.getErrorMessage)(e)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:e=>{var r;null==(r=null==t?void 0:t.onReceiveMetadata)||r.call(t,e)},onReceiveMessage:e=>{var i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){r={code:s.Status.INTERNAL,details:`Response message parsing error: ${(0,a.getErrorMessage)(e)}`,metadata:new n.Metadata},this.call.cancelWithStatus(r.code,r.details);return}null==(i=null==t?void 0:t.onReceiveMessage)||i.call(t,o)},onReceiveStatus:e=>{var n,i;r?null==(n=null==t?void 0:t.onReceiveStatus)||n.call(t,r):null==(i=null==t?void 0:t.onReceiveStatus)||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class y extends m{constructor(e,t){super(e,t)}start(e,t){var r,n;let i=!1,s={onReceiveMetadata:null!=(n=null==(r=null==t?void 0:t.onReceiveMetadata)?void 0:r.bind(t))?n:e=>{},onReceiveMessage:e=>{var r;i=!0,null==(r=null==t?void 0:t.onReceiveMessage)||r.call(t,e)},onReceiveStatus:e=>{var r,n;i||null==(r=null==t?void 0:t.onReceiveMessage)||r.call(t,null),null==(n=null==t?void 0:t.onReceiveStatus)||n.call(t,e)}};super.start(e,s),this.call.startRead()}}class v extends m{}function _(e,t,r){let n=g(e,r.path,t);return r.responseStream?new v(n,r):new y(n,r)}r.getInterceptingCall=function(e,t,r,n){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);let s=Object.assign({},r,{method_definition:t});return i.reduceRight((e,t)=>r=>t(r,e),e=>_(n,e,t))(s)}},40575,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Client=void 0;let n=e.r(21628),i=e.r(31394),s=e.r(51195),a=e.r(89220),o=e.r(63878),l=e.r(79170),u=Symbol(),c=Symbol(),h=Symbol(),d=Symbol();function f(e){return"function"==typeof e}function p(e){return e.stack.split("\n").slice(1).join("\n")}class g{constructor(e,t,r={}){var n,s;if(r=Object.assign({},r),this[c]=null!=(n=r.interceptors)?n:[],delete r.interceptors,this[h]=null!=(s=r.interceptor_providers)?s:[],delete r.interceptor_providers,this[c].length>0&&this[h].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[d]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[u]=r.channelOverride;else if(r.channelFactoryOverride){const n=r.channelFactoryOverride;delete r.channelFactoryOverride,this[u]=n(e,t,r)}else this[u]=new i.ChannelImplementation(e,t,r)}close(){this[u].close()}getChannel(){return this[u]}waitForReady(e,t){let r=n=>{let i;if(n)return void t(Error("Failed to connect before the deadline"));try{i=this[u].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[u].watchConnectivityState(i,e,r)}catch(e){t(Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(f(e))return{metadata:new o.Metadata,options:{},callback:e};if(f(t))if(e instanceof o.Metadata)return{metadata:e,options:{},callback:t};else return{metadata:new o.Metadata,options:e,callback:t};if(!(e instanceof o.Metadata&&t instanceof Object&&f(r)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,f){var g,m;let y=this.checkOptionalUnaryResponseArguments(s,o,f),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},_={argument:i,metadata:y.metadata,call:new n.ClientUnaryCallImpl,channel:this[u],methodDefinition:v,callOptions:y.options,callback:y.callback};this[d]&&(_=this[d](_));let b=_.call,S={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(g=_.callOptions.interceptors)?g:[],callInterceptorProviders:null!=(m=_.callOptions.interceptor_providers)?m:[]},C=(0,l.getInterceptingCall)(S,_.methodDefinition,_.callOptions,_.channel);b.call=C;let w=null,T=!1,E=Error();return C.start(_.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==w&&C.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),w=e},onReceiveStatus(e){if(!T){if(T=!0,e.code===a.Status.OK)if(null===w){let t=p(E);_.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else _.callback(null,w);else{let t=p(E);_.callback((0,n.callErrorFromStatus)(e,t))}E=null,b.emit("status",e)}}}),C.sendMessage(i),C.halfClose(),b}makeClientStreamRequest(e,t,r,i,s,o){var f,g;let m=this.checkOptionalUnaryResponseArguments(i,s,o),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},v={metadata:m.metadata,call:new n.ClientWritableStreamImpl(t),channel:this[u],methodDefinition:y,callOptions:m.options,callback:m.callback};this[d]&&(v=this[d](v));let _=v.call,b={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(f=v.callOptions.interceptors)?f:[],callInterceptorProviders:null!=(g=v.callOptions.interceptor_providers)?g:[]},S=(0,l.getInterceptingCall)(b,v.methodDefinition,v.callOptions,v.channel);_.call=S;let C=null,w=!1,T=Error();return S.start(v.metadata,{onReceiveMetadata:e=>{_.emit("metadata",e)},onReceiveMessage(e){null!==C&&S.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),C=e},onReceiveStatus(e){if(!w){if(w=!0,e.code===a.Status.OK)if(null===C){let t=p(T);v.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,C);else{let t=p(T);v.callback((0,n.callErrorFromStatus)(e,t))}T=null,_.emit("status",e)}}}),_}checkMetadataAndOptions(e,t){let r,n;return e instanceof o.Metadata?(r=e,n=t||{}):(n=e||{},r=new o.Metadata),{metadata:r,options:n}}makeServerStreamRequest(e,t,r,i,s,o){var f,g;let m=this.checkMetadataAndOptions(s,o),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},v={argument:i,metadata:m.metadata,call:new n.ClientReadableStreamImpl(r),channel:this[u],methodDefinition:y,callOptions:m.options};this[d]&&(v=this[d](v));let _=v.call,b={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(f=v.callOptions.interceptors)?f:[],callInterceptorProviders:null!=(g=v.callOptions.interceptor_providers)?g:[]},S=(0,l.getInterceptingCall)(b,v.methodDefinition,v.callOptions,v.channel);_.call=S;let C=!1,w=Error();return S.start(v.metadata,{onReceiveMetadata(e){_.emit("metadata",e)},onReceiveMessage(e){_.push(e)},onReceiveStatus(e){if(!C){if(C=!0,_.push(null),e.code!==a.Status.OK){let t=p(w);_.emit("error",(0,n.callErrorFromStatus)(e,t))}w=null,_.emit("status",e)}}}),S.sendMessage(i),S.halfClose(),_}makeBidiStreamRequest(e,t,r,i,s){var o,f;let g=this.checkMetadataAndOptions(i,s),m={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},y={metadata:g.metadata,call:new n.ClientDuplexStreamImpl(t,r),channel:this[u],methodDefinition:m,callOptions:g.options};this[d]&&(y=this[d](y));let v=y.call,_={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(o=y.callOptions.interceptors)?o:[],callInterceptorProviders:null!=(f=y.callOptions.interceptor_providers)?f:[]},b=(0,l.getInterceptingCall)(_,y.methodDefinition,y.callOptions,y.channel);v.call=b;let S=!1,C=Error();return b.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!S){if(S=!0,v.push(null),e.code!==a.Status.OK){let t=p(C);v.emit("error",(0,n.callErrorFromStatus)(e,t))}C=null,v.emit("status",e)}}}),v}}r.Client=g},78320,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.loadPackageDefinition=r.makeClientConstructor=void 0;let n=e.r(40575),i={unary:n.Client.prototype.makeUnaryRequest,server_stream:n.Client.prototype.makeServerStreamRequest,client_stream:n.Client.prototype.makeClientStreamRequest,bidi:n.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function a(e,t,r){r||(r={});class a extends n.Client{}return Object.keys(e).forEach(t=>{let r;if(s(t))return;let n=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");r=n.requestStream?n.responseStream?"bidi":"client_stream":n.responseStream?"server_stream":"unary";let l=n.requestSerialize,u=n.responseDeserialize,c=o(i[r],n.path,l,u);a.prototype[t]=c,Object.assign(a.prototype[t],n),n.originalName&&!s(n.originalName)&&(a.prototype[n.originalName]=a.prototype[t])}),a.service=e,a.serviceName=t,a}function o(e,t,r,n){return function(...i){return e.call(this,t,r,n,...i)}}function l(e){return"format"in e}r.makeClientConstructor=a,r.loadPackageDefinition=function(e){let t={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let n=e[r],i=r.split(".");if(i.some(e=>s(e)))continue;let o=i[i.length-1],u=t;for(let e of i.slice(0,-1))u[e]||(u[e]={}),u=u[e];l(n)?u[o]=n:u[o]=a(n,o,{})}return t}},43234,(e,t,r)=>{var n=1/0,i="[object Symbol]",s=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,a=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,o="\\ud800-\\udfff",l="\\u0300-\\u036f\\ufe20-\\ufe23",u="\\u20d0-\\u20f0",c="\\u2700-\\u27bf",h="a-z\\xdf-\\xf6\\xf8-\\xff",d="A-Z\\xc0-\\xd6\\xd8-\\xde",f="\\ufe0e\\ufe0f",p="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",g="['â€™]",m="["+o+"]",y="["+p+"]",v="["+l+u+"]",_="\\d+",b="["+c+"]",S="["+h+"]",C="[^"+o+p+_+c+h+d+"]",w="\\ud83c[\\udffb-\\udfff]",T="[^"+o+"]",E="(?:\\ud83c[\\udde6-\\uddff]){2}",k="[\\ud800-\\udbff][\\udc00-\\udfff]",I="["+d+"]",R="\\u200d",x="(?:"+S+"|"+C+")",D="(?:"+I+"|"+C+")",O="(?:"+g+"(?:d|ll|m|re|s|t|ve))?",A="(?:"+g+"(?:D|LL|M|RE|S|T|VE))?",N="(?:"+v+"|"+w+")?",P="["+f+"]?",M="(?:"+R+"(?:"+[T,E,k].join("|")+")"+P+N+")*",L=P+N+M,F="(?:"+[b,E,k].join("|")+")"+L,B="(?:"+[T+v+"?",v,E,k,m].join("|")+")",j=RegExp(g,"g"),q=RegExp(v,"g"),U=RegExp(w+"(?="+w+")|"+B+L,"g"),V=RegExp([I+"?"+S+"+"+O+"(?="+[y,I,"$"].join("|")+")",D+"+"+A+"(?="+[y,I+x,"$"].join("|")+")",I+"?"+x+"+"+O,I+"+"+A,_,F].join("|"),"g"),z=RegExp("["+R+o+l+u+f+"]"),H=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,W={Ã€:"A",Ã:"A",Ã‚:"A",Ãƒ:"A",Ã„:"A",Ã…:"A",Ã :"a",Ã¡:"a",Ã¢:"a",Ã£:"a",Ã¤:"a",Ã¥:"a",Ã‡:"C",Ã§:"c",Ã:"D",Ã°:"d",Ãˆ:"E",Ã‰:"E",ÃŠ:"E",Ã‹:"E",Ã¨:"e",Ã©:"e",Ãª:"e",Ã«:"e",ÃŒ:"I",Ã:"I",ÃŽ:"I",Ã:"I",Ã¬:"i",Ã­:"i",Ã®:"i",Ã¯:"i",Ã‘:"N",Ã±:"n",Ã’:"O",Ã“:"O",Ã”:"O",Ã•:"O",Ã–:"O",Ã˜:"O",Ã²:"o",Ã³:"o",Ã´:"o",Ãµ:"o",Ã¶:"o",Ã¸:"o",Ã™:"U",Ãš:"U",Ã›:"U",Ãœ:"U",Ã¹:"u",Ãº:"u",Ã»:"u",Ã¼:"u",Ã:"Y",Ã½:"y",Ã¿:"y",Ã†:"Ae",Ã¦:"ae",Ãž:"Th",Ã¾:"th",ÃŸ:"ss",Ä€:"A",Ä‚:"A",Ä„:"A",Ä:"a",Äƒ:"a",Ä…:"a",Ä†:"C",Äˆ:"C",ÄŠ:"C",ÄŒ:"C",Ä‡:"c",Ä‰:"c",Ä‹:"c",Ä:"c",ÄŽ:"D",Ä:"D",Ä:"d",Ä‘:"d",Ä’:"E",Ä”:"E",Ä–:"E",Ä˜:"E",Äš:"E",Ä“:"e",Ä•:"e",Ä—:"e",Ä™:"e",Ä›:"e",Äœ:"G",Äž:"G",Ä :"G",Ä¢:"G",Ä:"g",ÄŸ:"g",Ä¡:"g",Ä£:"g",Ä¤:"H",Ä¦:"H",Ä¥:"h",Ä§:"h",Ä¨:"I",Äª:"I",Ä¬:"I",Ä®:"I",Ä°:"I",Ä©:"i",Ä«:"i",Ä­:"i",Ä¯:"i",Ä±:"i",Ä´:"J",Äµ:"j",Ä¶:"K",Ä·:"k",Ä¸:"k",Ä¹:"L",Ä»:"L",Ä½:"L",Ä¿:"L",Å:"L",Äº:"l",Ä¼:"l",Ä¾:"l",Å€:"l",Å‚:"l",Åƒ:"N",Å…:"N",Å‡:"N",ÅŠ:"N",Å„:"n",Å†:"n",Åˆ:"n",Å‹:"n",ÅŒ:"O",ÅŽ:"O",Å:"O",Å:"o",Å:"o",Å‘:"o",Å”:"R",Å–:"R",Å˜:"R",Å•:"r",Å—:"r",Å™:"r",Åš:"S",Åœ:"S",Åž:"S",Å :"S",Å›:"s",Å:"s",ÅŸ:"s",Å¡:"s",Å¢:"T",Å¤:"T",Å¦:"T",Å£:"t",Å¥:"t",Å§:"t",Å¨:"U",Åª:"U",Å¬:"U",Å®:"U",Å°:"U",Å²:"U",Å©:"u",Å«:"u",Å­:"u",Å¯:"u",Å±:"u",Å³:"u",Å´:"W",Åµ:"w",Å¶:"Y",Å·:"y",Å¸:"Y",Å¹:"Z",Å»:"Z",Å½:"Z",Åº:"z",Å¼:"z",Å¾:"z",Ä²:"IJ",Ä³:"ij",Å’:"Oe",Å“:"oe",Å‰:"'n",Å¿:"ss"},$=e.g&&e.g.Object===Object&&e.g,K="object"==typeof self&&self&&self.Object===Object&&self,G=$||K||Function("return this")();function Q(e,t,r,n){var i=-1,s=e?e.length:0;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function Y(e){return e.split("")}function J(e){return e.match(s)||[]}var X=function(e){return function(t){return null==e?void 0:e[t]}}(W);function Z(e){return z.test(e)}function ee(e){return H.test(e)}function et(e){return Z(e)?er(e):Y(e)}function er(e){return e.match(U)||[]}function en(e){return e.match(V)||[]}var ei=Object.prototype.toString,es=G.Symbol,ea=es?es.prototype:void 0,eo=ea?ea.toString:void 0;function el(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function eu(e){if("string"==typeof e)return e;if(ef(e))return eo?eo.call(e):"";var t=e+"";return"0"==t&&1/e==-n?"-0":t}function ec(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:el(e,t,r)}function eh(e){return function(t){var r=Z(t=ep(t))?et(t):void 0,n=r?r[0]:t.charAt(0),i=r?ec(r,1).join(""):t.slice(1);return n[e]()+i}}function ed(e){return!!e&&"object"==typeof e}function ef(e){return"symbol"==typeof e||ed(e)&&ei.call(e)==i}function ep(e){return null==e?"":eu(e)}var eg=function(e){return function(t){return Q(e_(ey(t).replace(j,"")),e,"")}}(function(e,t,r){return t=t.toLowerCase(),e+(r?em(t):t)});function em(e){return ev(ep(e).toLowerCase())}function ey(e){return(e=ep(e))&&e.replace(a,X).replace(q,"")}var ev=eh("toUpperCase");function e_(e,t,r){return(e=ep(e),void 0===(t=r?void 0:t))?ee(e)?en(e):J(e):e.match(t)||[]}t.exports=eg},11772,(e,t,r)=>{"use strict";t.exports=function e(e,t){for(var r=Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(i,a){r[n]=function(e){if(s)if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){s&&(s=!1,a(e))}})}},72495,(e,t,r)=>{"use strict";var n=r;n.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=Array(64),s=Array(123),a=0;a<64;)s[i[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;n.encode=function(e,t,r){for(var n,s=null,a=[],o=0,l=0;t<r;){var u=e[t++];switch(l){case 0:a[o++]=i[u>>2],n=(3&u)<<4,l=1;break;case 1:a[o++]=i[n|u>>4],n=(15&u)<<2,l=2;break;case 2:a[o++]=i[n|u>>6],a[o++]=i[63&u],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return(l&&(a[o++]=i[n],a[o++]=61,1===l&&(a[o++]=61)),s)?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var o="invalid encoding";n.decode=function(e,t,r){for(var n,i=r,a=0,l=0;l<e.length;){var u=e.charCodeAt(l++);if(61===u&&a>1)break;if(void 0===(u=s[u]))throw Error(o);switch(a){case 0:n=u,a=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,a=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,a=3;break;case 3:t[r++]=(3&n)<<6|u,a=0}}if(1===a)throw Error(o);return r-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},61581,(e,t,r)=>{"use strict";function n(){this._listeners={}}t.exports=n,n.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},23791,(e,t,r)=>{"use strict";function n(e){return"u">typeof Float32Array?!function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function s(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function o(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:s,e.writeFloatBE=n?s:i,e.readFloatLE=n?a:o,e.readFloatBE=n?o:a}():!function(){function t(e,t,r,n){var i=+(t<0);if(i&&(t=-t),0===t)e(1/t>0?0:0x80000000,r,n);else if(isNaN(t))e(0x7fc00000,r,n);else if(t>34028234663852886e22)e((i<<31|0x7f800000)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var s=Math.floor(Math.log(t)/Math.LN2),a=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|a)>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=(n>>31)*2+1,s=n>>>23&255,a=8388607&n;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,s),e.readFloatLE=r.bind(null,a),e.readFloatBE=r.bind(null,o)}(),"u">typeof Float64Array?!function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function s(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function o(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:s,e.writeDoubleBE=n?s:i,e.readDoubleLE=n?a:o,e.readDoubleBE=n?o:a}():!function(){function t(e,t,r,n,i,s){var a,o=+(n<0);if(o&&(n=-n),0===n)e(0,i,s+t),e(1/n>0?0:0x80000000,i,s+r);else if(isNaN(n))e(0,i,s+t),e(0x7ff80000,i,s+r);else if(n>17976931348623157e292)e(0,i,s+t),e((o<<31|0x7ff00000)>>>0,i,s+r);else if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,s+t),e((o<<31|a/0x100000000)>>>0,i,s+r);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(0x10000000000000*(a=n*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+r)}}function r(e,t,r,n,i){var s=e(n,i+t),a=e(n,i+r),o=(a>>31)*2+1,l=a>>>20&2047,u=0x100000000*(1048575&a)+s;return 2047===l?u?NaN:1/0*o:0===l?5e-324*o*u:o*Math.pow(2,l-1075)*(u+0x10000000000000)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,s,4,0),e.readDoubleLE=r.bind(null,a,0,4),e.readDoubleBE=r.bind(null,o,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function s(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function o(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=n(n)},54311,(__turbopack_context__,module,exports)=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},93070,(e,t,r)=>{"use strict";var n=r;n.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t},n.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,s=[],a=0;t<r;)(n=e[t++])<128?s[a++]=n:n>191&&n<224?s[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(n>>10),s[a++]=56320+(1023&n)):s[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},n.write=function(e,t,r){for(var n,i,s=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-s}},37005,(e,t,r)=>{"use strict";t.exports=function e(e,t,r){var n=r||8192,i=n>>>1,s=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(s=e(n),a=0);var o=t.call(s,a,a+=r);return 7&a&&(a=(7|a)+1),o}}},87954,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(21890);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/0x100000000>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>0xffffffff&&(r=0,++n>0xffffffff&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e))if(!n.Long)return i.fromNumber(parseInt(e,10));else e=n.Long.fromString(e);return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+0x100000000*r)}return this.lo+0x100000000*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},21890,(e,t,r)=>{"use strict";var n=r;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function s(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=e.r(11772),n.base64=e.r(72495),n.EventEmitter=e.r(61581),n.float=e.r(23791),n.inquire=e.r(54311),n.utf8=e.r(93070),n.pool=e.r(37005),n.LongBits=e.r(87954),n.isNode=!!(e.g&&e.g.process&&e.g.process.versions&&e.g.process.versions.node),n.global=n.isNode&&e.g||"u">typeof self&&self||e.e,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!!(null!=r&&e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"u"<typeof Uint8Array?e:new Uint8Array(e)},n.Array="u">typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;if(!e){n._Buffer_from=n._Buffer_allocUnsafe=null;return}n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},14168,(e,t,r)=>{"use strict";t.exports={}},54109,(e,t,r)=>{"use strict";function n(e,t){"string"==typeof e&&(t=e,e=void 0);var r=[];function i(e){if("string"!=typeof e){var t=s();if(n.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var a=Object.keys(e),o=Array(a.length+1),l=Array(a.length),u=0;u<a.length;)o[u]=a[u],l[u]=e[a[u++]];return o[u]=t,Function.apply(null,o).apply(null,l)}return Function(t)()}for(var c=Array(arguments.length-1),h=0;h<c.length;)c[h]=arguments[++h];if(h=0,e=e.replace(/%([%dfijs])/g,function(e,t){var r=c[h++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"}),h!==c.length)throw Error("parameter count mismatch");return r.push(e),i}function s(n){return"function "+(n||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return i.toString=s,i}t.exports=n,n.verbose=!1},49498,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(11772),i=e.r(54311)("fs");function s(e,t,r){return("function"==typeof t?(r=t,t={}):t||(t={}),r)?!t.xhr&&i&&i.readFile?i.readFile(e,function(n,i){return n&&"u">typeof XMLHttpRequest?s.xhr(e,t,r):n?r(n):r(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,r):n(s,this,e,t)}s.xhr=function(e,t,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(t.binary){var e=n.response;if(!e){e=[];for(var i=0;i<n.responseText.length;++i)e.push(255&n.responseText.charCodeAt(i))}return r(null,"u">typeof Uint8Array?new Uint8Array(e):e)}return r(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}},50171,(e,t,r)=>{"use strict";var n=r,i=n.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},s=n.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=i(e),n="";r&&(n=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):r?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return n+t.join("/")};n.resolve=function(e,t,r){return(r||(t=s(t)),i(t))?t:(r||(e=s(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?s(e+"/"+t):t)}},80361,(e,t,r)=>{"use strict";t.exports=h;var n,i,s,a=e.r(589);((h.prototype=Object.create(a.prototype)).constructor=h).className="Namespace";var o=e.r(12666),l=e.r(78054),u=e.r(99511);function c(e,t){if(e&&e.length){for(var r={},n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}}function h(e,t){a.call(this,e,t),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function d(e){e._nestedArray=null,e._lookupCache={};for(var t=e;t=t.parent;)t._lookupCache={};return e}h.fromJSON=function(e,t){return new h(e,t.options).addJSON(t.nested)},h.arrayToJSON=c,h.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0}return!1},h.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),h.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",c(this.nestedArray,e)])},h.prototype.addJSON=function(e){var t=this;if(e)for(var r,a=Object.keys(e),l=0;l<a.length;++l)r=e[a[l]],t.add((void 0!==r.fields?n.fromJSON:void 0!==r.values?s.fromJSON:void 0!==r.methods?i.fromJSON:void 0!==r.id?o.fromJSON:h.fromJSON)(a[l],r));return this},h.prototype.get=function(e){return this.nested&&this.nested[e]||null},h.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},h.prototype.add=function(e){if(!(e instanceof o&&void 0!==e.extend||e instanceof n||e instanceof u||e instanceof s||e instanceof i||e instanceof h))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t)if(t instanceof h&&e instanceof h&&!(t instanceof n||t instanceof i)){for(var r=t.nestedArray,a=0;a<r.length;++a)e.add(r[a]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}else this.nested={};this.nested[e.name]=e,this instanceof n||this instanceof i||this instanceof s||this instanceof o||e._edition||(e._edition=e._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var l=this;l=l.parent;)l._needsRecursiveFeatureResolution=!0,l._needsRecursiveResolve=!0;return e.onAdd(this),d(this)},h.prototype.remove=function(e){if(!(e instanceof a))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),d(this)},h.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){var n=e.shift();if(r.nested&&r.nested[n]){if(!((r=r.nested[n])instanceof h))throw Error("path conflicts with non-namespace objects")}else r.add(r=new h(n))}return t&&r.addJSON(t),r},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof h?e[t++].resolveAll():e[t++].resolve();return this._needsRecursiveResolve=!1,this},h.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,e=this._edition||e,a.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},h.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;var n=e.join(".");if(""===e[0])return this.root.lookup(e.slice(1),t);var i=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+n];if(i&&(!t||t.indexOf(i.constructor)>-1)||(i=this._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;if(r)return null;for(var s=this;s.parent;){if((i=s.parent._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;s=s.parent}return null},h.prototype._lookupImpl=function(e,t){if(Object.prototype.hasOwnProperty.call(this._lookupCache,t))return this._lookupCache[t];var r=this.get(e[0]),n=null;if(r)1===e.length?n=r:r instanceof h&&(e=e.slice(1),n=r._lookupImpl(e,e.join(".")));else for(var i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof h&&(r=this._nestedArray[i]._lookupImpl(e,t))&&(n=r);return this._lookupCache[t]=n,n},h.prototype.lookupType=function(e){var t=this.lookup(e,[n]);if(!t)throw Error("no such type: "+e);return t},h.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},h.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[n,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},h.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},h._configure=function(e,t,r){n=e,i=t,s=r}},43187,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(12666);((a.prototype=Object.create(n.prototype)).constructor=a).className="MapField";var i=e.r(970),s=e.r(78054);function a(e,t,r,i,a,o){if(n.call(this,e,t,i,void 0,void 0,a,o),!s.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return n.prototype.resolve.call(this)},a.d=function(e,t,r){return"function"==typeof r?r=s.decorateType(r).name:r&&"object"==typeof r&&(r=s.decorateEnum(r).name),function(n,i){s.decorateType(n.constructor).add(new a(i,e,t,r))}}},40023,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(589);((s.prototype=Object.create(n.prototype)).constructor=s).className="Method";var i=e.r(78054);function s(e,t,r,s,a,o,l,u,c){if(i.isObject(a)?(l=a,a=o=void 0):i.isObject(o)&&(l=o,o=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");n.call(this,e,l),this.type=t||"rpc",this.requestType=r,this.requestStream=!!a||void 0,this.responseType=s,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=c}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))}},45069,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(21890);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,s,a){if(!s)throw TypeError("request must be specified");var o=this;if(!a)return n.asPromise(e,o,t,r,i,s);if(!o.rpcImpl)return void setTimeout(function(){a(Error("already ended"))},0);try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,r){if(e)return o.emit("error",e,t),a(e);if(null===r)return void o.end(!0);if(!(r instanceof i))try{r=i[o.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",r,t),a(null,r)})}catch(e){o.emit("error",e,t),setTimeout(function(){a(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},6943,(e,t,r)=>{"use strict";r.Service=e.r(45069)},29242,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(80361);((o.prototype=Object.create(n.prototype)).constructor=o).className="Service";var i=e.r(40023),s=e.r(78054),a=e.r(6943);function o(e,t){n.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}o.fromJSON=function(e,t){var r=new o(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),s=0;s<n.length;++s)r.add(i.fromJSON(n[s],t.methods[n[s]]));return t.nested&&r.addJSON(t.nested),t.edition&&(r._edition=t.edition),r.comment=t.comment,r._defaultEdition="proto3",r},o.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",n.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),o.prototype.get=function(e){return this.methods[e]||n.prototype.get.call(this,e)},o.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolve.call(this);for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this},o.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},o.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):n.prototype.add.call(this,e)},o.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return n.prototype.remove.call(this,e)},o.prototype.create=function(e,t,r){for(var n,i=new a.Service(e,t,r),o=0;o<this.methodsArray.length;++o){var l=s.lcFirst((n=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return i}},22292,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(21890);function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,n.toJSONOptions)}},88081,(e,t,r)=>{"use strict";t.exports=l;var n,i=e.r(21890),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var u="u">typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},c=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new n(e):u(e)})(e)}:u};function h(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw o(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=c(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=0xffffffff;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw o(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var n=i.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++])return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){n=e,l.create=c(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},69303,(e,t,r)=>{"use strict";t.exports=h;var n,i=e.r(21890),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new n})()}:function(){return new h}};function f(e,t,r){t[r]=255&e}function p(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function g(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function y(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,r){return this.tail=this.tail.next=new l(e,t,r),this.len+=t,this},g.prototype=Object.create(l.prototype),g.prototype.fn=p,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new g((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(m,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(m,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(m,t.length(),t)},h.prototype.bool=function(e){return this._push(f,1,+!!e)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(i.isString(e)){var r=h.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(f,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},h._configure=function(e){n=e,h.create=d(),n._configure()}},18420,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(89554),i=e.r(970),s=e.r(78054);function a(e){return"missing required '"+e.name+"'"}function o(e){for(var t=s.codegen(["r","l","e"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),r=0;r<e.fieldsArray.length;++r){var o=e._fieldsArray[r].resolve(),l=o.resolvedType instanceof n?"int32":o.type,u="m"+s.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",r):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==i.long[o.keyType]?t('%s[typeof k==="object"?util.longToHash(k):k]=value',u):t("%s[k]=value",u)):o.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,l)("}else"),void 0===i.basic[l]?t(o.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",u,r):t("%s.push(r.%s())",u,l)):void 0===i.basic[l]?t(o.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",u,r):t("%s=r.%s()",u,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var c=e._fieldsArray[r];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",a(c))}return t("return m")}},44324,(e,t,r)=>{"use strict";t.exports=l;var n=e.r(89554),i=e.r(78054);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,r,i){if(t.resolvedType)if(t.resolvedType instanceof n){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),o=0;o<a.length;++o)e("case %i:",t.resolvedType.values[a[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function o(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=e.oneofsArray,n={};r.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var u=e._fieldsArray[l].resolve(),c="m"+i.safeProp(u.name);if(u.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,u.name),u.map)t("if(!util.isObject(%s))",c)("return%j",s(u,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),o(t,u,"k[i]"),a(t,u,l,c+"[k[i]]")("}");else if(u.repeated)t("if(!Array.isArray(%s))",c)("return%j",s(u,"array"))("for(var i=0;i<%s.length;++i){",c),a(t,u,l,c+"[i]")("}");else{if(u.partOf){var h=i.safeProp(u.partOf.name);1===n[u.partOf.name]&&t("if(p%s===1)",h)("return%j",u.partOf.name+": multiple values"),n[u.partOf.name]=1,t("p%s=1",h)}a(t,u,l,c)}u.optional&&t("}")}return t("return null")}},37062,(e,t,r)=>{"use strict";var n=r,i=e.r(89554),s=e.r(78054);function a(e,t,r,n){var s=!1;if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",n);for(var a=t.resolvedType.values,o=Object.keys(a),l=0;l<o.length;++l)a[o[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',n,n,n),t.repeated||e("break"),s=!0),e("case%j:",o[l])("case %i:",a[o[l]])("m%s=%j",n,a[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",n,r,n);else{var u=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":u=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,u)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,u?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length >= 0)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n)}}return e}function o(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",n,r,n,n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,s?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n)}}return e}n.fromObject=function(e){var t=e.fieldsArray,r=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var n=0;n<t.length;++n){var o=t[n].resolve(),l=s.safeProp(o.name);o.map?(r("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(r,o,n,l+"[ks[i]]")("}")("}")):o.repeated?(r("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(r,o,n,l+"[i]")("}")("}")):(o.resolvedType instanceof i||r("if(d%s!=null){",l),a(r,o,n,l),o.resolvedType instanceof i||r("}"))}return r("return m")},n.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var r=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],a=[],l=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?n:t[u].map?a:l).push(t[u]);if(n.length){for(r("if(o.arrays||o.defaults){"),u=0;u<n.length;++u)r("d%s=[]",s.safeProp(n[u].name));r("}")}if(a.length){for(r("if(o.objects||o.defaults){"),u=0;u<a.length;++u)r("d%s={}",s.safeProp(a[u].name));r("}")}if(l.length){for(r("if(o.defaults){"),u=0;u<l.length;++u){var c=l[u],h=s.safeProp(c.name);if(c.resolvedType instanceof i)r("d%s=o.enums===String?%j:%j",h,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var d="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else r("d%s=%j",h,c.typeDefault)}r("}")}var f=!1;for(u=0;u<t.length;++u){var c=t[u],p=e._fieldsArray.indexOf(c),h=s.safeProp(c.name);c.map?(f||(f=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),o(r,c,p,h+"[ks2[j]]")("}")):c.repeated?(r("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),o(r,c,p,h+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",h,c.name),o(r,c,p,h),c.partOf&&r("if(o.oneofs)")("d%s=%j",s.safeProp(c.partOf.name),c.name)),r("}")}return r("return d")}},80116,(e,t,r)=>{"use strict";var n=r,i=e.r(22292);n[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),r=this.lookup(t);if(r){var n="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===n.indexOf("/")&&(n="/"+n),this.create({type_url:n,value:r.encode(r.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var r="type.googleapis.com/",n="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),n=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var a=this.lookup(s);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var o=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===n&&(n=r),s=n+l,o["@type"]=s,o}return this.toObject(e,t)}}},98922,(e,t,r)=>{"use strict";t.exports=v;var n=e.r(80361);((v.prototype=Object.create(n.prototype)).constructor=v).className="Type";var i=e.r(89554),s=e.r(99511),a=e.r(12666),o=e.r(43187),l=e.r(29242),u=e.r(22292),c=e.r(88081),h=e.r(69303),d=e.r(78054),f=e.r(91649),p=e.r(18420),g=e.r(44324),m=e.r(37062),y=e.r(80116);function v(e,t){n.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function _(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],n=r.id;if(this._fieldsById[n])throw Error("duplicate id "+n+" in "+this);this._fieldsById[n]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,u,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var n={};for(r=0;r<this.oneofsArray.length;++r)n[this._oneofsArray[r].resolve().name]={get:d.oneOfGetter(this._oneofsArray[r].oneof),set:d.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,n)}}}),v.generateConstructor=function(e){for(var t,r=d.codegen(["p"],e.name),n=0;n<e.fieldsArray.length;++n)(t=e._fieldsArray[n]).map?r("this%s={}",d.safeProp(t.name)):t.repeated&&r("this%s=[]",d.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var r=new v(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)r.add((void 0!==t.fields[u[c]].keyType?o.fromJSON:a.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)r.add(s.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){var h=t.nested[u[c]];r.add((void 0!==h.id?a.fromJSON:void 0!==h.fields?v.fromJSON:void 0!==h.values?i.fromJSON:void 0!==h.methods?l.fromJSON:n.fromJSON)(u[c],h))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},v.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return d.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",n.arrayToJSON(this.oneofsArray,e),"fields",n.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},v.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolveAll.call(this);var e=this.oneofsArray;for(r=0;r<e.length;)e[r++].resolve();for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();return this},v.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)})),this},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),_(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),_(this)):n.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),_(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),_(this)}return n.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=f(this)({Writer:h,types:t,util:d}),this.decode=p(this)({Reader:c,types:t,util:d}),this.verify=g(this)({types:t,util:d}),this.fromObject=m.fromObject(this)({types:t,util:d}),this.toObject=m.toObject(this)({types:t,util:d});var n=y[e];if(n){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(i),i.toObject=this.toObject,this.toObject=n.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){d.decorateType(t,e)}}},41790,(e,t,r)=>{"use strict";t.exports=h;var n,i,s,a=e.r(80361);((h.prototype=Object.create(a.prototype)).constructor=h).className="Root";var o=e.r(12666),l=e.r(89554),u=e.r(99511),c=e.r(78054);function h(e){a.call(this,"",e),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()},h.prototype.resolvePath=c.path.resolve,h.prototype.fetch=c.fetch,h.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=void 0);var a=this;if(!n)return c.asPromise(e,a,t,r);var o=n===d;function l(e,t){if(n){if(o)throw e;t&&t.resolveAll();var r=n;n=null,r(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var r=e.substring(t);if(r in s)return r}return null}function h(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){i.filename=e;var n,s=i(t,a,r),h=0;if(s.imports)for(;h<s.imports.length;++h)(n=u(s.imports[h])||a.resolvePath(e,s.imports[h]))&&f(n);if(s.weakImports)for(h=0;h<s.weakImports.length;++h)(n=u(s.weakImports[h])||a.resolvePath(e,s.weakImports[h]))&&f(n,!0)}else a.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}o||p||l(null,a)}function f(e,t){if(e=u(e)||e,!(a.files.indexOf(e)>-1)){if(a.files.push(e),e in s)return void(o?h(e,s[e]):(++p,setTimeout(function(){--p,h(e,s[e])})));if(o){var r;try{r=c.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}h(e,r)}else++p,a.fetch(e,function(r,i){if(--p,n){if(r)return void(t?p||l(null,a):l(r));h(e,i)}})}}var p=0;c.isString(t)&&(t=[t]);for(var g,m=0;m<t.length;++m)(g=a.resolvePath("",t[m]))&&f(g);return o?a.resolveAll():p||l(null,a),a},h.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return a.prototype.resolveAll.call(this)};var f=/^[A-Z]/;function p(e,t){var r=t.parent.lookup(t.extend);if(r){var n=new o(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!r.get(n.name)||(n.declaringField=t,t.extensionField=n,r.add(n),!0)}return!1}h.prototype._handleAdd=function(e){if(e instanceof o)void 0===e.extend||e.extensionField||p(this,e)||this.deferred.push(e);else if(e instanceof l)f.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof n)for(var t=0;t<this.deferred.length;)p(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);f.test(e.name)&&(e.parent[e.name]=e)}(e instanceof n||e instanceof l||e instanceof o)&&(this._fullyQualifiedObjects[e.fullName]=e)},h.prototype._handleRemove=function(e){if(e instanceof o){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof l)f.test(e.name)&&delete e.parent[e.name];else if(e instanceof a){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);f.test(e.name)&&delete e.parent[e.name]}delete this._fullyQualifiedObjects[e.fullName]},h._configure=function(e,t,r){n=e,i=t,s=r}},78054,(e,t,r)=>{"use strict";var n,i,s=t.exports=e.r(21890),a=e.r(14168);s.codegen=e.r(54109),s.fetch=e.r(49498),s.path=e.r(50171),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),r=Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},s.toObject=function(e){for(var t={},r=0;r<e.length;){var n=e[r++],i=e[r++];void 0!==i&&(t[n]=i)}return t};var o=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(o,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(t,r){if(t.$type)return r&&t.$type.name!==r&&(s.decorateRoot.remove(t.$type),t.$type.name=r,s.decorateRoot.add(t.$type)),t.$type;n||(n=e.r(98922));var i=new n(r||t.name);return s.decorateRoot.add(i),i.ctor=t,Object.defineProperty(t,"$type",{value:i,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:i,enumerable:!1}),i};var c=0;s.decorateEnum=function(t){if(t.$type)return t.$type;i||(i=e.r(89554));var r=new i("Enum"+c++,t);return s.decorateRoot.add(r),Object.defineProperty(t,"$type",{value:r,enumerable:!1}),r},s.setProperty=function(e,t,r,n){function i(e,t,r){var s=t.shift();if("__proto__"===s||"prototype"===s)return e;if(t.length>0)e[s]=i(e[s]||{},t,r);else{var a=e[s];if(a&&n)return e;a&&(r=[].concat(a).concat(r)),e[s]=r}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return i(e,t=t.split("."),r)},Object.defineProperty(s,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(e.r(41790)))}})},970,(e,t,r)=>{"use strict";var n=r,i=e.r(78054),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var r=0,n={};for(t|=0;r<e.length;)n[s[r+t]]=e[r++];return n}n.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),n.long=a([0,0,0,1,1],7),n.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},12666,(e,t,r)=>{"use strict";t.exports=u;var n,i=e.r(589);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";var s=e.r(89554),a=e.r(970),o=e.r(78054),l=/^required|optional|repeated$/;function u(e,t,r,n,s,u,c){if(o.isObject(n)?(c=s,u=n,n=s=void 0):o.isObject(s)&&(c=u,u=s,s=void 0),i.call(this,e,u),!o.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!o.isString(r))throw TypeError("type must be a string");if(void 0!==n&&!l.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");"proto3_optional"===n&&(n="optional"),this.rule=n&&"optional"!==n?n:void 0,this.type=r,this.id=t,this.extend=s||void 0,this.repeated="repeated"===n,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==a.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=c}u.fromJSON=function(e,t){var r=new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},Object.defineProperty(u.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(u.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(u.prototype,"delimited",{get:function(){return this.resolvedType instanceof n&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(u.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(u.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),u.prototype.setOption=function(e,t,r){return i.prototype.setOption.call(this,e,t,r)},u.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return o.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof n?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;o.base64.test(this.typeDefault)?o.base64.decode(this.typeDefault,e=o.newBuffer(o.base64.length(this.typeDefault)),0):o.utf8.write(this.typeDefault,e=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof n&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.prototype._inferLegacyProtoFeatures=function(e){if("proto2"!==e&&"proto3"!==e)return{};var t={};if("required"===this.rule&&(t.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===a.defaults[this.type]){var r=this.parent.get(this.type.split(".").pop());r&&r instanceof n&&r.group&&(t.message_encoding="DELIMITED")}return!0===this.getOption("packed")?t.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(t.repeated_field_encoding="EXPANDED"),t},u.prototype._resolveFeatures=function(e){return i.prototype._resolveFeatures.call(this,this._edition||e)},u.d=function(e,t,r,n){return"function"==typeof t?t=o.decorateType(t).name:t&&"object"==typeof t&&(t=o.decorateEnum(t).name),function(i,s){o.decorateType(i.constructor).add(new u(s,e,t,r,{default:n}))}},u._configure=function(e){n=e}},99511,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(589);((a.prototype=Object.create(n.prototype)).constructor=a).className="OneOf";var i=e.r(12666),s=e.r(78054);function a(e,t,r,i){if(Array.isArray(t)||(r=t,t=void 0),n.call(this,e,r),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function o(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,o(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){n.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}o(this)},a.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);n.prototype.onRemove.call(this,e)},Object.defineProperty(a.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var e=this.fieldsArray[0];return null!=e.options&&!0===e.options.proto3_optional}}),a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){s.decorateType(t.constructor).add(new a(r,e)),Object.defineProperty(t,r,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},589,(e,t,r)=>{"use strict";t.exports=u,u.className="ReflectionObject";let n=e.r(99511);var i,s=e.r(78054),a={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},o={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},l={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function u(e,t){if(!s.isString(e))throw TypeError("name must be a string");if(t&&!s.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(u.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),u.prototype.toJSON=function(){throw Error()},u.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof i&&t._handleAdd(this)},u.prototype.onRemove=function(e){var t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},u.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},u.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)},u.prototype._resolveFeatures=function(e){if(!this._featuresResolved){var t={};if(!e)throw Error("Unknown edition for "+this.fullName);var r=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if("proto2"===e)t=Object.assign({},o);else if("proto3"===e)t=Object.assign({},l);else if("2023"===e)t=Object.assign({},a);else throw Error("Unknown edition: "+e);this._features=Object.assign(t,r||{}),this._featuresResolved=!0;return}if(this.partOf instanceof n){var i=Object.assign({},this.partOf._features);this._features=Object.assign(i,r||{})}else if(this.declaringField);else if(this.parent){var s=Object.assign({},this.parent._features);this._features=Object.assign(s,r||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},u.prototype._inferLegacyProtoFeatures=function(){return{}},u.prototype.getOption=function(e){if(this.options)return this.options[e]},u.prototype.setOption=function(e,t,r){return this.options||(this.options={}),/^features\./.test(e)?s.setProperty(this.options,e,t,r):r&&void 0!==this.options[e]||(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this},u.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(r){var i=n.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(i){var a=i[e];s.setProperty(a,r,t)}else(i={})[e]=s.setProperty({},r,t),n.push(i)}else{var o={};o[e]=t,n.push(o)}return this},u.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this},u.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},u.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},u._configure=function(e){i=e}},89554,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(589);((a.prototype=Object.create(n.prototype)).constructor=a).className="Enum";var i=e.r(80361),s=e.r(78054);function a(e,t,r,i,s,a){if(n.call(this,e,r),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=a,this._valuesFeatures={},this.reserved=void 0,t)for(var o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.prototype._resolveFeatures=function(e){return e=this._edition||e,n.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(e=>{var t=Object.assign({},this._features);this._valuesFeatures[e]=Object.assign(t,this.valuesOptions&&this.valuesOptions[e]&&this.valuesOptions[e].features)}),this},a.fromJSON=function(e,t){var r=new a(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,r,n){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return n&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=n||null),this.comments[e]=r||null,this},a.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},91649,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(89554),i=e.r(970),s=e.r(78054);function a(e,t,r,n){return t.delimited?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,n,(t.id<<3|2)>>>0)}function o(e){for(var t,r,o=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var u=l[t].resolve(),c=e._fieldsArray.indexOf(u),h=u.resolvedType instanceof n?"int32":u.type,d=i.basic[h];r="m"+s.safeProp(u.name),u.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===d?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,r):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,r),o("}")("}")):u.repeated?(o("if(%s!=null&&%s.length){",r,r),u.packed&&void 0!==i.packed[h]?o("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",h,r)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",r),void 0===d?a(o,u,c,r+"[i]"):o("w.uint32(%i).%s(%s[i])",(u.id<<3|d)>>>0,h,r)),o("}")):(u.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,u.name),void 0===d?a(o,u,c,r):o("w.uint32(%i).%s(%s)",(u.id<<3|d)>>>0,h,r))}return o("return w")}},2344,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(69303);(s.prototype=Object.create(n.prototype)).constructor=s;var i=e.r(21890);function s(){n.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},62010,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(88081);(s.prototype=Object.create(n.prototype)).constructor=s;var i=e.r(21890);function s(e){n.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},27655,(e,t,r)=>{"use strict";var n=r;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=e.r(69303),n.BufferWriter=e.r(2344),n.Reader=e.r(88081),n.BufferReader=e.r(62010),n.util=e.r(21890),n.rpc=e.r(6943),n.roots=e.r(14168),n.configure=i,i()},28099,(e,t,r)=>{"use strict";var n=t.exports=e.r(27655);function i(e,t,r){return"function"==typeof t?(r=t,t=new n.Root):t||(t=new n.Root),t.load(e,r)}function s(e,t){return t||(t=new n.Root),t.loadSync(e)}n.build="light",n.load=i,n.loadSync=s,n.encoder=e.r(91649),n.decoder=e.r(18420),n.verifier=e.r(44324),n.converter=e.r(37062),n.ReflectionObject=e.r(589),n.Namespace=e.r(80361),n.Root=e.r(41790),n.Enum=e.r(89554),n.Type=e.r(98922),n.Field=e.r(12666),n.OneOf=e.r(99511),n.MapField=e.r(43187),n.Service=e.r(29242),n.Method=e.r(40023),n.Message=e.r(22292),n.wrappers=e.r(80116),n.types=e.r(970),n.util=e.r(78054),n.ReflectionObject._configure(n.Root),n.Namespace._configure(n.Type,n.Service,n.Enum),n.Root._configure(n.Type),n.Field._configure(n.Type)},30183,(e,t,r)=>{"use strict";t.exports=f;var n=/[\s{}=;:[\],'"()<>]/g,i=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,s=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,a=/^ *[*/]+ */,o=/^\s*\*?\/*/,l=/\n/g,u=/\s/,c=/\\(.?)/g,h={0:"\0",r:"\r",n:"\n",t:"	"};function d(e){return e.replace(c,function(e,t){switch(t){case"\\":case"":return t;default:return h[t]||""}})}function f(e,t){e=e.toString();var r=0,c=e.length,h=1,f=0,p={},g=[],m=null;function y(e){return Error("illegal "+e+" (line "+h+")")}function v(){var t="'"===m?s:i;t.lastIndex=r-1;var n=t.exec(e);if(!n)throw y("string");return r=t.lastIndex,T(m),m=null,d(n[1])}function _(t){return e.charAt(t)}function b(r,n,i){var s,u={type:e.charAt(r++),lineEmpty:!1,leading:i},c=r-(t?2:3);do if(--c<0||"\n"===(s=e.charAt(c))){u.lineEmpty=!0;break}while(" "===s||"	"===s)for(var d=e.substring(r,n).split(l),g=0;g<d.length;++g)d[g]=d[g].replace(t?o:a,"").trim();u.text=d.join("\n").trim(),p[h]=u,f=h}function S(t){var r=C(t),n=e.substring(t,r);return/^\s*\/\//.test(n)}function C(e){for(var t=e;t<c&&"\n"!==_(t);)t++;return t}function w(){if(g.length>0)return g.shift();if(m)return v();var i,s,a,o,l,d=0===r;do{if(r===c)return null;for(i=!1;u.test(a=_(r));)if("\n"===a&&(d=!0,++h),++r===c)return null;if("/"===_(r)){if(++r===c)throw y("comment");if("/"===_(r))if(t){if(o=r,l=!1,S(r-1)){l=!0;do if((r=C(r))===c||(r++,!d))break;while(S(r))}else r=Math.min(c,C(r)+1);l&&(b(o,r,d),d=!0),h++,i=!0}else{for(l="/"===_(o=r+1);"\n"!==_(++r);)if(r===c)return null;++r,l&&(b(o,r-1,d),d=!0),++h,i=!0}else{if("*"!==(a=_(r)))return"/";o=r+1,l=t||"*"===_(o);do{if("\n"===a&&++h,++r===c)throw y("comment");s=a,a=_(r)}while("*"!==s||"/"!==a)++r,l&&(b(o,r-2,d),d=!0),i=!0}}}while(i)var f=r;if(n.lastIndex=0,!n.test(_(f++)))for(;f<c&&!n.test(_(f));)++f;var p=e.substring(r,r=f);return('"'===p||"'"===p)&&(m=p),p}function T(e){g.push(e)}function E(){if(!g.length){var e=w();if(null===e)return null;T(e)}return g[0]}function k(e,t){var r=E();if(r===e)return w(),!0;if(!t)throw y("token '"+r+"', '"+e+"' expected");return!1}function I(e){var r,n=null;return void 0===e?(r=p[h-1],delete p[h-1],r&&(t||"*"===r.type||r.lineEmpty)&&(n=r.leading?r.text:null)):(f<e&&E(),r=p[e],delete p[e],r&&!r.lineEmpty&&(t||"/"===r.type)&&(n=r.leading?null:r.text)),n}return Object.defineProperty({next:w,peek:E,push:T,skip:k,cmnt:I},"line",{get:function(){return h}})}f.unescape=d},63658,(e,t,r)=>{"use strict";t.exports=T,T.filename=null,T.defaults={keepCase:!1};var n=e.r(30183),i=e.r(41790),s=e.r(98922),a=e.r(12666),o=e.r(43187),l=e.r(99511),u=e.r(89554),c=e.r(29242),h=e.r(40023),d=e.r(589),f=e.r(970),p=e.r(78054),g=/^[1-9][0-9]*$/,m=/^-?[1-9][0-9]*$/,y=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,_=/^0[0-7]+$/,b=/^-?0[0-7]+$/,S=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,C=/^[a-zA-Z_][a-zA-Z_0-9]*$/,w=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function T(e,t,r){t instanceof i||(r=t,t=new i),r||(r=T.defaults);var E,k,I,R,x=r.preferTrailingComment||!1,D=n(e,r.alternateCommentMode||!1),O=D.next,A=D.push,N=D.peek,P=D.skip,M=D.cmnt,L=!0,F="proto2",B=t,j=[],q={},U=r.keepCase?function(e){return e}:p.camelCase;function V(){j.forEach(e=>{e._edition=F,Object.keys(q).forEach(t=>{void 0===e.getOption(t)&&e.setOption(t,q[t],!0)})})}function z(e,t,r){var n=T.filename;return r||(T.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(n?n+", ":"")+"line "+D.line+")")}function H(){var e,t=[];do{if('"'!==(e=O())&&"'"!==e)throw z(e);t.push(O()),P(e),e=N()}while('"'===e||"'"===e)return t.join("")}function W(e){var t=O();switch(t){case"'":case'"':return A(t),H();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return K(t,!0)}catch(r){if(e&&w.test(t))return t;throw z(t,"value")}}function $(e,t){do if(t&&('"'===(r=N())||"'"===r)){var r,n,i=H();if(e.push(i),F>=2023)throw z(i,"id")}else try{e.push([n=G(O()),P("to",!0)?G(O()):n])}catch(n){if(t&&w.test(r)&&F>=2023)e.push(r);else throw n}while(P(",",!0))var s={options:void 0};s.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},ee(s,function(e){if("option"===e)el(s,e),P(";");else throw z(e)},function(){ed(s)})}function K(e,t){var r=1;switch("-"===e.charAt(0)&&(r=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*r;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(g.test(e))return r*parseInt(e,10);if(y.test(e))return r*parseInt(e,16);if(_.test(e))return r*parseInt(e,8);if(S.test(e))return r*parseFloat(e);throw z(e,"number",t)}function G(e,t){switch(e){case"max":case"MAX":case"Max":return 0x1fffffff;case"0":return 0}if(!t&&"-"===e.charAt(0))throw z(e,"id");if(m.test(e))return parseInt(e,10);if(v.test(e))return parseInt(e,16);if(b.test(e))return parseInt(e,8);throw z(e,"id")}function Q(){if(void 0!==k)throw z("package");if(k=O(),!w.test(k))throw z(k,"name");B=B.define(k),P(";")}function Y(){var e,t=N();switch(t){case"weak":e=R||(R=[]),O();break;case"public":O();default:e=I||(I=[])}t=H(),P(";"),e.push(t)}function J(){if(P("="),(F=H())<2023)throw z(F,"syntax");P(";")}function X(){if(P("="),!["2023"].includes(F=H()))throw z(F,"edition");P(";")}function Z(e,t){switch(t){case"option":return el(e,t),P(";"),!0;case"message":return et(e,t),!0;case"enum":return ea(e,t),!0;case"service":return ef(e,t),!0;case"extend":return eg(e,t),!0}return!1}function ee(e,t,r){var n,i=D.line;if(e&&("string"!=typeof e.comment&&(e.comment=M()),e.filename=T.filename),P("{",!0)){for(;"}"!==(n=O());)t(n);P(";",!0)}else r&&r(),P(";"),e&&("string"!=typeof e.comment||x)&&(e.comment=M(i)||e.comment)}function et(e,t){if(!C.test(t=O()))throw z(t,"type name");var r=new s(t);ee(r,function(e){if(!Z(r,e))switch(e){case"map":ei(r,e);break;case"required":if("proto2"!==F)throw z(e);case"repeated":er(r,e);break;case"optional":if("proto3"===F)er(r,"proto3_optional");else if("proto2"!==F)throw z(e);else er(r,"optional");break;case"oneof":es(r,e);break;case"extensions":$(r.extensions||(r.extensions=[]));break;case"reserved":$(r.reserved||(r.reserved=[]),!0);break;default:if("proto2"===F||!w.test(e))throw z(e);A(e),er(r,"optional")}}),e.add(r),e===B&&j.push(r)}function er(e,t,r){var n=O();if("group"===n)return void en(e,t);for(;n.endsWith(".")||N().startsWith(".");)n+=O();if(!w.test(n))throw z(n,"type");var i=O();if(!C.test(i))throw z(i,"name");i=U(i),P("=");var s=new a(i,G(O()),n,t,r);if(ee(s,function(e){if("option"===e)el(s,e),P(";");else throw z(e)},function(){ed(s)}),"proto3_optional"===t){var o=new l("_"+i);s.setOption("proto3_optional",!0),o.add(s),e.add(o)}else e.add(s);e===B&&j.push(s)}function en(e,t){if(F>=2023)throw z("group");var r=O();if(!C.test(r))throw z(r,"name");var n=p.lcFirst(r);r===n&&(r=p.ucFirst(r)),P("=");var i=G(O()),o=new s(r);o.group=!0;var l=new a(n,i,r,t);l.filename=T.filename,ee(o,function(e){switch(e){case"option":el(o,e),P(";");break;case"required":case"repeated":er(o,e);break;case"optional":"proto3"===F?er(o,"proto3_optional"):er(o,"optional");break;case"message":et(o,e);break;case"enum":ea(o,e);break;case"reserved":$(o.reserved||(o.reserved=[]),!0);break;default:throw z(e)}}),e.add(o).add(l)}function ei(e){P("<");var t=O();if(void 0===f.mapKey[t])throw z(t,"type");P(",");var r=O();if(!w.test(r))throw z(r,"type");P(">");var n=O();if(!C.test(n))throw z(n,"name");P("=");var i=new o(U(n),G(O()),t,r);ee(i,function(e){if("option"===e)el(i,e),P(";");else throw z(e)},function(){ed(i)}),e.add(i)}function es(e,t){if(!C.test(t=O()))throw z(t,"name");var r=new l(U(t));ee(r,function(e){"option"===e?(el(r,e),P(";")):(A(e),er(r,"optional"))}),e.add(r)}function ea(e,t){if(!C.test(t=O()))throw z(t,"name");var r=new u(t);ee(r,function(e){switch(e){case"option":el(r,e),P(";");break;case"reserved":$(r.reserved||(r.reserved=[]),!0),void 0===r.reserved&&(r.reserved=[]);break;default:eo(r,e)}}),e.add(r),e===B&&j.push(r)}function eo(e,t){if(!C.test(t))throw z(t,"name");P("=");var r=G(O(),!0),n={options:void 0};n.getOption=function(e){return this.options[e]},n.setOption=function(e,t){d.prototype.setOption.call(n,e,t)},n.setParsedOption=function(){},ee(n,function(e){if("option"===e)el(n,e),P(";");else throw z(e)},function(){ed(n)}),e.add(t,r,n.comment,n.parsedOptions||n.options)}function el(e,t){var r,n,i=!0;for("option"===t&&(t=O());"="!==t;){if("("===t){var s=O();P(")"),t="("+s+")"}if(i){if(i=!1,t.includes(".")&&!t.includes("(")){var a=t.split(".");r=a[0]+".",t=a[1];continue}r=t}else n=n?n+=t:t;t=O()}var o=eu(e,n?r.concat(n):r);n=n&&"."===n[0]?n.slice(1):n,eh(e,r=r&&"."===r[r.length-1]?r.slice(0,-1):r,o,n)}function eu(e,t){if(P("{",!0)){for(var r={};!P("}",!0);){if(!C.test(E=O()))throw z(E,"name");if(null===E)throw z(E,"end of input");var n,i,s=E;if(P(":",!0),"{"===N())n=eu(e,t+"."+E);else if("["===N()){if(n=[],P("[",!0)){do i=W(!0),n.push(i);while(P(",",!0))P("]"),void 0!==i&&ec(e,t+"."+E,i)}}else n=W(!0),ec(e,t+"."+E,n);var a=r[s];a&&(n=[].concat(a).concat(n)),r[s]=n,P(",",!0),P(";",!0)}return r}var o=W(!0);return ec(e,t,o),o}function ec(e,t,r){if(B===e&&/^features\./.test(t)){q[t]=r;return}e.setOption&&e.setOption(t,r)}function eh(e,t,r,n){e.setParsedOption&&e.setParsedOption(t,r,n)}function ed(e){if(P("[",!0)){do el(e,"option");while(P(",",!0))P("]")}return e}function ef(e,t){if(!C.test(t=O()))throw z(t,"service name");var r=new c(t);ee(r,function(e){if(!Z(r,e))if("rpc"===e)ep(r,e);else throw z(e)}),e.add(r),e===B&&j.push(r)}function ep(e,t){var r=M(),n=t;if(!C.test(t=O()))throw z(t,"name");var i,s,a,o,l=t;if(P("("),P("stream",!0)&&(s=!0),!w.test(t=O())||(i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(o=!0),!w.test(t=O())))throw z(t);a=t,P(")");var u=new h(l,n,i,a,s,o);u.comment=r,ee(u,function(e){if("option"===e)el(u,e),P(";");else throw z(e)}),e.add(u)}function eg(e,t){if(!w.test(t=O()))throw z(t,"reference");var r=t;ee(null,function(t){switch(t){case"required":case"repeated":er(e,t,r);break;case"optional":"proto3"===F?er(e,"proto3_optional",r):er(e,"optional",r);break;default:if("proto2"===F||!w.test(t))throw z(t);A(t),er(e,"optional",r)}})}for(;null!==(E=O());)switch(E){case"package":if(!L)throw z(E);Q();break;case"import":if(!L)throw z(E);Y();break;case"syntax":if(!L)throw z(E);J();break;case"edition":if(!L)throw z(E);X();break;case"option":el(B,E),P(";",!0);break;default:if(Z(B,E)){L=!1;continue}throw z(E)}return V(),T.filename=null,{package:k,imports:I,weakImports:R,root:t}}},8441,(e,t,r)=>{"use strict";t.exports=s;var n,i=/\/|\./;function s(e,t){i.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),s[e]=t}s("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),s("duration",{Duration:n={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),s("timestamp",{Timestamp:n}),s("empty",{Empty:{fields:{}}}),s("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),s("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),s("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),s.get=function(e){return s[e]||null}},92330,(e,t,r)=>{"use strict";var n=t.exports=e.r(28099);n.build="full",n.tokenize=e.r(30183),n.parse=e.r(63658),n.common=e.r(8441),n.Root._configure(n.Type,n.parse,n.common)},8401,(e,t,r)=>{"use strict";t.exports=e.r(92330)},16348,(e,t,r)=>{"use strict";var n=e.r(8401);t.exports=r=n.descriptor=n.Root.fromJSON(e.r(11973)).lookup(".google.protobuf");var i=n.Namespace,s=n.Root,a=n.Enum,o=n.Type,l=n.Field,u=n.MapField,c=n.OneOf,h=n.Service,d=n.Method;function f(e,t,n){var u=r.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});D(n,u),e instanceof s||(u.package=e.fullName.substring(1));for(var c,d=0;d<e.nestedArray.length;++d)(c=e._nestedArray[d])instanceof o?u.messageType.push(c.toDescriptor(n)):c instanceof a?u.enumType.push(c.toDescriptor()):c instanceof l?u.extension.push(c.toDescriptor(n)):c instanceof h?u.service.push(c.toDescriptor()):c instanceof i&&f(c,t,n);u.options=k(e.options,r.FileOptions),u.messageType.length+u.enumType.length+u.extension.length+u.service.length&&t.push(u)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=r.FileDescriptorSet.decode(e));var t=new s;if(e.file)for(var n,i,u,c=0;c<e.file.length;++c){i=t,(n=e.file[c]).package&&n.package.length&&(i=t.define(n.package));var d=x(n);if(n.name&&n.name.length&&t.files.push(i.filename=n.name),n.messageType)for(u=0;u<n.messageType.length;++u)i.add(o.fromDescriptor(n.messageType[u],d));if(n.enumType)for(u=0;u<n.enumType.length;++u)i.add(a.fromDescriptor(n.enumType[u],d));if(n.extension)for(u=0;u<n.extension.length;++u)i.add(l.fromDescriptor(n.extension[u],d));if(n.service)for(u=0;u<n.service.length;++u)i.add(h.fromDescriptor(n.service[u],d));var f=T(n.options,r.FileOptions);if(f){var p=Object.keys(f);for(u=0;u<p.length;++u)i.setOption(p[u],f[p[u]])}}return t.resolveAll()},s.prototype.toDescriptor=function(e){var t=r.FileDescriptorSet.create();return f(this,t.file,e),t};var p=0;o.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.DescriptorProto.decode(e));var i,s=new o(e.name.length?e.name:"Type"+p++,T(e.options,r.MessageOptions));if(n||(s._edition=t),e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)s.add(c.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var u=l.fromDescriptor(e.field[i],t,!0);s.add(u),e.field[i].hasOwnProperty("oneofIndex")&&s.oneofsArray[e.field[i].oneofIndex].add(u)}if(e.extension)for(i=0;i<e.extension.length;++i)s.add(l.fromDescriptor(e.extension[i],t,!0));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)s.add(o.fromDescriptor(e.nestedType[i],t,!0)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&s.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)s.add(a.fromDescriptor(e.enumType[i],t,!0));if(e.extensionRange&&e.extensionRange.length)for(i=0,s.extensions=[];i<e.extensionRange.length;++i)s.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(s.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)s.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)s.reserved.push(e.reservedName[i])}return s},o.prototype.toDescriptor=function(e){var t,n,i=r.DescriptorProto.create({name:this.name});for(n=0;n<this.fieldsArray.length;++n)if(i.field.push(t=this._fieldsArray[n].toDescriptor(e)),this._fieldsArray[n]instanceof u){var s=C(this._fieldsArray[n].keyType,this._fieldsArray[n].resolvedKeyType,!1),c=C(this._fieldsArray[n].type,this._fieldsArray[n].resolvedType,!1),h=11===c||14===c?this._fieldsArray[n].resolvedType&&I(this.parent,this._fieldsArray[n].resolvedType)||this._fieldsArray[n].type:void 0;i.nestedType.push(r.DescriptorProto.create({name:t.typeName,field:[r.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),r.FieldDescriptorProto.create({name:"value",number:2,label:1,type:c,typeName:h})],options:r.MessageOptions.create({mapEntry:!0})}))}for(n=0;n<this.oneofsArray.length;++n)i.oneofDecl.push(this._oneofsArray[n].toDescriptor());for(n=0;n<this.nestedArray.length;++n)this._nestedArray[n]instanceof l?i.field.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof o?i.nestedType.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof a&&i.enumType.push(this._nestedArray[n].toDescriptor());if(this.extensions)for(n=0;n<this.extensions.length;++n)i.extensionRange.push(r.DescriptorProto.ExtensionRange.create({start:this.extensions[n][0],end:this.extensions[n][1]}));if(this.reserved)for(n=0;n<this.reserved.length;++n)"string"==typeof this.reserved[n]?i.reservedName.push(this.reserved[n]):i.reservedRange.push(r.DescriptorProto.ReservedRange.create({start:this.reserved[n][0],end:this.reserved[n][1]}));return i.options=k(this.options,r.MessageOptions),i};var g=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,t,n){if("number"==typeof e.length&&(e=r.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(i=e.typeName&&e.typeName.length?e.typeName:b(e.type),e.label){case 1:s=void 0;break;case 2:s="required";break;case 3:s="repeated";break;default:throw Error("illegal label: "+e.label)}var i,s,a=e.extendee;void 0!==e.extendee&&(a=a.length?a:void 0);var o=new l(e.name.length?e.name:"field"+e.number,e.number,i,s,a);if(n||(o._edition=t),o.options=T(e.options,r.FieldOptions),e.proto3_optional&&(o.options.proto3_optional=!0),e.defaultValue&&e.defaultValue.length){var u=e.defaultValue;switch(u){case"true":case"TRUE":u=!0;break;case"false":case"FALSE":u=!1;break;default:g.exec(u)&&(u=parseInt(u))}o.setOption("default",u)}return S(e.type)&&("proto3"===t?e.options&&!e.options.packed&&o.setOption("packed",!1):(!t||"proto2"===t)&&e.options&&e.options.packed&&o.setOption("packed",!0)),o},l.prototype.toDescriptor=function(e){var t=r.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=n.util.ucFirst(this.name),t.label=3;else{switch(t.type=C(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:t.typeName=this.resolvedType?I(this.parent,this.resolvedType):this.type}"repeated"===this.rule?t.label=3:this.required&&"proto2"===e?t.label=2:t.label=1}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=k(this.options,r.FieldOptions),null!=this.options.default&&(t.defaultValue=String(this.options.default)),this.options.proto3_optional&&(t.proto3_optional=!0)),"proto3"===e?this.packed||((t.options||(t.options=r.FieldOptions.create())).packed=!1):(!e||"proto2"===e)&&this.packed&&((t.options||(t.options=r.FieldOptions.create())).packed=!0),t};var m=0;a.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.EnumDescriptorProto.decode(e));var i={};if(e.value)for(var s=0;s<e.value.length;++s){var o=e.value[s].name,l=e.value[s].number||0;i[o&&o.length?o:"NAME"+l]=l}var u=new a(e.name&&e.name.length?e.name:"Enum"+m++,i,T(e.options,r.EnumOptions));return n||(u._edition=t),u},a.prototype.toDescriptor=function(){for(var e=[],t=0,n=Object.keys(this.values);t<n.length;++t)e.push(r.EnumValueDescriptorProto.create({name:n[t],number:this.values[n[t]]}));return r.EnumDescriptorProto.create({name:this.name,value:e,options:k(this.options,r.EnumOptions)})};var y=0;c.fromDescriptor=function(e){return"number"==typeof e.length&&(e=r.OneofDescriptorProto.decode(e)),new c(e.name&&e.name.length?e.name:"oneof"+y++)},c.prototype.toDescriptor=function(){return r.OneofDescriptorProto.create({name:this.name})};var v=0;h.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.ServiceDescriptorProto.decode(e));var i=new h(e.name&&e.name.length?e.name:"Service"+v++,T(e.options,r.ServiceOptions));if(n||(i._edition=t),e.method)for(var s=0;s<e.method.length;++s)i.add(d.fromDescriptor(e.method[s]));return i},h.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return r.ServiceDescriptorProto.create({name:this.name,method:e,options:k(this.options,r.ServiceOptions)})};var _=0;function b(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function S(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function C(e,t,r){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof a)return 14;if(t instanceof o)return r?10:11;throw Error("illegal type: "+e)}function w(e,t){for(var r,n,i={},s=0;s<t.fieldsArray.length;++s)if("uninterpretedOption"!==(n=(r=t._fieldsArray[s]).name)&&Object.prototype.hasOwnProperty.call(e,n)){var l=R(n);r.resolvedType instanceof o?i[l]=w(e[n],r.resolvedType):r.resolvedType instanceof a?i[l]=r.resolvedType.valuesById[e[n]]:i[l]=e[n]}return i}function T(e,t){if(e)return w(t.toObject(e),t)}function E(e,t){for(var r={},i=Object.keys(e),s=0;s<i.length;++s){var a=i[s],l=n.util.camelCase(a);if(Object.prototype.hasOwnProperty.call(t.fields,l)){var u=t.fields[l];u.resolvedType instanceof o?r[l]=E(e[a],u.resolvedType):r[l]=e[a],u.repeated&&!Array.isArray(r[l])&&(r[l]=[r[l]])}}return r}function k(e,t){if(e)return t.fromObject(E(e,t))}function I(e,t){var r=e.fullName.split("."),n=t.fullName.split("."),a=0,o=0,l=n.length-1;if(!(e instanceof s)&&t instanceof i)for(;a<r.length&&o<l&&r[a]===n[o];){var u=t.lookup(r[a++],!0);if(null!==u&&u!==t)break;++o}else for(;a<r.length&&o<l&&r[a]===n[o];++a,++o);return n.slice(o).join(".")}function R(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}function x(e){if("editions"===e.syntax)if(e.edition===r.Edition.EDITION_2023)return"2023";else throw Error("Unsupported edition "+e.edition);return"proto3"===e.syntax?"proto3":"proto2"}function D(e,t){if(e)if("proto2"===e||"proto3"===e)t.syntax=e;else if(t.syntax="editions","2023"===e)t.edition=r.Edition.EDITION_2023;else throw Error("Unsupported edition "+e)}d.fromDescriptor=function(e){return"number"==typeof e.length&&(e=r.MethodDescriptorProto.decode(e)),new d(e.name&&e.name.length?e.name:"Method"+_++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,T(e.options,r.MethodOptions))},d.prototype.toDescriptor=function(){return r.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:k(this.options,r.MethodOptions)})}},48605,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addCommonProtos=r.loadProtosWithOptionsSync=r.loadProtosWithOptions=void 0;let n=e.r(22734),i=e.r(14747),s=e.r(8401);function a(e,t){let r=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return n.accessSync(t,n.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),r(e,s)}}r.loadProtosWithOptions=async function(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));a(r,t.includeDirs)}let n=await r.load(e,t);return n.resolveAll(),n},r.loadProtosWithOptionsSync=function(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");a(r,t.includeDirs)}let n=r.loadSync(e,t);return n.resolveAll(),n},r.addCommonProtos=function(){let t=e.r(43707),r=e.r(11973),n=e.r(89452),i=e.r(72341);s.common("api",t.nested.google.nested.protobuf.nested),s.common("descriptor",r.nested.google.nested.protobuf.nested),s.common("source_context",n.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}},41262,(e,t,r)=>{!function(n,i){function s(e){return e.default||e}if("function"==typeof define&&define.amd){let t;void 0!==(t=function(){var e={};return i(e),s(e)}())&&e.v(t)}else i(r),t.exports=s(r)}("u">typeof globalThis?globalThis:"u">typeof self?self:e.e,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function n(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=n;var s={},a={};function o(e,t){var r,n,i;if(t)return(e>>>=0,(i=0<=e&&e<256)&&(n=a[e]))?n:(r=u(e,0,!0),i&&(a[e]=r),r);return(e|=0,(i=-128<=e&&e<128)&&(n=s[e]))?n:(r=u(e,e<0?-1:0,!1),i&&(s[e]=r),r)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=p)return w}else{if(e<=-g)return T;if(e+1>=g)return C}return e<0?l(-e,t).neg():u(e%f|0,e/f|0,t)}function u(e,t,n){return new r(e,t,n)}r.fromInt=o,r.fromNumber=l,r.fromBits=u;var c=Math.pow;function h(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((r=r||10)<2||36<r)throw RangeError("radix");if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return h(e.substring(1),t,r).neg();for(var n,i=l(c(r,8)),s=y,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),u=parseInt(e.substring(a,a+o),r);if(o<8){var d=l(c(r,o));s=s.mul(d).add(l(u))}else s=(s=s.mul(i)).add(l(u))}return s.unsigned=t,s}function d(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?h(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=h,r.fromValue=d;var f=0x100000000,p=0xffffffffffffffff,g=0x8000000000000000,m=o(0x1000000),y=o(0);r.ZERO=y;var v=o(0,!0);r.UZERO=v;var _=o(1);r.ONE=_;var b=o(1,!0);r.UONE=b;var S=o(-1);r.NEG_ONE=S;var C=u(-1,0x7fffffff,!1);r.MAX_VALUE=C;var w=u(-1,-1,!0);r.MAX_UNSIGNED_VALUE=w;var T=u(0,-0x80000000,!1);r.MIN_VALUE=T;var E=r.prototype;E.toInt=function(){return this.unsigned?this.low>>>0:this.low},E.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},E.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(!this.eq(T))return"-"+this.neg().toString(e);else{var t=l(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}for(var i=l(c(e,6),this.unsigned),s=this,a="";;){var o=s.div(i),u=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},E.getHighBits=function(){return this.high},E.getHighBitsUnsigned=function(){return this.high>>>0},E.getLowBits=function(){return this.low},E.getLowBitsUnsigned=function(){return this.low>>>0},E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},E.isSafeInteger=function(){var e=this.high>>21;return!e||!this.unsigned&&-1===e&&(0!==this.low||-2097152!==this.high)},E.isZero=function(){return 0===this.high&&0===this.low},E.eqz=E.isZero,E.isNegative=function(){return!this.unsigned&&this.high<0},E.isPositive=function(){return this.unsigned||this.high>=0},E.isOdd=function(){return(1&this.low)==1},E.isEven=function(){return(1&this.low)==0},E.equals=function(e){return n(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},E.eq=E.equals,E.notEquals=function(e){return!this.eq(e)},E.neq=E.notEquals,E.ne=E.notEquals,E.lessThan=function(e){return 0>this.comp(e)},E.lt=E.lessThan,E.lessThanOrEqual=function(e){return 0>=this.comp(e)},E.lte=E.lessThanOrEqual,E.le=E.lessThanOrEqual,E.greaterThan=function(e){return this.comp(e)>0},E.gt=E.greaterThan,E.greaterThanOrEqual=function(e){return this.comp(e)>=0},E.gte=E.greaterThanOrEqual,E.ge=E.greaterThanOrEqual,E.compare=function(e){if(n(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},E.comp=E.compare,E.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(_)},E.neg=E.negate,E.add=function(e){n(e)||(e=d(e));var t,r,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,l=e.high>>>16,c=65535&e.high,h=e.low>>>16,f=65535&e.low,p=0,g=0;return t=0+((r=0+(o+f))>>>16),r&=65535,t+=a+h,g+=t>>>16,t&=65535,g+=s+c,p+=g>>>16,g&=65535,p+=i+l,u(t<<16|r,(p&=65535)<<16|g,this.unsigned)},E.subtract=function(e){return n(e)||(e=d(e)),this.add(e.neg())},E.sub=E.subtract,E.multiply=function(e){if(this.isZero())return this;if(n(e)||(e=d(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(T))return e.isOdd()?T:y;if(e.eq(T))return this.isOdd()?T:y;if(this.isNegative())if(e.isNegative())return this.neg().mul(e.neg());else return this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return l(this.toNumber()*e.toNumber(),this.unsigned);var r,i,s=this.high>>>16,a=65535&this.high,o=this.low>>>16,c=65535&this.low,h=e.high>>>16,f=65535&e.high,p=e.low>>>16,g=65535&e.low,_=0,b=0;return r=0+((i=0+c*g)>>>16),i&=65535,r+=o*g,b+=r>>>16,r&=65535,r+=c*p,b+=r>>>16,r&=65535,b+=a*g,_+=b>>>16,b&=65535,b+=o*p,_+=b>>>16,b&=65535,b+=c*f,_+=b>>>16,b&=65535,_+=s*g+a*p+o*f+c*h,u(r<<16|i,(_&=65535)<<16|b,this.unsigned)},E.mul=E.multiply,E.divide=function(e){if(n(e)||(e=d(e)),e.isZero())throw Error("division by zero");if(t){var r,i,s;return this.unsigned||-0x80000000!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return b;s=v}else{if(this.eq(T))if(e.eq(_)||e.eq(S))return T;else return e.eq(T)?_:(r=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?_:S:(i=this.sub(e.mul(r)),s=r.add(i.div(e)));if(e.eq(T))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(r=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),o=a<=48?1:c(2,a-48),h=l(r),f=h.mul(e);f.isNegative()||f.gt(i);)r-=o,f=(h=l(r,this.unsigned)).mul(e);h.isZero()&&(h=_),s=s.add(h),i=i.sub(f)}return s},E.div=E.divide,E.modulo=function(e){return(n(e)||(e=d(e)),t)?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},E.mod=E.modulo,E.rem=E.modulo,E.not=function(){return u(~this.low,~this.high,this.unsigned)},E.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},E.clz=E.countLeadingZeros,E.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},E.ctz=E.countTrailingZeros,E.and=function(e){return n(e)||(e=d(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},E.or=function(e){return n(e)||(e=d(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},E.xor=function(e){return n(e)||(e=d(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},E.shiftLeft=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},E.shl=E.shiftLeft,E.shiftRight=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},E.shr=E.shiftRight,E.shiftRightUnsigned=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?u(this.high,0,this.unsigned):u(this.high>>>e-32,0,this.unsigned)},E.shru=E.shiftRightUnsigned,E.shr_u=E.shiftRightUnsigned,E.rotateLeft=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,u(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},E.rotl=E.rotateLeft,E.rotateRight=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,u(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},E.rotr=E.rotateRight,E.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},E.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},E.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},E.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},E.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},"function"==typeof BigInt&&(r.fromBigInt=function(e,t){return u(Number(BigInt.asIntN(32,e)),Number(BigInt.asIntN(32,e>>BigInt(32))),t)},r.fromValue=function(e,t){return"bigint"==typeof e?r.fromBigInt(e,t):d(e,t)},E.toBigInt=function(){var e=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|e}),e.default=r})},32521,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.loadFileDescriptorSetFromObject=r.loadFileDescriptorSetFromBuffer=r.fromJSON=r.loadSync=r.load=r.IdempotencyLevel=r.isAnyExtension=r.Long=void 0;let i=e.r(43234),s=e.r(8401),a=e.r(16348),o=e.r(48605);r.Long=e.r(41262),r.isAnyExtension=function(e){return"@type"in e&&"string"==typeof e["@type"]},function(e){e.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",e.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",e.IDEMPOTENT="IDEMPOTENT"}(n=r.IdempotencyLevel||(r.IdempotencyLevel={}));let l={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function u(e,t){return""===e?t:e+"."+t}function c(e){return e instanceof s.Service||e instanceof s.Type||e instanceof s.Enum}function h(e){return e instanceof s.Namespace||e instanceof s.Root}function d(e,t){let r=u(t,e.name);return c(e)?[[r,e]]:h(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>d(e.nested[t],r)).reduce((e,t)=>e.concat(t),[]):[]}function f(e,t){return function(r){return e.toObject(e.decode(r),t)}}function p(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let r=e.fromObject(t);return e.encode(r).finish()}}function g(e){return(e||[]).reduce((e,t)=>{for(let[r,n]of Object.entries(t))"uninterpreted_option"===r?e.uninterpreted_option.push(t.uninterpreted_option):e[r]=n;return e},{deprecated:!1,idempotency_level:n.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function m(e,t,r,n){let s=e.resolvedRequestType,a=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:p(s),requestDeserialize:f(s,r),responseSerialize:p(a),responseDeserialize:f(a,r),originalName:i(e.name),requestType:v(s,n),responseType:v(a,n),options:g(e.parsedOptions)}}function y(e,t,r,n){let i={};for(let s of e.methodsArray)i[s.name]=m(s,t,r,n);return i}function v(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:r.$type.toObject(r,l),fileDescriptorProtos:t}}function _(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:r.$type.toObject(r,l),fileDescriptorProtos:t}}function b(e,t,r,n){if(e instanceof s.Service)return y(e,t,r,n);if(e instanceof s.Type)return v(e,n);if(e instanceof s.Enum)return _(e,n);throw Error("Type mismatch in reflection object handling")}function S(e,t){let r={};e.resolveAll();let n=e.toDescriptor("proto3").file.map(e=>Buffer.from(a.FileDescriptorProto.encode(e).finish()));for(let[i,s]of d(e,""))r[i]=b(s,i,t,n);return r}function C(e,t){t=t||{};let r=s.Root.fromDescriptor(e);return r.resolveAll(),S(r,t)}r.load=function(e,t){return(0,o.loadProtosWithOptions)(e,t).then(e=>S(e,t))},r.loadSync=function(e,t){return S((0,o.loadProtosWithOptionsSync)(e,t),t)},r.fromJSON=function(e,t){t=t||{};let r=s.Root.fromJSON(e);return r.resolveAll(),S(r,t)},r.loadFileDescriptorSetFromBuffer=function(e,t){return C(a.FileDescriptorSet.decode(e),t)},r.loadFileDescriptorSetFromObject=function(e,t){return C(a.FileDescriptorSet.fromObject(e),t)},(0,o.addCommonProtos)()},2605,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.getChannelzServiceDefinition=r.getChannelzHandlers=r.unregisterChannelzRef=r.registerChannelzSocket=r.registerChannelzServer=r.registerChannelzSubchannel=r.registerChannelzChannel=r.ChannelzCallTracker=r.ChannelzChildrenTracker=r.ChannelzTrace=void 0;let n=e.r(4446),i=e.r(51195),s=e.r(89220),a=e.r(21800),o=e.r(61295),l=e.r(78320);function u(e){return{channel_id:e.id,name:e.name}}function c(e){return{subchannel_id:e.id,name:e.name}}function h(e){return{server_id:e.id}}function d(e){return{socket_id:e.id,name:e.name}}let f=32;class p{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let n=new Date;this.events.push({description:t,severity:e,timestamp:n,childChannel:(null==r?void 0:r.kind)==="channel"?r:void 0,childSubchannel:(null==r?void 0:r.kind)==="subchannel"?r:void 0}),this.events.length>=2*f&&(this.events=this.events.slice(f)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:I(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:I(e.timestamp),channel_ref:e.childChannel?u(e.childChannel):null,subchannel_ref:e.childSubchannel?c(e.childSubchannel):null}))}}}r.ChannelzTrace=p;class g{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,n;switch(e.kind){case"channel":{let r=null!=(t=this.channelChildren.get(e.id))?t:{ref:e,count:0};r.count+=1,this.channelChildren.set(e.id,r);break}case"subchannel":{let t=null!=(r=this.subchannelChildren.get(e.id))?r:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{let t=null!=(n=this.socketChildren.get(e.id))?n:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){let e=[];for(let{ref:t}of this.channelChildren.values())e.push(t);let t=[];for(let{ref:e}of this.subchannelChildren.values())t.push(e);let r=[];for(let{ref:e}of this.socketChildren.values())r.push(e);return{channels:e,subchannels:t,sockets:r}}}r.ChannelzChildrenTracker=g;class m{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}r.ChannelzCallTracker=m;let y=1;function v(){return y++}let _=[],b=[],S=[],C=[];function w(e){let t=Number.parseInt(e,16);return[t/256|0,t%256]}function T(e){return""===e?[]:[].concat(...e.split(":").map(e=>w(e)))}function E(e){if((0,n.isIPv4)(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!(0,n.isIPv6)(e))return null;{let t,r,n=e.indexOf("::");-1===n?(t=e,r=""):(t=e.substring(0,n),r=e.substring(n+2));let i=Buffer.from(T(t)),s=Buffer.from(T(r)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}}function k(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function I(e){if(!e)return null;let t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function R(e){let t=e.getInfo();return{ref:u(e.ref),data:{target:t.target,state:k(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:I(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>u(e)),subchannel_ref:t.children.subchannels.map(e=>c(e))}}function x(e,t){let r=Number.parseInt(e.request.channel_id),n=_[r];void 0===n?t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+r}):t(null,{channel:R(n)})}function D(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_channel_id);for(;i<_.length;i++){let e=_[i];if(void 0!==e&&(n.push(R(e)),n.length>=r))break}t(null,{channel:n,end:i>=S.length})}function O(e){let t=e.getInfo();return{ref:h(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:I(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>d(e))}}function A(e,t){let r=Number.parseInt(e.request.server_id),n=S[r];void 0===n?t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r}):t(null,{server:O(n)})}function N(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_server_id);for(;i<S.length;i++){let e=S[i];if(void 0!==e&&(n.push(O(e)),n.length>=r))break}t(null,{server:n,end:i>=S.length})}function P(e,t){let r=Number.parseInt(e.request.subchannel_id),n=b[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+r});let i=n.getInfo();t(null,{subchannel:{ref:c(n.ref),data:{target:i.target,state:k(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:I(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>d(e))}})}function M(e){var t;return(0,a.isTcpSubchannelAddress)(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(t=E(e.host))?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function L(e,t){var r,n,i,a,o;let l=Number.parseInt(e.request.socket_id),u=C[l];if(void 0===u)return void t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});let c=u.getInfo(),h=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(r=c.security.cipherSuiteStandardName)?r:void 0,other_name:null!=(n=c.security.cipherSuiteOtherName)?n:void 0,local_certificate:null!=(i=c.security.localCertificate)?i:void 0,remote_certificate:null!=(a=c.security.remoteCertificate)?a:void 0}}:null;t(null,{socket:{ref:d(u.ref),local:c.localAddress?M(c.localAddress):null,remote:c.remoteAddress?M(c.remoteAddress):null,remote_name:null!=(o=c.remoteName)?o:void 0,security:h,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:I(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:I(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:I(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:I(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}}})}function F(e,t){let r=Number.parseInt(e.request.server_id),n=S[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});let i=Number.parseInt(e.request.start_socket_id),a=Number.parseInt(e.request.max_results),o=n.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],u=0;for(;u<o.length&&(!(o[u].id>=i)||(l.push(d(o[u])),!(l.length>=a)));u++);t(null,{socket_ref:l,end:u>=o.length})}function B(){return{GetChannel:x,GetTopChannels:D,GetServer:A,GetServers:N,GetSubchannel:P,GetSocket:L,GetServerSockets:F}}r.registerChannelzChannel=function(e,t,r){let n=v(),i={id:n,name:e,kind:"channel"};return r&&(_[n]={ref:i,getInfo:t}),i},r.registerChannelzSubchannel=function(e,t,r){let n=v(),i={id:n,name:e,kind:"subchannel"};return r&&(b[n]={ref:i,getInfo:t}),i},r.registerChannelzServer=function(e,t){let r=v(),n={id:r,kind:"server"};return t&&(S[r]={ref:n,getInfo:e}),n},r.registerChannelzSocket=function(e,t,r){let n=v(),i={id:n,name:e,kind:"socket"};return r&&(C[n]={ref:i,getInfo:t}),i},r.unregisterChannelzRef=function(e){switch(e.kind){case"channel":delete _[e.id];return;case"subchannel":delete b[e.id];return;case"server":delete S[e.id];return;case"socket":delete C[e.id];return}},r.getChannelzHandlers=B;let j=null;function q(){if(j)return j;let t=(0,e.r(32521).loadSync)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:["/ROOT/Desktop/gps-tracker/node_modules/@grpc/grpc-js/build/src/../../proto"]});return j=(0,l.loadPackageDefinition)(t).grpc.channelz.v1.Channelz.service}r.getChannelzServiceDefinition=q,r.setup=function(){(0,o.registerAdminService)(q,B)}},58121,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Subchannel=void 0;let n=e.r(51195),i=e.r(44943),s=e.r(95763),a=e.r(89220),o=e.r(1602),l=e.r(21800),u=e.r(2605),c="subchannel",h=0x7fffffff;class d{constructor(e,t,r,s,a){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=s,this.connector=a,this.connectivityState=n.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new u.ChannelzCallTracker,this.childrenTracker=new u.ChannelzChildrenTracker,this.streamTracker=new u.ChannelzCallTracker;const c={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.handleBackoffTimer()},c),this.backoffTimeout.unref(),this.subchannelAddressString=(0,l.subchannelAddressToString)(t),this.keepaliveTime=null!=(o=r["grpc.keepalive_time_ms"])?o:-1,0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new u.ChannelzTrace,this.channelzRef=(0,u.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){s.trace(a.LogVerbosity.DEBUG,c,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){s.trace(a.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING):this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,h);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.READY)?(this.transport=e,this.channelzEnabled&&this.childrenTracker.refChild(e.getChannelzRef()),e.addDisconnectListener(e=>{this.transitionToState([n.ConnectivityState.READY],n.ConnectivityState.IDLE),e&&this.keepaliveTime>0&&(this.keepaliveTime*=2,s.log(a.LogVerbosity.ERROR,`Connection to ${(0,o.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):e.shutdown()},e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.TRANSIENT_FAILURE,`${e}`)})}transitionToState(e,t,r){var i,s;if(-1===e.indexOf(this.connectivityState))return!1;this.trace(n.ConnectivityState[this.connectivityState]+" -> "+n.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+n.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case n.ConnectivityState.READY:this.stopBackoff();break;case n.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case n.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(i=this.transport)||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case n.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(s=this.transport)||s.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let e of this.stateListeners)e(this,a,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,u.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([n.ConnectivityState.CONNECTING,n.ConnectivityState.READY],n.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(e,t,r,n){let i;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),i={onCallEnd:e=>{e.code===a.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):i={},this.transport.createCall(e,t,r,n,i)}startConnecting(){process.nextTick(()=>{this.transitionToState([n.ConnectivityState.IDLE],n.ConnectivityState.CONNECTING)||this.connectivityState!==n.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}}r.Subchannel=d},91786,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.DEFAULT_PORT=void 0;let n=e.r(17927),i=e.r(79594),s=e.r(24361),a=e.r(14177),o=e.r(89220),l=e.r(63878),u=e.r(95763),c=e.r(89220),h=e.r(1602),d=e.r(4446),f=e.r(44943),p="dns_resolver";function g(e){u.trace(c.LogVerbosity.DEBUG,p,e)}r.DEFAULT_PORT=443;let m=3e4,y=s.promisify(i.resolveTxt),v=s.promisify(i.lookup);function _(...e){let t=[];for(let r=0;r<Math.max.apply(null,e.map(e=>e.length));r++)for(let n of e)r<n.length&&t.push(n[r]);return t}class b{constructor(e,t,n){var i,s,a;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,g("Resolver constructed for target "+(0,h.uriToString)(e));const u=(0,h.splitHostPort)(e.path);null===u?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,d.isIPv4)(u.host)||(0,d.isIPv6)(u.host)?(this.ipResult=[{host:u.host,port:null!=(i=u.port)?i:r.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=u.host,this.port=null!=(s=u.port)?s:r.DEFAULT_PORT),this.percentage=100*Math.random(),1===n["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:o.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata};const c={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoff=new f.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},c),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(a=n["grpc.dns_min_time_between_resolutions_ms"])?a:m,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(g("Returning IP address for target "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)g("Failed to parse DNS address "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:o.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;g("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=v(e,{all:!0}),this.pendingLookupPromise.then(e=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let t=e.filter(e=>4===e.family),r=e.filter(e=>6===e.family);this.latestLookupResult=_(r,t).map(e=>({host:e.address,port:+this.port}));let n="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";(g("Resolved addresses for target "+(0,h.uriToString)(this.target)+": "+n),0===this.latestLookupResult.length)?this.listener.onError(this.defaultResolutionError):this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{null!==this.pendingLookupPromise&&(g("Resolution error for target "+(0,h.uriToString)(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=y(e),this.pendingTxtPromise.then(e=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,a.extractAndSelectServiceConfig)(e,this.percentage)}catch(e){this.latestServiceConfigError={code:o.Status.UNAVAILABLE,details:`Parsing service config failed with error ${e.message}`,metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},e=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?g('resolution update delayed by "min time between resolutions" rate limit'):g("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}}r.setup=function(){(0,n.registerResolver)("dns",b),(0,n.registerDefaultScheme)("dns")}},59522,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getProxiedConnection=r.mapProxyName=void 0;let n=e.r(95763),i=e.r(89220),s=e.r(17927),a=e.r(21517),o=e.r(55004),l=e.r(95763),u=e.r(21800),c=e.r(1602),h=e.r(92509),d=e.r(91786),f="proxy";function p(e){l.trace(i.LogVerbosity.DEBUG,f,e)}function g(){let e,t="",r="";if(process.env.grpc_proxy)r="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)r="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};r="http_proxy",t=process.env.http_proxy}try{e=new h.URL(t)}catch(e){return(0,n.log)(i.LogVerbosity.ERROR,`cannot parse value of "${r}" env var`),{}}if("http:"!==e.protocol)return(0,n.log)(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?((0,n.log)(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let a=e.hostname,o=e.port;""===o&&(o="80");let l={address:`${a}:${o}`};return s&&(l.creds=s),p("Proxy server "+l.address+" set by environment variable "+r),l}function m(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(p("No proxy server list set by environment variable "+t),e.split(",")):[]}r.mapProxyName=function(e,t){var r;let n={target:e,extraOptions:{}};if((null!=(r=t["grpc.enable_http_proxy"])?r:1)===0||"unix"===e.scheme)return n;let i=g();if(!i.address)return n;let s=(0,c.splitHostPort)(e.path);if(!s)return n;let a=s.host;for(let t of m())if(t===a)return p("Not using proxy for target in no_proxy list: "+(0,c.uriToString)(e)),n;let o={"grpc.http_connect_target":(0,c.uriToString)(e)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}},r.getProxiedConnection=function(e,t,r){var l;if(!("grpc.http_connect_target"in t))return Promise.resolve({});let h=t["grpc.http_connect_target"],f=(0,c.parseUri)(h);if(null===f)return Promise.resolve({});let g=(0,c.splitHostPort)(f.path);if(null===g)return Promise.resolve({});let m=`${g.host}:${null!=(l=g.port)?l:d.DEFAULT_PORT}`,y={method:"CONNECT",path:m},v={Host:m};(0,u.isTcpSubchannelAddress)(e)?(y.host=e.host,y.port=e.port):y.socketPath=e.path,"grpc.http_connect_creds"in t&&(v["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),y.headers=v;let _=(0,u.subchannelAddressToString)(e);return p("Using proxy "+_+" to connect to "+y.path),new Promise((e,t)=>{let l=a.request(y);l.once("connect",(a,u,h)=>{var d;if(l.removeAllListeners(),u.removeAllListeners(),200===a.statusCode)if(p("Successfully connected to "+y.path+" through proxy "+_),"secureContext"in r){let n=(0,s.getDefaultAuthority)(f),i=(0,c.splitHostPort)(n),a=null!=(d=null==i?void 0:i.host)?d:n,l=o.connect(Object.assign({host:a,servername:a,socket:u},r),()=>{p("Successfully established a TLS connection to "+y.path+" through proxy "+_),e({socket:l,realTarget:f})});l.on("error",e=>{p("Failed to establish a TLS connection to "+y.path+" through proxy "+_+" with error "+e.message),t()})}else p("Successfully established a plaintext connection to "+y.path+" through proxy "+_),e({socket:u,realTarget:f});else(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to "+y.path+" through proxy "+_+" with status "+a.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to proxy "+_+" with error "+e.message),t()}),l.end()})}},63836,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(n||(n={}));class i{constructor(e){this.maxReadMessageLength=e,this.readState=n.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,r=0,i=[];for(;r<e.length;)switch(this.readState){case n.NO_DATA:this.readCompressFlag=e.slice(r,r+1),r+=1,this.readState=n.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case n.READING_SIZE:if(t=Math.min(e.length-r,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,r,r+t),this.readSizeRemaining-=t,r+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=n.READING_MESSAGE;else{let e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=n.NO_DATA,i.push(e)}}break;case n.READING_MESSAGE:if(t=Math.min(e.length-r,this.readMessageRemaining),this.readPartialMessage.push(e.slice(r,r+t)),this.readMessageRemaining-=t,r+=t,0===this.readMessageRemaining){let e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=n.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}r.StreamDecoder=i},78788,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2SubchannelCall=void 0;let n=e.r(25328),i=e.r(46786),s=e.r(89220),a=e.r(63878),o=e.r(63836),l=e.r(95763),u=e.r(89220),c="subchannel_call";function h(e){for(let[t,r]of Object.entries(i.constants.errno))if(r===e)return t;return"Unknown system error "+e}class d{constructor(e,t,r,i,l){var u;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=l,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;const c=null!=(u=i.getOptions()["grpc.max_receive_message_length"])?u:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new o.StreamDecoder(c),e.on("response",(e,t)=>{let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+r),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&n.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=a.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new a.Metadata});return}this.listener.onReceiveMetadata(t)}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{let t;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+e.length);try{t=this.decoder.write(e)}catch(e){this.cancelWithStatus(s.Status.RESOURCE_EXHAUSTED,e.message);return}for(let e of t)this.trace("parsed message of length "+e.length),this.callEventTracker.addMessageReceived(),this.tryPush(e)}}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var t;let r;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null==(t=this.finalStatus)?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case n.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case n.constants.NGHTTP2_REFUSED_STREAM:r=s.Status.UNAVAILABLE,i="Stream refused by server";break;case n.constants.NGHTTP2_CANCEL:r=s.Status.CANCELLED,i="Call cancelled";break;case n.constants.NGHTTP2_ENHANCE_YOUR_CALM:r=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case n.constants.NGHTTP2_INADEQUATE_SECURITY:r=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case n.constants.NGHTTP2_INTERNAL_ERROR:r=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(r=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:r,details:i,metadata:new a.Metadata,rstCode:e.rstCode})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+h(e.errno)+" syscall="+e.syscall),this.internalError=e),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new a.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){l.trace(u.LogVerbosity.DEBUG,c,"["+this.callId+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===s.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){let t;this.callEventTracker.onStreamEnd(!0);let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+r);try{t=a.Metadata.fromHttp2Headers(e)}catch(e){t=new a.Metadata}let n=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof n["grpc-status"]){let e=Number(n["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let o="";if("string"==typeof n["grpc-message"]){try{o=decodeURI(n["grpc-message"])}catch(e){o=n["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let l={code:i,details:o,metadata:t};this.endCall(l)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;t=(null==(e=this.finalStatus)?void 0:e.code)===s.Status.OK?n.constants.NGHTTP2_NO_ERROR:n.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new a.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=t=>{process.nextTick(()=>{var r;let n=s.Status.UNAVAILABLE;(null==t?void 0:t.code)==="ERR_STREAM_WRITE_AFTER_END"&&(n=s.Status.INTERNAL),t&&this.cancelWithStatus(n,`Write error: ${t.message}`),null==(r=e.callback)||r.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new a.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}r.Http2SubchannelCall=d},733,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getNextCallNumber=void 0;let n=0;r.getNextCallNumber=function(){return n++}},19891,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2SubchannelConnector=void 0;let n=e.r(25328),i=e.r(55004),s=e.r(2605),a=e.r(89220),o=e.r(59522),l=e.r(95763),u=e.r(17927),c=e.r(21800),h=e.r(1602),d=e.r(4446),f=e.r(78788),p=e.r(733),g="transport",m="transport_flowctrl",y=e.r(6235).version,{HTTP2_HEADER_AUTHORITY:v,HTTP2_HEADER_CONTENT_TYPE:_,HTTP2_HEADER_METHOD:b,HTTP2_HEADER_PATH:S,HTTP2_HEADER_TE:C,HTTP2_HEADER_USER_AGENT:w}=n.constants,T=2e4,E=Buffer.from("too_many_pings","ascii");class k{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=T,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new s.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,c.subchannelAddressToString)(t),0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,s.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${y}`,r["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=1===r["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(e,t,r)=>{let i=!1;e===n.constants.NGHTTP2_ENHANCE_YOUR_CALM&&r&&r.equals(E)&&(i=!0),this.trace("connection closed by GOAWAY with code "+e+" and data "+(null==r?void 0:r.toString())),this.reportDisconnectToOwner(i)}),e.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(g)&&(e.on("remoteSettings",t=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))}),e.on("localSettings",t=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let n,i=this.session.socket,s=i.remoteAddress?(0,c.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,c.stringToSubchannelAddress)(i.localAddress,i.localPort):null;if(this.session.encrypted){let t=i,r=t.getCipher(),s=t.getCertificate(),a=t.getPeerCertificate();n={cipherSuiteStandardName:null!=(e=r.standardName)?e:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:a&&"raw"in a?a.raw:null}}else n=null;return{remoteAddress:s,localAddress:a,security:n,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(t=this.session.state.localWindowSize)?t:null,remoteFlowControlWindow:null!=(r=this.session.state.remoteWindowSize)?r:null}}trace(e){l.trace(a.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(a.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(a.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(a.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(t=(e=this.keepaliveTimeoutId).unref)||t.call(e));try{this.session.ping((e,t,r)=>{e&&(this.keepaliveTrace("Ping failed with error "+e.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(e){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),0===this.activeCalls.size&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,n,i){let s,a,o,l=e.toHttp2Headers();l[v]=t,l[w]=this.userAgent,l[_]="application/grpc",l[b]="POST",l[S]=r,l[C]="trailers";try{s=this.session.request(l)}catch(e){throw this.handleDisconnect(),e}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),a={addMessageSent:()=>{var e;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(t=i.onStreamEnd)||t.call(i,e)}}):a={addMessageSent:()=>{var e;null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;null==(t=i.onStreamEnd)||t.call(i,e)}},o=new f.Http2SubchannelCall(s,a,n,this,(0,p.getNextCallNumber)()),this.addActiveCall(o),o}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,s.unregisterChannelzRef)(this.channelzRef)}}class I{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){l.trace(a.LogVerbosity.DEBUG,g,(0,h.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,s){return this.isShutdown?Promise.reject():new Promise((a,o)=>{var l,f,p;let g;s.realTarget?(g=(0,h.uriToString)(s.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,h.uriToString)(s.realTarget))):(g=null,this.trace("creating HTTP/2 session to "+(0,c.subchannelAddressToString)(e)));let m=(0,u.getDefaultAuthority)(null!=(l=s.realTarget)?l:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?y.maxSessionMemory=r["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in y){if(v="https://",r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];y.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),y.servername=e}else{let e=null!=(p=null==(f=(0,h.splitHostPort)(m))?void 0:f.host)?p:"localhost";y.servername=e}s.socket&&(y.createConnection=(e,t)=>s.socket)}else y.createConnection=(t,r)=>s.socket?s.socket:d.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:1===r["grpc-node.tls_enable_trace"]});let _=n.connect(v+m,y);this.session=_;let b="Failed to connect";_.unref(),_.once("connect",()=>{_.removeAllListeners(),a(new k(_,e,r,g)),this.session=null}),_.once("close",()=>{this.session=null,setImmediate(()=>{o(`${b} (${new Date().toISOString()})`)})}),_.once("error",e=>{b=e.message,this.trace("connection failed with error "+b)})})}connect(e,t,r){var n,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];a.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),a.servername=e}else if("grpc.http_connect_target"in r){let e=(0,u.getDefaultAuthority)(null!=(n=(0,h.parseUri)(r["grpc.http_connect_target"]))?n:{path:"localhost"}),t=(0,h.splitHostPort)(e);a.servername=null!=(s=null==t?void 0:t.host)?s:e}r["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,o.getProxiedConnection)(e,r,a).then(n=>this.createSession(e,t,r,n))}shutdown(){var e;this.isShutdown=!0,null==(e=this.session)||e.close(),this.session=null}}r.Http2SubchannelConnector=I},35037,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getSubchannelPool=r.SubchannelPool=void 0;let n=e.r(21255),i=e.r(58121),s=e.r(21800),a=e.r(1602),o=e.r(19891),l=1e4;class u{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let r=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},l),null==(t=(e=this.cleanupTimer).unref)||t.call(e))}getOrCreateSubchannel(e,t,r,l){this.ensureCleanupTask();let u=(0,a.uriToString)(e);if(u in this.pool){for(let e of this.pool[u])if((0,s.subchannelAddressEqual)(t,e.subchannelAddress)&&(0,n.channelOptionsEqual)(r,e.channelArguments)&&l._equals(e.channelCredentials))return e.subchannel}let c=new i.Subchannel(e,t,r,l,new o.Http2SubchannelConnector(e));return u in this.pool||(this.pool[u]=[]),this.pool[u].push({subchannelAddress:t,channelArguments:r,channelCredentials:l,subchannel:c}),c.ref(),c}}r.SubchannelPool=u;let c=new u;r.getSubchannelPool=function(e){return e?c:new u}},79376,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FilterStackFactory=r.FilterStack=void 0;class n{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}r.FilterStack=n;class i{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new i([...this.factories])}createFilter(){return new n(this.factories.map(e=>e.createFilter()))}}r.FilterStackFactory=i},56874,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(n||(r.CompressionAlgorithms=n={}))},50948,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BaseFilter=void 0;class n{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}}r.BaseFilter=n},75564,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CompressionFilterFactory=r.CompressionFilter=void 0;let n=e.r(6461),i=e.r(56874),s=e.r(89220),a=e.r(50948),o=e.r(95763),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class u{async writeMessage(e,t){let r=e;t&&(r=await this.compressMessage(r));let n=Buffer.allocUnsafe(r.length+5);return n.writeUInt8(+!!t,0),n.writeUInt32BE(r.length,1),r.copy(n,5),n}async readMessage(e){let t=1===e.readUInt8(0),r=e.slice(5);return t&&(r=await this.decompressMessage(r)),r}}class c extends u{async compressMessage(e){return e}async writeMessage(e,t){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class h extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.deflate(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createInflate();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class d extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.gzip(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createGunzip();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class f extends u{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function p(e,t){switch(e){case"identity":return new c;case"deflate":return new h(t);case"gzip":return new d(t);default:return new f(e)}}class g extends a.BaseFilter{constructor(e,t){var r,n;super(),this.sharedFilterConfig=t,this.sendCompression=new c,this.receiveCompression=new c,this.currentCompressionAlgorithm="identity";const a=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(r=e["grpc.max_receive_message_length"])?r:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==a)if(l(a)){const e=i.CompressionAlgorithms[a],r=null==(n=t.serverSupportedEncodingHeader)?void 0:n.split(",");(!r||r.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=p(this.currentCompressionAlgorithm,-1))}else o.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${a}`)}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let e=t[0];"string"==typeof e&&(this.receiveCompression=p(e,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new c,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let r,n=await e;return r=!(this.sendCompression instanceof c)&&((null!=(t=n.flags)?t:0)&2)==0,{message:await this.sendCompression.writeMessage(n.message,r),flags:n.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}r.CompressionFilter=g;class m{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new g(this.options,this.sharedFilterConfig)}}r.CompressionFilterFactory=m},23236,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deadlineToString=r.getRelativeTimeout=r.getDeadlineTimeoutString=r.minDeadline=void 0,r.minDeadline=function(...e){let t=1/0;for(let r of e){let e=r instanceof Date?r.getTime():r;e<t&&(t=e)}return t};let n=[["m",1],["S",1e3],["M",6e4],["H",36e5]];r.getDeadlineTimeoutString=function(e){let t=new Date().getTime();e instanceof Date&&(e=e.getTime());let r=Math.max(e-t,0);for(let[e,t]of n){let n=r/t;if(n<1e8)return String(Math.ceil(n))+e}throw Error("Deadline is too far in the future")};let i=0x7fffffff;r.getRelativeTimeout=function(e){let t=(e instanceof Date?e.getTime():e)-new Date().getTime();return t<0?0:t>i?1/0:t},r.deadlineToString=function(e){if(e instanceof Date)return e.toISOString();{let t=new Date(e);return Number.isNaN(t.getTime())?""+e:t.toISOString()}}},72621,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.restrictControlPlaneStatusCode=void 0;let n=e.r(89220),i=[n.Status.OK,n.Status.INVALID_ARGUMENT,n.Status.NOT_FOUND,n.Status.ALREADY_EXISTS,n.Status.FAILED_PRECONDITION,n.Status.ABORTED,n.Status.OUT_OF_RANGE,n.Status.DATA_LOSS];r.restrictControlPlaneStatusCode=function(e,t){return i.includes(e)?{code:n.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${n.Status[e]} ${t}`}:{code:e,details:t}}},46334,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoadBalancingCall=void 0;let n=e.r(51195),i=e.r(89220),s=e.r(23236),a=e.r(63878),o=e.r(36891),l=e.r(1602),u=e.r(95763),c=e.r(72621),h=e.r(25328),d="load_balancing_call";class f{constructor(e,t,r,n,i,s,a){var o,u;this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;const c=this.methodName.split("/");let h="";c.length>=2&&(h=c[1]);const d=null!=(u=null==(o=(0,l.splitHostPort)(this.host))?void 0:o.host)?u:"localhost";this.serviceUrl=`https://${d}/${h}`}trace(e){u.trace(i.LogVerbosity.DEBUG,d,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,n;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let i=Object.assign(Object.assign({},e),{progress:t});null==(r=this.listener)||r.onReceiveStatus(i),null==(n=this.onCallEnded)||n.call(this,i.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),l=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+o.PickResultType[r.pickResultType]+" subchannel: "+l+" status: "+(null==(e=r.status)?void 0:e.code)+" "+(null==(t=r.status)?void 0:t.details)),r.pickResultType){case o.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(e=>{var t,o,u;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let c=this.metadata.clone();if(c.merge(e),c.get("authorization").length>1&&this.outputStatus({code:i.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new a.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==n.ConnectivityState.READY){this.trace("Picked subchannel "+l+" has state "+n.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&c.set("grpc-timeout",(0,s.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(c,this.host,this.methodName,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(e)},onReceiveMessage:e=>{this.trace("Received message"),this.listener.onReceiveMessage(e)},onReceiveStatus:e=>{this.trace("Received status"),e.rstCode===h.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(e,"REFUSED"):this.outputStatus(e,"PROCESSED")}})}catch(e){this.trace("Failed to start call on picked subchannel "+l+" with error "+e.message),this.outputStatus({code:i.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+e.message,metadata:new a.Metadata},"NOT_STARTED");return}null==(o=(t=this.callConfig).onCommitted)||o.call(t),null==(u=r.onCallStarted)||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},e=>{let{code:t,details:r}=(0,c.restrictControlPlaneStatusCode)("number"==typeof e.code?e.code:i.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${e.message}`);this.outputStatus({code:t,details:r,metadata:new a.Metadata},"PROCESSED")});break;case o.PickResultType.DROP:let{code:u,details:d}=(0,c.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:u,details:d,metadata:r.status.metadata},"DROP")});break;case o.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:e,details:t}=(0,c.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:e,details:t,metadata:r.status.metadata},"PROCESSED")})}break;case o.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(r=this.child)||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new a.Metadata},"PROCESSED")}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}r.LoadBalancingCall=f},48635,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ResolvingCall=void 0;let n=e.r(89220),i=e.r(23236),s=e.r(63878),a=e.r(95763),o=e.r(72621),l="resolving_call";class u{constructor(e,t,r,s,a,o){this.channel=e,this.method=t,this.filterStackFactory=s,this.credentials=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&n.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(n.Status.CANCELLED,"Cancelled by parent call")}),r.flags&n.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,i.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){a.trace(n.LogVerbosity.DEBUG,l,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,i.deadlineToString)(this.deadline));let e=(0,i.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(n.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{var e;null==(e=this.listener)||e.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(t=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,t.message),this.pendingHalfClose&&r.halfClose()},e=>{this.cancelWithStatus(e.code,e.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if("NONE"===e.type)return void this.channel.queueCallForConfig(this);if("ERROR"===e.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error));let t=e.config;if(t.status!==n.Status.OK){let{code:e,details:r}=(0,o.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:e,details:r,metadata:new s.Metadata});return}if(t.methodConfig.timeout){let e=new Date;e.setSeconds(e.getSeconds()+t.methodConfig.timeout.seconds),e.setMilliseconds(e.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,i.minDeadline)(this.deadline,e),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(e=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(e,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(e))},onReceiveMessage:e=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(e).then(e=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(e),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},e=>{this.cancelWithStatus(e.code,e.details)})},onReceiveStatus:e=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=e:this.outputStatus(e)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},e=>{this.outputStatus(e)})}reportResolverError(e){var t;(null==(t=this.metadata)?void 0:t.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(r=this.child)||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new s.Metadata})}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}}r.ResolvingCall=u},30155,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RetryingCall=r.MessageBufferTracker=r.RetryThrottler=void 0;let n=e.r(89220),i=e.r(63878),s=e.r(95763),a="retrying_call";class o{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}r.RetryThrottler=o;class l{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let n=null!=(r=this.allocatedPerCall.get(t))?r:0;return!(this.limitPerCall-n<e)&&!(this.totalLimit-this.totalAllocated<e)&&(this.allocatedPerCall.set(t,n+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let n=null!=(r=this.allocatedPerCall.get(t))?r:0;if(n<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${n}`);this.allocatedPerCall.set(t,n-e)}freeAll(e){var t;let r=null!=(t=this.allocatedPerCall.get(e))?t:0;if(this.totalAllocated<r)throw Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}}r.MessageBufferTracker=l;let u="grpc-previous-rpc-attempts";class c{constructor(e,t,r,n,i,s,a,o,l){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.bufferTracker=o,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";const e=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(e.initialBackoff.substring(0,e.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){s.trace(n.LogVerbosity.DEBUG,a,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;null==(t=this.listener)||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){for(let{call:r}of(this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new i.Metadata}),this.underlyingCalls))r.cancelWithStatus(e,t)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return null!=(t=this.writeBuffer[e-this.writeBufferOffset])?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let e=this.getBufferEntry(t);e.allocated&&this.bufferTracker.free(e.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[e].state){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&"COMPLETED"!==this.underlyingCalls[t].state&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(n.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let e=-1,t=-1;for(let[r,n]of this.underlyingCalls.entries())"ACTIVE"===n.state&&n.nextMessageToSend>e&&(e=n.nextMessageToSend,t=r);-1===t?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(e=>e===t||e.toString().toLowerCase()===n.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=null==(e=this.callConfig)?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,n=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,n),r}maybeRetryCall(e,t){let r;if("RETRY"!==this.state)return void t(!1);let n=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return void t(!1);if(null===e)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var e,r;"RETRY"!==this.state?t(!1):(null==(r=null==(e=this.retryThrottler)?void 0:e.canRetryCall())||r)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)(null==t?void 0:t.state)==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var n,i,s;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList(null!=(n=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?n:[],e.code)){let n;if(null==(i=this.retryThrottler)||i.addCallFailed(),null===r)n=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else n=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(t),this.reportStatus(e))},n)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?(null==(s=this.retryThrottler)||s.addCallFailed(),this.maybeRetryCall(r,r=>{r||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e))}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(0===t.length)return null;try{return parseInt(t[0])}catch(e){return -1}}handleChildStatus(e,t){var r;if("COMPLETED"===this.underlyingCalls[t].state)return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===n.Status.OK){null==(r=this.retryThrottler)||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if("COMMITTED"===this.state)return void this.reportStatus(e);let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let n=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return;let i=null!=(e=n.hedgingDelay)?e:"0s",s=Number(i.substring(0,i.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*s),null==(r=(t=this.hedgingTimer).unref)||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,n=this.initialMetadata.clone();r>0&&n.set(u,`${r}`);let i=!1;e.start(n,{onReceiveMetadata:n=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),i=!0,r>0&&n.set(u,`${r}`),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMetadata(n)},onReceiveMessage:r=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMessage(r)},onReceiveStatus:n=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!i&&r>0&&n.metadata.set(u,`${r}`),this.handleChildStatus(n,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let n=this.underlyingCalls[e],i=n.nextMessageToSend;null==(r=(t=this.getBufferEntry(i)).callback)||r.call(t),this.clearSentMessages(),n.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if("COMPLETED"!==t.state&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:t=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose()}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let n={message:t,flags:e.flags},i=this.getNextBufferIndex(),s={entryType:"MESSAGE",message:n,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(s),s.allocated)for(let[n,s]of(null==(r=e.callback)||r.call(e),this.underlyingCalls.entries()))"ACTIVE"===s.state&&s.nextMessageToSend===i&&s.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(n)}},t);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let r=this.underlyingCalls[this.committedCallIndex];s.callback=e.callback,"ACTIVE"===r.state&&r.nextMessageToSend===i&&r.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){for(let e of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==e?void 0:e.state)==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();for(let t of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==t?void 0:t.state)==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}r.RetryingCall=c},15851,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BaseSubchannelWrapper=void 0;class n{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}}r.BaseSubchannelWrapper=n},82788,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InternalChannel=void 0;let n=e.r(9553),i=e.r(68631),s=e.r(35037),a=e.r(36891),o=e.r(89220),l=e.r(79376),u=e.r(75564),c=e.r(17927),h=e.r(95763),d=e.r(59522),f=e.r(1602),p=e.r(51195),g=e.r(2605),m=e.r(46334),y=e.r(23236),v=e.r(48635),_=e.r(733),b=e.r(72621),S=e.r(30155),C=e.r(15851),w=0x7fffffff,T=1e3,E=18e5,k=new Map,I=0x1000000,R=1048576;class x extends C.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(e,r,n,i)=>{t.throttleKeepalive(i)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class D{constructor(e,t,r){var m,y,v,_,C,D,O,A;if(this.credentials=t,this.options=r,this.connectivityState=p.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new g.ChannelzCallTracker,this.childrenTracker=new g.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.originalTarget=e;const N=(0,f.parseUri)(e);if(null===N)throw Error(`Could not parse target name "${e}"`);const P=(0,c.mapUriDefaultScheme)(N);if(null===P)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},w),null==(y=(m=this.callRefTimer).unref)||y.call(m),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new g.ChannelzTrace,this.channelzRef=(0,g.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,c.getDefaultAuthority)(P);const M=(0,d.mapProxyName)(P,r);this.target=M.target,this.options=Object.assign({},this.options,M.extraOptions),this.subchannelPool=(0,s.getSubchannelPool)((null!=(v=r["grpc.use_local_subchannel_pool"])?v:0)===0),this.retryBufferTracker=new S.MessageBufferTracker(null!=(_=r["grpc.retry_buffer_size"])?_:I,null!=(C=r["grpc.per_rpc_retry_buffer_size"])?C:R),this.keepaliveTime=null!=(D=r["grpc.keepalive_time_ms"])?D:-1,this.idleTimeoutMs=Math.max(null!=(O=r["grpc.client_idle_timeout_ms"])?O:E,T);const L={createSubchannel:(e,t)=>{let r=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);r.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",r.getChannelzRef());let n=new x(r,this);return this.wrappedSubchannels.add(n),n},updateState:(e,t)=>{this.currentPicker=t;let r=this.pickQueue.slice();for(let e of(this.pickQueue=[],r.length>0&&this.callRefTimerUnref(),r))e.doPick();this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new i.ResolvingLoadBalancer(this.target,L,r,(e,t)=>{e.retryThrottling?k.set(this.getTarget(),new S.RetryThrottler(e.retryThrottling.maxTokens,e.retryThrottling.tokenRatio,k.get(this.getTarget()))):k.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=t,this.currentResolutionError=null,process.nextTick(()=>{let e=this.configSelectionQueue;for(let t of(this.configSelectionQueue=[],e.length>0&&this.callRefTimerUnref(),e))t.getConfig()})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,b.restrictControlPlaneStatusCode)(e.code,e.details)),{metadata:e.metadata}));let t=this.configSelectionQueue;for(let r of(this.configSelectionQueue=[],t.length>0&&this.callRefTimerUnref(),t))r.reportResolverError(e)}),this.filterStackFactory=new l.FilterStackFactory([new u.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));const F=Error();(0,h.trace)(o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(A=F.stack)?void 0:A.substring(F.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,h.trace)(null!=t?t:o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,f.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,n;(null==(t=(e=this.callRefTimer).hasRef)?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(n=(r=this.callRefTimer).ref)||n.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(t=(e=this.callRefTimer).unref)||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(let t of((0,h.trace)(o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,f.uriToString)(this.target)+" "+p.ConnectivityState[this.connectivityState]+" -> "+p.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+p.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==p.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime)for(let t of(this.keepaliveTime=e,this.wrappedSubchannels))t.throttleKeepalive(e)}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(p.ConnectivityState.IDLE),this.currentPicker=new a.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let e=new Date().valueOf()-this.lastActivityTimestamp.valueOf();e>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-e)},e),null==(r=(t=this.idleTimer).unref)||r.call(t)}maybeStartIdleTimer(){this.connectivityState===p.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,n,i){let s=(0,_.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+s+'] method="'+t+'"'),new m.LoadBalancingCall(this,e,t,r,n,i,s)}createRetryingCall(e,t,r,n,i){let s=(0,_.getNextCallNumber)();return this.trace("createRetryingCall ["+s+'] method="'+t+'"'),new S.RetryingCall(this,e,t,r,n,i,s,this.retryBufferTracker,k.get(this.getTarget()))}createInnerCall(e,t,r,n,i){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(e,t,r,n,i):this.createRetryingCall(e,t,r,n,i)}createResolvingCall(e,t,r,n,i){let s=(0,_.getNextCallNumber)();this.trace("createResolvingCall ["+s+'] method="'+e+'", deadline='+(0,y.deadlineToString)(t));let a={deadline:t,flags:null!=i?i:o.Propagate.DEFAULTS,host:null!=r?r:this.defaultAuthority,parentCall:n},l=new v.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),s);return this.onCallStart(),l.addStatusWatcher(e=>{this.onCallEnd(e)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(p.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,g.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,f.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===p.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let n=null;if(t!==1/0){let e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s)return void process.nextTick(r,Error("Deadline passed without connectivity state change"));n=setTimeout(()=>{this.removeConnectivityStateWatcher(i),r(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}let i={currentState:e,callback:r,timer:n};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===p.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(e,t,r,n,i)}}r.InternalChannel=D},31394,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChannelImplementation=void 0;let n=e.r(9553),i=e.r(82788);class s{constructor(e,t,r){if("string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.internalChannel=new i.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,n,i)}}r.ChannelImplementation=s},6577,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2ServerCallStream=r.ServerDuplexStreamImpl=r.ServerWritableStreamImpl=r.ServerReadableStreamImpl=r.ServerUnaryCallImpl=void 0;let n=e.r(27699),i=e.r(25328),s=e.r(88947),a=e.r(6461),o=e.r(89220),l=e.r(63878),u=e.r(63836),c=e.r(95763),h=e.r(30810),d="server_call";function f(e){c.trace(o.LogVerbosity.DEBUG,d,e)}let p="grpc-message",g="grpc-status",m="grpc-timeout",y=/(\d{1,8})\s*([HMSmun])/,v={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},_={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},b={[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},S={waitForTrailers:!0};class C extends n.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}r.ServerUnaryCallImpl=C;class w extends s.Readable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,n)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}r.ServerReadableStreamImpl=w;class T extends s.Writable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let t=this.call.serializeMessage(e);if(!this.call.write(t))return void this.call.once("drain",r)}catch(e){this.emit("error",{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:o.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}r.ServerWritableStreamImpl=T;class E extends s.Duplex{constructor(e,t,r,n,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}r.ServerDuplexStreamImpl=E,E.prototype._read=w.prototype._read,E.prototype._write=T.prototype._write,E.prototype._final=T.prototype._final;class k extends n.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=o.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=o.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{var e;f("Request to method "+(null==(e=this.handler)?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:o.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if("identity"===t)return r;if("deflate"!==t&&"gzip"!==t)return Promise.reject({code:o.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`});{let e;return e="deflate"===t?a.createInflate():a.createGunzip(),new Promise((t,n)=>{let i=0,s=[];e.on("data",t=>{s.push(t),i+=t.byteLength,-1!==this.maxReceiveMessageSize&&i>this.maxReceiveMessageSize&&(e.destroy(),n({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),e.on("end",()=>{t(Buffer.concat(s))}),e.write(r),e.end()})}}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},b),_),t);this.stream.respond(r,S)}receiveMetadata(e){let t=l.Metadata.fromHttp2Headers(e);c.isTracerEnabled(d)&&f("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(m);if(r.length>0){let e=r[0].toString().match(y);if(null===e){let e=Error("Invalid deadline");return e.code=o.Status.OUT_OF_RANGE,this.sendError(e),t}let n=e[1]*v[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+n),this.deadlineTimer=setTimeout(I,n,this),t.remove(m)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:n}=this,i=0,s=this,a=[],l=this.maxReceiveMessageSize;function u(e){if(i+=e.byteLength,-1!==l&&i>l){n.removeListener("data",u),n.removeListener("end",c),n.removeListener("error",c),r({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${i} vs. ${l})`});return}a.push(e)}function c(l){if(n.removeListener("data",u),n.removeListener("end",c),n.removeListener("error",c),void 0!==l)return void r({code:o.Status.INTERNAL,details:l.message});if(0===i)return void r({code:o.Status.INTERNAL,details:"received empty unary message"});s.emit("receiveMessage");let h=Buffer.concat(a,i),d=1===h.readUInt8(0)?e:"identity",f=s.getDecompressedMessage(h,d);Buffer.isBuffer(f)?t(s.deserializeMessageWithInternalError(f)):f.then(e=>t(s.deserializeMessageWithInternalError(e)),t=>r(t.code?t:{code:o.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}this.stream.on("data",u),this.stream.on("end",c),this.stream.on("error",c)})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(e){throw{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL}}}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,n=Buffer.allocUnsafe(r+5);return n.writeUInt8(0,0),n.writeUInt32BE(r,1),t.copy(n,5),n}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,r,n){if(!this.checkCancelled()){if(void 0===r&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let e=this.serializeMessage(t);this.write(e),this.sendStatus({code:o.Status.OK,details:"OK",metadata:r})}catch(e){this.sendError({details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}}}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===o.Status.OK),!this.checkCancelled())if(f("Request to method "+(null==(t=this.handler)?void 0:t.path)+" ended with status code: "+o.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var t;let r=Object.assign({[g]:e.code,[p]:encodeURI(e.details)},null==(t=e.metadata)?void 0:t.toHttp2Headers());this.stream.sendTrailers(r),this.statusSent=!0}),this.stream.end());else{let t=Object.assign(Object.assign({[g]:e.code,[p]:encodeURI(e.details)},b),null==(r=e.metadata)?void 0:r.toHttp2Headers());this.stream.respond(t,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:o.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize?void this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e))}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new u.StreamDecoder(this.maxReceiveMessageSize),n=!1,i=!1,s=!1,a=async()=>{s||!n||i||(s=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async n=>{let s;try{s=r.write(n)}catch(e){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:e.message});return}for(let r of(i=!0,this.stream.pause(),s)){let n;this.emit("receiveMessage");let i=1===r.readUInt8(0)?t:"identity";try{n=await this.getDecompressedMessage(r,i)}catch(e){this.sendError(e);return}if(!n)return;await this.pushOrBufferMessage(e,n)}i=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{n=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(null===t||!1===r){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){f("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}f("Received message of length "+t.length),this.isPushPending=!0;try{let r=await this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let t=(0,h.getErrorCode)(r);(null===t||t<o.Status.OK||t>o.Status.UNAUTHENTICATED)&&(t=o.Status.INTERNAL),e.emit("error",{details:(0,h.getErrorMessage)(r),code:t})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){var e;let t=null==(e=this.stream.session)?void 0:e.socket;return null!=t&&t.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function I(e){let t=Error("Deadline exceeded");t.code=o.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}r.Http2ServerCallStream=k},75546,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ServerCredentials=void 0;let n=e.r(26406);class i{static createInsecure(){return new s}static createSsl(e,t,r=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof r)throw TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let e=0;e<t.length;e++){let r=t[e];if(null===r||"object"!=typeof r)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(r.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(r.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(r.cert_chain),s.push(r.private_key)}return new a({ca:e||(0,n.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:n.CIPHER_SUITES})}}r.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class a extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},40305,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Server=void 0;let n=e.r(25328),i=e.r(89220),s=e.r(6577),a=e.r(75546),o=e.r(17927),l=e.r(95763),u=e.r(21800),c=e.r(1602),h=e.r(2605),d=0x7fffffff,f=0x7fffffff,p=2e4,{HTTP2_HEADER_PATH:g}=n.constants,m="server";function y(){}function v(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function _(e,t){let r=v(t);switch(e){case"unary":return(e,t)=>{t(r,null)};case"clientStream":return(e,t)=>{t(r,null)};case"serverStream":return e=>{e.emit("error",r)};case"bidi":return e=>{e.emit("error",r)};default:throw Error(`Invalid handlerType ${e}`)}}class b{constructor(e){var t,r,n,i;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new h.ChannelzTrace,this.callTracker=new h.ChannelzCallTracker,this.listenerChildrenTracker=new h.ChannelzChildrenTracker,this.sessionChildrenTracker=new h.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,h.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(t=this.options["grpc.max_connection_age_ms"])?t:d,this.maxConnectionAgeGraceMs=null!=(r=this.options["grpc.max_connection_age_grace_ms"])?r:d,this.keepaliveTimeMs=null!=(n=this.options["grpc.keepalive_time_ms"])?n:f,this.keepaliveTimeoutMs=null!=(i=this.options["grpc.keepalive_timeout_ms"])?i:p,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,n;let i,s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,u.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,u.stringToSubchannelAddress)(a.localAddress,a.localPort):null;if(e.encrypted){let e=a,r=e.getCipher(),n=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!=(t=r.standardName)?t:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:n&&"raw"in n?n.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:o,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(r=e.state.localWindowSize)?r:null,remoteFlowControlWindow:null!=(n=e.state.remoteWindowSize)?n:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");let r=Object.keys(e);if(0===r.length)throw Error("Cannot add an empty service to a server");r.forEach(r=>{let n,i,s=e[r];n=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let a=t[r];if(void 0===a&&"string"==typeof s.originalName&&(a=t[s.originalName]),i=void 0!==a?a.bind(t):_(n,r),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,n))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{let r=e[t];this.unregister(r.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof a.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof r)throw TypeError("callback must be a function");let s=(0,c.parseUri)(e);if(null===s)throw Error(`Could not parse port "${e}"`);let d=(0,o.mapUriDefaultScheme)(s);if(null===d)throw Error(`Could not get a default scheme for port "${e}"`);let f={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?f.maxSessionMemory=this.options["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(f.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let p=(e,t)=>{process.nextTick(()=>r(e,t))},g=()=>{let e;if(t._isSecure()){let r=Object.assign(f,t._getSettings());r.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(e=n.createSecureServer(r)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=n.createServer(f);return e.setTimeout(0,y),this._setupHandlers(e),e},m=(e,t,r)=>0===e.length?Promise.resolve({port:t,count:r}):Promise.all(e.map(e=>{let r;this.trace("Attempting to bind "+(0,u.subchannelAddressToString)(e)),r=(0,u.isTcpSubchannelAddress)(e)?{host:e.host,port:t}:e;let n=g();return new Promise((i,s)=>{let a=t=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(e)+" with error "+t.message),i(t)};n.once("error",a),n.listen(r,()=>{let e;if(this.shutdown){n.close(),i(Error("bindAsync failed because server is shutdown"));return}let r=n.address();e="string"==typeof r?{path:r}:{host:r.address,port:r.port};let s=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(s),this.http2ServerList.push({server:n,channelzRef:s}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(e)),i("port"in e?e.port:t),n.removeListener("error",a)})})})).then(e=>{let n=0;for(let r of e)if("number"==typeof r&&(n+=1,r!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:n+r}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});let t=e[0],r=g();return new Promise((n,i)=>{let s=r=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(t)+" with error "+r.message),n(v(e.slice(1)))};r.once("error",s),r.listen(t,()=>{if(this.shutdown){r.close(),n({port:0,count:0});return}let t=r.address(),i={host:t.address,port:t.port},a=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(i),()=>({localAddress:i,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(a),this.http2ServerList.push({server:r,channelzRef:a}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(i)),n(m(e.slice(1),t.port,1)),r.removeListener("error",s)})})},_={onSuccessfulResolution:(t,r,n)=>{let s;(_.onSuccessfulResolution=()=>{},this.shutdown&&p(Error("bindAsync failed because server is shutdown"),0),0===t.length)?p(Error(`No addresses resolved for port ${e}`),0):(s=(0,u.isTcpSubchannelAddress)(t[0])?0===t[0].port?v(t):m(t,t[0].port,0):m(t,1,0)).then(e=>{if(0===e.count){let e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),p(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),p(null,e.port)},e=>{let r=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,r),p(Error(r),0)})},onError:e=>{p(Error(e.details),0)}};(0,o.createResolver)(d,_,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(n.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,n,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:r,deserialize:n,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef),e(t)},r=0;function n(){0==--r&&t()}for(let{server:e,channelzRef:t}of(this.started=!1,this.shutdown=!0,this.http2ServerList))e.listening&&(r++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t)),n()}));this.sessions.forEach((e,t)=>{t.closed||(r+=1,t.close(n))}),0===r&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[n.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof r&&!!r.startsWith("application/grpc")||(e.respond({[n.constants.HTTP2_HEADER_STATUS]:n.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return void 0===t?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let n=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed()),n.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==r||r.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed();return}let n=t[g],a=this._retrieveHandler(n);if(!a)return void this._respondWithError(v(n),e,r);let o=new s.Http2ServerCallStream(e,a,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",e=>{e?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,a,t)||(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${a.type}`}))}_streamHandler(e,t){if(!0!==this._verifyContentType(e,t))return;let r=t[g],n=this._retrieveHandler(r);if(!n)return void this._respondWithError(v(r),e,null);let a=new s.Http2ServerCallStream(e,n,this.options);this._runHandlerForCall(a,n,t)||a.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${n.type}`})}_runHandlerForCall(e,t,r){var n;let i=e.receiveMetadata(r),s=null!=(n=i.get("grpc-encoding")[0])?n:"identity";i.remove("grpc-encoding");let{type:a}=t;if("unary"===a)S(e,t,i,s);else if("clientStream"===a)C(e,t,i,s);else if("serverStream"===a)w(e,t,i,s);else{if("bidi"!==a)return!1;T(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),r="null";t&&(r="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",e=>{var t,r,i,s,a;if(!this.started)return void e.destroy();let o=(0,h.registerChannelzSocket)(null!=(t=e.socket.remoteAddress)?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),l={ref:o,streamTracker:new h.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,l);let u=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+u),this.sessionChildrenTracker.refChild(o));let c=null,f=null,p=!1;if(this.maxConnectionAgeMs!==d){let t=this.maxConnectionAgeMs/10,s=Math.random()*t*2-t;c=null==(i=(r=setTimeout(()=>{var t,r;p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+u);try{e.goaway(n.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(t){e.destroy();return}e.close(),this.maxConnectionAgeGraceMs!==d&&(f=null==(r=(t=setTimeout(()=>{e.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:r.call(t))},this.maxConnectionAgeMs+s)).unref)?void 0:i.call(r)}let g=null==(a=(s=setInterval(()=>{var t,r;let n=null==(r=(t=setTimeout(()=>{p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+u),e.close()},this.keepaliveTimeoutMs)).unref)?void 0:r.call(t);try{e.ping((e,t,r)=>{clearTimeout(n)})}catch(t){e.destroy()}},this.keepaliveTimeMs)).unref)?void 0:a.call(s);e.on("close",()=>{this.channelzEnabled&&(p||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+u),this.sessionChildrenTracker.unrefChild(o),(0,h.unregisterChannelzRef)(o)),c&&clearTimeout(c),f&&clearTimeout(f),g&&clearTimeout(g),this.sessions.delete(e)})})}}async function S(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerUnaryCallImpl(e,r,i);t.func(a,(t,r,n,i)=>{e.sendUnaryMessage(t,r,n,i)})}catch(t){e.sendError(t)}}function C(e,t,r,n){let i=new s.ServerReadableStreamImpl(e,r,t.deserialize,n);function a(t,r,n,s){i.destroy(),e.sendUnaryMessage(t,r,n,s)}e.cancelled||(i.on("error",a),t.func(i,a))}async function w(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerWritableStreamImpl(e,r,t.serialize,i);t.func(a)}catch(t){e.sendError(t)}}function T(e,t,r,n){let i=new s.ServerDuplexStreamImpl(e,r,t.serialize,t.deserialize,n);e.cancelled||t.func(i)}r.Server=b},14870,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StatusBuilder=void 0;class n{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}r.StatusBuilder=n},19992,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isDuration=r.durationToMs=r.msToDuration=void 0,r.msToDuration=function(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}},r.durationToMs=function(e){return 1e3*e.seconds+e.nanos/1e6|0},r.isDuration=function(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}},82418,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.OutlierDetectionLoadBalancer=r.OutlierDetectionLoadBalancingConfig=void 0;let i=e.r(51195),s=e.r(89220),a=e.r(19992),o=e.r(17853),l=e.r(10579),u=e.r(79548),c=e.r(36891),h=e.r(21800),d=e.r(15851),f=e.r(95763),p="outlier_detection";function g(e){f.trace(s.LogVerbosity.DEBUG,p,e)}let m="outlier_detection",y=(null!=(n=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?n:"true")==="true",v={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},_={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function b(e,t,r,n){if(t in e&&typeof e[t]!==r){let i=n?`${n}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${r}, got ${typeof e[t]}`)}}function S(e,t,r){let n=r?`${r}.${t}`:t;if(t in e){if(!(0,a.isDuration)(e[t]))throw Error(`outlier detection config ${n} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${n} parse error: values out of range for non-negative Duaration`)}}function C(e,t,r){let n=r?`${r}.${t}`:t;if(b(e,t,"number",r),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${n} parse error: value out of range for percentage (0-100)`)}class w{constructor(e,t,r,n,i,s,a){if(this.childPolicy=a,a.length>0&&"pick_first"===a[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=r?r:3e5,this.maxEjectionPercent=null!=n?n:10,this.successRateEjection=i?Object.assign(Object.assign({},v),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},_),s):null}getLoadBalancerName(){return m}toJsonObject(){return{interval:(0,a.msToDuration)(this.intervalMs),base_ejection_time:(0,a.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,a.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new w(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(S(e,"interval"),S(e,"base_ejection_time"),S(e,"max_ejection_time"),C(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");b(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),C(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),b(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),b(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");C(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),C(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),b(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),b(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new w(e.interval?(0,a.durationToMs)(e.interval):null,e.base_ejection_time?(0,a.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,a.durationToMs)(e.max_ejection_time):null,null!=(t=e.max_ejection_percent)?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(l.validateLoadBalancingConfig))}}r.OutlierDetectionLoadBalancingConfig=w;class T extends d.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,r,n)=>{if(this.childSubchannelState=r,!this.ejected)for(let e of this.stateListeners)e(this,t,r,n)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(let e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function E(){return{success:0,failure:0}}class k{constructor(){this.activeBucket=E(),this.inactiveBucket=E()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=E()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class I{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType!==c.PickResultType.COMPLETE)return t;{let e=t.subchannel,r=e.getMapEntry();if(!r)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let n=t.onCallEnded;return this.countCalls&&(n=e=>{var n;e===s.Status.OK?r.counter.addSuccess():r.counter.addFailure(),null==(n=t.onCallEnded)||n.call(t,e)}),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),onCallEnded:n})}}}}class R{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new u.ChildLoadBalancerHandler((0,o.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let n=e.createSubchannel(t,r),i=this.addressMap.get((0,h.subchannelAddressToString)(t)),s=new T(n,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,r)=>{t===i.ConnectivityState.READY?e.updateState(t,new I(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;g("Running success rate check");let r=t.request_volume,n=0,i=[];for(let[e,t]of this.addressMap){let s=t.counter.getLastSuccesses(),a=t.counter.getLastFailures();g("Stats for "+e+": successes="+s+" failures="+a+" targetRequestVolume="+r),s+a>=r&&(n+=1,i.push(s/(s+a)))}if(g("Found "+n+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),n<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,a=0;for(let e of i){let t=e-s;a+=t*t}let o=Math.sqrt(a/i.length),l=s-o*(t.stdev_factor/1e3);for(let[n,i]of(g("stdev="+o+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();if(s+a<r)continue;let o=s/(s+a);if(g("Checking candidate "+n+" successRate="+o),o<l){let r=100*Math.random();g("Candidate "+n+" randomNumber="+r+" enforcement_percentage="+t.enforcement_percentage),r<t.enforcement_percentage&&(g("Ejecting candidate "+n),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;g("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(r+=1);if(!(r<t.minimum_hosts))for(let[r,n]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let i=n.counter.getLastSuccesses(),s=n.counter.getLastFailures();if((g("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume))&&100*s/(s+i)>t.threshold){let i=100*Math.random();g("Candidate "+r+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(g("Ejecting candidate "+r),this.eject(n,e))}}}eject(e,t){for(let t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(let t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),null==(r=(t=this.ejectionTimer).unref)||r.call(t)}runChecks(){let e=new Date;if(g("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[t,r]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===r.currentEjectionTimestamp)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let e=this.latestConfig.getBaseEjectionTimeMs(),n=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(r.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*r.ejectionTimeMultiplier,Math.max(e,n))),i<new Date&&(g("Unejecting "+t),this.uneject(r))}}updateAddressList(e,t,r){if(!(t instanceof w))return;let n=new Set;for(let t of e)n.add((0,h.subchannelAddressToString)(t));for(let e of n)this.addressMap.has(e)||(g("Adding map entry for "+e),this.addressMap.set(e,{counter:new k,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let e of this.addressMap.keys())n.has(e)||(g("Removing map entry for "+e),this.addressMap.delete(e));let i=(0,l.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){g("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else g("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else for(let e of(g("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return m}}r.OutlierDetectionLoadBalancer=R,r.setup=function(){y&&(0,o.registerLoadBalancerType)(m,R,w)}},17853,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OutlierDetectionLoadBalancingConfig=r.BaseSubchannelWrapper=r.registerAdminService=r.FilterStackFactory=r.BaseFilter=r.PickResultType=r.QueuePicker=r.UnavailablePicker=r.ChildLoadBalancerHandler=r.subchannelAddressToString=r.validateLoadBalancingConfig=r.getFirstUsableConfig=r.registerLoadBalancerType=r.createChildChannelControlHelper=r.BackoffTimeout=r.durationToMs=r.uriToString=r.createResolver=r.registerResolver=r.log=r.trace=void 0;var n=e.r(95763);Object.defineProperty(r,"trace",{enumerable:!0,get:function(){return n.trace}}),Object.defineProperty(r,"log",{enumerable:!0,get:function(){return n.log}});var i=e.r(17927);Object.defineProperty(r,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}}),Object.defineProperty(r,"createResolver",{enumerable:!0,get:function(){return i.createResolver}});var s=e.r(1602);Object.defineProperty(r,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});var a=e.r(19992);Object.defineProperty(r,"durationToMs",{enumerable:!0,get:function(){return a.durationToMs}});var o=e.r(44943);Object.defineProperty(r,"BackoffTimeout",{enumerable:!0,get:function(){return o.BackoffTimeout}});var l=e.r(10579);Object.defineProperty(r,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(r,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(r,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(r,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});var u=e.r(21800);Object.defineProperty(r,"subchannelAddressToString",{enumerable:!0,get:function(){return u.subchannelAddressToString}});var c=e.r(79548);Object.defineProperty(r,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return c.ChildLoadBalancerHandler}});var h=e.r(36891);Object.defineProperty(r,"UnavailablePicker",{enumerable:!0,get:function(){return h.UnavailablePicker}}),Object.defineProperty(r,"QueuePicker",{enumerable:!0,get:function(){return h.QueuePicker}}),Object.defineProperty(r,"PickResultType",{enumerable:!0,get:function(){return h.PickResultType}});var d=e.r(50948);Object.defineProperty(r,"BaseFilter",{enumerable:!0,get:function(){return d.BaseFilter}});var f=e.r(79376);Object.defineProperty(r,"FilterStackFactory",{enumerable:!0,get:function(){return f.FilterStackFactory}});var p=e.r(61295);Object.defineProperty(r,"registerAdminService",{enumerable:!0,get:function(){return p.registerAdminService}});var g=e.r(15851);Object.defineProperty(r,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return g.BaseSubchannelWrapper}});var m=e.r(82418);Object.defineProperty(r,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return m.OutlierDetectionLoadBalancingConfig}})},44624,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;let n=e.r(17927);class i{constructor(e,t,r){let n;this.listener=t,this.addresses=[],this.hasReturnedResult=!1,n=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:n}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}}r.setup=function(){(0,n.registerResolver)("unix",i)}},70990,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;let n=e.r(4446),i=e.r(89220),s=e.r(63878),a=e.r(17927),o=e.r(1602),l=e.r(95763),u="ip_resolver";function c(e){l.trace(i.LogVerbosity.DEBUG,u,e)}let h="ipv4",d="ipv6",f=443;class p{constructor(e,t,r){var a;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,c("Resolver constructed for target "+(0,o.uriToString)(e));const l=[];if(e.scheme!==h&&e.scheme!==d){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(const t of e.path.split(",")){const r=(0,o.splitHostPort)(t);if(null===r||e.scheme===h&&!(0,n.isIPv4)(r.host)||e.scheme===d&&!(0,n.isIPv6)(r.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:r.host,port:null!=(a=r.port)?a:f})}this.addresses=l,c("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}}r.setup=function(){(0,a.registerResolver)(h,p),(0,a.registerResolver)(d,p)}},2608,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.PickFirstLoadBalancer=r.shuffled=r.PickFirstLoadBalancingConfig=void 0;let n=e.r(10579),i=e.r(51195),s=e.r(36891),a=e.r(95763),o=e.r(89220),l="pick_first";function u(e){a.trace(o.LogVerbosity.DEBUG,l,e)}let c="pick_first",h=250;class d{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return c}toJsonObject(){return{[c]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&"boolean"!=typeof e.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new d(!0===e.shuffleAddressList)}}r.PickFirstLoadBalancingConfig=d;class f{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function p(e){let t=e.slice();for(let e=t.length-1;e>1;e--){let r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}return t}r.shuffled=p;class g{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(e,t,r,n,i)=>{this.onSubchannelStateUpdate(e,t,r,i)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(i.ConnectivityState.READY,new f(this.currentPick)):0===this.children.length?this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:e}of(this.stickyTransientFailureMode=!0,this.children))e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,n){var s;if(null==(s=this.currentPick)?void 0:s.realSubchannelEquals(e)){r!==i.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[t,s]of this.children.entries())if(e.realSubchannelEquals(s.subchannel)){r===i.ConnectivityState.READY&&this.pickSubchannel(s.subchannel),r===i.ConnectivityState.TRANSIENT_FAILURE&&(s.hasReportedTransientFailure=!0,n&&(this.lastError=n),this.maybeEnterStickyTransientFailureMode(),t===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(t+1)),s.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let e=r.subchannel.getConnectivityState();if(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.CONNECTING)return void this.startConnecting(t)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===i.ConnectivityState.IDLE&&(u("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var t;null==(t=this.children[e])||t.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},h)).unref)?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(u("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){u(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(e=>({subchannel:this.channelControlHelper.createSubchannel(e,{}),hasReportedTransientFailure:!1}));for(let{subchannel:e}of t)e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(let{subchannel:e}of(this.resetSubchannelList(),this.children=t,this.children))if(e.addConnectivityStateListener(this.subchannelStateListener),e.getConnectivityState()===i.ConnectivityState.READY)return void this.pickSubchannel(e);for(let e of this.children)e.subchannel.getConnectivityState()===i.ConnectivityState.TRANSIENT_FAILURE&&(e.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof d&&(t.getShuffleAddressList()&&(e=p(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===i.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return c}}r.PickFirstLoadBalancer=g,r.setup=function(){(0,n.registerLoadBalancerType)(c,g,d),(0,n.registerDefaultLoadBalancerType)(c)}},94220,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.RoundRobinLoadBalancer=void 0;let n=e.r(10579),i=e.r(51195),s=e.r(36891),a=e.r(21800),o=e.r(95763),l=e.r(89220),u="round_robin";function c(e){o.trace(l.LogVerbosity.DEBUG,u,e)}let h="round_robin";class d{getLoadBalancerName(){return h}toJsonObject(){return{[h]:{}}}static createFromJson(e){return new d}}class f{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class p{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(e,t,r,n,s)=>{this.calculateAndUpdateState(),(r===i.ConnectivityState.TRANSIENT_FAILURE||r===i.ConnectivityState.IDLE)&&(s&&(this.lastError=s),this.channelControlHelper.requestReresolution(),e.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(i.ConnectivityState.READY)>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new f(e,t))}else this.countSubchannelsWithState(i.ConnectivityState.CONNECTING)>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(i.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){for(let t of(this.resetSubchannelList(),c("Connect to address list "+e.map(e=>(0,a.subchannelAddressToString)(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());let e=t.getConnectivityState();(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return h}}r.RoundRobinLoadBalancer=p,r.setup=function(){(0,n.registerLoadBalancerType)(h,p,d)}},18807,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.experimental=r.addAdminServicesToServer=r.getChannelzHandlers=r.getChannelzServiceDefinition=r.InterceptorConfigurationError=r.InterceptingCall=r.RequesterBuilder=r.ListenerBuilder=r.StatusBuilder=r.getClientChannel=r.ServerCredentials=r.Server=r.setLogVerbosity=r.setLogger=r.load=r.loadObject=r.CallCredentials=r.ChannelCredentials=r.waitForClientReady=r.closeClient=r.Channel=r.makeGenericClientConstructor=r.makeClientConstructor=r.loadPackageDefinition=r.Client=r.compressionAlgorithms=r.propagate=r.connectivityState=r.status=r.logVerbosity=r.Metadata=r.credentials=void 0;let n=e.r(17418);Object.defineProperty(r,"CallCredentials",{enumerable:!0,get:function(){return n.CallCredentials}});let i=e.r(31394);Object.defineProperty(r,"Channel",{enumerable:!0,get:function(){return i.ChannelImplementation}});let s=e.r(56874);Object.defineProperty(r,"compressionAlgorithms",{enumerable:!0,get:function(){return s.CompressionAlgorithms}});let a=e.r(51195);Object.defineProperty(r,"connectivityState",{enumerable:!0,get:function(){return a.ConnectivityState}});let o=e.r(9553);Object.defineProperty(r,"ChannelCredentials",{enumerable:!0,get:function(){return o.ChannelCredentials}});let l=e.r(40575);Object.defineProperty(r,"Client",{enumerable:!0,get:function(){return l.Client}});let u=e.r(89220);Object.defineProperty(r,"logVerbosity",{enumerable:!0,get:function(){return u.LogVerbosity}}),Object.defineProperty(r,"status",{enumerable:!0,get:function(){return u.Status}}),Object.defineProperty(r,"propagate",{enumerable:!0,get:function(){return u.Propagate}});let c=e.r(95763),h=e.r(78320);Object.defineProperty(r,"loadPackageDefinition",{enumerable:!0,get:function(){return h.loadPackageDefinition}}),Object.defineProperty(r,"makeClientConstructor",{enumerable:!0,get:function(){return h.makeClientConstructor}}),Object.defineProperty(r,"makeGenericClientConstructor",{enumerable:!0,get:function(){return h.makeClientConstructor}});let d=e.r(63878);Object.defineProperty(r,"Metadata",{enumerable:!0,get:function(){return d.Metadata}});let f=e.r(40305);Object.defineProperty(r,"Server",{enumerable:!0,get:function(){return f.Server}});let p=e.r(75546);Object.defineProperty(r,"ServerCredentials",{enumerable:!0,get:function(){return p.ServerCredentials}});let g=e.r(14870);Object.defineProperty(r,"StatusBuilder",{enumerable:!0,get:function(){return g.StatusBuilder}}),r.credentials={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:o.ChannelCredentials.createInsecure,createSsl:o.ChannelCredentials.createSsl,createFromSecureContext:o.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:n.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:n.CallCredentials.createFromGoogleCredential,createEmpty:n.CallCredentials.createEmpty},r.closeClient=e=>e.close(),r.waitForClientReady=(e,t,r)=>e.waitForReady(t,r),r.loadObject=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},r.load=(e,t,r)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},r.setLogger=e=>{c.setLogger(e)},r.setLogVerbosity=e=>{c.setLoggerVerbosity(e)},r.getClientChannel=e=>l.Client.prototype.getChannel.call(e);var m=e.r(79170);Object.defineProperty(r,"ListenerBuilder",{enumerable:!0,get:function(){return m.ListenerBuilder}}),Object.defineProperty(r,"RequesterBuilder",{enumerable:!0,get:function(){return m.RequesterBuilder}}),Object.defineProperty(r,"InterceptingCall",{enumerable:!0,get:function(){return m.InterceptingCall}}),Object.defineProperty(r,"InterceptorConfigurationError",{enumerable:!0,get:function(){return m.InterceptorConfigurationError}});var y=e.r(2605);Object.defineProperty(r,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return y.getChannelzServiceDefinition}}),Object.defineProperty(r,"getChannelzHandlers",{enumerable:!0,get:function(){return y.getChannelzHandlers}});var v=e.r(61295);Object.defineProperty(r,"addAdminServicesToServer",{enumerable:!0,get:function(){return v.addAdminServicesToServer}}),r.experimental=e.r(17853);let _=e.r(91786),b=e.r(44624),S=e.r(70990),C=e.r(2608),w=e.r(94220),T=e.r(82418),E=e.r(2605);(()=>{_.setup(),b.setup(),S.setup(),C.setup(),w.setup(),T.setup(),E.setup()})()},43647,(e,t,r)=>{var n=e.r(874),i=n.Buffer;function s(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(s(n,r),r.Buffer=a),a.prototype=Object.create(i.prototype),s(i,a),a.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},a.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},65475,(e,t,r)=>{"use strict";var n=e.r(88947).Stream,i=e.r(24361),s=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};i.inherits(s,n),s.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},s.prototype.resume=function(){this._paused=!1,this.emit("drain");var e=this._driver.messages;e._paused=!1,e.emit("drain")},s.prototype.write=function(e){return!!this.writable&&(this._driver.parse(e),!this._paused)},s.prototype.end=function(e){if(this.writable){void 0!==e&&this.write(e),this.writable=!1;var t=this._driver.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))}},s.prototype.destroy=function(){this.end()};var a=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};i.inherits(a,n),a.prototype.pause=function(){this._driver.io._paused=!0},a.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},a.prototype.write=function(e){return!!this.writable&&("string"==typeof e?this._driver.text(e):this._driver.binary(e),!this._paused)},a.prototype.end=function(e){void 0!==e&&this.write(e)},a.prototype.destroy=function(){},r.IO=s,r.Messages=a},76847,(e,t,r)=>{"use strict";var n=function(){this.clear()};n.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],n.prototype.clear=function(){this._sent={},this._lines=[]},n.prototype.set=function(e,t){if(void 0!==t){e=this._strip(e),t=this._strip(t);var r=e.toLowerCase();(!this._sent.hasOwnProperty(r)||this.ALLOWED_DUPLICATES.indexOf(r)>=0)&&(this._sent[r]=!0,this._lines.push(e+": "+t+"\r\n"))}},n.prototype.toString=function(){return this._lines.join("")},n.prototype._strip=function(e){return e.toString().replace(/^ */,"").replace(/ *$/,"")},t.exports=n},19139,(e,t,r)=>{"use strict";var n=e.r(43647).Buffer,i=function(){this._queue=[],this._queueSize=0,this._offset=0};i.prototype.put=function(e){e&&0!==e.length&&(n.isBuffer(e)||(e=n.from(e)),this._queue.push(e),this._queueSize+=e.length)},i.prototype.read=function(e){if(e>this._queueSize)return null;if(0===e)return n.alloc(0);this._queueSize-=e;var t,r,i=this._queue,s=e,a=i[0];if(a.length>=e)if(a.length===e)return i.shift();else return r=a.slice(0,e),i[0]=a.slice(e),r;for(var o=0,l=i.length;o<l&&!(s<i[o].length);o++)s-=i[o].length;return t=i.splice(0,o),s>0&&i.length>0&&(t.push(i[0].slice(0,s)),i[0]=i[0].slice(s)),n.concat(t,e)},i.prototype.eachByte=function(e,t){for(var r,n,i;this._queue.length>0;){for(n=(r=this._queue[0]).length;this._offset<n;)i=this._offset,this._offset+=1,e.call(t,r[i]);this._offset=0,this._queue.shift()}},t.exports=i},35309,(e,t,r)=>{"use strict";var n=e.r(43647).Buffer,i=e.r(27699).EventEmitter,s=e.r(24361),a=e.r(65475),o=e.r(76847),l=e.r(19139),u=function(e,t,r){i.call(this),u.validateOptions(r||{},["maxLength","masking","requireMasking","protocols"]),this._request=e,this._reader=new l,this._options=r||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new o,this.__queue=[],this.readyState=0,this.url=t,this.io=new a.IO(this),this.messages=new a.Messages(this),this._bindEventListeners()};s.inherits(u,i),u.isWebSocket=function(e){var t=e.headers.connection||"",r=e.headers.upgrade||"";return"GET"===e.method&&t.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===r.toLowerCase()},u.validateOptions=function(e,t){for(var r in e)if(0>t.indexOf(r))throw Error("Unrecognized option: "+r)};var c={MAX_LENGTH:0x3ffffff,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var e=this;this.messages.on("error",function(){}),this.on("message",function(t){var r=e.messages;r.readable&&r.emit("data",t.data)}),this.on("error",function(t){var r=e.messages;r.readable&&r.emit("error",t)}),this.on("close",function(){var t=e.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(e){return!1},setHeader:function(e,t){return!(this.readyState>0)&&(this._headers.set(e,t),!0)},start:function(){var e;if(0!==this.readyState)return!1;if(!u.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{e=this._handshakeResponse()}catch(e){return this._failHandshake(e)}return this._write(e),-1!==this._stage&&this._open(),!0},_failHandshake:function(e){var t=new o;return t.set("Content-Type","text/plain"),t.set("Content-Length",n.byteLength(e.message,"utf8")),t=["HTTP/1.1 400 Bad Request",t.toString(),e.message],this._write(n.from(t.join("\r\n"),"utf8")),this._fail("protocol_error",e.message),!1},text:function(e){return this.frame(e)},binary:function(e){return!1},ping:function(){return!1},pong:function(){return!1},close:function(e,t){return 1===this.readyState&&(this.readyState=3,this.emit("close",new u.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(e){this.frame.apply(this,e)},this),this.__queue=[],this.emit("open",new u.OpenEvent)},_queue:function(e){return this.__queue.push(e),!0},_write:function(e){var t=this.io;t.readable&&t.emit("data",e)},_fail:function(e,t){this.readyState=2,this.emit("error",Error(t)),this.close()}};for(var h in c)u.prototype[h]=c[h];u.ConnectEvent=function(){},u.OpenEvent=function(){},u.CloseEvent=function(e,t){this.code=e,this.reason=t},u.MessageEvent=function(e){this.data=e},u.PingEvent=function(e){this.data=e},u.PongEvent=function(e){this.data=e},t.exports=u},3470,(e,t,r)=>{function n(e){if(void 0!==e&&e!==n.REQUEST&&e!==n.RESPONSE)throw Error("type must be REQUEST or RESPONSE");void 0===e||this.initialize(e),this.maxHeaderSize=n.maxHeaderSize}r.HTTPParser=n,n.prototype.initialize=function(e,t){if(e!==n.REQUEST&&e!==n.RESPONSE)throw Error("type must be REQUEST or RESPONSE");this.type=e,this.state=e+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},n.encoding="ascii",n.maxHeaderSize=81920,n.REQUEST="REQUEST",n.RESPONSE="RESPONSE";var i=n.kOnHeaders=1,s=n.kOnHeadersComplete=2,a=n.kOnBody=3,o=n.kOnMessageComplete=4;n.prototype[i]=n.prototype[s]=n.prototype[a]=n.prototype[o]=function(){};var l=!0;Object.defineProperty(n,"kOnExecute",{get:function(){return l=!1,99}});var u=r.methods=n.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],c=u.indexOf("CONNECT");n.prototype.reinitialize=n,n.prototype.close=n.prototype.pause=n.prototype.resume=n.prototype.remove=n.prototype.free=function(){},n.prototype._compatMode0_11=!1,n.prototype.getAsyncId=function(){return 0};var h={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};n.prototype.execute=function(e,t,r){if(!(this instanceof n))throw TypeError("not a HTTPParser");t=t||0,r="number"==typeof r?r:e.length,this.chunk=e,this.offset=t;var i=this.end=t+r;try{for(;this.offset<i&&!this[this.state](););}catch(e){if(this.isUserCall)throw e;return this.hadError=!0,e}return(this.chunk=null,r=this.offset-t,h[this.state]&&(this.headerSize+=r,this.headerSize>(this.maxHeaderSize||n.maxHeaderSize)))?Error("max header size exceeded"):r};var d={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};n.prototype.finish=function(){if(!this.hadError){if(!d[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[o]())}},n.prototype.consume=n.prototype.unconsume=n.prototype.getCurrentBuffer=function(){},n.prototype.userCall=function(){this.isUserCall=!0;var e=this;return function(t){return e.isUserCall=!1,t}},n.prototype.nextRequest=function(){this.userCall()(this[o]()),this.reinitialize(this.type)},n.prototype.consumeLine=function(){for(var e=this.end,t=this.chunk,r=this.offset;r<e;r++)if(10===t[r]){var i=this.line+t.toString(n.encoding,this.offset,r);return"\r"===i.charAt(i.length-1)&&(i=i.substr(0,i.length-1)),this.line="",this.offset=r+1,i}this.line+=t.toString(n.encoding,this.offset,this.end),this.offset=this.end};var f=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,p=/^[ \t]+(.*[^ \t])/;n.prototype.parseHeader=function(e,t){if(-1!==e.indexOf("\r"))throw y("HPE_LF_EXPECTED");var r=f.exec(e),n=r&&r[1];if(n)t.push(n),t.push(r[2]);else{var i=p.exec(e);i&&t.length&&(t[t.length-1]&&(t[t.length-1]+=" "),t[t.length-1]+=i[1])}};var g=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;n.prototype.REQUEST_LINE=function(){var e=this.consumeLine();if(e){var t=g.exec(e);if(null===t)throw y("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?t[1]:u.indexOf(t[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=t[2],this.info.versionMajor=+t[3],this.info.versionMinor=+t[4],this.body_bytes=0,this.state="HEADER"}};var m=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function y(e){var t=Error("Parse Error");return t.code=e,t}n.prototype.RESPONSE_LINE=function(){var e=this.consumeLine();if(e){var t=m.exec(e);if(null===t)throw y("HPE_INVALID_CONSTANT");this.info.versionMajor=+t[1],this.info.versionMinor=+t[2];var r=this.info.statusCode=+t[3];this.info.statusMessage=t[4],((r/100|0)==1||204===r||304===r)&&(this.body_bytes=0),this.state="HEADER"}},n.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},n.prototype.HEADER=function(){var e=this.consumeLine();if(void 0!==e){var t=this.info;if(e)this.parseHeader(e,t.headers);else{for(var r,i,a=t.headers,o=!1,u=!1,h=0;h<a.length;h+=2)switch(a[h].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===a[h+1].toLowerCase();break;case"content-length":if(r=+a[h+1],o){if(r!==this.body_bytes)throw y("HPE_UNEXPECTED_CONTENT_LENGTH")}else o=!0,this.body_bytes=r;break;case"connection":this.connection+=a[h+1].toLowerCase();break;case"upgrade":u=!0}if(this.isChunked&&o&&(o=!1,this.body_bytes=null),u&&-1!=this.connection.indexOf("upgrade")?t.upgrade=this.type===n.REQUEST||101===t.statusCode:t.upgrade=t.method===c,this.isChunked&&t.upgrade&&(this.isChunked=!1),t.shouldKeepAlive=this.shouldKeepAlive(),2===(i=l?this.userCall()(this[s](t)):this.userCall()(this[s](t.versionMajor,t.versionMinor,t.headers,t.method,t.url,t.statusCode,t.statusMessage,t.upgrade,t.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!i)this.state="BODY_CHUNKHEAD";else{if(i||0===this.body_bytes)return this.nextRequest(),t.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},n.prototype.BODY_CHUNKHEAD=function(){var e=this.consumeLine();void 0!==e&&(this.body_bytes=parseInt(e,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},n.prototype.BODY_CHUNK=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[a](this.chunk.slice(this.offset,this.offset+e),0,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},n.prototype.BODY_CHUNKEMPTYLINE=function(){var e=this.consumeLine();if(void 0!==e){if(""!==e)throw Error("Expected empty line");this.state="BODY_CHUNKHEAD"}},n.prototype.BODY_CHUNKTRAILERS=function(){var e=this.consumeLine();void 0!==e&&(e?this.parseHeader(e,this.trailers):(this.trailers.length&&this.userCall()(this[i](this.trailers,"")),this.nextRequest()))},n.prototype.BODY_RAW=function(){this.userCall()(this[a](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end},n.prototype.BODY_SIZED=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[a](this.chunk.slice(this.offset,this.offset+e),0,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(e){var t=n["kOn"+e];Object.defineProperty(n.prototype,"on"+e,{get:function(){return this[t]},set:function(e){return this._compatMode0_11=!0,c="CONNECT",this[t]=e}})})},73776,(e,t,r)=>{"use strict";var n=e.r(3470).HTTPParser,i=e.r(43647).Buffer,s={request:n.REQUEST||"request",response:n.RESPONSE||"response"},a=function(e){this._type=e,this._parser=new n(s[e]),this._complete=!1,this.headers={};var t=null,r=this;this._parser.onHeaderField=function(e,r,n){t=e.toString("utf8",r,r+n).toLowerCase()},this._parser.onHeaderValue=function(e,n,i){var s=e.toString("utf8",n,n+i);r.headers.hasOwnProperty(t)?r.headers[t]+=", "+s:r.headers[t]=s},this._parser.onHeadersComplete=this._parser[n.kOnHeadersComplete]=function(e,t,n,i,s,o){var l=arguments[0];if("object"==typeof l&&(i=l.method,s=l.url,o=l.statusCode,n=l.headers),r.method="number"==typeof i?a.METHODS[i]:i,r.statusCode=o,r.url=s,n){for(var u,c,h=0,d=n.length;h<d;h+=2)u=n[h].toLowerCase(),c=n[h+1],r.headers.hasOwnProperty(u)?r.headers[u]+=", "+c:r.headers[u]=c;r._complete=!0}}};a.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var o=process.version?process.version.match(/[0-9]+/g).map(function(e){return parseInt(e,10)}):[];0===o[0]&&12===o[1]&&(a.METHODS[16]="REPORT",a.METHODS[17]="MKACTIVITY",a.METHODS[18]="CHECKOUT",a.METHODS[19]="MERGE",a.METHODS[20]="M-SEARCH",a.METHODS[21]="NOTIFY",a.METHODS[22]="SUBSCRIBE",a.METHODS[23]="UNSUBSCRIBE",a.METHODS[24]="PATCH",a.METHODS[25]="PURGE"),a.prototype.isComplete=function(){return this._complete},a.prototype.parse=function(e){var t=this._parser.execute(e,0,e.length);if("number"!=typeof t){this.error=t,this._complete=!0;return}this._complete&&(this.body=t<e.length?e.slice(t):i.alloc(0))},t.exports=a},63150,(e,t,r)=>{"use strict";var n=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,i=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,s=RegExp(n.source+"(?:=(?:"+n.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),a=RegExp(n.source+"(?: *; *"+s.source+")*","g"),o=RegExp("^"+a.source+"(?: *, *"+a.source+")*$"),l=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,u=Object.prototype.hasOwnProperty,c={parseHeader:function(e){var t=new h;if(""===e||void 0===e)return t;if(!o.test(e))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+e);return e.match(a).forEach(function(e){var r=e.match(RegExp(s.source,"g")),n=r.shift(),i={};r.forEach(function(e){var t,r=e.match(s),n=r[1];t=void 0!==r[2]?r[2]:void 0===r[3]||r[3].replace(/\\/g,""),l.test(t)&&(t=parseFloat(t)),u.call(i,n)?(i[n]=[].concat(i[n]),i[n].push(t)):i[n]=t},this),t.push(n,i)},this),t},serializeParams:function(e,t){var r=[],n=function(e,t){t instanceof Array?t.forEach(function(t){n(e,t)}):!0===t?r.push(e):"number"==typeof t?r.push(e+"="+t):i.test(t)?r.push(e+'="'+t.replace(/"/g,'\\"')+'"'):r.push(e+"="+t)};for(var s in t)n(s,t[s]);return[e].concat(r).join("; ")}},h=function(){this._byName={},this._inOrder=[]};h.prototype.push=function(e,t){u.call(this._byName,e)||(this._byName[e]=[]),this._byName[e].push(t),this._inOrder.push({name:e,params:t})},h.prototype.eachOffer=function(e,t){for(var r=this._inOrder,n=0,i=r.length;n<i;n++)e.call(t,r[n].name,r[n].params)},h.prototype.byName=function(e){return this._byName[e]||[]},h.prototype.toArray=function(){return this._inOrder.slice()},t.exports=c},67416,(e,t,r)=>{"use strict";var n=function(e){this._bufferSize=e,this.clear()};n.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},n.prototype.push=function(e){var t=!1,r=!1;this._ringSize<this._bufferSize?t=0===this._tail:this._ringOffset===this._ringSize&&(t=!0,r=0===this._tail),t&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,r&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=e,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},n.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},n.prototype.shift=function(){if(0!==this.length){var e=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,e}},t.exports=n},29782,(e,t,r)=>{"use strict";var n=e.r(67416),i=function(e,t){this._session=e,this._method=t,this._queue=new n(i.QUEUE_SIZE),this._stopped=!1,this.pending=0};i.QUEUE_SIZE=8,i.prototype.call=function(e,t,r,n){if(!this._stopped){var i={error:e,message:t,callback:r,context:n,done:!1},s=!1,a=this;if(this._queue.push(i),i.error)return i.done=!0,this._stop(),this._flushQueue();var o=function(e,t){s^(s=!0)&&(e?(a._stop(),i.error=e,i.message=null):i.message=t,i.done=!0,a._flushQueue())};try{this._session[this._method](t,o)}catch(e){o(e)}}},i.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},i.prototype._flushQueue=function(){for(var e,t=this._queue;t.length>0&&t.peek().done;)(e=t.shift()).error?(this.pending=0,t.clear()):this.pending-=1,e.callback.call(e.context,e.error,e.message)},t.exports=i},26635,(e,t,r)=>{"use strict";var n=e.r(67416),i=function(){this._complete=!1,this._callbacks=new n(i.QUEUE_SIZE)};i.QUEUE_SIZE=4,i.all=function(e){var t=new i,r=e.length,n=r;for(0===r&&t.done();n--;)e[n].then(function(){0==(r-=1)&&t.done()});return t},i.prototype.then=function(e){this._complete?e():this._callbacks.push(e)},i.prototype.done=function(){this._complete=!0;for(var e,t=this._callbacks;e=t.shift();)e()},t.exports=i},43200,(e,t,r)=>{"use strict";var n=e.r(29782),i=e.r(26635),s=function(e){this._ext=e[0],this._session=e[1],this._functors={incoming:new n(this._session,"processIncomingMessage"),outgoing:new n(this._session,"processOutgoingMessage")}};s.prototype.pending=function(e){var t=this._functors[e];t._stopped||(t.pending+=1)},s.prototype.incoming=function(e,t,r,n){this._exec("incoming",e,t,r,n)},s.prototype.outgoing=function(e,t,r,n){this._exec("outgoing",e,t,r,n)},s.prototype.close=function(){return this._closed=this._closed||new i,this._doClose(),this._closed},s.prototype._exec=function(e,t,r,n,i){this._functors[e].call(t,r,function(e,t){e&&(e.message=this._ext.name+": "+e.message),n.call(i,e,t),this._doClose()},this)},s.prototype._doClose=function(){var e=this._functors.incoming,t=this._functors.outgoing;this._closed&&e.pending+t.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())},t.exports=s},59142,(e,t,r)=>{"use strict";var n=e.r(43200),i=e.r(26635),s=function(e){this._cells=e.map(function(e){return new n(e)}),this._stopped={incoming:!1,outgoing:!1}};s.prototype.processIncomingMessage=function(e,t,r){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,e,t,r)},s.prototype.processOutgoingMessage=function(e,t,r){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,e,t,r)},s.prototype.close=function(e,t){this._stopped={incoming:!0,outgoing:!0};var r=this._cells.map(function(e){return e.close()});e&&i.all(r).then(function(){e.call(t)})},s.prototype._loop=function(e,t,r,n,i,s,a){for(var o=this._cells,l=o.length,u=this;l--;)o[l].pending(e);var c=function(t,i,l){if(t===r)return s.call(a,i,l);o[t][e](i,l,function(r,i){r&&(u._stopped[e]=!0),c(t+n,r,i)})};c(t,null,i)},t.exports=s},14389,(e,t,r)=>{"use strict";var n=e.r(63150),i=e.r(59142),s=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};s.MESSAGE_OPCODES=[1,2];var a={add:function(e){if("string"!=typeof e.name)throw TypeError("extension.name must be a string");if("permessage"!==e.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof e.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof e.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof e.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(e.name))throw TypeError('An extension with name "'+e.name+'" is already registered');this._byName[e.name]=e,this._inOrder.push(e)},generateOffer:function(){var e=[],t=[],r={};return this._inOrder.forEach(function(i){var s=i.createClientSession();if(s){var a=[i,s];e.push(a),r[i.name]=a;var o=s.generateOffer();o=o?[].concat(o):[],o.forEach(function(e){t.push(n.serializeParams(i.name,e))},this)}},this),this._sessions=e,this._index=r,t.length>0?t.join(", "):null},activate:function(e){var t=n.parseHeader(e),r=[];t.eachOffer(function(e,t){var i=this._index[e];if(!i)throw Error('Server sent an extension response for unknown extension "'+e+'"');var s=i[0],a=i[1],o=this._reserved(s);if(o)throw Error("Server sent two extension responses that use the RSV"+o[0]+' bit: "'+o[1]+'" and "'+s.name+'"');if(!0!==a.activate(t))throw Error("Server sent unacceptable extension parameters: "+n.serializeParams(e,t));this._reserve(s),r.push(i)},this),this._sessions=r,this._pipeline=new i(r)},generateResponse:function(e){var t=[],r=[],s=n.parseHeader(e);return this._inOrder.forEach(function(e){var i=s.byName(e.name);if(!(0===i.length||this._reserved(e))){var a=e.createServerSession(i);a&&(this._reserve(e),t.push([e,a]),r.push(n.serializeParams(e.name,a.generateResponse())))}},this),this._sessions=t,this._pipeline=new i(t),r.length>0?r.join(", "):null},validFrameRsv:function(e){var t,r={rsv1:!1,rsv2:!1,rsv3:!1};if(s.MESSAGE_OPCODES.indexOf(e.opcode)>=0)for(var n=0,i=this._sessions.length;n<i;n++)t=this._sessions[n][0],r.rsv1=r.rsv1||t.rsv1,r.rsv2=r.rsv2||t.rsv2,r.rsv3=r.rsv3||t.rsv3;return(r.rsv1||!e.rsv1)&&(r.rsv2||!e.rsv2)&&(r.rsv3||!e.rsv3)},processIncomingMessage:function(e,t,r){this._pipeline.processIncomingMessage(e,t,r)},processOutgoingMessage:function(e,t,r){this._pipeline.processOutgoingMessage(e,t,r)},close:function(e,t){if(!this._pipeline)return e.call(t);this._pipeline.close(e,t)},_reserve:function(e){this._rsv1=this._rsv1||e.rsv1&&e.name,this._rsv2=this._rsv2||e.rsv2&&e.name,this._rsv3=this._rsv3||e.rsv3&&e.name},_reserved:function(e){return this._rsv1&&e.rsv1?[1,this._rsv1]:this._rsv2&&e.rsv2?[2,this._rsv2]:!!this._rsv3&&!!e.rsv3&&[3,this._rsv3]}};for(var o in a)s.prototype[o]=a[o];t.exports=s},68936,(e,t,r)=>{"use strict";var n=function(){},i={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var s in i)n.prototype[s]=i[s];t.exports=n},9324,(e,t,r)=>{"use strict";var n=e.r(43647).Buffer,i=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},s={read:function(){return this.data=this.data||n.concat(this._chunks,this.length)},pushFrame:function(e){this.rsv1=this.rsv1||e.rsv1,this.rsv2=this.rsv2||e.rsv2,this.rsv3=this.rsv3||e.rsv3,null===this.opcode&&(this.opcode=e.opcode),this._chunks.push(e.payload),this.length+=e.length}};for(var a in s)i.prototype[a]=s[a];t.exports=i},92620,(e,t,r)=>{"use strict";var n=e.r(43647).Buffer,i=e.r(54799),s=e.r(24361),a=e.r(14389),o=e.r(35309),l=e.r(68936),u=e.r(9324),c=function(e,t,r){if(o.apply(this,arguments),this._extensions=new a,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var n=this._request.headers["sec-websocket-protocol"],i=this._protocols;void 0!==n&&("string"==typeof n&&(n=n.split(/ *, */)),this.protocol=n.filter(function(e){return i.indexOf(e)>=0})[0]),this.version="hybi-"+c.VERSION}};s.inherits(c,o),c.VERSION="13",c.mask=function(e,t,r){if(!t||0===t.length)return e;r=r||0;for(var n=0,i=e.length-r;n<i;n++)e[r+n]=e[r+n]^t[n%4];return e},c.generateAccept=function(e){var t=i.createHash("sha1");return t.update(e+c.GUID),t.digest("base64")},c.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var h={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(e){return this._extensions.add(e),!0},parse:function(e){this._reader.put(e);for(var t=!0;t;)switch(this._stage){case 0:(t=this._reader.read(1))&&this._parseOpcode(t[0]);break;case 1:(t=this._reader.read(1))&&this._parseLength(t[0]);break;case 2:(t=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(t);break;case 3:(t=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=t);break;case 4:(t=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(t));break;default:t=null}},text:function(e){return!(this.readyState>1)&&this.frame(e,"text")},binary:function(e){return!(this.readyState>1)&&this.frame(e,"binary")},ping:function(e,t){return!(this.readyState>1)&&(e=e||"",t&&(this._pingCallbacks[e]=t),this.frame(e,"ping"))},pong:function(e){return!(this.readyState>1)&&(e=e||"",this.frame(e,"pong"))},close:function(e,t){return(e=e||"",t=t||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new o.CloseEvent(t,e)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(e,"close",t)},this),!0)},frame:function(e,t,r){if(this.readyState<=0)return this._queue([e,t,r]);if(this.readyState>2)return!1;e instanceof Array&&(e=n.from(e)),"number"==typeof e&&(e=e.toString());var s,a,o=new u,c="string"==typeof e;o.rsv1=o.rsv2=o.rsv3=!1,o.opcode=this.OPCODES[t||(c?"text":"binary")],s=c?n.from(e,"utf8"):e,r&&(a=s,(s=n.allocUnsafe(2+a.length)).writeUInt16BE(r,0),a.copy(s,2)),o.data=s;var h=function(e){var t=new l;t.final=!0,t.rsv1=e.rsv1,t.rsv2=e.rsv2,t.rsv3=e.rsv3,t.opcode=e.opcode,t.masked=!!this._masking,t.length=e.data.length,t.payload=e.data,t.masked&&(t.maskingKey=i.randomBytes(4)),this._sendFrame(t)};return this.MESSAGE_OPCODES.indexOf(o.opcode)>=0?this._extensions.processOutgoingMessage(o,function(e,t){if(e)return this._fail("extension_error",e.message);h.call(this,t)},this):h.call(this,o),!0},_sendFrame:function(e){var t=e.length,r=t<=125?2:t<=65535?4:10,i=r+4*!!e.masked,s=n.allocUnsafe(i+t),a=e.masked?this.MASK:0;s[0]=(e.final?this.FIN:0)|(e.rsv1?this.RSV1:0)|(e.rsv2?this.RSV2:0)|(e.rsv3?this.RSV3:0)|e.opcode,t<=125?s[1]=a|t:t<=65535?(s[1]=126|a,s.writeUInt16BE(t,2)):(s[1]=127|a,s.writeUInt32BE(Math.floor(t/0x100000000),2),s.writeUInt32BE(t%0x100000000,6)),e.payload.copy(s,i),e.masked&&(e.maskingKey.copy(s,r),c.mask(s,e.maskingKey,i)),this._write(s)},_handshakeResponse:function(){var e=this._request.headers["sec-websocket-key"],t=this._request.headers["sec-websocket-version"];if(t!==c.VERSION)throw Error("Unsupported WebSocket version: "+t);if("string"!=typeof e)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",c.generateAccept(e)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var r=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);r&&this._headers.set("Sec-WebSocket-Extensions",r);var i=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return n.from(i.join("\r\n"),"utf8")},_shutdown:function(e,t,r){delete this._frame,delete this._message,this._stage=5;var n=1===this.readyState;this.readyState=2,this._extensions.close(function(){n&&this.frame(t,"close",e),this.readyState=3,r&&this.emit("error",Error(t)),this.emit("close",new o.CloseEvent(e,t))},this)},_fail:function(e,t){this.readyState>1||this._shutdown(this.ERRORS[e],t,!0)},_parseOpcode:function(e){var t=[this.RSV1,this.RSV2,this.RSV3].map(function(t){return(e&t)===t}),r=this._frame=new l;return(r.final=(e&this.FIN)===this.FIN,r.rsv1=t[0],r.rsv2=t[1],r.rsv3=t[2],r.opcode=e&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(r))?0>this.OPCODE_CODES.indexOf(r.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+r.opcode):0>this.MESSAGE_OPCODES.indexOf(r.opcode)&&!r.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+r.opcode):this._message&&this.OPENING_OPCODES.indexOf(r.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+ +!!r.rsv1+", reserved2 = "+ +!!r.rsv2+", reserved3 = "+ +!!r.rsv3)},_parseLength:function(e){var t=this._frame;if(t.masked=(e&this.MASK)===this.MASK,t.length=e&this.LENGTH,t.length>=0&&t.length<=125){if(this._stage=t.masked?3:4,!this._checkFrameLength())return}else this._stage=2,t.lengthBytes=126===t.length?2:8;if(this._requireMasking&&!t.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(e){var t=this._frame;if(t.length=this._readUInt(e),this._stage=t.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(t.opcode)&&t.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+t.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(e){var t,r,n,i,s,a=this._frame,l=a.payload=c.mask(e,a.maskingKey),h=a.opcode;if(delete this._frame,h===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(a)}if((h===this.OPCODES.text||h===this.OPCODES.binary)&&(this._message=new u,this._message.pushFrame(a)),a.final&&this.MESSAGE_OPCODES.indexOf(h)>=0)return this._emitMessage(this._message);h===this.OPCODES.close&&(r=l.length>=2?l.readUInt16BE(0):null,n=l.length>2?this._encode(l.slice(2)):null,0!==l.length&&!(null!==r&&r>=this.MIN_RESERVED_ERROR&&r<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(r)&&(r=this.ERRORS.protocol_error),(l.length>125||l.length>2&&!n)&&(r=this.ERRORS.protocol_error),this._shutdown(r||this.DEFAULT_ERROR_CODE,n||"")),h===this.OPCODES.ping&&(this.frame(l,"pong"),this.emit("ping",new o.PingEvent(l.toString()))),h===this.OPCODES.pong&&(s=(i=this._pingCallbacks)[t=this._encode(l)],delete i[t],s&&s(),this.emit("pong",new o.PongEvent(l.toString())))},_emitMessage:function(e){var e=this._message;e.read(),delete this._message,this._extensions.processIncomingMessage(e,function(e,t){if(e)return this._fail("extension_error",e.message);var r=t.data;if(t.opcode===this.OPCODES.text&&(r=this._encode(r)),null===r)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new o.MessageEvent(r))},this)},_encode:function(e){try{var t=e.toString("binary",0,e.length);if(!this.UTF8_MATCH.test(t))return null}catch(e){}return e.toString("utf8",0,e.length)},_readUInt:function(e){return 2===e.length?e.readUInt16BE(0):0x100000000*e.readUInt32BE(0)+e.readUInt32BE(4)}};for(var d in h)c.prototype[d]=h[d];t.exports=c},89843,(e,t,r)=>{"use strict";var n=e.r(43647).Buffer,i=e.r(88947).Stream,s=e.r(92509),a=e.r(24361),o=e.r(35309),l=e.r(76847),u=e.r(73776),c={"ws:":80,"wss:":443},h=function(e,t,r){this._client=e,this._http=new u("response"),this._origin="object"==typeof e.url?e.url:s.parse(e.url),this._url="object"==typeof t?t:s.parse(t),this._options=r||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new l,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var i=this._url.auth&&n.from(this._url.auth,"utf8").toString("base64");i&&this._headers.set("Proxy-Authorization","Basic "+i)};a.inherits(h,i);var d={setHeader:function(e,t){return 0===this._state&&(this._headers.set(e,t),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var e=this._origin,t=e.port||c[e.protocol],r=["CONNECT "+e.hostname+":"+t+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",n.from(r.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(e){if(!this.writable)return!1;if(this._http.parse(e),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new o.ConnectEvent);else{var t="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(t))}return this.end(),!this._paused},end:function(e){this.writable&&(void 0!==e&&this.write(e),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var f in d)h.prototype[f]=d[f];t.exports=h},10406,(e,t,r)=>{"use strict";var n=e.r(43647).Buffer,i=e.r(54799),s=e.r(92509),a=e.r(24361),o=e.r(73776),l=e.r(35309),u=e.r(92620),c=e.r(89843),h=function(e,t){this.version="hybi-"+u.VERSION,u.call(this,null,e,t),this.readyState=-1,this._key=h.generateKey(),this._accept=u.generateAccept(this._key),this._http=new o("response");var r=s.parse(this.url),i=r.auth&&n.from(r.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(r.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(r.pathname||"/")+(r.search||""),this._headers.set("Host",r.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",u.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),i&&this._headers.set("Authorization","Basic "+i)};a.inherits(h,u),h.generateKey=function(){return i.randomBytes(16).toString("base64")};var d={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(e,t){return new c(this,e,t)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(e){return 3===this.readyState?void 0:this.readyState>0?u.prototype.parse.call(this,e):(this._http.parse(e),this._http.isComplete())?void(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body))):void 0},_handshakeRequest:function(){var e=this._extensions.generateOffer();e&&this._headers.set("Sec-WebSocket-Extensions",e);var t=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return n.from(t.join("\r\n"),"utf8")},_failHandshake:function(e){e="Error during WebSocket handshake: "+e,this.readyState=3,this.emit("error",Error(e)),this.emit("close",new l.CloseEvent(this.ERRORS.protocol_error,e))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var e=this._http.headers,t=e.upgrade||"",r=e.connection||"",n=e["sec-websocket-accept"]||"",i=e["sec-websocket-protocol"]||"";if(""===t)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==t.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===r)return this._failHandshake("'Connection' header is missing");if("upgrade"!==r.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(n!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==i)if(0>this._protocols.indexOf(i))return this._failHandshake("Sec-WebSocket-Protocol mismatch");else this.protocol=i;try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(e){return this._failHandshake(e.message)}}};for(var f in d)h.prototype[f]=d[f];t.exports=h},86838,(e,t,r)=>{"use strict";var n=e.r(43647).Buffer,i=e.r(35309),s=e.r(24361),a=function(e,t,r){i.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};s.inherits(a,i);var o={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new i.CloseEvent(null,null)),!0)},parse:function(e){this.readyState>1||(this._reader.put(e),this._reader.eachByte(function(e){var t;switch(this._stage){case -1:this._body.push(e),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:if(this._length=(127&e)+128*this._length,this._closing&&0===this._length)return this.close();(128&e)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===e)this._stage=0,t=n.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new i.MessageEvent(t));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(e),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(e){if(0===this.readyState)return this._queue([e]);if(this.readyState>1)return!1;"string"!=typeof e&&(e=e.toString());var t=n.byteLength(e),r=n.allocUnsafe(t+2);return r[0]=0,r.write(e,1),r[r.length-1]=255,this._write(r),!0},_handshakeResponse:function(){var e=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return n.from(e.join("\r\n"),"utf8")},_parseLeadingByte:function(e){(128&e)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var l in o)a.prototype[l]=o[l];t.exports=a},74712,(e,t,r)=>{"use strict";var n=e.r(43647).Buffer,i=e.r(35309),s=e.r(86838),a=e.r(54799),o=e.r(24361),l=function(e){return parseInt((e.match(/[0-9]/g)||[]).join(""),10)},u=function(e){return(e.match(/ /g)||[]).length},c=function(e,t,r){s.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};o.inherits(c,s);var h={BODY_SIZE:8,start:function(){return!!s.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(n.from([255,0])),this.readyState=3,this.emit("close",new i.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var e=this._request.headers,t=e["sec-websocket-key1"],r=e["sec-websocket-key2"];if(!t)throw Error("Missing required header: Sec-WebSocket-Key1");if(!r)throw Error("Missing required header: Sec-WebSocket-Key2");var i=l(t),s=u(t),a=l(r),o=u(r);if(i%s!=0||a%o!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[i/s,a/o];var e=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return n.from(e.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var e=a.createHash("md5"),t=n.allocUnsafe(8+this.BODY_SIZE);return t.writeUInt32BE(this._keyValues[0],0),t.writeUInt32BE(this._keyValues[1],4),n.from(this._body).copy(t,8,0,this.BODY_SIZE),e.update(t),n.from(e.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var e=this._handshakeSignature();e&&(this._write(e),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(e){if(255!==e)return s.prototype._parseLeadingByte.call(this,e);this._closing=!0,this._length=0,this._stage=1}};for(var d in h)c.prototype[d]=h[d];t.exports=c},61392,(e,t,r)=>{"use strict";var n=e.r(24361),i=e.r(73776),s=e.r(35309),a=e.r(86838),o=e.r(74712),l=e.r(92620),u=function(e){s.call(this,null,null,e),this._http=new i("request")};n.inherits(u,s);var c={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(e){if(this._delegate)return this._delegate.parse(e);if(this._http.parse(e),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var t=this;this._delegate=u.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(e){this._delegate.on(e,function(r){t.emit(e,r)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new s.ConnectEvent)}},_open:function(){this.__queue.forEach(function(e){this._delegate[e[0]].apply(this._delegate,e[1])},this),this.__queue=[]}};for(var h in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(e){c[e]=function(){return this._delegate?this._delegate[e].apply(this._delegate,arguments):(this.__queue.push([e,arguments]),!0)}}),c)u.prototype[h]=c[h];u.isSecureRequest=function(e){if(e.connection&&void 0!==e.connection.authorized||e.socket&&e.socket.secure)return!0;var t=e.headers;return!!t&&("on"===t.https||"on"===t["x-forwarded-ssl"]||"https"===t["x-forwarded-scheme"]||"https"===t["x-forwarded-proto"])},u.determineUrl=function(e){return(this.isSecureRequest(e)?"wss:":"ws:")+"//"+e.headers.host+e.url},u.http=function(e,t){void 0===(t=t||{}).requireMasking&&(t.requireMasking=!0);var r=e.headers,n=r["sec-websocket-version"],i=r["sec-websocket-key"],s=r["sec-websocket-key1"],u=r["sec-websocket-key2"],c=this.determineUrl(e);return n||i?new l(e,c,t):s||u?new o(e,c,t):new a(e,c,t)},t.exports=u},34149,(e,t,r)=>{"use strict";var n=e.r(35309),i=e.r(10406),s=e.r(61392);t.exports={client:function(e,t){return void 0===(t=t||{}).masking&&(t.masking=!0),new i(e,t)},server:function(e){return void 0===(e=e||{}).requireMasking&&(e.requireMasking=!0),new s(e)},http:function(){return s.http.apply(s,arguments)},isSecureRequest:function(e){return s.isSecureRequest(e)},isWebSocket:function(e){return n.isWebSocket(e)},validateOptions:function(e,t){n.validateOptions(e,t)}}},21600,(e,t,r)=>{"use strict";var n=function(e,t){for(var r in this.type=e,t)this[r]=t[r]};n.prototype.initEvent=function(e,t,r){this.type=e,this.bubbles=t,this.cancelable=r},n.prototype.stopPropagation=function(){},n.prototype.preventDefault=function(){},n.CAPTURING_PHASE=1,n.AT_TARGET=2,n.BUBBLING_PHASE=3,t.exports=n},49909,(e,t,r)=>{"use strict";var n=e.r(21600);t.exports={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(e,t,r){this.on(e,t)},removeEventListener:function(e,t,r){this.removeListener(e,t)},dispatchEvent:function(e){e.target=e.currentTarget=this,e.eventPhase=n.AT_TARGET,this["on"+e.type]&&this["on"+e.type](e),this.emit(e.type,e)}}},26595,(e,t,r)=>{"use strict";var n=e.r(88947).Stream,i=e.r(24361),s=e.r(34149),a=e.r(49909),o=e.r(21600),l=function(e){e=e||{},s.validateOptions(e,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var t=e.headers;if(t)for(var r in t)this._driver.setHeader(r,t[r]);var n=e.extensions;n&&[].concat(n).forEach(this._driver.addExtension,this._driver),this._ping=e.ping,this._pingId=0,this.readyState=l.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var i=this;this._driver.on("open",function(e){i._open()}),this._driver.on("message",function(e){i._receiveMessage(e.data)}),this._driver.on("close",function(e){i._beginClose(e.reason,e.code)}),this._driver.on("error",function(e){i._emitError(e.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i._pingId+=1,i.ping(i._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};i.inherits(l,n),l.CONNECTING=0,l.OPEN=1,l.CLOSING=2,l.CLOSED=3,l.CLOSE_TIMEOUT=3e4;var u={write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.send(e),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(e){return!(this.readyState>l.OPEN)&&(e instanceof Buffer||(e=String(e)),this._driver.messages.write(e))},ping:function(e,t){return!(this.readyState>l.OPEN)&&this._driver.ping(e,t)},close:function(e,t){if(void 0===e&&(e=1e3),void 0===t&&(t=""),1e3!==e&&(e<3e3||e>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+e+" is neither.");if(this.readyState<l.CLOSING){var r=this;this._closeTimer=setTimeout(function(){r._beginClose("",1006)},l.CLOSE_TIMEOUT)}this.readyState!==l.CLOSED&&(this.readyState=l.CLOSING),this._driver.close(t,e)},_configureStream:function(){var e=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(t){this._stream.on(t,function(){e._finalizeClose()})},this),this._stream.on("error",function(t){e._emitError("Network error: "+e.url+": "+t.message),e._finalizeClose()})},_open:function(){if(this.readyState===l.CONNECTING){this.readyState=l.OPEN,this.protocol=this._driver.protocol||"";var e=new o("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},_receiveMessage:function(e){if(this.readyState>l.OPEN)return!1;this.readable&&this.emit("data",e);var t=new o("message",{data:e});t.initEvent("message",!1,!1),this.dispatchEvent(t)},_emitError:function(e){if(!(this.readyState>=l.CLOSING)){var t=new o("error",{message:e});t.initEvent("error",!1,!1),this.dispatchEvent(t)}},_beginClose:function(e,t){this.readyState!==l.CLOSED&&(this.readyState=l.CLOSING,this._closeParams=[e,t],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==l.CLOSED){this.readyState=l.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var e=this._closeParams?this._closeParams[0]:"",t=this._closeParams?this._closeParams[1]:1006,r=new o("close",{code:t,reason:e});r.initEvent("close",!1,!1),this.dispatchEvent(r)}}};for(var c in u)l.prototype[c]=u[c];for(var h in a)l.prototype[h]=a[h];t.exports=l},31117,(e,t,r)=>{"use strict";var n=e.r(24361),i=e.r(4446),s=e.r(55004),a=e.r(92509),o=e.r(34149),l=e.r(26595);e.r(21600);var u={"http:":80,"https:":443,"ws:":80,"wss:":443},c=["https:","wss:"],h=function(e,t,r){r=r||{},this.url=e,this._driver=o.client(this.url,{maxLength:r.maxLength,protocols:t}),["open","error"].forEach(function(e){this._driver.on(e,function(){v.headers=v._driver.headers,v.statusCode=v._driver.statusCode})},this);var n=r.proxy||{},h=a.parse(n.origin||this.url),d=h.port||u[h.protocol],f=c.indexOf(h.protocol)>=0,p=function(){v._onConnect()},g=r.net||{},m=r.tls||{},y=n.origin?n.tls||{}:m,v=this;g.host=y.host=h.hostname,g.port=y.port=d,m.ca=m.ca||r.ca,y.servername=y.servername||h.hostname,this._stream=f?s.connect(y,p):i.connect(g,p),n.origin&&this._configureProxy(n,m),l.call(this,r)};n.inherits(h,l),h.prototype._onConnect=function(){(this._proxy||this._driver).start()},h.prototype._configureProxy=function(e,t){var r,n=a.parse(this.url),i=c.indexOf(n.protocol)>=0,o=this;if(this._proxy=this._driver.proxy(e.origin),e.headers)for(r in e.headers)this._proxy.setHeader(r,e.headers[r]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(i){var e={socket:o._stream,servername:n.hostname};for(r in t)e[r]=t[r];o._stream=s.connect(e),o._configureStream()}o._driver.io.pipe(o._stream),o._stream.pipe(o._driver.io),o._driver.start()}),this._proxy.on("error",function(e){o._driver.emit("error",e)})},t.exports=h},43506,(e,t,r)=>{"use strict";var n=e.r(88947).Stream,i=e.r(24361),s=e.r(34149),a=e.r(76847),o=e.r(26595),l=e.r(49909),u=e.r(21600),c=function(e,t,r){this.writable=!0,r=r||{},this._stream=t.socket,this._ping=r.ping||this.DEFAULT_PING,this._retry=r.retry||this.DEFAULT_RETRY;var n=s.isSecureRequest(e)?"https:":"http:";this.url=n+"//"+e.headers.host+e.url,this.lastEventId=e.headers["last-event-id"]||"",this.readyState=o.CONNECTING;var i=new a,l=this;if(r.headers)for(var u in r.headers)i.set(u,r.headers[u]);if(this._stream&&this._stream.writable){process.nextTick(function(){l._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var c="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+i.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(c),this._stream.on("drain",function(){l.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){l.ping()},1e3*this._ping)),["error","end"].forEach(function(e){l._stream.on(e,function(){l.close()})})}};i.inherits(c,n),c.isEventSource=function(e){return"GET"===e.method&&(e.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var h={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(e){if(!this.writable)return!1;try{return this._stream.write(e,"utf8")}catch(e){return!1}},_open:function(){if(this.readyState===o.CONNECTING){this.readyState=o.OPEN;var e=new u("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.write(e),this.close()},send:function(e,t){if(this.readyState>o.OPEN)return!1;e=String(e).replace(/(\r\n|\r|\n)/g,"$1data: ");var r="";return(t=t||{}).event&&(r+="event: "+t.event+"\r\n"),t.id&&(r+="id: "+t.id+"\r\n"),r+="data: "+e+"\r\n\r\n",this._write(r)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>o.OPEN)return!1;this.readyState=o.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var e=new u("close");return e.initEvent("close",!1,!1),this.dispatchEvent(e),!0}};for(var d in h)c.prototype[d]=h[d];for(var f in l)c.prototype[f]=l[f];t.exports=c},79508,(e,t,r)=>{"use strict";var n=e.r(24361),i=e.r(34149),s=e.r(26595),a=function(e,t,r,n,a){a=a||{},this._stream=t,this._driver=i.http(e,{maxLength:a.maxLength,protocols:n});var o=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var l=function(){o._stream.removeListener("data",l)};this._stream.on("data",l),s.call(this,a),process.nextTick(function(){o._driver.start(),o._driver.io.write(r)})}};n.inherits(a,s),a.isWebSocket=function(e){return i.isWebSocket(e)},a.validateOptions=function(e,t){i.validateOptions(e,t)},a.WebSocket=a,a.Client=e.r(31117),a.EventSource=e.r(43506),t.exports=a},12366,e=>{"use strict";let t,r,n,i,s,a,o,l,u,c,h,d;var f,p,g,m,y,v,_=e.i(82936),b=e.i(33279),S=e.i(10683),C=e.i(66546),w=e.i(38755),T=e.i(5834),E=e.i(16507),k=e.i(83496),I=e.i(95571),R=e.i(75223),x=e.i(37845),D=e.i(52226),O=e.i(61497),A=e.i(42298),N=e.i(15575),P=e.i(93695);e.i(24636);var M=e.i(95426);let L=()=>void 0,F={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},B=function(e,t){if(!e)throw j(t)},j=function(e){return Error("Firebase Database ("+F.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},q=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},U=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},V={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(h=64)),n.push(r[u],r[c],r[h],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(q(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):U(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new z;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class z extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let H=function(e){let t=q(e);return V.encodeByteArray(t,!0)},W=function(e){return H(e).replace(/\./g,"")},$=function(e){try{return V.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function K(e){return G(void 0,e)}function G(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(let r in t)t.hasOwnProperty(r)&&Q(r)&&(e[r]=G(e[r],t[r]));return e}function Q(e){return"__proto__"!==e}function Y(){return"u">typeof self?self:e.g}let J=()=>Y().__FIREBASE_DEFAULTS__,X=()=>{if("u"<typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},Z=()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&$(e[1]);return t&&JSON.parse(t)},ee=()=>{try{return L()||J()||X()||Z()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},et=e=>ee()?.emulatorHosts?.[e],er=e=>{let t=et(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},en=()=>ee()?.config;class ei{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function es(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ea(e){return(await fetch(e,{credentials:"include"})).ok}function eo(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r={alg:"none",type:"JWT"},n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e},o="";return[W(JSON.stringify(r)),W(JSON.stringify(a)),o].join(".")}function el(e,t){}function eu(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function ec(){return!1}function eh(){let t=ee()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function ed(){return ef()}function ef(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function ep(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function eg(){return!0===F.NODE_CLIENT||!0===F.NODE_ADMIN}function em(){return!eh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ey(){return!eh()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function ev(){try{return"object"==typeof indexedDB}catch(e){return!1}}function e_(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}})}let eb="FirebaseError";class eS extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=eb,Object.setPrototypeOf(this,eS.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,eC.prototype.create)}}class eC{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?ew(i,r):"Error",a=`${this.serviceName}: ${s} (${n}).`;return new eS(n,a,r)}}function ew(e,t){return e.replace(eT,(e,r)=>{let n=t[r];return null!=n?String(n):`<${r}?>`})}let eT=/\{\$([^}]+)}/g;function eE(e){return JSON.parse(e)}function ek(e){return JSON.stringify(e)}let eI=function(e){let t={},r={},n={},i="";try{let s=e.split(".");t=eE($(s[0])||""),r=eE($(s[1])||""),i=s[2],n=r.d||{},delete r.d}catch(e){}return{header:t,claims:r,data:n,signature:i}},eR=function(e){let t=eI(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},ex=function(e){let t=eI(e).claims;return"object"==typeof t&&!0===t.admin};function eD(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eO(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function eA(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function eN(e,t,r){let n={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=t.call(r,e[i],i,e));return n}function eP(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(eM(r)&&eM(s)){if(!eP(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function eM(e){return null!==e&&"object"==typeof e}function eL(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}class eF{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let r,n;t||(t=0);let i=this.W_;if("string"==typeof e)for(let r=0;r<16;r++)i[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let r=0;r<16;r++)i[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=i[e-3]^i[e-8]^i[e-14]^i[e-16];i[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],a=this.chain_[1],o=this.chain_[2],l=this.chain_[3],u=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(r=l^a&(o^l),n=0x5a827999):(r=a^o^l,n=0x6ed9eba1):e<60?(r=a&o|l&(a|o),n=0x8f1bbcdc):(r=a^o^l,n=0xca62c1d6);let t=(s<<5|s>>>27)+r+u+n+i[e]|0;u=l,l=o,o=(a<<30|a>>>2)&0xffffffff,a=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+a|0,this.chain_[2]=this.chain_[2]+o|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+u|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let r=t-this.blockSize,n=0,i=this.buf_,s=this.inbuf_;for(;n<t;){if(0===s)for(;n<=r;)this.compress_(e,n),n+=this.blockSize;if("string"==typeof e){for(;n<t;)if(i[s]=e.charCodeAt(n),++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}else for(;n<t;)if(i[s]=e[n],++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let r=0;for(let t=0;t<5;t++)for(let n=24;n>=0;n-=8)e[r]=this.chain_[t]>>n&255,++r;return e}}function eB(e,t){return`${e} failed: ${t} argument `}let ej=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);if(i>=55296&&i<=56319){let t=i-55296;B(++n<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(n)-56320)}i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},eq=function(e){let t=0;for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,r++):t+=3}return t};function eU(e){return e&&e._delegate?e._delegate:e}F.NODE_CLIENT=!0;class eV{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ez="[DEFAULT]";class eH{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new ei;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(e$(e))try{this.getOrInitializeService({instanceIdentifier:ez})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=ez){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ez){return this.instances.has(e)}getOptions(e=ez){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:eW(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ez){return this.component?this.component.multipleInstances?e:ez:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function eW(e){return e===ez?void 0:e}function e$(e){return"EAGER"===e.instantiationMode}class eK{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eH(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let eG=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(f||(f={}));let eQ={debug:f.DEBUG,verbose:f.VERBOSE,info:f.INFO,warn:f.WARN,error:f.ERROR,silent:f.SILENT},eY=f.INFO,eJ={[f.DEBUG]:"log",[f.VERBOSE]:"log",[f.INFO]:"info",[f.WARN]:"warn",[f.ERROR]:"error"},eX=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=eJ[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eZ{constructor(e){this.name=e,this._logLevel=eY,this._logHandler=eX,this._userLogHandler=null,eG.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in f))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eQ[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,f.DEBUG,...e),this._logHandler(this,f.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,f.VERBOSE,...e),this._logHandler(this,f.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,f.INFO,...e),this._logHandler(this,f.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,f.WARN,...e),this._logHandler(this,f.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,f.ERROR,...e),this._logHandler(this,f.ERROR,...e)}}function e0(e){eG.forEach(t=>{t.setLogLevel(e)})}function e1(e,t){for(let r of eG){let n=null;t&&t.level&&(n=eQ[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:f[r].toLowerCase(),message:s,args:i,type:t.name})}}}let e2=(e,t)=>t.some(t=>e instanceof t);function e3(){return t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function e6(){return r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let e4=new WeakMap,e5=new WeakMap,e8=new WeakMap,e9=new WeakMap,e7=new WeakMap;function te(e){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(ta(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&e4.set(t,e)}).catch(()=>{}),e7.set(t,e),t}function tt(e){if(e5.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});e5.set(e,t)}let tr={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return e5.get(e);if("objectStoreNames"===t)return e.objectStoreNames||e8.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return ta(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function tn(e){tr=e(tr)}function ti(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?e6().includes(e)?function(...t){return e.apply(to(this),t),ta(e4.get(this))}:function(...t){return ta(e.apply(to(this),t))}:function(t,...r){let n=e.call(to(this),t,...r);return e8.set(n,t.sort?t.sort():[t]),ta(n)}}function ts(e){return"function"==typeof e?ti(e):(e instanceof IDBTransaction&&tt(e),e2(e,e3()))?new Proxy(e,tr):e}function ta(e){if(e instanceof IDBRequest)return te(e);if(e9.has(e))return e9.get(e);let t=ts(e);return t!==e&&(e9.set(e,t),e7.set(t,e)),t}let to=e=>e7.get(e);function tl(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=ta(a);return n&&a.addEventListener("upgradeneeded",e=>{n(ta(a.result),e.oldVersion,e.newVersion,ta(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let tu=["get","getKey","getAll","getAllKeys","count"],tc=["put","add","delete","clear"],th=new Map;function td(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(th.get(t))return th.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=tc.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||tu.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return th.set(t,s),s}tn(e=>({...e,get:(t,r,n)=>td(t,r)||e.get(t,r,n),has:(t,r)=>!!td(t,r)||e.has(t,r)}));class tf{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!tp(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}function tp(e){let t=e.getComponent();return t?.type==="VERSION"}let tg="@firebase/app",tm="0.14.7",ty=new eZ("@firebase/app"),tv="12.8.0",t_="[DEFAULT]",tb={[tg]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},tS=new Map,tC=new Map,tw=new Map;function tT(e,t){try{e.container.addComponent(t)}catch(r){ty.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function tE(e,t){e.container.addOrOverwriteComponent(t)}function tk(e){let t=e.name;if(tw.has(t))return ty.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(tw.set(t,e),tS.values()))tT(r,e);for(let t of tC.values())tT(t,e);return!0}function tI(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function tR(e,t,r=t_){tI(e,t).clearInstance(r)}function tx(e){return void 0!==e.options}function tD(e){return!tx(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function tO(e){return null!=e&&void 0!==e.settings}function tA(){tw.clear()}let tN=new eC("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class tP{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new eV("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tN.create("app-deleted",{appName:this._name})}}function tM(e,t){let r=$(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class tL extends tP{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&tM(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&tM(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,tz(tg,tm,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){tV(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw tN.create("server-app-deleted")}}let tF=tv;function tB(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:t_,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw tN.create("bad-app-name",{appName:String(i)});if(r||(r=en()),!r)throw tN.create("no-options");let s=tS.get(i);if(s)if(eP(r,s.options)&&eP(n,s.config))return s;else throw tN.create("duplicate-app",{appName:i});let a=new eK(i);for(let e of tw.values())a.addComponent(e);let o=new tP(r,n,a);return tS.set(i,o),o}function tj(e,t={}){let r;if(ed()&&!ef())throw tN.create("invalid-server-app-environment");let n=t||{};if(e&&(tx(e)?r=e.options:tD(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=en()),!r)throw tN.create("no-options");let i={...n,...r};void 0!==i.releaseOnDeref&&delete i.releaseOnDeref;let s=e=>[...e].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0);if(void 0!==n.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw tN.create("finalization-registry-not-supported",{});let a=""+s(JSON.stringify(i)),o=tC.get(a);if(o)return o.incRefCount(n.releaseOnDeref),o;let l=new eK(a);for(let e of tw.values())l.addComponent(e);let u=new tL(r,n,a,l);return tC.set(a,u),u}function tq(e=t_){let t=tS.get(e);if(!t&&e===t_&&en())return tB();if(!t)throw tN.create("no-app",{appName:e});return t}function tU(){return Array.from(tS.values())}async function tV(e){let t=!1,r=e.name;tS.has(r)?(t=!0,tS.delete(r)):tC.has(r)&&0>=e.decRefCount()&&(tC.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tz(e,t,r){let n=tb[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ty.warn(e.join(" "));return}tk(new eV(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function tH(e,t){if(null!==e&&"function"!=typeof e)throw tN.create("invalid-log-argument");e1(e,t)}function tW(e){e0(e)}let t$="firebase-heartbeat-database",tK=1,tG="firebase-heartbeat-store",tQ=null;function tY(){return tQ||(tQ=tl(t$,tK,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tG)}catch(e){console.warn(e)}}}).catch(e=>{throw tN.create("idb-open",{originalErrorMessage:e.message})})),tQ}async function tJ(e){try{let t=(await tY()).transaction(tG),r=await t.objectStore(tG).get(tZ(e));return await t.done,r}catch(e){if(e instanceof eS)ty.warn(e.message);else{let t=tN.create("idb-get",{originalErrorMessage:e?.message});ty.warn(t.message)}}}async function tX(e,t){try{let r=(await tY()).transaction(tG,"readwrite"),n=r.objectStore(tG);await n.put(t,tZ(e)),await r.done}catch(e){if(e instanceof eS)ty.warn(e.message);else{let t=tN.create("idb-set",{originalErrorMessage:e?.message});ty.warn(t.message)}}}function tZ(e){return`${e.name}!${e.options.appId}`}let t0=1024,t1=30;class t2{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new t4(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=t3();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>t1){let e=t8(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ty.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=t3(),{heartbeatsToSend:t,unsentEntries:r}=t6(this._heartbeatsCache.heartbeats),n=W(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return ty.warn(e),""}}}function t3(){return new Date().toISOString().substring(0,10)}function t6(e,t=t0){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),t5(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),t5(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class t4{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!ev()&&e_().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tJ(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tX(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tX(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function t5(e){return W(JSON.stringify({version:2,heartbeats:e})).length}function t8(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(function(e){tk(new eV("platform-logger",e=>new tf(e),"PRIVATE")),tk(new eV("heartbeat",e=>new t2(e),"PRIVATE")),tz(tg,tm,""),tz(tg,tm,"esm2020"),tz("fire-js","")})(""),e.s(["SDK_VERSION",()=>tF,"_DEFAULT_ENTRY_NAME",()=>t_,"_addComponent",()=>tT,"_addOrOverwriteComponent",()=>tE,"_apps",()=>tS,"_clearComponents",()=>tA,"_components",()=>tw,"_getProvider",()=>tI,"_isFirebaseApp",()=>tx,"_isFirebaseServerApp",()=>tO,"_isFirebaseServerAppSettings",()=>tD,"_registerComponent",()=>tk,"_removeServiceInstance",()=>tR,"_serverApps",()=>tC,"deleteApp",()=>tV,"getApp",()=>tq,"getApps",()=>tU,"initializeApp",()=>tB,"initializeServerApp",()=>tj,"onLog",()=>tH,"registerVersion",()=>tz,"setLogLevel",()=>tW],67527),tz("firebase","12.8.0","app"),e.i(67527);var t9="u">typeof globalThis?globalThis:e.g,t7={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function t(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function r(e,t){var r=s;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=t(e)}function n(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}(function(e,t){function r(){}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}})(e,function(){this.blockSize=-1}),e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,r){void 0===r&&(r=e.length);let n=r-this.blockSize,i=this.C,s=this.h,a=0;for(;a<r;){if(0==s)for(;a<=n;)t(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<r;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){t(this,i),s=0;break}}else for(;a<r;)if(i[s++]=e[a++],s==this.blockSize){t(this,i),s=0;break}}this.h=s,this.o+=r},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var i,s={};function a(e){return -128<=e&&e<128?r(e,function(e){return new n([0|e],e<0?-1:0)}):new n([0|e],e<0?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return u;if(e<0)return m(o(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new n(t,0)}function l(e,t){if(0==e.length)throw Error("number format error: empty string");if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return m(l(e.substring(1),t));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=o(Math.pow(t,8)),n=u;for(let s=0;s<e.length;s+=8){var i=Math.min(8,e.length-s);let a=parseInt(e.substring(s,s+i),t);i<8?(i=o(Math.pow(t,i)),n=n.j(i).add(o(a))):n=(n=n.j(r)).add(o(a))}return n}var u=a(0),c=a(1),h=a(0x1000000);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function m(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new n(r,~e.h).add(c)}function y(e,t){return e.add(m(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function _(e,t){this.g=e,this.h=t}function b(e,t){if(d(t))throw Error("division by zero");if(d(e))return new _(u,u);if(f(e))return t=b(m(e),t),new _(m(t.g),m(t.h));if(f(t))return t=b(e,m(t)),new _(m(t.g),t.h);if(e.g.length>30){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var r=c,n=t;0>=n.l(e);)r=S(r),n=S(n);var i=C(r,1),s=C(n,1);for(n=C(n,2),r=C(r,2);!d(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=C(n,1),r=C(r,1)}return t=y(e,i.j(t)),new _(i,t)}for(i=u;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=o(r)).j(t);f(a)||a.l(e)>0;)r-=n,a=(s=o(r)).j(t);d(s)&&(s=c),i=i.add(s),e=y(e,a)}return new _(i,e)}function S(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new n(r,e.h)}function C(e,t){let r=t>>5;t%=32;let i=e.g.length-r,s=[];for(let n=0;n<i;n++)s[n]=t>0?e.i(n+r)>>>t|e.i(n+r+1)<<32-t:e.i(n+r);return new n(s,e.h)}(i=n.prototype).m=function(){if(f(this))return-m(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},i.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+m(this).toString(e);let t=o(Math.pow(e,6));var r=this;let n="";for(;;){let i=b(r,t).g,s=(((r=y(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(d(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},i.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},i.l=function(e){return f(e=y(this,e))?-1:+!d(e)},i.abs=function(){return f(this)?m(this):this},i.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],i=0;for(let n=0;n<=t;n++){let t=i+(65535&this.i(n))+(65535&e.i(n)),s=(t>>>16)+(this.i(n)>>>16)+(e.i(n)>>>16);i=s>>>16,t&=65535,s&=65535,r[n]=s<<16|t}return new n(r,-0x80000000&r[r.length-1]?-1:0)},i.j=function(e){if(d(this)||d(e))return u;if(f(this))return f(e)?m(this).j(m(e)):m(m(this).j(e));if(f(e))return m(this.j(m(e)));if(0>this.l(h)&&0>e.l(h))return o(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var i=0;i<2*t;i++)r[i]=0;for(i=0;i<this.g.length;i++)for(let t=0;t<e.g.length;t++){let n=this.i(i)>>>16,s=65535&this.i(i),a=e.i(t)>>>16,o=65535&e.i(t);r[2*i+2*t]+=s*o,v(r,2*i+2*t),r[2*i+2*t+1]+=n*o,v(r,2*i+2*t+1),r[2*i+2*t+1]+=s*a,v(r,2*i+2*t+1),r[2*i+2*t+2]+=n*a,v(r,2*i+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new n(r,0)},i.B=function(e){return b(this,e).h},i.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new n(r,this.h&e.h)},i.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new n(r,this.h|e.h)},i.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new n(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,g=t7.Md5=e,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.B,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=o,n.fromString=l,p=t7.Integer=n}).apply(void 0!==t9?t9:"u">typeof self?self:{});var re=e.i(24361),rt=e.i(54799),rr=e.i(18807),rn=e.i(32521);class ri{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ri.UNAUTHENTICATED=new ri(null),ri.GOOGLE_CREDENTIALS=new ri("google-credentials-uid"),ri.FIRST_PARTY=new ri("first-party-uid"),ri.MOCK_USER=new ri("mock-user");let rs="12.8.0";function ra(e){rs=e}function ro(e){return(0,re.inspect)(e,{depth:100})}let rl=new eZ("@firebase/firestore");function ru(){return rl.logLevel}function rc(e,...t){if(rl.logLevel<=f.DEBUG){let r=t.map(rf);rl.debug(`Firestore (${rs}): ${e}`,...r)}}function rh(e,...t){if(rl.logLevel<=f.ERROR){let r=t.map(rf);rl.error(`Firestore (${rs}): ${e}`,...r)}}function rd(e,...t){if(rl.logLevel<=f.WARN){let r=t.map(rf);rl.warn(`Firestore (${rs}): ${e}`,...r)}}function rf(e){if("string"==typeof e)return e;try{return ro(e)}catch(t){return e}}function rp(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,rg(e,n,r)}function rg(e,t,r){let n=`FIRESTORE (${rs}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{let e=JSON.stringify(r);n+=" CONTEXT: "+e}catch(e){n+=" CONTEXT: "+r}throw rh(n),Error(n)}function rm(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||rg(t,i,n)}function ry(e,t){return e}let rv="ok",r_="cancelled",rb="unknown",rS="invalid-argument",rC="deadline-exceeded",rw="not-found",rT="already-exists",rE="permission-denied",rk="unauthenticated",rI="resource-exhausted",rR="failed-precondition",rx="aborted",rD="out-of-range",rO="unimplemented",rA="internal",rN="unavailable",rP="data-loss";class rM extends eS{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class rL{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class rF{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rB{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ri.UNAUTHENTICATED))}shutdown(){}}class rj{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class rq{constructor(e){this.authProvider=e,this.currentUser=ri.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){rm(void 0===this.tokenListener,42304);let r=this.tokenCounter,n=e=>this.tokenCounter!==r?(r=this.tokenCounter,t(e)):Promise.resolve(),i=new rL;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new rL,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{rc("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),s())};this.authProvider.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.authProvider.getImmediate({optional:!0});e?a(e):(rc("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new rL)}},0),s()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(rc("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(rm("string"==typeof t.accessToken,31837,{tokenData:t}),new rF(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return rm(null===e||"string"==typeof e,2055,{currentUid:e}),new ri(e)}}class rU{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=ri.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class rV{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new rU(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(ri.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rz{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rH{constructor(e,t){this.appCheckProvider=t,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,tO(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken)}start(e,t){rm(void 0===this.tokenListener,3512);let r=e=>{null!=e.error&&rc("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,rc("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{rc("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.appCheckProvider.getImmediate({optional:!0});e?n(e):rc("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new rz(this.serverAppAppCheckToken));let e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(rm("string"==typeof e.token,44558,{tokenResult:e}),this.latestAppCheckToken=e.token,new rz(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function rW(e){if(!e)return new rB;switch(e.type){case"firstParty":return new rV(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new rM(rS,"makeAuthCredentialsProvider failed due to invalid credential type")}}function r$(e){return(0,rt.randomBytes)(e)}class rK{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",n=20;for(;r.length<n;){let i=r$(40);for(let s=0;s<i.length;++s)r.length<n&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function rG(e,t){return e<t?-1:+(e>t)}function rQ(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return rX(r)===rX(i)?rG(r,i):rX(r)?1:-1}return rG(e.length,t.length)}let rY=55296,rJ=57343;function rX(e){let t=e.charCodeAt(0);return t>=rY&&t<=rJ}function rZ(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}function r0(e){return e+"\0"}let r1="__name__";class r2{constructor(e,t,r){void 0===t?t=0:t>e.length&&rp(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&rp(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===r2.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r2?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=r2.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return rG(e.length,t.length)}static compareSegments(e,t){let r=r2.isNumericId(e),n=r2.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?r2.extractNumericId(e).compare(r2.extractNumericId(t)):rQ(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return p.fromString(e.substring(4,e.length-2))}}class r3 extends r2{construct(e,t,r){return new r3(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new rM(rS,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new r3(t)}static emptyPath(){return new r3([])}}let r6=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class r4 extends r2{construct(e,t,r){return new r4(e,t,r)}static isValidIdentifier(e){return r6.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r4.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===r1}static keyField(){return new r4([r1])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new rM(rS,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new rM(rS,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new rM(rS,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new rM(rS,"Unterminated ` in path: "+e);return new r4(t)}static emptyPath(){return new r4([])}}class r5{constructor(e){this.path=e}static fromPath(e){return new r5(r3.fromString(e))}static fromName(e){return new r5(r3.fromString(e).popFirst(5))}static empty(){return new r5(r3.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===r3.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return r3.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r5(new r3(e.slice()))}}function r8(e,t,r){if(!r)throw new rM(rS,`Function ${e}() cannot be called with an empty ${t}.`)}function r9(e,t,r,n){if(!0===t&&!0===n)throw new rM(rS,`${e} and ${r} cannot be used together.`)}function r7(e){if(!r5.isDocumentKey(e))throw new rM(rS,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ne(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function nt(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e)if(e instanceof Array)return"an array";else{let t=nr(e);return t?`a custom ${t} object`:"an object"}else if("function"==typeof e)return"a function";else return rp(12329,{type:typeof e})}function nr(e){return e.constructor?e.constructor.name:null}function nn(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t))if(t.name===e.constructor.name)throw new rM(rS,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let r=nt(e);throw new rM(rS,`Expected type '${t.name}', but it was: ${r}`)}return e}function ni(e,t){if(t<=0)throw new rM(rS,`Function ${e}() requires a positive number, but it was: ${t}.`)}function ns(e,t){let r={typeString:e};return t&&(r.value=t),r}function na(e,t){let r;if(!ne(e))throw new rM(rS,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new rM(rS,r);return!0}let no=-0xe7791f700,nl=1e6;class nu{static now(){return nu.fromMillis(Date.now())}static fromDate(e){return nu.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*nl);return new nu(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new rM(rS,"Timestamp nanoseconds out of range: "+t);if(e<no||e>=0x3afff44180)throw new rM(rS,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/nl}_compareTo(e){return this.seconds===e.seconds?rG(this.nanoseconds,e.nanoseconds):rG(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:nu._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(na(e,nu._jsonSchema))return new nu(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds-no).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}nu._jsonSchemaVersion="firestore/timestamp/1.0",nu._jsonSchema={type:ns("string",nu._jsonSchemaVersion),seconds:ns("number"),nanoseconds:ns("number")};class nc{static fromTimestamp(e){return new nc(e)}static min(){return new nc(new nu(0,0))}static max(){return new nc(new nu(0x3afff4417f,1e9-1))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let nh=-1,nd=0;class nf{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function np(e){return e.fields.find(e=>2===e.kind)}function ng(e){return e.fields.filter(e=>2!==e.kind)}function nm(e){let t=ng(e);return 0===t.length?0:t[t.length-1].kind}function ny(e,t){let r=rG(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=nb(e.fields[n],t.fields[n])))return r;return rG(e.fields.length,t.fields.length)}function nv(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}nf.UNKNOWN_ID=-1;class n_{constructor(e,t){this.fieldPath=e,this.kind=t}}function nb(e,t){let r=r4.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:rG(e.kind,t.kind)}class nS{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new nS(nd,nT.min())}}function nC(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new nT(nc.fromTimestamp(1e9===n?new nu(r+1,0):new nu(r,n)),r5.empty(),t)}function nw(e){return new nT(e.readTime,e.key,nh)}class nT{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new nT(nc.min(),r5.empty(),nh)}static max(){return new nT(nc.max(),r5.empty(),nh)}}function nE(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=r5.comparator(e.documentKey,t.documentKey))?r:rG(e.largestBatchId,t.largestBatchId)}let nk="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class nI{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function nR(e){if(e.code===rR&&e.message===nk)rc("LocalStore","Unexpectedly lost primary lease");else throw e}class nx{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&rp(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new nx((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();if(t instanceof nx)return t;return nx.resolve(t)}catch(e){return nx.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):nx.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):nx.reject(t)}static resolve(e){return new nx((t,r)=>{t(e)})}static reject(e){return new nx((t,r)=>{r(e)})}static waitFor(e){return new nx((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=nx.resolve(!1);for(let r of e)t=t.next(e=>e?nx.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new nx((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new nx((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let nD="SimpleDb",nO=3;class nA{static open(e,t,r,n){try{return new nA(t,e.transaction(n,r))}catch(e){throw new nL(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new rL,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new nL(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{let r=nU(t.target.error);this.completionDeferred.reject(new nL(e,r))}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(rc(nD,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new nB(this.transaction.objectStore(e))}}class nN{static delete(e){return rc(nD,"Removing database:",e),nj(Y().indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!ev())return!1;if(nN.isMockPersistence())return!0;let e=eu(),t=nN.getIOSVersion(e),r=0<t&&t<10,n=nP(e),i=0<n&&n<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!r&&!i}static isMockPersistence(){return"u">typeof process&&process.env?.USE_MOCK_PERSISTENCE==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,this.lastClosedDbVersion=null,12.2===nN.getIOSVersion(eu())&&rh("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(e){return this.db||(rc(nD,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new nL(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new rM(rR,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new rM(rR,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new nL(e,n))},n.onupgradeneeded=e=>{rc(nD,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.schemaConverter.createOrUpgrade(t,n.transaction,e.oldVersion,this.version).next(()=>{rc(nD,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=e=>this.versionchangelistener(e)),this.db}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);let t=nA.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),nx.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(r){let e=r,t="FirebaseError"!==e.name&&s<nO;if(rc(nD,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function nP(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class nM{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return nj(this.dbCursor.delete())}}class nL extends rM{constructor(e,t){super(rN,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function nF(e){return"IndexedDbTransactionError"===e.name}class nB{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(rc(nD,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(rc(nD,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),nj(r)}add(e){return rc(nD,"ADD",this.store.name,e,e),nj(this.store.add(e))}get(e){return nj(this.store.get(e)).next(t=>(void 0===t&&(t=null),rc(nD,"GET",this.store.name,e,t),t))}delete(e){return rc(nD,"DELETE",this.store.name,e),nj(this.store.delete(e))}count(){return rc(nD,"COUNT",this.store.name),nj(this.store.count())}loadAll(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new nx((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.iterateCursor(e,(e,r)=>{t.push(r)}).next(()=>t)}}loadFirst(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new nx((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){rc(nD,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let n=this.cursor(r);return this.iterateCursor(n,(e,t,r)=>r.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.iterateCursor(n,t)}iterateSerial(e){let t=this.cursor({});return new nx((r,n)=>{t.onerror=e=>{n(nU(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}iterateCursor(e,t){let r=[];return new nx((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new nM(i),a=t(i.primaryKey,i.value,s);if(a instanceof nx){let e=a.catch(e=>(s.done(),nx.reject(e)));r.push(e)}s.isDone?n():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>nx.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}}}function nj(e){return new nx((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(nU(e.target.error))}})}let nq=!1;function nU(e){let t=nN.getIOSVersion(eu());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new rM("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nq||(nq=!0,setTimeout(()=>{throw e},0)),e}}return e}let nV="IndexBackfiller",nz=15e3,nH=6e4,nW=50;class n${constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(nz)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){rc(nV,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.backfiller.backfill();rc(nV,`Documents written: ${e}`)}catch(e){nF(e)?rc(nV,"Ignoring IndexedDB error during index backfill: ",e):await nR(e)}await this.schedule(nH)})}}class nK{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=nW){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let r=new Set,n=t,i=!0;return nx.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||r.has(t)))return rc(nV,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(n,r)).next(r=>(rc(nV,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=nw(t);nE(n,r)>0&&(r=n)}),new nT(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class nG{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}nG.INVALID=-1;let nQ="\x01",nY="\x01",nJ="\x10",nX="\x11";function nZ(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=n1(t)),t=n0(e.get(r),t);return n1(t)}function n0(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+=nQ+nJ;break;case nQ:r+=nQ+nX;break;default:r+=n}}return r}function n1(e){return e+nQ+nY}function n2(e){let t=e.length;if(rm(t>=2,64408,{path:e}),2===t)return rm(e.charAt(0)===nQ&&e.charAt(1)===nY,56145,{path:e}),r3.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf(nQ,s);switch((t<0||t>r)&&rp(50515,{path:e}),e.charAt(t+1)){case nY:let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case nJ:i+=e.substring(s,t),i+="\0";break;case nX:i+=e.substring(s,t+1);break;default:rp(61167,{path:e})}s=t+2}return new r3(n)}let n3="remoteDocuments",n6="owner",n4="owner",n5="mutationQueues",n8="userId",n9="mutations",n7="batchId",ie="userMutationsIndex",it=["userId","batchId"];function ir(e){return[e]}function ii(e,t){return[e,nZ(t)]}function is(e,t,r){return[e,nZ(t),r]}let ia={},io="documentMutations",il="remoteDocumentsV14",iu=["prefixPath","collectionGroup","readTime","documentId"],ic="documentKeyIndex",ih=["prefixPath","collectionGroup","documentId"],id="collectionGroupIndex",ip=["collectionGroup","readTime","prefixPath","documentId"],ig="remoteDocumentGlobal",im="remoteDocumentGlobalKey",iy="targets",iv="targetId",i_="queryTargetsIndex",ib=["canonicalId","targetId"],iS="targetDocuments",iC=["targetId","path"],iw="documentTargetsIndex",iT=["path","targetId"],iE="targetGlobalKey",ik="targetGlobal",iI="collectionParents",iR=["collectionId","parent"],ix="clientMetadata",iD="clientId",iO="bundles",iA="bundleId",iN="namedQueries",iP="name",iM="indexConfiguration",iL="indexId",iF="collectionGroupIndex",iB="collectionGroup",ij="indexState",iq=["indexId","uid"],iU="sequenceNumberIndex",iV=["uid","sequenceNumber"],iz="indexEntries",iH=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],iW="documentKeyIndex",i$=["indexId","uid","orderedDocumentKey"],iK="documentOverlays",iG=["userId","collectionPath","documentId"],iQ="collectionPathOverlayIndex",iY=["userId","collectionPath","largestBatchId"],iJ="collectionGroupOverlayIndex",iX=["userId","collectionGroup","largestBatchId"],iZ="globals",i0="name",i1=[n5,n9,io,n3,iy,n6,ik,iS,ix,ig,iI,iO,iN],i2=[...i1,iK],i3=[n5,n9,io,il,iy,n6,ik,iS,ix,ig,iI,iO,iN,iK],i6=i3,i4=[...i6,iM,ij,iz],i5=i4,i8=[...i4,iZ],i9=i8;function i7(e){return 18===e?i9:17===e?i8:16===e?i5:15===e?i4:14===e?i6:13===e?i3:12===e?i2:11===e?i1:void rp(60245)}class se extends nI{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function st(e,t){let r=ry(e);return nN.getStore(r.simpleDbTransaction,t)}function sr(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function sn(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function si(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}function ss(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class sa{constructor(e,t){this.comparator=e,this.root=t||sl.EMPTY}insert(e,t){return new sa(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sl.BLACK,null,null))}remove(e){return new sa(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new so(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new so(this.root,e,this.comparator,!1)}getReverseIterator(){return new so(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new so(this.root,e,this.comparator,!0)}}class so{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sl{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:sl.RED,this.left=null!=n?n:sl.EMPTY,this.right=null!=i?i:sl.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new sl(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return sl.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key))if(n.right.isEmpty())return sl.EMPTY;else r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,sl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,sl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw rp(43730,{key:this.key,value:this.value});if(this.right.isRed())throw rp(14113,{key:this.key,value:this.value});let e=this.left.check();if(e===this.right.check())return e+ +!this.isRed();throw rp(27949)}}sl.EMPTY=null,sl.RED=!0,sl.BLACK=!1;class su{constructor(){this.size=0}get key(){throw rp(57766)}get value(){throw rp(16141)}get color(){throw rp(16727)}get left(){throw rp(29726)}get right(){throw rp(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new sl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}sl.EMPTY=new su;class sc{constructor(e){this.comparator=e,this.data=new sa(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new sh(this.data.getIterator())}getIteratorFrom(e){return new sh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof sc)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new sc(this.comparator);return t.data=e,t}}class sh{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sd(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=sf(s),l=sf(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=sf(a)):t?(i(o),o=sf(s)):(o=sf(s),l=sf(a))}}function sf(e){return e.hasNext()?e.getNext():void 0}class sp{constructor(e){this.fields=e,e.sort(r4.comparator)}static empty(){return new sp([])}unionWith(e){let t=new sc(r4.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new sp(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rZ(this.fields,e.fields,(e,t)=>e.isEqual(t))}}function sg(e){return Buffer.from(e,"base64").toString("binary")}function sm(e){return Buffer.from(e,"binary").toString("base64")}class sy{constructor(e){this.binaryString=e}static fromBase64String(e){return new sy(sg(e))}static fromUint8Array(e){return new sy(sv(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return sm(this.binaryString)}toUint8Array(){return s_(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rG(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function sv(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}function s_(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}sy.EMPTY_BYTE_STRING=new sy("");let sb=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function sS(e){if(rm(!!e,39018),"string"==typeof e){let t=0,r=sb.exec(e);if(rm(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:sC(e.seconds),nanos:sC(e.nanos)}}function sC(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function sw(e){return"string"==typeof e?sy.fromBase64String(e):sy.fromUint8Array(e)}let sT="server_timestamp",sE="__type__",sk="__previous_value__",sI="__local_write_time__";function sR(e){return(e?.mapValue?.fields||{})[sE]?.stringValue===sT}function sx(e,t){let r={fields:{[sE]:{stringValue:sT},[sI]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&sR(t)&&(t=sD(t)),t&&(r.fields[sk]=t),{mapValue:r}}function sD(e){let t=e.mapValue.fields[sk];return sR(t)?sD(t):t}function sO(e){let t=sS(e.mapValue.fields[sI].timestampValue);return new nu(t.seconds,t.nanos)}class sA{constructor(e,t,r,n,i,s,a,o,l,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=c}}let sN="(default)";class sP{constructor(e,t){this.projectId=e,this.database=t||sN}static empty(){return new sP("","")}get isDefaultDatabase(){return this.database===sN}isEqual(e){return e instanceof sP&&e.projectId===this.projectId&&e.database===this.database}}function sM(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new rM(rS,'"projectId" not provided in firebase.initializeApp.');return new sP(e.options.projectId,t)}let sL=-1;function sF(e){return null==e}function sB(e){return 0===e&&1/e==-1/0}function sj(e){return"number"==typeof e&&Number.isInteger(e)&&!sB(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}let sq="__type__",sU="__max__",sV={mapValue:{fields:{__type__:{stringValue:sU}}}},sz="__vector__",sH="value",sW={nullValue:"NULL_VALUE"};function s$(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?sR(e)?4:ab(e)?0x1fffffffffffff:av(e)?10:11:rp(28295,{value:e})}function sK(e,t){if(e===t)return!0;let r=s$(e);if(r!==s$(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return sO(e).isEqual(sO(t));case 3:return sG(e,t);case 5:return e.stringValue===t.stringValue;case 6:return sY(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return sQ(e,t);case 2:return sJ(e,t);case 9:return rZ(e.arrayValue.values||[],t.arrayValue.values||[],sK);case 10:case 11:return sX(e,t);default:return rp(52216,{left:e})}}function sG(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=sS(e.timestampValue),n=sS(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}function sQ(e,t){return sC(e.geoPointValue.latitude)===sC(t.geoPointValue.latitude)&&sC(e.geoPointValue.longitude)===sC(t.geoPointValue.longitude)}function sY(e,t){return sw(e.bytesValue).isEqual(sw(t.bytesValue))}function sJ(e,t){if("integerValue"in e&&"integerValue"in t)return sC(e.integerValue)===sC(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=sC(e.doubleValue),n=sC(t.doubleValue);return r===n?sB(r)===sB(n):isNaN(r)&&isNaN(n)}return!1}function sX(e,t){let r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(sr(r)!==sr(n))return!1;for(let e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!sK(r[e],n[e])))return!1;return!0}function sZ(e,t){return void 0!==(e.values||[]).find(e=>sK(e,t))}function s0(e,t){if(e===t)return 0;let r=s$(e),n=s$(t);if(r!==n)return rG(r,n);switch(r){case 0:case 0x1fffffffffffff:return 0;case 1:return rG(e.booleanValue,t.booleanValue);case 2:return s1(e,t);case 3:return s2(e.timestampValue,t.timestampValue);case 4:return s2(sO(e),sO(t));case 5:return rQ(e.stringValue,t.stringValue);case 6:return s4(e.bytesValue,t.bytesValue);case 7:return s3(e.referenceValue,t.referenceValue);case 8:return s6(e.geoPointValue,t.geoPointValue);case 9:return s5(e.arrayValue,t.arrayValue);case 10:return s8(e.mapValue,t.mapValue);case 11:return s9(e.mapValue,t.mapValue);default:throw rp(23264,{leftType:r})}}function s1(e,t){let r=sC(e.integerValue||e.doubleValue),n=sC(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}function s2(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return rG(e,t);let r=sS(e),n=sS(t),i=rG(r.seconds,n.seconds);return 0!==i?i:rG(r.nanos,n.nanos)}function s3(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=rG(r[e],n[e]);if(0!==t)return t}return rG(r.length,n.length)}function s6(e,t){let r=rG(sC(e.latitude),sC(t.latitude));return 0!==r?r:rG(sC(e.longitude),sC(t.longitude))}function s4(e,t){let r=sw(e),n=sw(t);return r.compareTo(n)}function s5(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=s0(r[e],n[e]);if(t)return t}return rG(r.length,n.length)}function s8(e,t){let r=e.fields||{},n=t.fields||{},i=r[sH]?.arrayValue,s=n[sH]?.arrayValue,a=rG(i?.values?.length||0,s?.values?.length||0);return 0!==a?a:s5(i,s)}function s9(e,t){if(e===sV.mapValue&&t===sV.mapValue)return 0;if(e===sV.mapValue)return 1;if(t===sV.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=rQ(n[e],s[e]);if(0!==t)return t;let a=s0(r[n[e]],i[s[e]]);if(0!==a)return a}return rG(n.length,s.length)}function s7(e){return ae(e)}function ae(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return ar(e.timestampValue);else if("stringValue"in e)return e.stringValue;else if("bytesValue"in e)return at(e.bytesValue);else if("referenceValue"in e)return ai(e.referenceValue);else if("geoPointValue"in e)return an(e.geoPointValue);else if("arrayValue"in e)return aa(e.arrayValue);else if("mapValue"in e)return as(e.mapValue);else return rp(61005,{value:e})}function at(e){return sw(e).toBase64()}function ar(e){let t=sS(e);return`time(${t.seconds},${t.nanos})`}function an(e){return`geo(${e.latitude},${e.longitude})`}function ai(e){return r5.fromName(e).toString()}function as(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${ae(e.fields[i])}`;return r+"}"}function aa(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=ae(n);return t+"]"}function ao(e){switch(s$(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=sD(e);return t?16+ao(t):16;case 5:return 2*e.stringValue.length;case 6:return sw(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return au(e.arrayValue);case 10:case 11:return al(e.mapValue);default:throw rp(13486,{value:e})}}function al(e){let t=0;return sn(e.fields,(e,r)=>{t+=e.length+ao(r)}),t}function au(e){return(e.values||[]).reduce((e,t)=>e+ao(t),0)}function ac(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ah(e){return!!e&&"integerValue"in e}function ad(e){return!!e&&"doubleValue"in e}function af(e){return ah(e)||ad(e)}function ap(e){return!!e&&"arrayValue"in e}function ag(e){return!!e&&"nullValue"in e}function am(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ay(e){return!!e&&"mapValue"in e}function av(e){return(e?.mapValue?.fields||{})[sq]?.stringValue===sz}function a_(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return sn(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=a_(r)),t}{if(!e.arrayValue)return{...e};let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=a_(e.arrayValue.values[r]);return t}}function ab(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===sU}let aS={mapValue:{fields:{[sq]:{stringValue:sz},[sH]:{arrayValue:{}}}}};function aC(e){if("nullValue"in e)return sW;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};else if("bytesValue"in e)return{bytesValue:""};else if("referenceValue"in e)return ac(sP.empty(),r5.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if(!("mapValue"in e))return rp(35942,{value:e});else return av(e)?aS:{mapValue:{}}}function aw(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};else if("bytesValue"in e)return ac(sP.empty(),r5.empty());else if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return aS;else if(!("mapValue"in e))return rp(61959,{value:e});else return av(e)?{mapValue:{}}:sV}function aT(e,t){let r=s0(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function aE(e,t){let r=s0(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class ak{constructor(e){this.value=e}static empty(){return new ak({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!ay(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=a_(t)}setAll(e){let t=r4.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=a_(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());ay(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sK(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];ay(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(sn(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new ak(a_(this.value))}}function aI(e){let t=[];return sn(e.fields,(e,r)=>{let n=new r4([e]);if(ay(r)){let e=aI(r.mapValue).fields;if(0===e.length)t.push(n);else for(let r of e)t.push(n.child(r))}else t.push(n)}),new sp(t)}class aR{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new aR(e,0,nc.min(),nc.min(),nc.min(),ak.empty(),0)}static newFoundDocument(e,t,r,n){return new aR(e,1,t,nc.min(),r,n,0)}static newNoDocument(e,t){return new aR(e,2,t,nc.min(),nc.min(),ak.empty(),0)}static newUnknownDocument(e,t){return new aR(e,3,t,nc.min(),nc.min(),ak.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(nc.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ak.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ak.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=nc.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof aR&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new aR(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function ax(e,t,r){let n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?s0(n,i):rp(42886)}class aD{constructor(e,t){this.position=e,this.inclusive=t}}function aO(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?r5.comparator(r5.fromName(a.referenceValue),r.key):s0(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function aA(e,t,r){let n=aO(e,t,r);return e.inclusive?n>=0:n>0}function aN(e,t,r){let n=aO(e,t,r);return e.inclusive?n<=0:n<0}function aP(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!sK(e.position[r],t.position[r]))return!1;return!0}class aM{constructor(e,t="asc"){this.field=e,this.dir=t}}function aL(e){return e.field.canonicalString()+e.dir}function aF(e){return`${e.field.canonicalString()} (${e.dir})`}function aB(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class aj{}class aq extends aj{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){if(e.isKeyField())if("in"===t||"not-in"===t)return this.createKeyFieldInFilter(e,t,r);else return new a0(e,t,r);if("array-contains"===t)return new a6(e,r);if("in"===t)return new a4(e,r);if("not-in"===t)return new a5(e,r);if("array-contains-any"===t)return new a8(e,r);else return new aq(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new a1(e,r):new a2(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(s0(t,this.value)):null!==t&&s$(this.value)===s$(t)&&this.matchesComparison(s0(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return rp(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class aU extends aj{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new aU(e,t)}matches(e){return aV(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function aV(e){return"and"===e.op}function az(e){return"or"===e.op}function aH(e){return aW(e)&&aV(e)}function aW(e){for(let t of e.filters)if(t instanceof aU)return!1;return!0}function a$(e){if(e instanceof aq)return e.field.canonicalString()+e.op.toString()+s7(e.value);{if(aH(e))return e.filters.map(e=>a$(e)).join(",");let t=e.filters.map(e=>a$(e)).join(",");return`${e.op}(${t})`}}function aK(e,t){return e instanceof aq?aG(e,t):e instanceof aU?aQ(e,t):void rp(19439)}function aG(e,t){return t instanceof aq&&e.op===t.op&&e.field.isEqual(t.field)&&sK(e.value,t.value)}function aQ(e,t){return t instanceof aU&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&aK(r,t.filters[n]),!0)}function aY(e,t){let r=e.filters.concat(t);return aU.create(r,e.op)}function aJ(e){return e instanceof aq?aZ(e):e instanceof aU?aX(e):"Filter"}function aX(e){return e.op.toString()+" {"+e.getFilters().map(aJ).join(" ,")+"}"}function aZ(e){return`${e.field.canonicalString()} ${e.op} ${s7(e.value)}`}class a0 extends aq{constructor(e,t,r){super(e,t,r),this.key=r5.fromName(r.referenceValue)}matches(e){let t=r5.comparator(e.key,this.key);return this.matchesComparison(t)}}class a1 extends aq{constructor(e,t){super(e,"in",t),this.keys=a3("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class a2 extends aq{constructor(e,t){super(e,"not-in",t),this.keys=a3("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function a3(e,t){return(t.arrayValue?.values||[]).map(e=>r5.fromName(e.referenceValue))}class a6 extends aq{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ap(t)&&sZ(t.arrayValue,this.value)}}class a4 extends aq{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&sZ(this.value.arrayValue,t)}}class a5 extends aq{constructor(e,t){super(e,"not-in",t)}matches(e){if(sZ(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!sZ(this.value.arrayValue,t)}}class a8 extends aq{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!!ap(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>sZ(this.value.arrayValue,e))}}class a9{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.memoizedCanonicalId=null}}function a7(e,t=null,r=[],n=[],i=null,s=null,a=null){return new a9(e,t,r,n,i,s,a)}function oe(e){let t=ry(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>a$(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>aL(e)).join(","),sF(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>s7(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>s7(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function ot(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>aJ(e)).join(", ")}]`),sF(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>aF(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>s7(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>s7(e)).join(",")),`Target(${t})`}function or(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!aB(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!aK(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!aP(e.startAt,t.startAt)&&aP(e.endAt,t.endAt)}function on(e){return r5.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function oi(e,t){return e.filters.filter(e=>e instanceof aq&&e.field.isEqual(t))}function os(e,t){let r=np(t);if(void 0===r)return null;for(let t of oi(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function oa(e,t){let r=new Map;for(let n of ng(t))for(let t of oi(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}function oo(e,t){let r=[],n=!0;for(let i of ng(t)){let t=0===i.kind?ou(e,i.fieldPath,e.startAt):oc(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new aD(r,n)}function ol(e,t){let r=[],n=!0;for(let i of ng(t)){let t=0===i.kind?oc(e,i.fieldPath,e.endAt):ou(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new aD(r,n)}function ou(e,t,r){let n=sW,i=!0;for(let r of oi(e,t)){let e=sW,t=!0;switch(r.op){case"<":case"<=":e=aC(r.value);break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=sW}0>aT({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>aT({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function oc(e,t,r){let n=sV,i=!0;for(let r of oi(e,t)){let e=sV,t=!0;switch(r.op){case">=":case">":e=aw(r.value),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=sV}aE({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];aE({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function oh(e){let t=new sc(r4.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}function od(e){return null!==e.limit}class of{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function op(e,t,r,n,i,s,a,o){return new of(e,t,r,n,i,s,a,o)}function og(e){return new of(e)}function om(e,t){return new of(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function oy(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ov(e){let t=new sc(r4.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}function o_(e){return r5.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function ob(e){return null!==e.collectionGroup}function oS(e){let t=ry(e);if(null===t.memoizedNormalizedOrderBy){t.memoizedNormalizedOrderBy=[];let e=new Set;for(let r of t.explicitOrderBy)t.memoizedNormalizedOrderBy.push(r),e.add(r.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";ov(t).forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.memoizedNormalizedOrderBy.push(new aM(n,r))}),e.has(r4.keyField().canonicalString())||t.memoizedNormalizedOrderBy.push(new aM(r4.keyField(),r))}return t.memoizedNormalizedOrderBy}function oC(e){let t=ry(e);return t.memoizedTarget||(t.memoizedTarget=oT(t,oS(e))),t.memoizedTarget}function ow(e){let t=ry(e);return t.memoizedAggregateTarget||(t.memoizedAggregateTarget=oT(t,e.explicitOrderBy)),t.memoizedAggregateTarget}function oT(e,t){if("F"===e.limitType)return a7(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new aM(e.field,t)});let r=e.endAt?new aD(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new aD(e.startAt.position,e.startAt.inclusive):null;return a7(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function oE(e,t){let r=e.filters.concat([t]);return new of(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function ok(e,t){let r=e.explicitOrderBy.concat([t]);return new of(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function oI(e,t,r){return new of(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function oR(e,t){return new of(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function ox(e,t){return new of(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function oD(e,t){return or(oC(e),oC(t))&&e.limitType===t.limitType}function oO(e){return`${oe(oC(e))}|lt:${e.limitType}`}function oA(e){return`Query(target=${ot(oC(e))}; limitType=${e.limitType})`}function oN(e,t){return t.isFoundDocument()&&oP(e,t)&&oM(e,t)&&oL(e,t)&&oF(e,t)}function oP(e,t){let r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):r5.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}function oM(e,t){for(let r of oS(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}function oL(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}function oF(e,t){return(!e.startAt||!!aN(e.startAt,oS(e),t))&&(!e.endAt||!!aA(e.endAt,oS(e),t))}function oB(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function oj(e){return(t,r)=>{let n=!1;for(let i of oS(e)){let e=oq(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}function oq(e,t,r){let n=e.field.isKeyField()?r5.comparator(t.key,r.key):ax(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return -1*n;default:return rp(19790,{direction:e.dir})}}class oU{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n){this.inner[r]=[[e,t]],this.innerSize++;return}for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e)){n[r]=[e,t];return}n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){sn(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return ss(this.inner)}size(){return this.innerSize}}let oV=new sa(r5.comparator);function oz(){return oV}let oH=new sa(r5.comparator);function oW(...e){let t=oH;for(let r of e)t=t.insert(r.key,r);return t}function o$(){return oY()}function oK(e){let t=oH;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function oG(){return oY()}function oQ(){return oY()}function oY(){return new oU(e=>e.toString(),(e,t)=>e.isEqual(t))}let oJ=new sa(r5.comparator);function oX(){return oJ}let oZ=new sc(r5.comparator);function o0(...e){let t=oZ;for(let r of e)t=t.add(r);return t}let o1=new sc(rG);function o2(){return o1}function o3(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};else if(t===1/0)return{doubleValue:"Infinity"};else if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sB(t)?"-0":t}}function o6(e){return{integerValue:""+e}}function o4(e,t){return sj(t)?o6(t):o3(e,t)}class o5{constructor(){this._=void 0}}function o8(e,t,r){return e instanceof lt?sx(r,t):e instanceof lr?ln(e,t):e instanceof li?ls(e,t):lo(e,t)}function o9(e,t,r){return e instanceof lr?ln(e,t):e instanceof li?ls(e,t):r}function o7(e,t){return e instanceof la?af(t)?t:{integerValue:0}:null}function le(e,t){return e instanceof lr&&t instanceof lr||e instanceof li&&t instanceof li?rZ(e.elements,t.elements,sK):e instanceof la&&t instanceof la?sK(e.operand,t.operand):e instanceof lt&&t instanceof lt}class lt extends o5{}class lr extends o5{constructor(e){super(),this.elements=e}}function ln(e,t){let r=lu(t);for(let t of e.elements)r.some(e=>sK(e,t))||r.push(t);return{arrayValue:{values:r}}}class li extends o5{constructor(e){super(),this.elements=e}}function ls(e,t){let r=lu(t);for(let t of e.elements)r=r.filter(e=>!sK(e,t));return{arrayValue:{values:r}}}class la extends o5{constructor(e,t){super(),this.serializer=e,this.operand=t}}function lo(e,t){let r=o7(e,t),n=ll(r)+ll(e.operand);return ah(r)&&ah(e.operand)?o6(n):o3(e.serializer,n)}function ll(e){return sC(e.integerValue||e.doubleValue)}function lu(e){return ap(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class lc{constructor(e,t){this.field=e,this.transform=t}}function lh(e,t){return e.field.isEqual(t.field)&&le(e.transform,t.transform)}function ld(e,t){return void 0===e&&void 0===t||!!e&&!!t&&rZ(e,t,(e,t)=>lh(e,t))}class lf{constructor(e,t){this.version=e,this.transformResults=t}}class lp{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new lp}static exists(e){return new lp(void 0,e)}static updateTime(e){return new lp(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function lg(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class lm{}function ly(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)if(e.isNoDocument())return new lO(e.key,lp.none());else return new lC(e.key,e.data,lp.none());{let r=e.data,n=ak.empty(),i=new sc(r4.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new lE(e.key,n,new sp(i.toArray()),lp.none())}}function lv(e,t,r){e instanceof lC?lw(e,t,r):e instanceof lE?lk(e,t,r):lA(e,t,r)}function l_(e,t,r,n){return e instanceof lC?lT(e,t,r,n):e instanceof lE?lI(e,t,r,n):lN(e,t,r)}function lb(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=o7(n.transform,e||null);null!=i&&(null===r&&(r=ak.empty()),r.set(n.field,i))}return r||null}function lS(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!ld(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class lC extends lm{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}function lw(e,t,r){let n=e.value.clone(),i=lx(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}function lT(e,t,r,n){if(!lg(e.precondition,t))return r;let i=e.value.clone(),s=lD(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class lE extends lm{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function lk(e,t,r){if(!lg(e.precondition,t))return void t.convertToUnknownDocument(r.version);let n=lx(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(lR(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}function lI(e,t,r,n){if(!lg(e.precondition,t))return r;let i=lD(e.fieldTransforms,n,t),s=t.data;return(s.setAll(lR(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function lR(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function lx(e,t,r){let n=new Map;rm(e.length===r.length,32656,{serverTransformResultCount:r.length,fieldTransformCount:e.length});for(let i=0;i<r.length;i++){let s=e[i],a=s.transform,o=t.data.field(s.field);n.set(s.field,o9(a,o,r[i]))}return n}function lD(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,o8(e,s,t))}return n}class lO extends lm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function lA(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}function lN(e,t,r){return lg(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}class lP extends lm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class lM{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&lv(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=l_(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=l_(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=oQ();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=ly(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(nc.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),o0())}isEqual(e){return this.batchId===e.batchId&&rZ(this.mutations,e.mutations,(e,t)=>lS(e,t))&&rZ(this.baseMutations,e.baseMutations,(e,t)=>lS(e,t))}}class lL{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){rm(e.mutations.length===r.length,58842,{mutationsSent:e.mutations.length,resultsReceived:r.length});let n=oX(),i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new lL(e,t,r,n)}}class lF{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class lB{constructor(e,t){this.count=e,this.unchangedNames=t}}function lj(e){switch(e){case rv:return rp(64938);case r_:case rb:case rC:case rI:case rA:case rN:case rk:return!1;case rS:case rw:case rT:case rE:case rR:case rx:case rD:case rO:case rP:return!0;default:return rp(15467,{code:e})}}function lq(e){return lj(e)&&e!==rx}function lU(e){if(void 0===e)return rh("GRPC error has no .code"),rb;switch(e){case m.OK:return rv;case m.CANCELLED:return r_;case m.UNKNOWN:return rb;case m.DEADLINE_EXCEEDED:return rC;case m.RESOURCE_EXHAUSTED:return rI;case m.INTERNAL:return rA;case m.UNAVAILABLE:return rN;case m.UNAUTHENTICATED:return rk;case m.INVALID_ARGUMENT:return rS;case m.NOT_FOUND:return rw;case m.ALREADY_EXISTS:return rT;case m.PERMISSION_DENIED:return rE;case m.FAILED_PRECONDITION:return rR;case m.ABORTED:return rx;case m.OUT_OF_RANGE:return rD;case m.UNIMPLEMENTED:return rO;case m.DATA_LOSS:return rP;default:return rp(39323,{code:e})}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(m||(m={}));class lV extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let lz=null;function lH(e){if(lz)throw Error("a TestingHooksSpi instance is already set");lz=e}function lW(){return new re.TextEncoder}function l$(){return new re.TextDecoder("utf-8")}let lK=new p([0xffffffff,0xffffffff],0);function lG(e){let t=lW().encode(e),r=new g;return r.update(t),new Uint8Array(r.digest())}function lQ(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new p([r,n],0),new p([i,s],0)]}class lY{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new lJ(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new lJ(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new lJ(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=p.fromNumber(this.bitCount)}getBitIndex(e,t,r){let n=e.add(t.multiply(p.fromNumber(r)));return 1===n.compare(lK)&&(n=new p([n.getBits(0),n.getBits(1)],0)),n.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;let[t,r]=lQ(lG(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);if(!this.isBitSet(n))return!1}return!0}static create(e,t,r){let n=e%8==0?0:8-e%8,i=new lY(new Uint8Array(Math.ceil(e/8)),n,t);return r.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;let[t,r]=lQ(lG(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);this.setBit(n)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class lJ extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class lX{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,lZ.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new lX(nc.min(),n,new sa(rG),oz(),o0())}}class lZ{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new lZ(r,t,o0(),o0(),o0())}}class l0{constructor(e,t,r,n){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=n}}class l1{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class l2{constructor(e,t,r=sy.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class l3{constructor(){this.pendingResponses=0,this.documentChanges=l8(),this._resumeToken=sy.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=o0(),t=o0(),r=o0();return this.documentChanges.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:rp(38017,{changeType:i})}}),new lZ(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=l8()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,rm(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let l6="WatchChangeAggregator";class l4{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=oz(),this.pendingDocumentUpdatesByTarget=l5(),this.pendingDocumentTargetMapping=l5(),this.pendingTargetResets=new sa(rG)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:rp(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,n=this.targetDataForActiveTarget(t);if(n){let i=n.target;if(on(i))if(0===r){let e=new r5(i.path);this.removeDocumentFromTarget(t,e,aR.newNoDocument(e,nc.min()))}else rm(1===r,20013,{expectedCount:r});else{let n=this.getCurrentDocumentCountForTarget(t);if(n!==r){let r=this.parseBloomFilter(e),i=r?this.applyBloomFilter(r,e,n):1;if(0!==i){this.resetTarget(t);let e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,e)}lz?.notifyOnExistenceFilterMismatch(l9(n,e.existenceFilter,this.metadataProvider.getDatabaseId(),r,i))}}}}parseBloomFilter(e){let t,r,n=e.existenceFilter.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=sw(i).toUint8Array()}catch(e){if(e instanceof lV)return rd("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new lY(t,s,a)}catch(e){return e instanceof lJ?rd("BloomFilter error: ",e):rd("Applying bloom filter failed: ",e),null}return 0===r.bitCount?null:r}applyBloomFilter(e,t,r){return 2*(t.existenceFilter.count!==r-this.filterRemovedDocuments(e,t.targetId))}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;!e.mightContain(s)&&(this.removeDocumentFromTarget(t,r,null),n++)}),n}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((r,n)=>{let i=this.targetDataForActiveTarget(n);if(i){if(r.current&&on(i.target)){let t=new r5(i.target.path);this.ensureDocumentUpdateByTarget(t).has(n)||this.targetContainsDocument(n,t)||this.removeDocumentFromTarget(n,t,aR.newNoDocument(t,e))}r.hasPendingChanges&&(t.set(n,r.toTargetChange()),r.clearPendingChanges())}});let r=o0();this.pendingDocumentTargetMapping.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.pendingDocumentUpdates.forEach((t,r)=>r.setReadTime(e));let n=new lX(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=oz(),this.pendingDocumentUpdatesByTarget=l5(),this.pendingDocumentTargetMapping=l5(),this.pendingTargetResets=new sa(rG),n}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=2*!!this.targetContainsDocument(e,t.key);this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(t.key,this.ensureDocumentUpdateByTarget(t.key).add(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let n=this.ensureTargetState(e);this.targetContainsDocument(e,t)?n.addDocumentChange(t,1):n.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).add(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new l3,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new sc(rG),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}ensureDocumentUpdateByTarget(e){let t=this.pendingDocumentUpdatesByTarget.get(e);return t||(t=new sc(rG),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(e,t)),t}isActiveTarget(e){let t=null!==this.targetDataForActiveTarget(e);return t||rc(l6,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new l3),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function l5(){return new sa(r5.comparator)}function l8(){return new sa(r5.comparator)}function l9(e,t,r,n,i){let s={localCacheCount:e,existenceFilterCount:t.count,databaseId:r.database,projectId:r.projectId},a=t.unchangedNames;return a&&(s.bloomFilter={applied:0===i,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>n?.mightContain(e)??!1}),s}let l7=(()=>{let e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),ue=(()=>{let e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),ut=(()=>{let e={};return e.and="AND",e.or="OR",e})();function ur(e,t){}class un{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ui(e){return new rM(void 0===e.code?rb:lU(e.code),e.message||"")}function us(e,t){return e.useProto3Json||sF(t)?t:{value:t}}function ua(e){let t;return sF(t="object"==typeof e?e.value:e)?null:t}function uo(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{let e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+t.nanoseconds).slice(-9);return`${e}.${r}Z`}}function ul(e){let t=sS(e);return new nu(t.seconds,t.nanos)}function uu(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function uc(e,t){return e.useProto3Json?(rm(void 0===t||"string"==typeof t,58123),sy.fromBase64String(t||"")):(rm(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),sy.fromUint8Array(t||new Uint8Array))}function uh(e,t){return uo(e,t.toTimestamp())}function ud(e){return rm(!!e,49232),nc.fromTimestamp(ul(e))}function uf(e,t){return up(e,t).canonicalString()}function up(e,t){let r=uS(e).child("documents");return void 0===t?r:r.child(t)}function ug(e){let t=r3.fromString(e);return rm(cd(t),10190,{key:t.toString()}),t}function um(e,t){return uf(e.databaseId,t.path)}function uy(e,t){let r=ug(t);if(r.get(1)!==e.databaseId.projectId)throw new rM(rS,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new rM(rS,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new r5(uC(r))}function uv(e,t){return uf(e.databaseId,t)}function u_(e){let t=ug(e);return 4===t.length?r3.emptyPath():uC(t)}function ub(e){return new r3(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function uS(e){return new r3(["projects",e.projectId,"databases",e.database])}function uC(e){return rm(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function uw(e,t,r){return{name:um(e,t),fields:r.value.mapValue.fields}}function uT(e,t){return{name:um(e,t.key),fields:t.data.value.mapValue.fields,updateTime:uo(e,t.version.toTimestamp()),createTime:uo(e,t.createTime.toTimestamp())}}function uE(e,t,r){let n=uy(e,t.name),i=ud(t.updateTime),s=t.createTime?ud(t.createTime):nc.min(),a=new ak({mapValue:{fields:t.fields}}),o=aR.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function uk(e,t){rm(!!t.found,43571),ur(t.found.name),ur(t.found.updateTime);let r=uy(e,t.found.name),n=ud(t.found.updateTime),i=t.found.createTime?ud(t.found.createTime):nc.min(),s=new ak({mapValue:{fields:t.found.fields}});return aR.newFoundDocument(r,n,i,s)}function uI(e,t){rm(!!t.missing,3894),rm(!!t.readTime,22933);let r=uy(e,t.missing),n=ud(t.readTime);return aR.newNoDocument(r,n)}function uR(e,t){return"found"in t?uk(e,t):"missing"in t?uI(e,t):rp(7234,{result:t})}function ux(e,t){let r;if("targetChange"in t){ur(t.targetChange);let n=uD(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=uc(e,t.targetChange.resumeToken),a=t.targetChange.cause;r=new l2(n,i,s,a&&ui(a)||null)}else if("documentChange"in t){ur(t.documentChange);let n=t.documentChange;ur(n.document),ur(n.document.name),ur(n.document.updateTime);let i=uy(e,n.document.name),s=ud(n.document.updateTime),a=n.document.createTime?ud(n.document.createTime):nc.min(),o=new ak({mapValue:{fields:n.document.fields}}),l=aR.newFoundDocument(i,s,a,o);r=new l0(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){ur(t.documentDelete);let n=t.documentDelete;ur(n.document);let i=uy(e,n.document),s=n.readTime?ud(n.readTime):nc.min(),a=aR.newNoDocument(i,s);r=new l0([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){ur(t.documentRemove);let n=t.documentRemove;ur(n.document);let i=uy(e,n.document);r=new l0([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return rp(11601,{change:t});ur(t.filter);let e=t.filter;ur(e.targetId);let{count:n=0,unchangedNames:i}=e,s=new lB(n,i);r=new l1(e.targetId,s)}return r}function uD(e){if("NO_CHANGE"===e)return 0;if("ADD"===e)return 1;if("REMOVE"===e)return 2;if("CURRENT"===e)return 3;if("RESET"===e)return 4;else return rp(39313,{state:e})}function uO(e){if(!("targetChange"in e))return nc.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?nc.min():ud(t.readTime)}function uA(e,t){let r;if(t instanceof lC)r={update:uw(e,t.key,t.value)};else if(t instanceof lO)r={delete:um(e,t.key)};else if(t instanceof lE)r={update:uw(e,t.key,t.data),updateMask:cc(t.fieldMask)};else{if(!(t instanceof lP))return rp(16599,{mutationType:t.type});r={verify:um(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(t=>uB(e,t))),t.precondition.isNone||(r.currentDocument=uP(e,t.precondition)),r}function uN(e,t){let r=t.currentDocument?uM(t.currentDocument):lp.none(),n=t.updateTransforms?t.updateTransforms.map(t=>uj(e,t)):[];if(t.update){ur(t.update.name);let i=uy(e,t.update.name),s=new ak({mapValue:{fields:t.update.fields}});return t.updateMask?new lE(i,s,ch(t.updateMask),r,n):new lC(i,s,r,n)}return t.delete?new lO(uy(e,t.delete),r):t.verify?new lP(uy(e,t.verify),r):rp(1463,{proto:t})}function uP(e,t){return void 0!==t.updateTime?{updateTime:uh(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:rp(27497)}function uM(e){return void 0!==e.updateTime?lp.updateTime(ud(e.updateTime)):void 0!==e.exists?lp.exists(e.exists):lp.none()}function uL(e,t){let r=e.updateTime?ud(e.updateTime):ud(t);return r.isEqual(nc.min())&&(r=ud(t)),new lf(r,e.transformResults||[])}function uF(e,t){return e&&e.length>0?(rm(void 0!==t,14353),e.map(e=>uL(e,t))):[]}function uB(e,t){let r=t.transform;if(r instanceof lt)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof lr)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof li)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof la)return{fieldPath:t.field.canonicalString(),increment:r.operand};throw rp(20930,{transform:t.transform})}function uj(e,t){let r=null;return"setToServerValue"in t?(rm("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new lt):"appendMissingElements"in t?r=new lr(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new li(t.removeAllFromArray.values||[]):"increment"in t?r=new la(e,t.increment):rp(16584,{proto:t}),new lc(r4.fromServerFormat(t.fieldPath),r)}function uq(e,t){return{documents:[uv(e,t.path)]}}function uU(e){let t=e.documents.length;return rm(1===t,1966,{count:t}),oC(og(u_(e.documents[0])))}function uV(e,t){let r,n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=uv(e,r);let s=uQ(t.filters);s&&(n.structuredQuery.where=s);let a=uX(t.orderBy);a&&(n.structuredQuery.orderBy=a);let o=us(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=u0(t.startAt)),t.endAt&&(n.structuredQuery.endAt=u1(t.endAt)),{queryTarget:n,parent:r}}function uz(e,t,r,n){let{queryTarget:i,parent:s}=uV(e,t),a={},o=[],l=0;return r.forEach(e=>{let t=n?e.alias:`aggregate_${l++}`;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:ce(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:ce(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},aliasMap:a,parent:s}}function uH(e){let t=u_(e.parent),r=e.structuredQuery,n=r.from?r.from.length:0,i=null;if(n>0){rm(1===n,65062);let e=r.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];r.where&&(s=uY(r.where));let a=[];r.orderBy&&(a=uZ(r.orderBy));let o=null;r.limit&&(o=ua(r.limit));let l=null;r.startAt&&(l=u2(r.startAt));let u=null;return r.endAt&&(u=u3(r.endAt)),op(t,i,a,s,o,"F",l,u)}function uW(e){return oC(uH(e))}function u$(e,t){let r=uK(t.purpose);return null==r?null:{"goog-listen-tags":r}}function uK(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return rp(28987,{purpose:e})}}function uG(e,t){let r,n=t.target;if((r=on(n)?{documents:uq(e,n)}:{query:uV(e,n).queryTarget}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=uu(e,t.resumeToken);let n=us(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(nc.min())>0){r.readTime=uo(e,t.snapshotVersion.toTimestamp());let n=us(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}function uQ(e){if(0!==e.length)return ci(aU.create(e,"and"))}function uY(e){let t=uJ(e);return t instanceof aU&&aH(t)?t.getFilters():[t]}function uJ(e){return void 0!==e.unaryFilter?co(e):void 0!==e.fieldFilter?cl(e):void 0!==e.compositeFilter?cu(e):rp(30097,{filter:e})}function uX(e){if(0!==e.length)return e.map(e=>cr(e))}function uZ(e){return e.map(e=>cn(e))}function u0(e){return{before:e.inclusive,values:e.position}}function u1(e){return{before:!e.inclusive,values:e.position}}function u2(e){let t=!!e.before;return new aD(e.values||[],t)}function u3(e){let t=!e.before;return new aD(e.values||[],t)}function u6(e){return l7[e]}function u4(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function u5(e){return ue[e]}function u8(e){return ut[e]}function u9(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return rp(58110);default:return rp(50506)}}function u7(e){switch(e){case"AND":return"and";case"OR":return"or";default:return rp(1026)}}function ce(e){return{fieldPath:e.canonicalString()}}function ct(e){return r4.fromServerFormat(e.fieldPath)}function cr(e){return{field:ce(e.field),direction:u6(e.dir)}}function cn(e){return new aM(ct(e.field),u4(e.direction))}function ci(e){return e instanceof aq?ca(e):e instanceof aU?cs(e):rp(54877,{filter:e})}function cs(e){let t=e.getFilters().map(e=>ci(e));return 1===t.length?t[0]:{compositeFilter:{op:u8(e.op),filters:t}}}function ca(e){if("=="===e.op){if(am(e.value))return{unaryFilter:{field:ce(e.field),op:"IS_NAN"}};else if(ag(e.value))return{unaryFilter:{field:ce(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(am(e.value))return{unaryFilter:{field:ce(e.field),op:"IS_NOT_NAN"}};else if(ag(e.value))return{unaryFilter:{field:ce(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ce(e.field),op:u5(e.op),value:e.value}}}function co(e){switch(e.unaryFilter.op){case"IS_NAN":let t=ct(e.unaryFilter.field);return aq.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=ct(e.unaryFilter.field);return aq.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=ct(e.unaryFilter.field);return aq.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=ct(e.unaryFilter.field);return aq.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return rp(61313);default:return rp(60726)}}function cl(e){return aq.create(ct(e.fieldFilter.field),u9(e.fieldFilter.op),e.fieldFilter.value)}function cu(e){return aU.create(e.compositeFilter.filters.map(e=>uJ(e)),u7(e.compositeFilter.op))}function cc(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function ch(e){return new sp((e.fieldPaths||[]).map(e=>r4.fromServerFormat(e)))}function cd(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function cf(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class cp{constructor(e,t,r,n,i=nc.min(),s=nc.min(),a=sy.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new cp(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new cp(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new cp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new cp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class cg{constructor(e){this.remoteSerializer=e}}function cm(e,t){let r;if(t.document)r=uE(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=r5.fromSegments(t.noDocument.path),n=cS(t.noDocument.readTime);r=aR.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return rp(56709);let e=r5.fromSegments(t.unknownDocument.path),n=cS(t.unknownDocument.version);r=aR.newUnknownDocument(e,n)}return t.readTime&&r.setReadTime(c_(t.readTime)),r}function cy(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:cv(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=uT(e.remoteSerializer,t);else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:cb(t.version)};else{if(!t.isUnknownDocument())return rp(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:cb(t.version)}}return n}function cv(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function c_(e){let t=new nu(e[0],e[1]);return nc.fromTimestamp(t)}function cb(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function cS(e){let t=new nu(e.seconds,e.nanoseconds);return nc.fromTimestamp(t)}function cC(e,t,r){let n=r.baseMutations.map(t=>uA(e.remoteSerializer,t)),i=r.mutations.map(t=>uA(e.remoteSerializer,t));return{userId:t,batchId:r.batchId,localWriteTimeMs:r.localWriteTime.toMillis(),baseMutations:n,mutations:i}}function cw(e,t){let r=(t.baseMutations||[]).map(t=>uN(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>uN(e.remoteSerializer,t)),i=nu.fromMillis(t.localWriteTimeMs);return new lM(t.batchId,i,r,n)}function cT(e){let t,r=cS(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?cS(e.lastLimboFreeSnapshotVersion):nc.min();return new cp(t=ck(e.query)?uU(e.query):uW(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,sy.fromBase64String(e.resumeToken))}function cE(e,t){let r,n=cb(t.snapshotVersion),i=cb(t.lastLimboFreeSnapshotVersion);r=on(t.target)?uq(e.remoteSerializer,t.target):uV(e.remoteSerializer,t.target).queryTarget;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:oe(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function ck(e){return void 0!==e.documents}function cI(e){return{id:e.bundleId,createTime:cS(e.createTime),version:e.version}}function cR(e){return{bundleId:e.id,createTime:cb(ud(e.createTime)),version:e.version}}function cx(e){return{name:e.name,query:cO(e.bundledQuery),readTime:cS(e.readTime)}}function cD(e){return{name:e.name,readTime:cb(ud(e.readTime)),bundledQuery:e.bundledQuery}}function cO(e){let t=uH({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?oI(t,t.limit,"L"):t}function cA(e){return{name:e.name,query:cO(e.bundledQuery),readTime:ud(e.readTime)}}function cN(e){return{id:e.id,version:e.version,createTime:ud(e.createTime)}}function cP(e,t){return new lF(t.largestBatchId,uN(e.remoteSerializer,t.overlayMutation))}function cM(e,t,r){let[n,i,s]=cL(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:uA(e.remoteSerializer,r.mutation)}}function cL(e,t){let r=t.path.lastSegment();return[e,nZ(t.path.popLast()),r]}function cF(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function cB(e,t){let r=t?new nS(t.sequenceNumber,new nT(cS(t.readTime),new r5(n2(t.documentKey)),t.largestBatchId)):nS.empty(),n=e.fields.map(([e,t])=>new n_(r4.fromServerFormat(e),t));return new nf(e.indexId,e.collectionGroup,n,r)}function cj(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:cb(n.readTime),documentKey:nZ(n.documentKey.path),largestBatchId:n.largestBatchId}}class cq{getBundleMetadata(e,t){return cU(e).get(t).next(e=>{if(e)return cI(e)})}saveBundleMetadata(e,t){return cU(e).put(cR(t))}getNamedQuery(e,t){return cV(e).get(t).next(e=>{if(e)return cx(e)})}saveNamedQuery(e,t){return cV(e).put(cD(t))}}function cU(e){return st(e,iO)}function cV(e){return st(e,iN)}class cz{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new cz(e,t.uid||"")}getOverlay(e,t){return cH(e).get(cL(this.userId,t)).next(e=>e?cP(this.serializer,e):null)}getOverlays(e,t){let r=oG();return nx.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new lF(t,i);n.push(this.saveOverlay(e,s))}),nx.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(nZ(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(cH(e).deleteAll(iQ,n))}),nx.waitFor(i)}getOverlaysForCollection(e,t,r){let n=oG(),i=nZ(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return cH(e).loadAll(iQ,s).next(e=>{for(let t of e){let e=cP(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=oG(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return cH(e).iterate({index:iJ,range:a},(e,t,r)=>{let a=cP(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}saveOverlay(e,t){return cH(e).put(cM(this.serializer,this.userId,t))}}function cH(e){return st(e,iK)}class cW{globalsStore(e){return st(e,iZ)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(e=>{let t=e?.value;return t?sy.fromUint8Array(t):sy.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}}let c$=5,cK=10,cG=13,cQ=15,cY=20,cJ=25,cX=30,cZ=37,c0=45,c1=50,c2=53,c3=55,c6=60,c4=2;class c5{writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,c$);else if("booleanValue"in e)this.writeValueTypeLabel(t,cK),t.writeNumber(+!!e.booleanValue);else if("integerValue"in e)this.writeValueTypeLabel(t,cQ),t.writeNumber(sC(e.integerValue));else if("doubleValue"in e){let r=sC(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,cG):(this.writeValueTypeLabel(t,cQ),sB(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,cY),"string"==typeof r&&(r=sS(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,cX),t.writeBytes(sw(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,c0),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?ab(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):av(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):rp(19022,{indexValue:e})}writeIndexString(e,t){this.writeValueTypeLabel(t,cJ),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};for(let e of(this.writeValueTypeLabel(t,c3),Object.keys(r)))this.writeIndexString(e,t),this.writeIndexValueAux(r[e],t)}writeIndexVector(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,c2);let n=sH,i=r[n].arrayValue?.values?.length||0;this.writeValueTypeLabel(t,cQ),t.writeNumber(sC(i)),this.writeIndexString(n,t),this.writeIndexValueAux(r[n],t)}writeIndexArray(e,t){let r=e.values||[];for(let e of(this.writeValueTypeLabel(t,c1),r))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,cZ),r5.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,c6),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(c4)}}c5.INSTANCE=new c5;let c8="\uD800",c9="\uDBFF",c7=0,he=255,ht=1,hr=255,hn=255,hi=0,hs=64,ha=8,ho=1024;function hl(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function hu(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function hc(e){let t=0;for(let r=0;r<8;++r){let n=hu(255&e[r]);if(t+=n,8!==n)break}return t}function hh(e){return Math.ceil((hs-hc(e))/ha)}class hd{constructor(){this.buffer=new Uint8Array(ho),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<c8||c9<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{let e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<c8||c9<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{let e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=hh(t);this.ensureAvailable(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){let t=this.toOrderedBits(e),r=hh(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(hr),this.writeEscapedByteAscending(hn)}writeInfinityDescending(){this.writeEscapedByteDescending(hr),this.writeEscapedByteDescending(hn)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=hl(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!r;return t}writeByteAscending(e){let t=255&e;t===c7?(this.writeEscapedByteAscending(c7),this.writeEscapedByteAscending(he)):t===hr?(this.writeEscapedByteAscending(hr),this.writeEscapedByteAscending(hi)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=255&e;t===c7?(this.writeEscapedByteDescending(c7),this.writeEscapedByteDescending(he)):t===hr?(this.writeEscapedByteDescending(hr),this.writeEscapedByteDescending(hi)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(c7),this.writeEscapedByteAscending(ht)}writeSeparatorDescending(){this.writeEscapedByteDescending(c7),this.writeEscapedByteDescending(ht)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class hf{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class hp{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class hg{constructor(){this.orderedCode=new hd,this.ascending=new hf(this.orderedCode),this.descending=new hp(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class hm{constructor(e,t,r,n){this._indexId=e,this._documentKey=t,this._arrayValue=r,this._directionalValue=n}successor(){let e=this._directionalValue.length,t=0===e||255===this._directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this._directionalValue,0),t!==e?r.set([0],this._directionalValue.length):++r[r.length-1],new hm(this._indexId,this._documentKey,this._arrayValue,r)}dbIndexEntry(e,t,r){return{indexId:this._indexId,uid:e,arrayValue:h_(this._arrayValue),directionalValue:h_(this._directionalValue),orderedDocumentKey:h_(t),documentKey:r.path.toArray()}}dbIndexEntryKey(e,t,r){let n=this.dbIndexEntry(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function hy(e,t){let r=e._indexId-t._indexId;return 0!==r||0!==(r=hv(e._arrayValue,t._arrayValue))||0!==(r=hv(e._directionalValue,t._directionalValue))?r:r5.comparator(e._documentKey,t._documentKey)}function hv(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function h_(e){return ey()?hS(e):e}function hb(e){return"string"!=typeof e?e:hC(e)}function hS(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}function hC(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}class hw{constructor(e){for(const t of(this.inequalityFilters=new sc((e,t)=>r4.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){const e=t;e.isInequality()?this.inequalityFilters=this.inequalityFilters.add(e):this.equalityFilters.push(e)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(rm(e.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let t=np(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let r=ng(e),n=new Set,i=0,s=0;for(;i<r.length;++i)if(this.hasMatchingEqualityFilter(r[i]))n=n.add(r[i].fieldPath.canonicalString());else break;if(i===r.length)return!0;if(this.inequalityFilters.size>0){let e=this.inequalityFilters.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.matchesFilter(e,t)||!this.matchesOrderBy(this.orderBys[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new sc(r4.comparator),t=[];for(let r of this.equalityFilters)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new n_(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new n_(r.field,0))}for(let r of this.orderBys)!r.field.isKeyField()&&(e.has(r.field)||(e=e.add(r.field),t.push(new n_(r.field,+("asc"!==r.dir)))));return new nf(nf.UNKNOWN_ID,this.collectionId,t,nS.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function hT(e){if(rm(e instanceof aq||e instanceof aU,20012),e instanceof aq)if(!(e instanceof a4))return e;else{let t=e.value.arrayValue?.values?.map(t=>aq.create(e.field,"==",t))||[];return aU.create(t,"or")}let t=e.filters.map(e=>hT(e));return aU.create(t,e.op)}function hE(e){if(0===e.getFilters().length)return[];let t=hD(hT(e));return(rm(hR(t),7391),hk(t)||hI(t))?[t]:t.getFilters()}function hk(e){return e instanceof aq}function hI(e){return e instanceof aU&&aH(e)}function hR(e){return hk(e)||hI(e)||hx(e)}function hx(e){if(e instanceof aU&&az(e)){for(let t of e.getFilters())if(!hk(t)&&!hI(t))return!1;return!0}return!1}function hD(e){if(rm(e instanceof aq||e instanceof aU,34018),e instanceof aq)return e;if(1===e.filters.length)return hD(e.filters[0]);let t=e.filters.map(e=>hD(e)),r=aU.create(t,e.op);return hR(r=hM(r))?r:(rm(r instanceof aU,64498),rm(aV(r),40251),rm(r.filters.length>1,57927),r.filters.reduce((e,t)=>hO(e,t)))}function hO(e,t){let r;return rm(e instanceof aq||e instanceof aU,38388),rm(t instanceof aq||t instanceof aU,25473),hM(r=e instanceof aq?t instanceof aq?hA(e,t):hP(e,t):t instanceof aq?hP(t,e):hN(e,t))}function hA(e,t){return aU.create([e,t],"and")}function hN(e,t){if(rm(e.filters.length>0&&t.filters.length>0,48005),aV(e)&&aV(t))return aY(e,t.getFilters());let r=az(e)?e:t,n=az(e)?t:e,i=r.filters.map(e=>hO(e,n));return aU.create(i,"or")}function hP(e,t){if(aV(t))return aY(t,e.getFilters());{let r=t.filters.map(t=>hO(e,t));return aU.create(r,"or")}}function hM(e){if(rm(e instanceof aq||e instanceof aU,11850),e instanceof aq)return e;let t=e.getFilters();if(1===t.length)return hM(t[0]);if(aW(e))return e;let r=t.map(e=>hM(e)),n=[];return(r.forEach(t=>{t instanceof aq?n.push(t):t instanceof aU&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length)?n[0]:aU.create(n,e.op)}class hL{constructor(){this.collectionParentIndex=new hF}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),nx.resolve()}getCollectionParents(e,t){return nx.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return nx.resolve()}deleteFieldIndex(e,t){return nx.resolve()}deleteAllFieldIndexes(e){return nx.resolve()}createTargetIndexes(e,t){return nx.resolve()}getDocumentsMatchingTarget(e,t){return nx.resolve(null)}getIndexType(e,t){return nx.resolve(0)}getFieldIndexes(e,t){return nx.resolve([])}getNextCollectionGroupToUpdate(e){return nx.resolve(null)}getMinOffset(e,t){return nx.resolve(nT.min())}getMinOffsetFromCollectionGroup(e,t){return nx.resolve(nT.min())}updateCollectionGroup(e,t,r){return nx.resolve()}updateIndexEntries(e,t){return nx.resolve()}}class hF{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new sc(r3.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new sc(r3.comparator)).toArray()}}let hB="IndexedDbIndexManager",hj=new Uint8Array(0);class hq{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new hF,this.targetToDnfSubTargets=new oU(e=>oe(e),(e,t)=>or(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let i={collectionId:r,parent:nZ(n)};return hU(e).put(i)}return nx.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[r0(t),""],!1,!0);return hU(e).loadAll(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(n2(n.parent))}return r})}addFieldIndex(e,t){let r=hz(e),n=cF(t);delete n.indexId;let i=r.add(n);if(!t.indexState)return i.next();{let r=hH(e);return i.next(e=>{r.put(cj(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){let r=hz(e),n=hH(e),i=hV(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=hz(e),r=hV(e),n=hH(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>n.deleteAll())}createTargetIndexes(e,t){return nx.forEach(this.getSubTargets(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new hw(t).buildTargetIndex();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=hV(e),n=!0,i=new Map;return nx.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(!n)return nx.resolve(null);{let e=o0(),n=[];return nx.forEach(i,(i,s)=>{rc(hB,`Using index ${nv(i)} to execute ${oe(t)}`);let a=os(s,i),o=oa(s,i),l=oo(s,i),u=ol(s,i),c=this.encodeBound(i,s,l),h=this.encodeBound(i,s,u),d=this.encodeValues(i,s,o),f=this.generateIndexRanges(i.indexId,a,c,l.inclusive,h,u.inclusive,d);return nx.forEach(f,i=>r.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{let r=r5.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:hE(aU.create(e.filters,"and")).map(t=>a7(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let c=0;c<o;++c){let o=t?this.encodeSingleElement(t[c/l]):hj,h=this.generateLowerBound(e,o,r[c%l],n),d=this.generateUpperBound(e,o,i[c%l],s),f=a.map(t=>this.generateLowerBound(e,o,t,!0));u.push(...this.createRange(h,d,f))}return u}generateLowerBound(e,t,r,n){let i=new hm(e,r5.empty(),t,r);return n?i:i.successor()}generateUpperBound(e,t,r,n){let i=new hm(e,r5.empty(),t,r);return n?i.successor():i}getFieldIndex(e,t){let r=new hw(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.servedByIndex(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.getSubTargets(t);return nx.forEach(n,t=>this.getFieldIndex(e,t).next(e=>{e?0!==r&&e.fields.length<oh(t)&&(r=1):r=0})).next(()=>od(t)&&n.length>1&&2===r?1:r)}encodeDirectionalElements(e,t){let r=new hg;for(let n of ng(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.forKind(n.kind);c5.INSTANCE.writeIndexValue(e,i)}return r.encodedBytes()}encodeSingleElement(e){let t=new hg;return c5.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new hg;return c5.INSTANCE.writeIndexValue(ac(this.databaseId,t),r.forKind(nm(e))),r.encodedBytes()}encodeValues(e,t,r){if(null===r)return[];let n=[];n.push(new hg);let i=0;for(let s of ng(e)){let e=r[i++];for(let r of n)if(this.isInFilter(t,s.fieldPath)&&ap(e))n=this.expandIndexValues(n,s,e);else{let t=r.forKind(s.kind);c5.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(n)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new hg;n.seed(r.encodedBytes()),c5.INSTANCE.writeIndexValue(e,n.forKind(t.kind)),i.push(n)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof aq&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=hz(e),n=hH(e);return(t?r.loadAll(iF,IDBKeyRange.bound(t,t)):r.loadAll()).next(e=>{let t=[];return nx.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{t.push(cB(e,r))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:rG(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=hz(e),i=hH(e);return this.getNextSequenceNumber(e).next(e=>n.loadAll(iF,IDBKeyRange.bound(t,t)).next(t=>nx.forEach(t,t=>i.put(cj(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return nx.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?nx.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),nx.forEach(i,r=>this.getExistingIndexEntries(e,t,r).next(t=>{let i=this.computeIndexEntries(n,r);return t.isEqual(i)?nx.resolve():this.updateEntries(e,n,r,t,i)}))))})}addIndexEntry(e,t,r,n){return hV(e).put(n.dbIndexEntry(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}deleteIndexEntry(e,t,r,n){return hV(e).delete(n.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}getExistingIndexEntries(e,t,r){let n=hV(e),i=new sc(hy);return n.iterate({index:iW,range:IDBKeyRange.only([r.indexId,this.uid,h_(this.encodeDirectionalKey(r,t))])},(e,n)=>{i=i.add(new hm(r.indexId,t,hb(n.arrayValue),hb(n.directionalValue)))}).next(()=>i)}computeIndexEntries(e,t){let r=new sc(hy),n=this.encodeDirectionalElements(t,e);if(null==n)return r;let i=np(t);if(null!=i){let s=e.data.field(i.fieldPath);if(ap(s))for(let i of s.arrayValue.values||[])r=r.add(new hm(t.indexId,e.key,this.encodeSingleElement(i),n))}else r=r.add(new hm(t.indexId,e.key,hj,n));return r}updateEntries(e,t,r,n,i){rc(hB,"Updating index entries for document '%s'",t.key);let s=[];return sd(n,i,hy,n=>{s.push(this.addIndexEntry(e,t,r,n))},n=>{s.push(this.deleteIndexEntry(e,t,r,n))}),nx.waitFor(s)}getNextSequenceNumber(e){let t=1;return hH(e).iterate({index:iU,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>hy(e,t)).filter((e,t,r)=>!t||0!==hy(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=hy(i,e),s=hy(i,t);if(0===r)n[0]=e.successor();else if(r>0&&s<0)n.push(i),n.push(i.successor());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.isRangeMatchable(n[e],n[e+1]))return[];let t=n[e].dbIndexEntryKey(this.uid,hj,r5.empty()),r=n[e+1].dbIndexEntryKey(this.uid,hj,r5.empty());i.push(IDBKeyRange.bound(t,r))}return i}isRangeMatchable(e,t){return hy(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(hW)}getMinOffset(e,t){return nx.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||rp(44426))).next(hW)}}function hU(e){return st(e,iI)}function hV(e){return st(e,iz)}function hz(e){return st(e,iM)}function hH(e){return st(e,ij)}function hW(e){rm(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>nE(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new nT(t.readTime,t.documentKey,r)}function h$(e,t,r){let n=e.store(n9),i=e.store(io),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.iterate({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{rm(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){let n=is(t,e.key.path,r.batchId);s.push(i.delete(n)),u.push(e.key)}return nx.waitFor(s).next(()=>u)}function hK(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw rp(14731);return JSON.stringify(t).length}class hG{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.documentKeysByBatchId={}}static forUser(e,t,r,n){return rm(""!==e.uid,64387),new hG(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return hJ(e).iterate({index:ie,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=hX(e),s=hJ(e);return s.add({}).next(a=>{rm("number"==typeof a,49019);let o=new lM(a,t,r,n),l=cC(this.serializer,this.userId,o),u=[],c=new sc((e,t)=>rG(e.canonicalString(),t.canonicalString()));for(let e of n){let t=is(this.userId,e.key.path,a);c=c.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,ia))}return c.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=o.keys()}),nx.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return hJ(e).get(t).next(e=>e?(rm(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),cw(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?nx.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{let r=e.keys();return this.documentKeysByBatchId[t]=r,r}})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return hJ(e).iterate({index:ie,range:n},(e,t,n)=>{t.userId===this.userId&&(rm(t.batchId>=r,47524,{nextBatchId:r}),i=cw(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=sL;return hJ(e).iterate({index:ie,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,sL],[this.userId,1/0]);return hJ(e).loadAll(ie,t).next(e=>e.map(e=>cw(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=ii(this.userId,t.path),n=IDBKeyRange.lowerBound(r),i=[];return hX(e).iterate({range:n},(r,n,s)=>{let[a,o,l]=r,u=n2(o);return a===this.userId&&t.path.isEqual(u)?hJ(e).get(l).next(e=>{if(!e)throw rp(61480,{indexKey:r,batchId:l});rm(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(cw(this.serializer,e))}):void s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new sc(rG),n=[];return t.forEach(t=>{let i=ii(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=hX(e).iterate({range:s},(e,n,i)=>{let[s,a,o]=e,l=n2(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),nx.waitFor(n).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=ii(this.userId,r),s=IDBKeyRange.lowerBound(i),a=new sc(rG);return hX(e).iterate({range:s},(e,t,i)=>{let[s,o,l]=e,u=n2(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],n=[];return t.forEach(t=>{n.push(hJ(e).get(t).next(e=>{if(null===e)throw rp(35274,{batchId:t});rm(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(cw(this.serializer,e))}))}),nx.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return h$(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),nx.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return nx.resolve();let r=IDBKeyRange.lowerBound(ir(this.userId)),n=[];return hX(e).iterate({range:r},(e,t,r)=>{if(e[0]!==this.userId)return void r.done();{let t=n2(e[1]);n.push(t)}}).next(()=>{rm(0===n.length,56720,{danglingKeys:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return hQ(e,this.userId,t)}getMutationQueueMetadata(e){return hZ(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:sL,lastStreamToken:""})}}function hQ(e,t,r){let n=ii(t,r.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return hX(e).iterate({range:s,keysOnly:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function hY(e,t){let r=!1;return hZ(e).iterateSerial(n=>hQ(e,n,t).next(e=>(e&&(r=!0),nx.resolve(!e)))).next(()=>r)}function hJ(e){return st(e,n9)}function hX(e){return st(e,io)}function hZ(e){return st(e,n5)}let h0=2;class h1{constructor(e){this.lastId=e}next(){return this.lastId+=h0,this.lastId}static forTargetCache(){return new h1(2-h0)}static forSyncEngine(){return new h1(1-h0)}}class h2{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new h1(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>nc.fromTimestamp(new nu(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.saveMetadata(e,n)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>h3(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(rm(t.targetCount>0,8065),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,r){let n=0,i=[];return h3(e).iterate((s,a)=>{let o=cT(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>nx.waitFor(i)).next(()=>n)}forEachTarget(e,t){return h3(e).iterate((e,r)=>{t(cT(r))})}retrieveMetadata(e){return h6(e).get(iE).next(e=>(rm(null!==e,2888),e))}saveMetadata(e,t){return h6(e).put(iE,t)}saveTargetData(e,t){return h3(e).put(cE(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let r=oe(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return h3(e).iterate({range:n,index:i_},(e,r,n)=>{let s=cT(r);or(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=h4(e);return t.forEach(t=>{let s=nZ(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),nx.waitFor(n)}removeMatchingKeys(e,t,r){let n=h4(e);return nx.forEach(t,t=>{let i=nZ(t.path);return nx.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=h4(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=h4(e),i=o0();return n.iterate({range:r,keysOnly:!0},(e,t,r)=>{let n=new r5(n2(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=nZ(t.path),n=IDBKeyRange.bound([r],[r0(r)],!1,!0),i=0;return h4(e).iterate({index:iw,keysOnly:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return h3(e).get(t).next(e=>e?cT(e):null)}}function h3(e){return st(e,iy)}function h6(e){return st(e,ik)}function h4(e){return st(e,iS)}let h5={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},h8=-1,h9=0x2800000;class h7{static withCacheSize(e){return new h7(e,h7.DEFAULT_COLLECTION_PERCENTILE,h7.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}h7.DEFAULT_COLLECTION_PERCENTILE=10,h7.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,h7.DEFAULT=new h7(h9,h7.DEFAULT_COLLECTION_PERCENTILE,h7.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),h7.DISABLED=new h7(h8,0,0);let de="LruGarbageCollector",dt=1048576,dr=6e4,dn=3e5;function di([e,t],[r,n]){let i=rG(e,r);return 0===i?rG(t,n):i}class ds{constructor(e){this.maxElements=e,this.buffer=new sc(di),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>di(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class da{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==h8&&this.scheduleGC(dr)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){rc(de,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){nF(e)?rc(de,"Ignoring IndexedDB error during garbage collection: ",e):await nR(e)}await this.scheduleGC(dn)})}}class dl{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return nx.resolve(nG.INVALID);let r=new ds(t);return this.delegate.forEachTarget(e,e=>r.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>r.addElement(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===h8?(rc("LruGarbageCollector","Garbage collection skipped; disabled"),nx.resolve(h5)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(rc("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),h5):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,n,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(rc("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),ru()<=f.DEBUG&&rc("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${n} in ${a-s}ms
	Removed ${i} targets in ${o-a}ms
	Removed ${e} documents in ${l-o}ms
Total Duration: ${l-u}ms`),nx.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}function du(e,t){return new dl(e,t)}class dc{constructor(e,t){this.db=e,this.garbageCollector=du(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,r)=>t(r))}addReference(e,t,r){return df(e,r)}removeReference(e,t,r){return df(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return df(e,t)}isPinned(e,t){return hY(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.forEachOrphanedDocument(e,(s,a)=>{if(a<=t){let t=this.isPinned(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,nc.min()),h4(e).delete(dh(s))))});n.push(t)}}).next(()=>nx.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return df(e,t)}forEachOrphanedDocument(e,t){let r,n=h4(e),i=nG.INVALID;return n.iterate({index:iw},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==nG.INVALID&&t(new r5(n2(r)),i),i=a,r=s):i=nG.INVALID}).next(()=>{i!==nG.INVALID&&t(new r5(n2(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function dh(e){return[0,nZ(e.path)]}function dd(e,t){return{targetId:0,path:nZ(e.path),sequenceNumber:t}}function df(e,t){return h4(e).put(dd(t,e.currentSequenceNumber))}class dp{constructor(){this.changes=new oU(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,aR.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?nx.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class dg{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return d_(e).put(r)}removeEntry(e,t,r){return d_(e).delete(dS(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=aR.newInvalidDocument(t);return d_(e).iterate({index:ic,range:IDBKeyRange.only(db(t))},(e,n)=>{r=this.maybeDecodeDocument(t,n)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:aR.newInvalidDocument(t)};return d_(e).iterate({index:ic,range:IDBKeyRange.only(db(t))},(e,n)=>{r={document:this.maybeDecodeDocument(t,n),size:hK(n)}}).next(()=>r)}getEntries(e,t){let r=oz();return this.forEachDbEntry(e,t,(e,t)=>{let n=this.maybeDecodeDocument(e,t);r=r.insert(e,n)}).next(()=>r)}getSizedEntries(e,t){let r=oz(),n=new sa(r5.comparator);return this.forEachDbEntry(e,t,(e,t)=>{let i=this.maybeDecodeDocument(e,t);r=r.insert(e,i),n=n.insert(e,hK(t))}).next(()=>({documents:r,sizeMap:n}))}forEachDbEntry(e,t,r){if(t.isEmpty())return nx.resolve();let n=new sc(dw);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(db(n.first()),db(n.last())),s=n.getIterator(),a=s.getNext();return d_(e).iterate({index:ic,range:i},(e,t,n)=>{let i=r5.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>dw(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.skip(db(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),cv(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return d_(e).loadAll(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=oz();for(let i of e){let e=this.maybeDecodeDocument(r5.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(oN(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=oz(),s=dC(t,r),a=dC(t,nT.max());return d_(e).iterate({index:id,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.maybeDecodeDocument(r5.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new dy(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return dv(e).get(im).next(e=>(rm(!!e,20021),e))}setMetadata(e,t){return dv(e).put(im,t)}maybeDecodeDocument(e,t){if(t){let e=cm(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(nc.min())))return e}return aR.newInvalidDocument(e)}}function dm(e){return new dg(e)}class dy extends dp{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new oU(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new sc((e,t)=>rG(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=cy(this.documentCache.serializer,s);n=n.add(i.path.popLast());let l=hK(o);r+=l-a.size,t.push(this.documentCache.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=cy(this.documentCache.serializer,s.convertToNoDocument(nc.min()));t.push(this.documentCache.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.documentCache.updateMetadata(e,r)),nx.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,r)=>{this.documentStates.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function dv(e){return st(e,ig)}function d_(e){return st(e,il)}function db(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function dS(e,t){let r=e.path.toArray();return[r.slice(0,r.length-2),r[r.length-2],cv(t),r[r.length-1]]}function dC(e,t){let r=t.documentKey.path.toArray();return[e,cv(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function dw(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=rG(r[e],n[e]))return i;return(i=rG(r.length,n.length))||(i=rG(r[r.length-2],n[n.length-2]))?i:rG(r[r.length-1],n[n.length-1])}let dT=18;class dE{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class dk{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&l_(r.mutation,e,sp.empty(),nu.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,o0()).next(()=>t))}getLocalViewOfDocuments(e,t,r=o0()){let n=oG();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=oW();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=oG();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,o0()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=oz(),s=oY(),a=o$();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof lE)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),l_(a.mutation,t,a.mutation.getFieldMask(),nu.now())):s.set(t.key,sp.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new dE(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=oY(),n=new sa((e,t)=>e-t),i=o0();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||sp.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||o0()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=oQ();l.forEach(e=>{if(!i.has(e)){let n=ly(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return nx.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return o_(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ob(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):nx.resolve(oG()),a=nh,o=i;return s.next(t=>nx.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t))?nx.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,o0())).next(e=>({batchId:a,changes:oK(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new r5(t)).next(e=>{let t=oW();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=oW();return this.indexManager.getCollectionParents(e,i).next(a=>nx.forEach(a,a=>{let o=om(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,aR.newInvalidDocument(n)))});let r=oW();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&l_(s.mutation,n,sp.empty(),nu.now()),oN(t,n)&&(r=r.insert(e,n))}),r})}}class dI{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return nx.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,cN(t)),nx.resolve()}getNamedQuery(e,t){return nx.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,cA(t)),nx.resolve()}}class dR{constructor(){this.overlays=new sa(r5.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return nx.resolve(this.overlays.get(t))}getOverlays(e,t){let r=oG();return nx.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.saveOverlay(e,t,n)}),nx.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.overlayByBatchId.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(r)),nx.resolve()}getOverlaysForCollection(e,t,r){let n=oG(),i=t.length+1,s=new r5(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return nx.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new sa((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=oG(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=oG(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return nx.resolve(a)}saveOverlay(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.overlayByBatchId.get(n.largestBatchId).delete(r.key);this.overlayByBatchId.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new lF(t,r));let i=this.overlayByBatchId.get(t);void 0===i&&(i=o0(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(r.key))}}class dx{constructor(){this.sessionToken=sy.EMPTY_BYTE_STRING}getSessionToken(e){return nx.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,nx.resolve()}}class dD{constructor(){this.refsByKey=new sc(dO.compareByKey),this.refsByTarget=new sc(dO.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new dO(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new dO(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){let t=new r5(new r3([])),r=new dO(t,e),n=new dO(t,e+1),i=[];return this.refsByTarget.forEachInRange([r,n],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new r5(new r3([])),r=new dO(t,e),n=new dO(t,e+1),i=o0();return this.refsByTarget.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new dO(e,0),r=this.refsByKey.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class dO{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return r5.comparator(e.key,t.key)||rG(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return rG(e.targetOrBatchId,t.targetOrBatchId)||r5.comparator(e.key,t.key)}}class dA{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new sc(dO.compareByKey)}checkEmpty(e){return nx.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new lM(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new dO(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return nx.resolve(s)}lookupMutationBatch(e,t){return nx.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=this.indexOfBatchId(r),i=n<0?0:n;return nx.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return nx.resolve(0===this.mutationQueue.length?sL:this.nextBatchId-1)}getAllMutationBatches(e){return nx.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new dO(t,0),n=new dO(t,1/0),i=[];return this.batchesByDocumentKey.forEachInRange([r,n],e=>{let t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),nx.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new sc(rG);return t.forEach(e=>{let t=new dO(e,0),n=new dO(e,1/0);this.batchesByDocumentKey.forEachInRange([t,n],e=>{r=r.add(e.targetOrBatchId)})}),nx.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;r5.isDocumentKey(i)||(i=i.child(""));let s=new dO(new r5(i),0),a=new sc(rG);return this.batchesByDocumentKey.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.targetOrBatchId)),!0)},s),nx.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(e=>{let r=this.findMutationBatch(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){rm(0===this.indexOfExistingBatchId(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return nx.forEach(t.mutations,n=>{let i=new dO(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new dO(t,0),n=this.batchesByDocumentKey.firstAfterOrEqual(r);return nx.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,nx.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}let dN="-9223372036854775808";function dP(){return new sa(r5.comparator)}class dM{constructor(e){this.sizer=e,this.docs=dP(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return nx.resolve(r?r.document.mutableCopy():aR.newInvalidDocument(t))}getEntries(e,t){let r=oz();return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():aR.newInvalidDocument(e))}),nx.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=oz(),s=t.path,a=new r5(s.child("__id"+dN+"__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=nE(nw(a),r))&&(n.has(a.key)||oN(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return nx.resolve(i)}getAllFromCollectionGroup(e,t,r,n){rp(9500)}forEachDocumentKey(e,t){return nx.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new dF(this)}getSize(e){return nx.resolve(this.size)}}function dL(e){return new dM(e)}class dF extends dp{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.documentCache.addEntry(e,n)):this.documentCache.removeEntry(r)}),nx.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}class dB{constructor(e){this.persistence=e,this.targets=new oU(e=>oe(e),or),this.lastRemoteSnapshotVersion=nc.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new dD,this.targetCount=0,this.targetIdGenerator=h1.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,r)=>t(r)),nx.resolve()}getLastRemoteSnapshotVersion(e){return nx.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return nx.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),nx.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),nx.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new h1(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,nx.resolve()}updateTargetData(e,t){return this.saveTargetData(t),nx.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,nx.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.targets.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),nx.waitFor(i).next(()=>n)}getTargetCount(e){return nx.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return nx.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),nx.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),nx.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),nx.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return nx.resolve(r)}containsKey(e,t){return nx.resolve(this.references.containsKey(t))}}let dj="MemoryPersistence";class dq{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new nG(0),this._started=!1,this._started=!0,this.globalsCache=new dx,this.referenceDelegate=e(this),this.targetCache=new dB(this);const r=e=>this.referenceDelegate.documentSize(e);this.indexManager=new hL,this.remoteDocumentCache=dL(r),this.serializer=new cg(t),this.bundleCache=new dI(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dR,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new dA(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){rc(dj,"Starting transaction:",e);let n=new dU(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(n).next(e=>this.referenceDelegate.onTransactionCommitted(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return nx.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}}class dU extends nI{constructor(e){super(),this.currentSequenceNumber=e}}class dV{constructor(e){this.persistence=e,this.localViewReferences=new dD,this._orphanedDocuments=null}static factory(e){return new dV(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw rp(60996)}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),nx.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),nx.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),nx.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nx.forEach(this.orphanedDocuments,r=>{let n=r5.fromPath(r);return this.isReferenced(e,n).next(e=>{e||t.removeEntry(n,nc.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return nx.or([()=>nx.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class dz{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new oU(e=>nZ(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=du(this,t)}static factory(e,t){return new dz(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return nx.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return nx.forEach(this.orphanedSequenceNumbers,(r,n)=>this.isPinned(e,r,n).next(e=>e?nx.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.forEachDocumentKey(e,n=>this.isPinned(e,n,t).next(e=>{e||(r++,i.removeEntry(n,nc.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),nx.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),nx.resolve()}removeReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),nx.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),nx.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ao(e.data.value)),t}isPinned(e,t,r){return nx.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.orphanedSequenceNumbers.get(t);return nx.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class dH{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,n){let i=new nA("createOrUpgrade",t);r<1&&n>=1&&(d$(e),dK(e),dX(e),dQ(e));let s=nx.resolve();return r<3&&n>=3&&(0!==r&&(dZ(e),dX(e)),s=s.next(()=>d1(i))),r<4&&n>=4&&(0!==r&&(s=s.next(()=>dG(e,i))),s=s.next(()=>{d2(e)})),r<5&&n>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),r<6&&n>=6&&(s=s.next(()=>(dJ(e),this.addDocumentGlobal(i)))),r<7&&n>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),r<8&&n>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),r<9&&n>=9&&(s=s.next(()=>{d0(e)})),r<10&&n>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),r<11&&n>=11&&(s=s.next(()=>{d3(e),d6(e)})),r<12&&n>=12&&(s=s.next(()=>{d5(e)})),r<13&&n>=13&&(s=s.next(()=>dY(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(n3))),r<14&&n>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),r<15&&n>=15&&(s=s.next(()=>d4(e))),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(ij).clear()}).next(()=>{t.objectStore(iz).clear()})),r<17&&n>=17&&(s=s.next(()=>{d8(e)})),r<18&&n>=18&&ey()&&(s=s.next(()=>{t.objectStore(ij).clear()}).next(()=>{t.objectStore(iz).clear()})),s}addDocumentGlobal(e){let t=0;return e.store(n3).iterate((e,r)=>{t+=hK(r)}).next(()=>{let r={byteSize:t};return e.store(ig).put(im,r)})}removeAcknowledgedMutations(e){let t=e.store(n5),r=e.store(n9);return t.loadAll().next(t=>nx.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,sL],[t.userId,t.lastAcknowledgedBatchId]);return r.loadAll(ie,n).next(r=>nx.forEach(r,r=>{rm(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=cw(this.serializer,r);return h$(e,t.userId,n).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(iS),r=e.store(n3);return e.store(ik).get(iE).next(e=>{let n=r=>t.put({targetId:0,path:nZ(r),sequenceNumber:e.highestListenSequenceNumber}),i=[];return r.iterate((e,r)=>{let s=new r3(e),a=dW(s);i.push(t.get(a).next(e=>e?nx.resolve():n(s)))}).next(()=>nx.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(iI,{keyPath:iR});let r=t.store(iI),n=new hF,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:nZ(n)})}};return t.store(n3).iterate({keysOnly:!0},(e,t)=>i(new r3(e).popLast())).next(()=>t.store(io).iterate({keysOnly:!0},([e,t,r],n)=>i(n2(t).popLast())))}rewriteCanonicalIds(e){let t=e.store(iy);return t.iterate((e,r)=>{let n=cT(r),i=cE(this.serializer,n);return t.put(i)})}rewriteRemoteDocumentCache(e,t){let r=t.store(n3),n=[];return r.iterate((e,r)=>{let i=t.store(il),s=d9(r).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>nx.waitFor(n))}runOverlayMigration(e,t){let r=t.store(n9),n=dm(this.serializer),i=new dq(dV.factory,this.serializer.remoteSerializer);return r.loadAll().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??o0();cw(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),nx.forEach(r,(e,r)=>{let s=new ri(r),a=cz.forUser(this.serializer,s),o=i.getIndexManager(s);return new dk(n,hG.forUser(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new se(t,nG.INVALID),e).next()})})}}function dW(e){return[0,nZ(e)]}function d$(e){e.createObjectStore(n6)}function dK(e){e.createObjectStore(n5,{keyPath:n8}),e.createObjectStore(n9,{keyPath:n7,autoIncrement:!0}).createIndex(ie,it,{unique:!0}),e.createObjectStore(io)}function dG(e,t){return t.store(n9).loadAll().next(r=>{e.deleteObjectStore(n9),e.createObjectStore(n9,{keyPath:n7,autoIncrement:!0}).createIndex(ie,it,{unique:!0});let n=t.store(n9),i=r.map(e=>n.put(e));return nx.waitFor(i)})}function dQ(e){e.createObjectStore(n3)}function dY(e){let t=e.createObjectStore(il,{keyPath:iu});t.createIndex(ic,ih),t.createIndex(id,ip)}function dJ(e){e.createObjectStore(ig)}function dX(e){e.createObjectStore(iS,{keyPath:iC}).createIndex(iw,iT,{unique:!0}),e.createObjectStore(iy,{keyPath:iv}).createIndex(i_,ib,{unique:!0}),e.createObjectStore(ik)}function dZ(e){e.deleteObjectStore(iS),e.deleteObjectStore(iy),e.deleteObjectStore(ik)}function d0(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function d1(e){let t=e.store(ik),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:nc.min().toTimestamp(),targetCount:0};return t.put(iE,r)}function d2(e){e.createObjectStore(ix,{keyPath:iD})}function d3(e){e.createObjectStore(iO,{keyPath:iA})}function d6(e){e.createObjectStore(iN,{keyPath:iP})}function d4(e){e.createObjectStore(iM,{keyPath:iL,autoIncrement:!0}).createIndex(iF,iB,{unique:!1}),e.createObjectStore(ij,{keyPath:iq}).createIndex(iU,iV,{unique:!1}),e.createObjectStore(iz,{keyPath:iH}).createIndex(iW,i$,{unique:!1})}function d5(e){let t=e.createObjectStore(iK,{keyPath:iG});t.createIndex(iQ,iY,{unique:!1}),t.createIndex(iJ,iX,{unique:!1})}function d8(e){e.createObjectStore(iZ,{keyPath:i0})}function d9(e){return e.document?new r5(r3.fromString(e.document.name).popFirst(5)):e.noDocument?r5.fromSegments(e.noDocument.path):e.unknownDocument?r5.fromSegments(e.unknownDocument.path):rp(36783)}let d7="IndexedDbPersistence",fe=18e5,ft=5e3,fr=4e3,fn="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",fi="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",fs="firestore_zombie",fa="main";class fo{constructor(e,t,r,n,i,s,a,o,l,u,c=dT){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=i,this.window=s,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=u,this.schemaVersion=c,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=-1/0,this.primaryStateListener=e=>Promise.resolve(),!fo.isAvailable())throw new rM(rO,fi);this.referenceDelegate=new dc(this,n),this.dbName=t+fa,this.serializer=new cg(o),this.simpleDb=new nN(this.dbName,this.schemaVersion,new dH(this.serializer)),this.globalsCache=new cW,this.targetCache=new h2(this.referenceDelegate,this.serializer),this.remoteDocumentCache=dm(this.serializer),this.bundleCache=new cq,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===u&&rh(d7,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new rM(rR,fn);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new nG(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>fu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(nF(e))return rc(d7,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return rc(d7,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return fl(e).get(n4).next(e=>nx.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return fu(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,fe)){this.lastGarbageCollectionTime=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=st(e,ix);return t.loadAll().next(e=>{let r=this.filterActiveClients(e,fe),n=e.filter(e=>-1===r.indexOf(e));return nx.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",fr,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?nx.resolve(!0):fl(e).get(n4).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,ft)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new rM(rR,fn);return!1}}return!!this.networkEnabled&&!!this.inForeground||fu(e).loadAll().next(e=>void 0===this.filterActiveClients(e,ft).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&rc(d7,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[n6,ix],e=>{let t=new se(e,nG.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>fu(e).loadAll().next(e=>this.filterActiveClients(e,fe).map(e=>e.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return hG.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new hq(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return cz.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){let n;rc(d7,"Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=i7(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(n=new se(i,this.listenSequence?this.listenSequence.next():nG.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(n).next(e=>!!e||this.canActAsPrimary(n)).next(t=>{if(!t)throw rh(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new rM(rR,nk);return r(n)}).next(e=>this.acquireOrExtendPrimaryLease(n).next(()=>e)):this.verifyAllowTabSynchronization(n).next(()=>r(n))).then(e=>(n.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return fl(e).get(n4).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,ft)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new rM(rR,fn)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return fl(e).put(n4,t)}static isAvailable(){return nN.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=fl(e);return t.get(n4).next(e=>this.isLocalClient(e)?(rc(d7,"Releasing primary lease."),t.delete(n4)):nx.resolve())}isWithinAge(e,t){let r=Date.now(),n=r-t,i=r;return!(e<n)&&(!(e>i)||(rh(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){"function"==typeof this.window?.addEventListener&&(this.windowUnloadHandler=()=>{this.markClientZombied();let e=/(?:Version|Mobile)\/1[456]/;em()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){try{let t=this.webStorage?.getItem(this.zombiedClientLocalStorageKey(e))!==null;return rc(d7,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return rh(d7,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){rh("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${fs}_${this.persistenceKey}_${e}`}}function fl(e){return st(e,n6)}function fu(e){return st(e,ix)}function fc(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}function fh(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])}function fd(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}let ff="LocalStore",fp=3e8;class fg{constructor(e,t,r,n){this.persistence=e,this.queryEngine=t,this.serializer=n,this.targetDataByTarget=new sa(rG),this.targetIdByTarget=new oU(e=>oe(e),or),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new dk(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function fm(e,t,r,n){return new fg(e,t,r,n)}async function fy(e,t){let r=ry(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(i=>(n=i,r.initializeUserComponents(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=o0();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return r.localDocuments.getDocuments(e,a).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function fv(e,t){let r,n,i=ry(e),s=nu.now(),a=t.reduce((e,t)=>e.add(t.key),o0());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=oz(),l=o0();return i.remoteDocuments.getEntries(e,a).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,o)).next(n=>{r=n;let a=[];for(let e of t){let t=lb(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new lE(e.key,t,aI(t.value.mapValue),lp.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{n=t;let s=t.applyToLocalDocumentSet(r,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:n.batchId,changes:oK(r)}))}function f_(e,t){let r=ry(e);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n=t.batch.keys(),i=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});return fN(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,fb(t))).next(()=>r.localDocuments.getDocuments(e,n))})}function fb(e){let t=o0();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}function fS(e,t){let r=ry(e);return r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(rm(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))})}function fC(e){let t=ry(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function fw(e,t){let r=ry(e),n=t.snapshotVersion,i=r.targetDataByTarget;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=r.targetDataByTarget;let a=[];t.targetChanges.forEach((s,o)=>{let l=i.get(o);if(!l)return;a.push(r.targetCache.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.targetCache.addMatchingKeys(e,s.addedDocuments,o)));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?u=u.withResumeToken(sy.EMPTY_BYTE_STRING,nc.min()).withLastLimboFreeSnapshotVersion(nc.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,n)),i=i.insert(o,u),fE(l,u,s)&&a.push(r.targetCache.updateTargetData(e,u))});let o=oz(),l=o0();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(fT(e,s,t.documentUpdates).next(e=>{o=e.changedDocuments,l=e.existenceChangedKeys})),!n.isEqual(nc.min())){let t=r.targetCache.getLastRemoteSnapshotVersion(e).next(t=>r.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return nx.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.targetDataByTarget=i,e))}function fT(e,t,r){let n=o0(),i=o0();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=oz();return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(nc.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):rc(ff,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{changedDocuments:n,existenceChangedKeys:i}})}function fE(e,t,r){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=fp)||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0}async function fk(e,t){let r=ry(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>nx.forEach(t,t=>nx.forEach(t.addedKeys,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>nx.forEach(t.removedKeys,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(nF(e))rc(ff,"Failed to update sequence numbers: "+e);else throw e}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=r.targetDataByTarget.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.targetDataByTarget=r.targetDataByTarget.insert(t,i)}}}function fI(e,t){let r=ry(e);return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=sL),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function fR(e,t){let r=ry(e);return r.persistence.runTransaction("read document","readonly",e=>r.localDocuments.getDocument(e,t))}function fx(e,t){let r=ry(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.targetCache.getTargetData(e,t).next(i=>i?(n=i,nx.resolve(n)):r.targetCache.allocateTargetId(e).next(i=>(n=new cp(t,i,"TargetPurposeListen",e.currentSequenceNumber),r.targetCache.addTargetData(e,n).next(()=>n))))}).then(e=>{let n=r.targetDataByTarget.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.targetDataByTarget=r.targetDataByTarget.insert(e.targetId,e),r.targetIdByTarget.set(t,e.targetId)),e})}function fD(e,t,r){let n=ry(e),i=n.targetIdByTarget.get(r);return void 0!==i?nx.resolve(n.targetDataByTarget.get(i)):n.targetCache.getTargetData(t,r)}async function fO(e,t,r){let n=ry(e),i=n.targetDataByTarget.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(nF(e))rc(ff,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(i.target)}function fA(e,t,r){let n=ry(e),i=nc.min(),s=o0();return n.persistence.runTransaction("Execute query","readwrite",e=>fD(n,e,oC(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>n.queryEngine.getDocumentsMatchingQuery(e,t,r?i:nc.min(),r?s:o0())).next(e=>(fj(n,oB(t),e),{documents:e,remoteKeys:s})))}function fN(e,t,r,n){let i=r.batch,s=i.keys(),a=nx.resolve();return s.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{let s=r.docVersions.get(e);rm(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function fP(e,t){let r=ry(e),n=ry(r.mutationQueue);return r.persistence.runTransaction("Lookup mutation documents","readonly",e=>n.lookupMutationKeys(e,t).next(t=>t?r.localDocuments.getDocuments(e,t):nx.resolve(null)))}function fM(e,t){ry(ry(e,fg).mutationQueue).removeCachedMutationKeys(t)}function fL(e){return ry(ry(e,fg).persistence).getActiveClients()}function fF(e,t){let r=ry(e),n=ry(r.targetCache),i=r.targetDataByTarget.get(t);return i?Promise.resolve(i.target):r.persistence.runTransaction("Get target data","readonly",e=>n.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function fB(e,t){let r=ry(e),n=r.collectionGroupReadTime.get(t)||nc.min();return r.persistence.runTransaction("Get new document changes","readonly",e=>r.remoteDocuments.getAllFromCollectionGroup(e,t,nC(n,nh),Number.MAX_SAFE_INTEGER)).then(e=>(fj(r,t,e),e))}function fj(e,t,r){let n=e.collectionGroupReadTime.get(t)||nc.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.collectionGroupReadTime.set(t,n)}function fq(e){return oC(og(r3.fromString(`__bundle__/docs/${e}`)))}async function fU(e,t,r,n){let i=ry(e),s=o0(),a=oz();for(let e of r){let r=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(r));let n=t.toMutableDocument(e);n.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),a=a.insert(r,n)}let o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await fx(i,fq(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>fT(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function fV(e,t){let r=ry(e),n=ud(t.createTime);return r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}function fz(e,t){let r=ry(e);return r.persistence.runTransaction("Save bundle","readwrite",e=>r.bundleCache.saveBundleMetadata(e,t))}function fH(e,t){let r=ry(e);return r.persistence.runTransaction("Get named query","readonly",e=>r.bundleCache.getNamedQuery(e,t))}async function fW(e,t,r=o0()){let n=await fx(e,oC(cO(t.bundledQuery))),i=ry(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=ud(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);let a=n.withResumeToken(sy.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(a.targetId,a),i.targetCache.updateTargetData(e,a).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,n.targetId)).next(()=>i.targetCache.addMatchingKeys(e,r,n.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}async function f$(e,t){let r=ry(e),n=r.indexManager,i=[];return r.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(r=>fh(r,t,ny,t=>{i.push(n.addFieldIndex(e,t))},t=>{i.push(n.deleteFieldIndex(e,t))})).next(()=>nx.waitFor(i)))}function fK(e,t){ry(e).queryEngine.indexAutoCreationEnabled=t}function fG(e){let t=ry(e),r=t.indexManager;return t.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}class fQ{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}let fY=100;function fJ(){return em()?8:nP(eu())>0?6:4}class fX{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=fY,this.relativeIndexReadCostPerDocument=fJ()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.performQueryUsingIndex(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.performQueryUsingRemoteKeys(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new fQ;return this.executeFullCollectionScan(e,t,r).next(n=>{if(i.result=n,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,r,n.size)})}).next(()=>i.result)}createCacheIndexes(e,t,r,n){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(ru()<=f.DEBUG&&rc("QueryEngine","SDK will not create cache indexes for query:",oA(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),nx.resolve()):(ru()<=f.DEBUG&&rc("QueryEngine","Query:",oA(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*n)?(ru()<=f.DEBUG&&rc("QueryEngine","The SDK decides to create cache indexes for query:",oA(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,oC(t))):nx.resolve()}performQueryUsingIndex(e,t){if(oy(t))return nx.resolve(null);let r=oC(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=oC(t=oI(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=o0(...n);return this.localDocumentsView.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.applyQuery(t,n);return this.needsRefill(t,s,i,r.readTime)?this.performQueryUsingIndex(e,oI(t,null,"F")):this.appendRemainingResults(e,s,t,r)}))})))}performQueryUsingRemoteKeys(e,t,r,n){return oy(t)||n.isEqual(nc.min())?nx.resolve(null):this.localDocumentsView.getDocuments(e,r).next(i=>{let s=this.applyQuery(t,i);return this.needsRefill(t,s,r,n)?nx.resolve(null):(ru()<=f.DEBUG&&rc("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),oA(t)),this.appendRemainingResults(e,s,t,nC(n,nh)).next(e=>e))})}applyQuery(e,t){let r=new sc(oj(e));return t.forEach((t,n)=>{oN(e,n)&&(r=r.add(n))}),r}needsRefill(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}executeFullCollectionScan(e,t,r){return ru()<=f.DEBUG&&rc("QueryEngine","Using full collection scan to execute query:",oA(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,nT.min(),r)}appendRemainingResults(e,t,r,n){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let fZ="firestore_clients";function f0(e,t){return`${fZ}_${e}_${t}`}let f1="firestore_mutations";function f2(e,t,r){let n=`${f1}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let f3="firestore_targets";function f6(e,t){return`${f3}_${e}_${t}`}let f4="firestore_online_state";function f5(e){return`${f4}_${e}`}let f8="firestore_bundle_loaded_v2";function f9(e){return`${f8}_${e}`}let f7="firestore_sequence_number";function pe(e){return`${f7}_${e}`}let pt="SharedClientState";class pr{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static fromWebStorageEntry(e,t,r){let n,i=JSON.parse(r),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(n=new rM(i.error.code,i.error.message)),s)?new pr(e,t,i.state,n):(rh(pt,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class pn{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r,n=JSON.parse(t),i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return(i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new rM(n.error.code,n.error.message)),i)?new pn(e,n.state,r):(rh(pt,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class pi{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=o2();for(let e=0;n&&e<r.activeTargetIds.length;++e)n=sj(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new pi(e,i):(rh(pt,`Failed to parse client data for instance '${e}': ${t}`),null)}}class ps{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new ps(t.clientId,t.onlineState):(rh(pt,`Failed to parse online state: ${e}`),null)}}class pa{constructor(){this.activeTargetIds=o2()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class po{constructor(e,t,r,n,i){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new sa(rG),this.started=!1,this.earlyEvents=[];const s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=f0(this.persistenceKey,this.localClientId),this.sequenceNumberKey=pe(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new pa),this.clientStateKeyRe=RegExp(`^${fZ}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${f1}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${f3}_${s}_(\\d+)$`),this.onlineStateKey=f5(this.persistenceKey),this.bundleLoadedKey=f9(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(let e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;let t=this.getItem(f0(this.persistenceKey,e));if(t){let r=pi.fromWebStorageEntry(e,t);r&&(this.activeClients=this.activeClients.insert(r.clientId,r))}}this.persistClientState();let e=this.storage.getItem(this.onlineStateKey);if(e){let t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(let e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(f6(this.persistenceKey,e));if(t){let n=pn.fromWebStorageEntry(e,t);n&&(r=n.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(f6(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return rc(pt,"READ",e,t),t}setItem(e,t){rc(pt,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){rc(pt,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(rc(pt,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void rh("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueRetryable(async()=>{if(!this.started)return void this.earlyEvents.push(t);if(null!==t.key){if(this.clientStateKeyRe.test(t.key))if(null!=t.newValue){let e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{let e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){let e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){let e=pl(t.newValue);e!==nG.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){let e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let n=new pr(this.currentUser,e,t,r),i=f2(this.persistenceKey,this.currentUser,e);this.setItem(i,n.toWebStorageJSON())}removeMutationState(e){let t=f2(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let n=f6(this.persistenceKey,e),i=new pn(e,t,r);this.setItem(n,i.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return pi.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return pr.fromWebStorageEntry(new ri(i),n,t)}fromWebStorageQueryTargetMetadata(e,t){let r=Number(this.queryTargetKeyRe.exec(e)[1]);return pn.fromWebStorageEntry(r,t)}fromWebStorageOnlineState(e){return ps.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){return e.user.uid!==this.currentUser.uid?void rc(pt,`Ignoring mutation for non-active user ${e.user.uid}`):this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),n=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.applyActiveTargetsChange(s,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=o2();return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}function pl(e){let t=nG.INVALID;if(null!=e)try{let r=JSON.parse(e);rm("number"==typeof r,30636,{seqString:e}),t=r}catch(e){rh(pt,"Failed to read sequence number from WebStorage",e)}return t}class pu{constructor(){this.localState=new pa,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new pa,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class pc{addCallback(e){}shutdown(){}}class ph{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}let pd=null;function pf(){return 0x10000000+Math.round(0x80000000*Math.random())}function pp(){return null===pd?pd=pf():pd++,"0x"+pd.toString(16)}function pg(e){return new Promise((t,r)=>{e((e,n)=>{e?r(e):t(n)})})}let pm="1.9.15",py="GrpcConnection",pv=`gl-node/${process.versions.node} fire/${rs} grpc/${pm}`;function p_(e,t,r,n,i){rm(null===t||"OAuth"===t.type,36936);let s=new rr.Metadata;return t&&t.headers.forEach((e,t)=>s.set(t,e)),r&&r.headers.forEach((e,t)=>s.set(t,e)),n&&s.set("X-Firebase-GMPID",n),s.set("X-Goog-Api-Client",pv),s.set("Google-Cloud-Resource-Prefix",e),s.set("x-goog-request-params",e),i&&s.set("X-Goog-Api-Key",i),s}class pb{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){rc(py,"Creating Firestore stub.");let e=this.databaseInfo.ssl?rr.credentials.createSsl():rr.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,n,i){let s=pp(),a=this.ensureActiveStub(),o=p_(this.databasePath,n,i,this.databaseInfo.appId,this.databaseInfo.apiKey),l={database:this.databasePath,...r};return pg(t=>(rc(py,`RPC '${e}' ${s} invoked with request:`,r),a[e](l,o,(r,n)=>{r?(rc(py,`RPC '${e}' ${s} failed with error:`,r),t(new rM(lU(r.code),r.message))):(rc(py,`RPC '${e}' ${s} completed with response:`,n),t(void 0,n))})))}invokeStreamingRPC(e,t,r,n,i,s){let a=pp(),o=[],l=new rL;rc(py,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),c=p_(this.databasePath,n,i,this.databaseInfo.appId,this.databaseInfo.apiKey),h={...r,database:this.databasePath},d=u[e](h,c),f=!1;return d.on("data",t=>{rc(py,`RPC ${e} ${a} received result:`,t),o.push(t),void 0!==s&&o.length===s&&(f=!0,l.resolve(o))}),d.on("end",()=>{rc(py,`RPC '${e}' ${a} completed.`),f||(f=!0,l.resolve(o))}),d.on("error",t=>{rc(py,`RPC '${e}' ${a} failed with error:`,t);let r=lU(t.code);l.reject(new rM(r,t.message))}),l.promise}openStream(e,t,r){let n=pp(),i=this.ensureActiveStub(),s=p_(this.databasePath,t,r,this.databaseInfo.appId,this.databaseInfo.apiKey),a=i[e](s),o=!1,l=e=>{o||(o=!0,u.callOnClose(e),a.end())},u=new ph({sendFn:t=>{if(o)rc(py,`RPC '${e}' stream ${n} not sending because gRPC stream is closed:`,t);else{rc(py,`RPC '${e}' stream ${n} sending:`,t);try{a.write(t)}catch(e){throw rh("Failure sending:",t),rh("Error:",e),e}}},closeFn:()=>{rc(py,`RPC '${e}' stream ${n} closed locally via close().`),l()}}),c=!1;return a.on("data",t=>{o||(rc(py,`RPC '${e}' stream ${n} received:`,t),c||(u.callOnConnected(),c=!0),u.callOnMessage(t))}),a.on("end",()=>{rc(py,`RPC '${e}' stream ${n} ended.`),l()}),a.on("error",t=>{o||(rd(py,`RPC '${e}' stream ${n} error. Code:`,t.code,"Message:",t.message),l(new rM(lU(t.code),t.message)))}),rc(py,`Opening RPC '${e}' stream ${n} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let pS={google:{nested:{protobuf:{options:{go_package:"github.com/golang/protobuf/protoc-gen-go/descriptor;descriptor",java_package:"com.google.protobuf",java_outer_classname:"DescriptorProtos",csharp_namespace:"Google.Protobuf.Reflection",objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2},options:{type:"ExtensionRangeOptions",id:3}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},ExtensionRangeOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3},reservedRange:{rule:"repeated",type:"EnumReservedRange",id:4},reservedName:{rule:"repeated",type:"string",id:5}},nested:{EnumReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5,options:{default:!1}},serverStreaming:{type:"bool",id:6,options:{default:!1}}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10,options:{default:!1}},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27,options:{default:!1}},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16,options:{default:!1}},javaGenericServices:{type:"bool",id:17,options:{default:!1}},pyGenericServices:{type:"bool",id:18,options:{default:!1}},phpGenericServices:{type:"bool",id:42,options:{default:!1}},deprecated:{type:"bool",id:23,options:{default:!1}},ccEnableArenas:{type:"bool",id:31,options:{default:!1}},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},swiftPrefix:{type:"string",id:39},phpClassPrefix:{type:"string",id:40},phpNamespace:{type:"string",id:41},phpMetadataNamespace:{type:"string",id:44},rubyPackage:{type:"string",id:45},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1,options:{default:!1}},noStandardDescriptorAccessor:{type:"bool",id:2,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8],[9,9]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},weak:{type:"bool",id:10,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[5,5]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},idempotencyLevel:{type:"IdempotencyLevel",id:34,options:{default:"IDEMPOTENCY_UNKNOWN"}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],nested:{IdempotencyLevel:{values:{IDEMPOTENCY_UNKNOWN:0,NO_SIDE_EFFECTS:1,IDEMPOTENT:2}}}},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Empty:{fields:{}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},Duration:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"cloud.google.com/go/firestore/apiv1/firestorepb;firestorepb",java_multiple_files:!0,java_outer_classname:"QueryProfileProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue","fieldReferenceValue","functionValue","pipelineValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6},fieldReferenceValue:{type:"string",id:19},functionValue:{type:"Function",id:20},pipelineValue:{type:"Pipeline",id:21}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Function:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}},Pipeline:{fields:{stages:{rule:"repeated",type:"Stage",id:1}},nested:{Stage:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},ExecutePipeline:{requestType:"ExecutePipelineRequest",responseType:"ExecutePipelineResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:executePipeline","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:executePipeline",body:"*"}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},ExecutePipelineRequest:{oneofs:{pipelineType:{oneof:["structuredPipeline"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredPipeline:{type:"StructuredPipeline",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},ExecutePipelineResponse:{fields:{transaction:{type:"bytes",id:1},results:{rule:"repeated",type:"Document",id:2},executionTime:{type:"google.protobuf.Timestamp",id:3}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredPipeline:{fields:{pipeline:{type:"Pipeline",id:1},options:{keyType:"string",type:"Value",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}},Avg:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}},ExplainOptions:{fields:{analyze:{type:"bool",id:1,options:{"(google.api.field_behavior)":"OPTIONAL"}}}},ExplainMetrics:{fields:{planSummary:{type:"PlanSummary",id:1},executionStats:{type:"ExecutionStats",id:2}}},PlanSummary:{fields:{indexesUsed:{rule:"repeated",type:"google.protobuf.Struct",id:1}}},ExecutionStats:{fields:{resultsReturned:{type:"int64",id:1},executionDuration:{type:"google.protobuf.Duration",id:3},readOperations:{type:"int64",id:4},debugStats:{type:"google.protobuf.Struct",id:5}}}}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api;api",java_multiple_files:!0,java_outer_classname:"LaunchStageProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1},fullyDecodeReservedExpansion:{type:"bool",id:2}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{selector:{type:"string",id:1},get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},body:{type:"string",id:7},responseBody:{type:"string",id:12},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}},LaunchStage:{values:{LAUNCH_STAGE_UNSPECIFIED:0,UNIMPLEMENTED:6,PRELAUNCH:7,EARLY_ACCESS:1,ALPHA:2,BETA:3,GA:4,DEPRECATED:5}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var pC={nested:pS},pw=Object.freeze({__proto__:null,nested:pS,default:pC});let pT={longs:String,enums:String,defaults:!0,oneofs:!1};function pE(){let e=rn.fromJSON(pw,pT);return rr.loadPackageDefinition(e)}function pk(e){return new pb(pE(),e)}function pI(){return new pc}function pR(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function px(){return null}function pD(e){return new un(e,!1)}let pO="ExponentialBackoff",pA=1e3,pN=1.5,pP=6e4;class pM{constructor(e,t,r=pA,n=pN,i=pP){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=n,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),n=Math.max(0,t-r);n>0&&rc(pO,`Backing off for ${n} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,n,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let pL="PersistentStream",pF=6e4,pB=1e4;class pj{constructor(e,t,r,n,i,s,a,o){this.queue=e,this.idleTimerId=r,this.healthTimerId=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new pM(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){(this.responseCount=0,4===this.state)?this.performBackoff():this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,pF,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===rI?(rh(t.toString()),rh("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===rk&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.closeCount===t&&this.startStream(e,r)},t=>{e(()=>{let e=new rM(rb,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,pB,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{r(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{r(()=>1==++this.responseCount?this.onFirst(e):this.onNext(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return rc(pL,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(rc(pL,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class pq extends pj{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=ux(this.serializer,e),r=uO(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=ub(this.serializer),t.addTarget=uG(this.serializer,e);let r=u$(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=ub(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class pU extends pj{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return rm(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,rm(!e.writeResults||0===e.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(e){rm(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=uF(e.writeResults,e.commitTime),r=ud(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=ub(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>uA(this.serializer,e))};this.sendRequest(t)}}class pV{}class pz extends pV{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new rM(rR,"The client has already been terminated.")}invokeRPC(e,t,r,n){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeRPC(e,up(t,r),n,i,s)).catch(e=>{if("FirebaseError"===e.name)throw e.code===rk&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new rM(rb,e.toString())})}invokeStreamingRPC(e,t,r,n,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeStreamingRPC(e,up(t,r),n,s,a,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===rk&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new rM(rb,e.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function pH(e,t,r,n){return new pz(e,t,r,n)}async function pW(e,t){let r=ry(e),n={writes:t.map(e=>uA(r.serializer,e))};await r.invokeRPC("Commit",r.serializer.databaseId,r3.emptyPath(),n)}async function p$(e,t){let r=ry(e),n={documents:t.map(e=>um(r.serializer,e))},i=await r.invokeStreamingRPC("BatchGetDocuments",r.serializer.databaseId,r3.emptyPath(),n,t.length),s=new Map;i.forEach(e=>{let t=uR(r.serializer,e);s.set(t.key.toString(),t)});let a=[];return t.forEach(e=>{let t=s.get(e.toString());rm(!!t,55234,{key:e}),a.push(t)}),a}async function pK(e,t,r){let n=ry(e),{request:i,aliasMap:s,parent:a}=uz(n.serializer,ow(t),r);n.connection.shouldResourcePathBeIncludedInRequest||delete i.parent;let o=(await n.invokeStreamingRPC("RunAggregationQuery",n.serializer.databaseId,a,i,1)).filter(e=>!!e.result);rm(1===o.length,64727);let l=o[0].result?.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}function pG(e,t,r){let n=ry(e);return n.verifyInitialized(),new pU(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}function pQ(e,t,r){let n=ry(e);return n.verifyInitialized(),new pq(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}let pY="OnlineStateTracker",pJ=1,pX=1e4;class pZ{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",pX,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${pX/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=pJ&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${pJ} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(rh(t),this.shouldWarnClientIsOffline=!1):rc(pY,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let p0="RemoteStore",p1=10;class p2{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{r.enqueueAndForget(async()=>{gn(this)&&(rc(p0,"Restarting streams for network reachability change."),await gw(this))})}),this.onlineStateTracker=new pZ(r,n)}}function p3(e,t,r,n,i){return new p2(e,t,r,n,i)}async function p6(e){if(gn(e))for(let t of e.onNetworkStatusChange)await t(!0)}async function p4(e){for(let t of e.onNetworkStatusChange)await t(!1)}async function p5(e){let t=ry(e);rc(p0,"RemoteStore shutting down."),t.offlineCauses.add(5),await p4(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function p8(e,t){let r=ry(e);!r.listenTargets.has(t.targetId)&&(r.listenTargets.set(t.targetId,t),gr(r)?gt(r):gk(r).isOpen()&&p7(r,t))}function p9(e,t){let r=ry(e),n=gk(r);r.listenTargets.delete(t),n.isOpen()&&ge(r,t),0===r.listenTargets.size&&(n.isOpen()?n.markIdle():gn(r)&&r.onlineStateTracker.set("Unknown"))}function p7(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(nc.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}gk(e).watch(t)}function ge(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),gk(e).unwatch(t)}function gt(e){e.watchChangeAggregator=new l4({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),gk(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function gr(e){return gn(e)&&!gk(e).isStarted()&&e.listenTargets.size>0}function gn(e){return 0===ry(e).offlineCauses.size}function gi(e){e.watchChangeAggregator=void 0}async function gs(e){e.onlineStateTracker.set("Online")}async function ga(e){e.listenTargets.forEach((t,r)=>{p7(e,t)})}async function go(e,t){gi(e),gr(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),gt(e)):e.onlineStateTracker.set("Unknown")}async function gl(e,t,r){if(e.onlineStateTracker.set("Online"),t instanceof l2&&2===t.state&&t.cause){try{await gd(e,t)}catch(r){rc(p0,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await gu(e,r)}return}if(t instanceof l0?e.watchChangeAggregator.handleDocumentChange(t):t instanceof l1?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!r.isEqual(nc.min()))try{let t=await fC(e.localStore);r.compareTo(t)>=0&&await gh(e,r)}catch(t){rc(p0,"Failed to raise snapshot:",t),await gu(e,t)}}async function gu(e,t,r){if(nF(t))e.offlineCauses.add(1),await p4(e),e.onlineStateTracker.set("Offline"),r||(r=()=>fC(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{rc(p0,"Retrying IndexedDB access"),await r(),e.offlineCauses.delete(1),await p6(e)});else throw t}function gc(e,t){return t().catch(r=>gu(e,r,t))}function gh(e,t){let r=e.watchChangeAggregator.createRemoteEvent(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){let i=e.listenTargets.get(n);i&&e.listenTargets.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{let n=e.listenTargets.get(t);n&&(e.listenTargets.set(t,n.withResumeToken(sy.EMPTY_BYTE_STRING,n.snapshotVersion)),ge(e,t),p7(e,new cp(n.target,t,r,n.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(r)}async function gd(e,t){let r=t.cause;for(let n of t.targetIds)e.listenTargets.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.listenTargets.delete(n),e.watchChangeAggregator.removeTarget(n))}async function gf(e){let t=ry(e),r=gI(t),n=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:sL;for(;gp(t);)try{let e=await fI(t.localStore,n);if(null===e){0===t.writePipeline.length&&r.markIdle();break}n=e.batchId,gg(t,e)}catch(e){await gu(t,e)}gm(t)&&gy(t)}function gp(e){return gn(e)&&e.writePipeline.length<p1}function gg(e,t){e.writePipeline.push(t);let r=gI(e);r.isOpen()&&r.handshakeComplete&&r.writeMutations(t.mutations)}function gm(e){return gn(e)&&!gI(e).isStarted()&&e.writePipeline.length>0}function gy(e){gI(e).start()}async function gv(e){gI(e).writeHandshake()}async function g_(e){let t=gI(e);for(let r of e.writePipeline)t.writeMutations(r.mutations)}async function gb(e,t,r){let n=e.writePipeline.shift(),i=lL.from(n,t,r);await gc(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await gf(e)}async function gS(e,t){t&&gI(e).handshakeComplete&&await gC(e,t),gm(e)&&gy(e)}async function gC(e,t){if(lq(t.code)){let r=e.writePipeline.shift();gI(e).inhibitBackoff(),await gc(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await gf(e)}}async function gw(e){let t=ry(e);t.offlineCauses.add(4),await p4(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await p6(t)}async function gT(e,t){let r=ry(e);r.asyncQueue.verifyOperationInProgress(),rc(p0,"RemoteStore received new credentials");let n=gn(r);r.offlineCauses.add(3),await p4(r),n&&r.onlineStateTracker.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.offlineCauses.delete(3),await p6(r)}async function gE(e,t){let r=ry(e);t?(r.offlineCauses.delete(2),await p6(r)):t||(r.offlineCauses.add(2),await p4(r),r.onlineStateTracker.set("Unknown"))}function gk(e){return e.watchStream||(e.watchStream=pQ(e.datastore,e.asyncQueue,{onConnected:gs.bind(null,e),onOpen:ga.bind(null,e),onClose:go.bind(null,e),onWatchChange:gl.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),gr(e)?gt(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),gi(e))})),e.watchStream}function gI(e){return e.writeStream||(e.writeStream=pG(e.datastore,e.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:gv.bind(null,e),onClose:gS.bind(null,e),onHandshakeComplete:g_.bind(null,e),onMutationResult:gb.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await gf(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(rc(p0,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}let gR="AsyncQueue";class gx{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new rL,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new gx(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new rM(r_,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function gD(e,t){if(rh(gR,`${t}: ${e}`),nF(e))return new rM(rN,`${t}: ${e}`);throw e}class gO{static emptySet(e){return new gO(e.comparator)}constructor(e){e?this.comparator=(t,r)=>e(t,r)||r5.comparator(t.key,r.key):this.comparator=(e,t)=>r5.comparator(e.key,t.key),this.keyedMap=oW(),this.sortedSet=new sa(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof gO)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new gO;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class gA{constructor(){this.changeMap=new sa(r5.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===r.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==r.type?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):rp(63341,{change:e,oldChange:r})}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}}class gN{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new gN(e,t,gO.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!oD(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class gP{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}}function gM(){return new gL}class gL{constructor(){this.queries=gF(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){gW(this,new rM(rx,"Firestore shutting down"))}}function gF(){return new oU(e=>oO(e),oD)}async function gB(e,t){let r=ry(e),n=3,i=t.query,s=r.queries.get(i);s?!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(n=2):(s=new gP,n=+!t.listensToRemoteStore());try{switch(n){case 0:s.viewSnap=await r.onListen(i,!0);break;case 1:s.viewSnap=await r.onListen(i,!1);break;case 2:await r.onFirstRemoteStoreListen(i)}}catch(r){let e=gD(r,`Initialization of query '${oA(t.query)}' failed`);t.onError(e);return}r.queries.set(i,s),s.listeners.push(t),t.applyOnlineStateChange(r.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&g$(r)}async function gj(e,t){let r=ry(e),n=t.query,i=3,s=r.queries.get(n);if(s){let e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),0===s.listeners.length?i=+!t.listensToRemoteStore():!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(i=2))}switch(i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function gq(e,t){let r=ry(e),n=!1;for(let e of t){let t=e.query,i=r.queries.get(t);if(i){for(let t of i.listeners)t.onViewSnapshot(e)&&(n=!0);i.viewSnap=e}}n&&g$(r)}function gU(e,t,r){let n=ry(e),i=n.queries.get(t);if(i)for(let e of i.listeners)e.onError(r);n.queries.delete(t)}function gV(e,t){let r=ry(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(let e of r.listeners)e.applyOnlineStateChange(t)&&(n=!0)}),n&&g$(r)}function gz(e,t){ry(e).snapshotsInSyncListeners.add(t),t.next()}function gH(e,t){ry(e).snapshotsInSyncListeners.delete(t)}function gW(e,t){let r=ry(e),n=r.queries;r.queries=gF(),n.forEach((e,r)=>{for(let e of r.listeners)e.onError(t)})}function g$(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}!function(e){e.Default="default",e.Cache="cache"}(y||(y={}));class gK{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new gN(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=gN.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==y.Cache}}class gG{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=n}static fromSnapshot(e,t){let r=o0(),n=o0();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new gG(e,t.fromCache,r,n)}}class gQ{constructor(e){this.serializer=e}toDocumentKey(e){return uy(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?uE(this.serializer,e.document,!1):aR.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return ud(e)}}class gY{constructor(e,t){this.bundleMetadata=e,this.serializer=t,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=gJ(e)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this._queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this._documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;let r=r3.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this._documents[this._documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}getQueryDocumentMapping(e){let t=new Map,r=new gQ(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.toDocumentKey(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||o0()).add(e);t.set(r,n)}}return t}async completeAndStoreAsync(e){let t=await fU(e,new gQ(this.serializer),this._documents,this.bundleMetadata.id),r=this.getQueryDocumentMapping(this.documents);for(let t of this._queries)await fW(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:t}}}function gJ(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function gX(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class gZ{constructor(e){this.key=e}}class g0{constructor(e){this.key=e}}class g1{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=o0(),this.mutatedKeys=o0(),this.docComparator=oj(e),this.documentSet=new gO(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new gA,n=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),c=oN(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),f=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(r.track({type:3,doc:c}),f=!0):!this.shouldWaitForSyncedDocument(u,c)&&(r.track({type:2,doc:c}),f=!0,(o&&this.docComparator(c,o)>0||l&&0>this.docComparator(c,l))&&(a=!0)):!u&&c?(r.track({type:0,doc:c}),f=!0):u&&!c&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(c?(s=s.add(c),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{documentSet:s,changeSet:r,needsRefill:a,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let s=e.changeSet.getChanges();s.sort((e,t)=>g2(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(r),n=n??!1;let a=t&&!n?this.updateLimboDocuments():[],o=+!!(0===this.limboDocuments.size&&this.current&&!n),l=o!==this.syncState;return(this.syncState=o,0!==s.length||l)?{snapshot:new gN(this.query,e.documentSet,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),limboChanges:a}:{limboChanges:a}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new gA,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=o0(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});let t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new g0(e))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new gZ(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=o0();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return gN.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function g2(e,t){let r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return rp(20277,{change:e})}};return r(e)-r(t)}let g3="SyncEngine";class g6{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class g4{constructor(e){this.key=e,this.receivedDocument=!1}}class g5{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new oU(e=>oO(e),oD),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new sa(r5.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new dD,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=h1.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function g8(e,t,r,n,i,s,a){let o=new g5(e,t,r,n,i,s);return a&&(o._isPrimaryClient=!0),o}async function g9(e,t,r=!0){let n,i=mN(e),s=i.queryViewsByQuery.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.computeInitialSnapshot()):n=await me(i,t,r,!0),n}async function g7(e,t){let r=mN(e);await me(r,t,!0,!1)}async function me(e,t,r,n){let i,s=await fx(e.localStore,oC(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await mt(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&p8(e.remoteStore,s),i}async function mt(e,t,r,n,i){e.applyDocChanges=(t,r,n)=>mb(e,t,r,n);let s=await fA(e.localStore,t,!0),a=new g1(t,s.remoteKeys),o=a.computeDocChanges(s.documents),l=lZ.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);mm(e,r,u.limboChanges);let c=new g6(t,r,a);return e.queryViewsByQuery.set(t,c),e.queriesByTarget.has(r)?e.queriesByTarget.get(r).push(t):e.queriesByTarget.set(r,[t]),u.snapshot}async function mr(e,t,r){let n=ry(e),i=n.queryViewsByQuery.get(t),s=n.queriesByTarget.get(i.targetId);if(s.length>1){n.queriesByTarget.set(i.targetId,s.filter(e=>!oD(e,t))),n.queryViewsByQuery.delete(t);return}n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await fO(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&p9(n.remoteStore,i.targetId),mp(n,i.targetId)}).catch(nR)):(mp(n,i.targetId),await fO(n.localStore,i.targetId,!0))}async function mn(e,t){let r=ry(e),n=r.queryViewsByQuery.get(t),i=r.queriesByTarget.get(n.targetId);r.isPrimaryClient&&1===i.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),p9(r.remoteStore,n.targetId))}async function mi(e,t,r){let n=mP(e);try{let e=await fv(n.localStore,t);n.sharedClientState.addPendingMutation(e.batchId),md(n,e.batchId,r),await m_(n,e.changes),await gf(n.remoteStore)}catch(t){let e=gD(t,"Failed to persist write");r.reject(e)}}async function ms(e,t){let r=ry(e);try{let e=await fw(r.localStore,t);t.targetChanges.forEach((e,t)=>{let n=r.activeLimboResolutionsByTarget.get(t);n&&(rm(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.receivedDocument=!0:e.modifiedDocuments.size>0?rm(n.receivedDocument,14607):e.removedDocuments.size>0&&(rm(n.receivedDocument,42227),n.receivedDocument=!1))}),await m_(r,e,t)}catch(e){await nR(e)}}function ma(e,t,r){let n=ry(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){let e=[];n.queryViewsByQuery.forEach((r,n)=>{let i=n.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),gV(n.eventManager,t),e.length&&n.syncEngineListener.onWatchChange(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function mo(e,t,r){let n=ry(e);n.sharedClientState.updateQueryState(t,"rejected",r);let i=n.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new sa(r5.comparator);e=e.insert(s,aR.newNoDocument(s,nc.min()));let r=o0().add(s),i=new lX(nc.min(),new Map,new sa(rG),e,r);await ms(n,i),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(s),n.activeLimboResolutionsByTarget.delete(t),mv(n)}else await fO(n.localStore,t,!1).then(()=>mp(n,t,r)).catch(nR)}async function ml(e,t){let r=ry(e),n=t.batch.batchId;try{let e=await f_(r.localStore,t);mf(r,n,null),mc(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await m_(r,e)}catch(e){await nR(e)}}async function mu(e,t,r){let n=ry(e);try{let e=await fS(n.localStore,t);mf(n,t,r),mc(n,t),n.sharedClientState.updateMutationState(t,"rejected",r),await m_(n,e)}catch(e){await nR(e)}}function mc(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function mh(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new rM(r_,t))})}),e.pendingWritesCallbacks.clear()}function md(e,t,r){let n=e.mutationUserCallbacks[e.currentUser.toKey()];n||(n=new sa(rG)),n=n.insert(t,r),e.mutationUserCallbacks[e.currentUser.toKey()]=n}function mf(e,t,r){let n=ry(e),i=n.mutationUserCallbacks[n.currentUser.toKey()];if(i){let e=i.get(t);e&&(r?e.reject(r):e.resolve(),i=i.remove(t)),n.mutationUserCallbacks[n.currentUser.toKey()]=i}}function mp(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(n),r&&e.syncEngineListener.onWatchError(n,r);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||mg(e,t)})}function mg(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());let r=e.activeLimboTargetsByKey.get(t);null!==r&&(p9(e.remoteStore,r),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(r),mv(e))}function mm(e,t,r){for(let n of r)n instanceof gZ?(e.limboDocumentRefs.addReference(n.key,t),my(e,n)):n instanceof g0?(rc(g3,"Document no longer in limbo: "+n.key),e.limboDocumentRefs.removeReference(n.key,t),e.limboDocumentRefs.containsKey(n.key)||mg(e,n.key)):rp(19791,{limboChange:n})}function my(e,t){let r=t.key,n=r.path.canonicalString();e.activeLimboTargetsByKey.get(r)||e.enqueuedLimboResolutions.has(n)||(rc(g3,"New document in limbo: "+r),e.enqueuedLimboResolutions.add(n),mv(e))}function mv(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){let t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);let r=new r5(r3.fromString(t)),n=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(n,new g4(r)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(r,n),p8(e.remoteStore,new cp(oC(og(r.path)),n,"TargetPurposeLimboResolution",nG.INVALID))}}async function m_(e,t,r){let n=ry(e),i=[],s=[],a=[];n.queryViewsByQuery.isEmpty()||(n.queryViewsByQuery.forEach((e,o)=>{a.push(n.applyDocChanges(o,t,r).then(e=>{if((e||r)&&n.isPrimaryClient){let t=e?!e.fromCache:r?.targetChanges.get(o.targetId)?.current;n.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){i.push(e);let t=gG.fromSnapshot(o.targetId,e);s.push(t)}}))}),await Promise.all(a),n.syncEngineListener.onWatchChange(i),await fk(n.localStore,s))}async function mb(e,t,r,n){let i=t.view.computeDocChanges(r);i.needsRefill&&(i=await fA(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return mm(e,t.targetId,o.limboChanges),o.snapshot}async function mS(e,t){let r=ry(e);if(!r.currentUser.isEqual(t)){rc(g3,"User change. New user:",t.toKey());let e=await fy(r.localStore,t);r.currentUser=t,mh(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await m_(r,e.affectedDocuments)}}function mC(e,t){let r=ry(e),n=r.activeLimboResolutionsByTarget.get(t);if(n&&n.receivedDocument)return o0().add(n.key);{let e=o0(),n=r.queriesByTarget.get(t);if(!n)return e;for(let t of n){let n=r.queryViewsByQuery.get(t);e=e.unionWith(n.view.syncedDocuments)}return e}}async function mw(e,t){let r=ry(e),n=await fA(r.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(n);return r.isPrimaryClient&&mm(r,t.targetId,i.limboChanges),i}async function mT(e,t){let r=ry(e);return fB(r.localStore,t).then(e=>m_(r,e))}async function mE(e,t,r,n){let i=ry(e),s=await fP(i.localStore,t);null===s?rc(g3,"Cannot apply mutation batch with id: "+t):("pending"===r?await gf(i.remoteStore):"acknowledged"===r||"rejected"===r?(mf(i,t,n||null),mc(i,t),fM(i.localStore,t)):rp(6720,"Unknown batchState",{batchState:r}),await m_(i,s))}async function mk(e,t){let r=ry(e);if(mN(r),mP(r),!0===t&&!0!==r._isPrimaryClient){let e=r.sharedClientState.getAllActiveQueryTargets(),t=await mR(r,e.toArray());for(let e of(r._isPrimaryClient=!0,await gE(r.remoteStore,!0),t))p8(r.remoteStore,e)}else if(!1===t&&!1!==r._isPrimaryClient){let e=[],t=Promise.resolve();r.queriesByTarget.forEach((n,i)=>{r.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(mp(r,i),fO(r.localStore,i,!0))),p9(r.remoteStore,i)}),await t,await mR(r,e),mI(r),r._isPrimaryClient=!1,await gE(r.remoteStore,!1)}}function mI(e){let t=ry(e);t.activeLimboResolutionsByTarget.forEach((e,r)=>{p9(t.remoteStore,r)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new sa(r5.comparator)}async function mR(e,t,r){let n=ry(e),i=[],s=[];for(let e of t){let t,r=n.queriesByTarget.get(e);if(r&&0!==r.length)for(let e of(t=await fx(n.localStore,oC(r[0])),r)){let t=n.queryViewsByQuery.get(e),r=await mw(n,t);r.snapshot&&s.push(r.snapshot)}else{let r=await fF(n.localStore,e);t=await fx(n.localStore,r),await mt(n,mx(r),e,!1,t.resumeToken)}i.push(t)}return n.syncEngineListener.onWatchChange(s),i}function mx(e){return op(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function mD(e){return fL(ry(e).localStore)}async function mO(e,t,r,n){let i=ry(e);if(i._isPrimaryClient)return void rc(g3,"Ignoring unexpected query state notification.");let s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(r){case"current":case"not-current":{let e=await fB(i.localStore,oB(s[0])),n=lX.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,sy.EMPTY_BYTE_STRING);await m_(i,e,n);break}case"rejected":await fO(i.localStore,t,!0),mp(i,t,n);break;default:rp(64155,r)}}async function mA(e,t,r){let n=mN(e);if(n._isPrimaryClient){for(let e of t){if(n.queriesByTarget.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){rc(g3,"Adding an already active target "+e);continue}let t=await fF(n.localStore,e),r=await fx(n.localStore,t);await mt(n,mx(t),r.targetId,!1,r.resumeToken),p8(n.remoteStore,r)}for(let e of r)n.queriesByTarget.has(e)&&await fO(n.localStore,e,!1).then(()=>{p9(n.remoteStore,e),mp(n,e)}).catch(nR)}}function mN(e){let t=ry(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=ms.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=mC.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=mo.bind(null,t),t.syncEngineListener.onWatchChange=gq.bind(null,t.eventManager),t.syncEngineListener.onWatchError=gU.bind(null,t.eventManager),t}function mP(e){let t=ry(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=ml.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=mu.bind(null,t),t}function mM(e,t,r){let n=ry(e);mL(n,t,r).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}async function mL(e,t,r){try{let n=await t.getMetadata();if(await fV(e.localStore,n))return await t.close(),r._completeWith(gX(n)),Promise.resolve(new Set);r._updateProgress(gJ(n));let i=new gY(n,t.serializer),s=await t.nextElement();for(;s;){let e=await i.addSizedElement(s);e&&r._updateProgress(e),s=await t.nextElement()}let a=await i.completeAndStoreAsync(e.localStore);return await m_(e,a.changedDocs,void 0),await fz(e.localStore,n),r._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(e){return rd(g3,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}}class mF{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=pD(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return fm(this.persistence,new fX,e.initialUser,this.serializer)}createPersistence(e){return new dq(dV.factory,this.serializer)}createSharedClientState(e){return new pu}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}mF.provider={build:()=>new mF};class mB extends mF{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){return rm(this.persistence.referenceDelegate instanceof dz,46915),new da(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createPersistence(e){let t=void 0!==this.cacheSizeBytes?h7.withCacheSize(this.cacheSizeBytes):h7.DEFAULT;return new dq(e=>dz.factory(e,t),this.serializer)}}class mj extends mF{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await mP(this.onlineComponentProvider.syncEngine),await gf(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return fm(this.persistence,new fX,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new da(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new nK(t,this.persistence);return new n$(e.asyncQueue,r)}createPersistence(e){let t=fc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?h7.withCacheSize(this.cacheSizeBytes):h7.DEFAULT;return new fo(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,pR(),px(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new pu}}class mq extends mj{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof po&&(this.sharedClientState.syncEngine={applyBatchState:mE.bind(null,t),applyTargetState:mO.bind(null,t),applyActiveTargetsChange:mA.bind(null,t),getActiveClients:mD.bind(null,t),synchronizeWithChangedDocuments:mT.bind(null,t)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async e=>{await mk(this.onlineComponentProvider.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){let t=pR();if(!po.isAvailable(t))throw new rM(rO,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=fc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new po(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class mU{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>ma(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=mS.bind(null,this.syncEngine),await gE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return gM()}createDatastore(e){let t=pD(e.databaseInfo.databaseId),r=pk(e.databaseInfo);return pH(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return p3(this.localStore,this.datastore,e.asyncQueue,e=>ma(this.syncEngine,e,0),pI())}createSyncEngine(e,t){return g8(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await p5(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}mU.provider={build:()=>new mU};let mV=10240;function mz(e,t=mV){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function mH(e,t){if(!(e instanceof Uint8Array))throw new rM(rS,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${nt(e)}`);return mz(e,t)}class mW{constructor(e){this.observer=e,this.muted=!1}next(e){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):rh("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class m${constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}class mK{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new rL,this.buffer=new Uint8Array,this.textDecoder=l$(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let e=await this.readLength();if(null===e)return null;let t=this.textDecoder.decode(e),r=Number(t);return isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`),new m$(JSON.parse(await this.readJsonString(r)),e.length+r)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){let e=await this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function mG(e,t){return new mK(e,t)}class mQ{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.nextElement();if(r&&r.isBundleMetadata())this.metadata=r;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.payload)}`);do null!==(r=this.nextElement())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let e=this.readLength();return new m$(JSON.parse(this.readJsonString(e)),e)}readJsonString(e){if(this.cursor+e>this.bundleData.length)throw new rM(rA,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}readLength(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}function mY(e,t){return new mQ(e,t)}class mJ{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new rM(rS,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await p$(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new lO(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=r5.fromPath(t);this.mutations.push(new lP(r,this.precondition(r)))}),await pW(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=nc.min();else throw rp(50498,{documentName:e.constructor.name});let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new rM(rx,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?lp.none():t.isEqual(nc.min())?lp.exists(!1):lp.updateTime(t)}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return lp.exists(!0);if(t.isEqual(nc.min()))throw new rM(rS,"Can't update a document that doesn't exist.");return lp.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class mX{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.attemptsRemaining=r.maxAttempts,this.backoff=new pM(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(async()=>{let e=new mJ(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.handleTransactionError(e)}))}).catch(e=>{this.handleTransactionError(e)})})}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);if(sF(t)||!t.catch||!t.then)return this.deferred.reject(Error("Transaction callback must return a Promise")),null;return t}catch(e){return this.deferred.reject(e),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e?.name==="FirebaseError"){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!lj(t)}return!1}}let mZ="FirestoreClient",m0=100,m1=11,m2=20,m3=22;class m6{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=ri.UNAUTHENTICATED,this.clientId=rK.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{rc(mZ,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(rc(mZ,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:m0}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rL;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=gD(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function m4(e,t){e.asyncQueue.verifyOperationInProgress(),rc(mZ,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await fy(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function m5(e,t){e.asyncQueue.verifyOperationInProgress();let r=await m9(e);rc(mZ,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>gT(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>gT(t.remoteStore,r)),e._onlineComponents=t}function m8(e){return"FirebaseError"===e.name?e.code===rR||e.code===rO:!("u">typeof DOMException&&e instanceof DOMException)||e.code===m3||e.code===m2||e.code===m1}async function m9(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){rc(mZ,"Using user provided OfflineComponentProvider");try{await m4(e,e._uninitializedComponentsProvider._offline)}catch(r){let t=r;if(!m8(t))throw t;rd("Error using user provided cache. Falling back to memory cache: "+t),await m4(e,new mF)}}else rc(mZ,"Using default OfflineComponentProvider"),await m4(e,new mB(void 0));return e._offlineComponents}async function m7(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(rc(mZ,"Using user provided OnlineComponentProvider"),await m5(e,e._uninitializedComponentsProvider._online)):(rc(mZ,"Using default OnlineComponentProvider"),await m5(e,new mU))),e._onlineComponents}function ye(e){return m9(e).then(e=>e.localStore)}function yt(e){return m7(e).then(e=>e.syncEngine)}function yr(e){return m7(e).then(e=>e.datastore)}async function yn(e){let t=await m7(e),r=t.eventManager;return r.onListen=g9.bind(null,t.syncEngine),r.onUnlisten=mr.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=g7.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=mn.bind(null,t.syncEngine),r}function yi(e,t,r,n){let i=new mW(n),s=new gK(t,i,r);return e.asyncQueue.enqueueAndForget(async()=>gB(await yn(e),s)),()=>{i.mute(),e.asyncQueue.enqueueAndForget(async()=>gj(await yn(e),s))}}function ys(e,t){let r=new rL;return e.asyncQueue.enqueueAndForget(async()=>yf(await ye(e),t,r)),r.promise}function ya(e,t,r={}){let n=new rL;return e.asyncQueue.enqueueAndForget(async()=>yp(await yn(e),e.asyncQueue,t,r,n)),n.promise}function yo(e,t){let r=new rL;return e.asyncQueue.enqueueAndForget(async()=>yg(await ye(e),t,r)),r.promise}function yl(e,t,r={}){let n=new rL;return e.asyncQueue.enqueueAndForget(async()=>ym(await yn(e),e.asyncQueue,t,r,n)),n.promise}function yu(e,t,r){let n=new rL;return e.asyncQueue.enqueueAndForget(async()=>{try{let i=await yr(e);n.resolve(pK(i,t,r))}catch(e){n.reject(e)}}),n.promise}function yc(e,t){let r=new rL;return e.asyncQueue.enqueueAndForget(async()=>mi(await yt(e),t,r)),r.promise}function yh(e,t){let r=new mW(t);return e.asyncQueue.enqueueAndForget(async()=>gz(await yn(e),r)),()=>{r.mute(),e.asyncQueue.enqueueAndForget(async()=>gH(await yn(e),r))}}function yd(e,t,r){let n=new rL;return e.asyncQueue.enqueueAndForget(async()=>{let i=await yr(e);new mX(e.asyncQueue,i,r,t,n).run()}),n.promise}async function yf(e,t,r){try{let n=await fR(e,t);n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new rM(rN,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=gD(n,`Failed to get document '${t} from cache`);r.reject(e)}}function yp(e,t,r,n,i){let s=new mW({next:o=>{s.mute(),t.enqueueAndForget(()=>gj(e,a));let l=o.docs.has(r);!l&&o.fromCache?i.reject(new rM(rN,"Failed to get document because the client is offline.")):l&&o.fromCache&&n&&"server"===n.source?i.reject(new rM(rN,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new gK(og(r.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return gB(e,a)}async function yg(e,t,r){try{let n=await fA(e,t,!0),i=new g1(t,n.remoteKeys),s=i.computeDocChanges(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=gD(n,`Failed to execute query '${t} against cache`);r.reject(e)}}function ym(e,t,r,n,i){let s=new mW({next:r=>{s.mute(),t.enqueueAndForget(()=>gj(e,a)),r.fromCache&&"server"===n.source?i.reject(new rM(rN,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(r)},error:e=>i.reject(e)}),a=new gK(r,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return gB(e,a)}function yy(e,t,r,n){let i=y_(r,pD(t));e.asyncQueue.enqueueAndForget(async()=>{mM(await yt(e),i,n)})}function yv(e,t){return e.asyncQueue.enqueue(async()=>fH(await ye(e),t))}function y_(e,t){let r;return mG(mH(r="string"==typeof e?lW().encode(e):e),t)}function yb(e,t){return mY(e,t)}function yS(e,t){return e.asyncQueue.enqueue(async()=>f$(await ye(e),t))}function yC(e,t){return e.asyncQueue.enqueue(async()=>fK(await ye(e),t))}function yw(e){return e.asyncQueue.enqueue(async()=>fG(await ye(e)))}function yT(e,t){return e.timeoutSeconds===t.timeoutSeconds}function yE(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let yk="ComponentProvider",yI=new Map;function yR(e){let t=yI.get(e);t&&(rc(yk,"Removing Datastore"),yI.delete(e),t.terminate())}function yx(e,t,r,n,i){return new sA(e,t,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,yE(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,n)}let yD="firestore.googleapis.com",yO=!0,yA=5,yN=30,yP=!0;class yM{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new rM(rS,"Can't provide ssl option if host option is not set");this.host=yD,this.ssl=yO}else this.host=e.host,this.ssl=e.ssl??yO;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=h9;else if(e.cacheSizeBytes!==h8&&e.cacheSizeBytes<dt)throw new rM(rS,`cacheSizeBytes must be at least ${dt}`);else this.cacheSizeBytes=e.cacheSizeBytes;r9("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=yP:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yE(e.experimentalLongPollingOptions??{}),yL(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&yT(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function yL(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new rM(rS,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<yA)throw new rM(rS,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${yA})`);if(e.timeoutSeconds>yN)throw new rM(rS,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${yN})`)}}class yF{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yM({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new rM(rR,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new rM(rR,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yM(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=rW(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return yR(this),Promise.resolve()}}function yB(e,t,r,n={}){e=nn(e,yF);let i=es(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&(ea(`https://${o}`),el("Firestore",!0)),s.host!==yD&&s.host!==o&&rd("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!eP(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=ri.MOCK_USER;else{t=eo(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new rM(rS,"mockUserToken must contain 'sub' or 'user_id' field!");r=new ri(i)}e._authCredentials=new rj(new rF(t,r))}}class yj{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new yj(this.firestore,e,this._query)}}class yq{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yU(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yq(this.firestore,e,this._key)}toJSON(){return{type:yq._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(na(t,yq._jsonSchema))return new yq(e,r||null,new r5(r3.fromString(t.referencePath)))}}yq._jsonSchemaVersion="firestore/documentReference/1.0",yq._jsonSchema={type:ns("string",yq._jsonSchemaVersion),referencePath:ns("string")};class yU extends yj{constructor(e,t,r){super(e,t,og(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new yq(this.firestore,null,new r5(e))}withConverter(e){return new yU(this.firestore,e,this._path)}}function yV(e,t,...r){if(e=eU(e),1==arguments.length&&(t=rK.newId()),r8("doc","path",t),e instanceof yF){let n=r3.fromString(t,...r);return r7(n),new yq(e,null,new r5(n))}{if(!(e instanceof yq)&&!(e instanceof yU))throw new rM(rS,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(r3.fromString(t,...r));return r7(n),new yq(e.firestore,e instanceof yU?e.converter:null,new r5(n))}}function yz(e,t){return e=eU(e),t=eU(t),e instanceof yj&&t instanceof yj&&e.firestore===t.firestore&&oD(e._query,t._query)&&e.converter===t.converter}let yH="AsyncQueue";class yW{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new pM(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new rL;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(nF(e))rc(yH,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,rh("INTERNAL UNHANDLED ERROR: ",y$(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let n=gx.createAndSchedule(this,e,t,r,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(n),n}verifyNotFailed(){this.failure&&rp(47125,{messageOrStack:y$(this.failure)})}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(let t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function y$(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class yK{constructor(){this._progressObserver={},this._taskCompletionResolver=new rL,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class yG extends yF{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new yW,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new yW(e),this._firestoreClient=void 0,await e}}}function yQ(e,t){let r="object"==typeof e?e:tq(),n="string"==typeof e?e:t||sN,i=tI(r,"firestore").getImmediate({identifier:n});if(!i._initialized){let e=er("firestore");e&&yB(i,...e)}return i}function yY(e){if(e._terminated)throw new rM(rR,"The client has already been terminated.");return e._firestoreClient||yJ(e),e._firestoreClient}function yJ(e){let t=e._freezeSettings(),r=yx(e._databaseId,e._app?.options.appId||"",e._persistenceKey,e._app?.options.apiKey,t);!e._componentsProvider&&t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new m6(e._authCredentials,e._appCheckCredentials,e._queue,r,e._componentsProvider&&yX(e._componentsProvider))}function yX(e){let t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}function yZ(e,t){let r=yY(e=nn(e,yG)),n=new yK;return yy(r,e._databaseId,t,n),n}function y0(e,t){return yv(yY(e=nn(e,yG)),t).then(t=>t?new yj(e,null,t.query):null)}class y1{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class y2{constructor(e){this._byteString=e}static fromBase64String(e){try{return new y2(sy.fromBase64String(e))}catch(e){throw new rM(rS,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new y2(sy.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:y2._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(na(e,y2._jsonSchema))return y2.fromBase64String(e.bytes)}}y2._jsonSchemaVersion="firestore/bytes/1.0",y2._jsonSchema={type:ns("string",y2._jsonSchemaVersion),bytes:ns("string")};class y3{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new rM(rS,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new r4(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class y6{constructor(e){this._methodName=e}}class y4{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new rM(rS,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new rM(rS,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return rG(this._lat,e._lat)||rG(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:y4._jsonSchemaVersion}}static fromJSON(e){if(na(e,y4._jsonSchema))return new y4(e.latitude,e.longitude)}}y4._jsonSchemaVersion="firestore/geoPoint/1.0",y4._jsonSchema={type:ns("string",y4._jsonSchemaVersion),latitude:ns("number"),longitude:ns("number")};class y5{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return fd(this._values,e._values)}toJSON(){return{type:y5._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(na(e,y5._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new y5(e.vectorValues);throw new rM(rS,"Expected 'vectorValues' field to be a number array")}}}y5._jsonSchemaVersion="firestore/vectorValue/1.0",y5._jsonSchema={type:ns("string",y5._jsonSchemaVersion),vectorValues:ns("object")};let y8=/^__.*__$/;class y9{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new lE(e,this.data,this.fieldMask,t,this.fieldTransforms):new lC(e,this.data,t,this.fieldTransforms)}}class y7{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new lE(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ve(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw rp(40011,{dataSource:e})}}class vt{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new vt({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return vb(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(ve(this.dataSource)&&y8.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class vr{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||pD(e)}createContext(e,t,r,n=!1){return new vt({dataSource:e,methodName:t,targetDoc:r,path:r4.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vn(e){let t=e._freezeSettings(),r=pD(e._databaseId);return new vr(e._databaseId,!!t.ignoreUndefinedProperties,r)}function vi(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);vm("Data must be an object, but it was:",l,n);let u=vc(n,l);if(s.merge)a=new sp(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=vy(t,n,r);if(!l.contains(i))throw new rM(rS,`Field '${i}' is specified in your field mask but missing from your input data.`);vS(e,i)||e.push(i)}a=new sp(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new y9(new ak(u),a,o)}class vs extends y6{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof vs}}function va(e,t,r,n){let i=e.createContext(1,t,r);vm("Data must be an object, but it was:",i,n);let s=[],a=ak.empty();return sn(n,(e,n)=>{let o=v_(t,e,r);n=eU(n);let l=i.childContextForFieldPath(o);if(n instanceof vs)s.push(o);else{let e=vu(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new y7(a,new sp(s),i.fieldTransforms)}function vo(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[vy(t,n,r)],l=[i];if(s.length%2!=0)throw new rM(rS,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(vy(t,s[e])),l.push(s[e+1]);let u=[],c=ak.empty();for(let e=o.length-1;e>=0;--e)if(!vS(u,o[e])){let t=o[e],r=l[e];r=eU(r);let n=a.childContextForFieldPath(t);if(r instanceof vs)u.push(t);else{let e=vu(r,n);null!=e&&(u.push(t),c.set(t,e))}}return new y7(c,new sp(u),a.fieldTransforms)}function vl(e,t,r,n=!1){return vu(r,e.createContext(n?4:3,t))}function vu(e,t){if(vg(e=eU(e)))return vm("Unsupported field value:",t,e),vc(e,t);if(e instanceof y6)return vd(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return vf(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return vh(e,t)}function vc(e,t){let r={};return ss(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):sn(e,(e,n)=>{let i=vu(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function vh(e,t){let r=[],n=0;for(let i of e){let e=vu(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}function vd(e,t){if(!ve(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}function vf(e,t){if(null===(e=eU(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return o4(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=nu.fromDate(e);return{timestampValue:uo(t.serializer,r)}}else if(e instanceof nu){let r=new nu(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:uo(t.serializer,r)}}else if(e instanceof y4)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof y2)return{bytesValue:uu(t.serializer,e._byteString)};else if(e instanceof yq){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:uf(e.firestore._databaseId||t.databaseId,e._key.path)}}else if(e instanceof y5)return vp(e,t);else if(cf(e))return e._toProto(t.serializer);else throw t.createError(`Unsupported field value: ${nt(e)}`)}function vp(e,t){return{mapValue:{fields:{[sq]:{stringValue:sz},[sH]:{arrayValue:{values:(e instanceof y5?e.toArray():e).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return o3(t.serializer,e)})}}}}}}function vg(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof nu)&&!(e instanceof y4)&&!(e instanceof y2)&&!(e instanceof yq)&&!(e instanceof y6)&&!(e instanceof y5)&&!cf(e)}function vm(e,t,r){if(!vg(r)||!ne(r)){let n=nt(r);if("an object"===n)throw t.createError(e+" a custom object");throw t.createError(e+" "+n)}}function vy(e,t,r){if((t=eU(t))instanceof y3)return t._internalPath;if("string"==typeof t)return v_(e,t);throw vb("Field path arguments must be of type string or ",e,!1,void 0,r)}let vv=RegExp("[~\\*/\\[\\]]");function v_(e,t,r){if(t.search(vv)>=0)throw vb(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new y3(...t.split("."))._internalPath}catch(n){throw vb(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function vb(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new rM(rS,o+e+l)}function vS(e,t){return e.some(e=>e.isEqual(t))}class vC{convertValue(e,t="none"){switch(s$(e)){case 0:return null;case 1:return e.booleanValue;case 2:return sC(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sw(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw rp(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return sn(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new y5(e.fields?.[sH].arrayValue?.values?.map(e=>sC(e.doubleValue)))}convertGeoPoint(e){return new y4(sC(e.latitude),sC(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=sD(e);if(null==r)return null;return this.convertValue(r,t);case"estimate":return this.convertTimestamp(sO(e));default:return null}}convertTimestamp(e){let t=sS(e);return new nu(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=r3.fromString(e);rm(cd(r),9688,{name:e});let n=new sP(r.get(1),r.get(3)),i=new r5(r.popFirst(5));return n.isEqual(t)||rh(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class vw extends vC{constructor(e){super(),this.firestore=e}convertBytes(e){return new y2(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new yq(this.firestore,null,t)}}let vT="@firebase/firestore",vE="4.10.0";function vk(e,t=!0){ra(tF),tk(new eV("firestore",(e,{instanceIdentifier:r,options:n})=>{let i=e.getProvider("app").getImmediate(),s=new yG(new rq(e.getProvider("auth-internal")),new rH(i,e.getProvider("app-check-internal")),sM(i,r),i);return n={useFetchStreams:t,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),tz(vT,vE,e),tz(vT,vE,"esm2020")}class vI{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class vR{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new ak({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class vx{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new yq(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let e=new vD(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(vy("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class vD extends vx{data(){return super.data()}}function vO(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new rM(rO,"limitToLast() queries require specifying at least one orderBy() clause")}class vA{}class vN extends vA{}function vP(e,t,...r){let n=[];for(let i of(t instanceof vA&&n.push(t),v7(n=n.concat(r)),n))e=i._apply(e);return e}class vM extends vN{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new vM(e,t,r)}_apply(e){let t=this._parse(e);return v4(e._query,t),new yj(e.firestore,e.converter,oE(e._query,t))}_parse(e){let t=vn(e.firestore);return vX(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function vL(e,t,r){let n=t,i=vy("where",e);return vM._create(i,n,r)}class vF extends vA{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new vF(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:aU.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(v5(e._query,t),new yj(e.firestore,e.converter,oE(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function vB(...e){return e.forEach(e=>v9("or",e)),vF._create("or",e)}function vj(...e){return e.forEach(e=>v9("and",e)),vF._create("and",e)}class vq extends vN{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new vq(e,t)}_apply(e){let t=vZ(e._query,this._field,this._direction);return new yj(e.firestore,e.converter,ok(e._query,t))}}function vU(e,t="asc"){let r=t,n=vy("orderBy",e);return vq._create(n,r)}class vV extends vN{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new vV(e,t,r)}_apply(e){return new yj(e.firestore,e.converter,oI(e._query,this._limit,this._limitType))}}function vz(e){return ni("limit",e),vV._create("limit",e,"F")}function vH(e){return ni("limitToLast",e),vV._create("limitToLast",e,"L")}class vW extends vN{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new vW(e,t,r)}_apply(e){let t=vJ(e,this.type,this._docOrFields,this._inclusive);return new yj(e.firestore,e.converter,oR(e._query,t))}}function v$(...e){return vW._create("startAt",e,!0)}function vK(...e){return vW._create("startAfter",e,!1)}class vG extends vN{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new vG(e,t,r)}_apply(e){let t=vJ(e,this.type,this._docOrFields,this._inclusive);return new yj(e.firestore,e.converter,ox(e._query,t))}}function vQ(...e){return vG._create("endBefore",e,!1)}function vY(...e){return vG._create("endAt",e,!0)}function vJ(e,t,r,n){if(r[0]=eU(r[0]),r[0]instanceof vx)return v0(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=vn(e.firestore);return v1(e._query,e.firestore._databaseId,i,t,r,n)}}function vX(e,t,r,n,i,s,a){let o;if(i.isKeyField())if("array-contains"===s||"array-contains-any"===s)throw new rM(rS,`Invalid Query. You can't perform '${s}' queries on documentId().`);else if("in"===s||"not-in"===s){v3(a,s);let t=[];for(let r of a)t.push(v2(n,e,r));o={arrayValue:{values:t}}}else o=v2(n,e,a);else("in"===s||"not-in"===s||"array-contains-any"===s)&&v3(a,s),o=vl(r,t,a,"in"===s||"not-in"===s);return aq.create(i,s,o)}function vZ(e,t,r){if(null!==e.startAt)throw new rM(rS,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new rM(rS,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new aM(t,r)}function v0(e,t,r,n,i){if(!n)throw new rM(rw,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of oS(e))if(r.field.isKeyField())s.push(ac(t,n.key));else{let e=n.data.field(r.field);if(sR(e))throw new rM(rS,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{let e=r.field.canonicalString();throw new rM(rS,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new aD(s,i)}function v1(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new rM(rS,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new rM(rS,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!ob(e)&&-1!==l.indexOf("/"))throw new rM(rS,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(r3.fromString(l));if(!r5.isDocumentKey(r))throw new rM(rS,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new r5(r);o.push(ac(t,i))}else{let e=vl(r,n,l);o.push(e)}}return new aD(o,s)}function v2(e,t,r){if("string"==typeof(r=eU(r))){if(""===r)throw new rM(rS,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ob(t)&&-1!==r.indexOf("/"))throw new rM(rS,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(r3.fromString(r));if(!r5.isDocumentKey(n))throw new rM(rS,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ac(e,new r5(n))}if(r instanceof yq)return ac(e,r._key);throw new rM(rS,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${nt(r)}.`)}function v3(e,t){if(!Array.isArray(e)||0===e.length)throw new rM(rS,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function v6(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function v4(e,t){let r=v8(e.filters,v6(t.op));if(null!==r)if(r===t.op)throw new rM(rS,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);else throw new rM(rS,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function v5(e,t){let r=e;for(let e of t.getFlattenedFilters())v4(r,e),r=oE(r,e)}function v8(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}function v9(e,t){if(!(t instanceof vM)&&!(t instanceof vF))throw new rM(rS,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function v7(e){let t=e.filter(e=>e instanceof vF).length,r=e.filter(e=>e instanceof vM).length;if(t>1||t>0&&r>0)throw new rM(rS,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}function _e(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class _t extends vC{constructor(e){super(),this.firestore=e}convertBytes(e){return new y2(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new yq(this.firestore,null,t)}}function _r(e){return new vI("sum",vy("sum",e))}function _n(e){return new vI("avg",vy("average",e))}function _i(){return new vI("count")}function _s(e,t){return e instanceof vI&&t instanceof vI&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function _a(e,t){return yz(e.query,t.query)&&eP(e.data(),t.data())}function _o(e){return _l(e,{count:_i()})}function _l(e,t){let r=nn(e.firestore,yG),n=yY(r),i=si(t,(e,t)=>new y1(t,e.aggregateType,e._internalFieldPath));return yu(n,e._query,i).then(t=>_u(r,e,t))}function _u(e,t,r){return new vR(t,new vw(e),r)}class _c{constructor(e){this.kind="memory",this._onlineComponentProvider=mU.provider,e?.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new mB(void 0)}}toJSON(){return{kind:this.kind}}}class _h{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=_b(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class _d{constructor(){this.kind="memoryEager",this._offlineComponentProvider=mF.provider}toJSON(){return{kind:this.kind}}}class _f{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new mB(e)}}toJSON(){return{kind:this.kind}}}function _p(){return new _d}function _g(e){return new _f(e?.cacheSizeBytes)}function _m(e){return new _c(e)}function _y(e){return new _h(e)}class _v{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=mU.provider,this._offlineComponentProvider={build:t=>new mj(t,e?.cacheSizeBytes,this.forceOwnership)}}}class __{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=mU.provider,this._offlineComponentProvider={build:t=>new mq(t,e?.cacheSizeBytes)}}}function _b(e){return new _v(e?.forceOwnership)}function _S(){return new __}let _C=lW();function _w(e){let t=JSON.stringify(e),r=_C.encode(t).byteLength;return`${r}${t}`}_w({metadata:{id:"test-bundle",createTime:{seconds:0x5e0be105,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),_w({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),_w({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),_w({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),_w({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),_w({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),_w({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:0x5ec5a5f3,nanos:191164e3}}}),_w({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:0x5ec5a5f3,nanos:543063e3}}});let _T=1;class _E{constructor(e,t){this.firestore=e,this.bundleId=t,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new nu(0,0),this.databaseId=e._databaseId,this.serializer=new un(this.databaseId,!0),this.userDataReader=new vr(this.databaseId,!0,this.serializer)}addBundleDocument(e,t){let r=this.documents.get(e.documentPath),n=r?.metadata.queries,i=e.readTime,s=r?.metadata.readTime?ul(r.metadata.readTime):null,a=!i&&null==s,o=void 0!==i&&(null==s||s<i);if((a||o)&&this.documents.set(e.documentPath,{document:this.toBundleDocument(e),metadata:{name:um(this.serializer,e.documentKey),readTime:i?uo(this.serializer,i):void 0,exists:e.documentExists}}),i&&i>this.latestReadTime&&(this.latestReadTime=i),t){let r=this.documents.get(e.documentPath);r.metadata.queries=n||[],r.metadata.queries.push(t)}}addBundleQuery(e){if(this.namedQueries.has(e.name))throw Error(`Query name conflict: ${name} has already been added.`);let t=new nu(0,0);for(let r of e.docBundleDataArray)this.addBundleDocument(r,e.name),r.readTime&&r.readTime>t&&(t=r.readTime);let r=uV(this.serializer,oC(e.query)),n={parent:e.parent,structuredQuery:r.queryTarget.structuredQuery};this.namedQueries.set(e.name,{name:e.name,bundledQuery:n,readTime:uo(this.serializer,t)})}toBundleDocument(e){let t=this.userDataReader.createContext(4,"internal toBundledDocument"),r=vc(e.documentData,t);return{name:um(this.serializer,e.documentKey),fields:r.mapValue.fields,updateTime:uo(this.serializer,e.versionTime),createTime:uo(this.serializer,e.createdTime)}}lengthPrefixedString(e){let t=JSON.stringify(e),r=_C.encode(t).byteLength;return`${r}${t}`}build(){let e="";for(let t of this.namedQueries.values())e+=this.lengthPrefixedString({namedQuery:t});for(let t of this.documents.values()){let r=t.metadata;e+=this.lengthPrefixedString({documentMetadata:r});let n=t.document;n&&(e+=this.lengthPrefixedString({document:n}))}let t={id:this.bundleId,createTime:uo(this.serializer,this.latestReadTime),version:_T,totalDocuments:this.documents.size,totalBytes:_C.encode(e).length};return this.lengthPrefixedString({metadata:t})+e}}function _k(e,t,r,n){let i=new _E(e,rK.newId());return i.addBundleDocument(_R(n,r,t)),i.build()}function _I(e,t,r,n,i,s,a){let o=[];for(let e=0;e<s.length;e++)o.push(_R(i[e],a[e],s[e]));let l={name:r,query:t,parent:n,docBundleDataArray:o},u=new _E(e,r);return u.addBundleQuery(l),u.build()}function _R(e,t,r){return{documentData:t,documentKey:r.mutableCopy().key,documentPath:e,documentExists:!0,createdTime:r.createTime.toTimestamp(),readTime:r.readTime.toTimestamp(),versionTime:r.version.toTimestamp()}}let _x="NOT SUPPORTED";class _D{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _O extends vx{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{let t=new _N(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){let r=this._document.data.field(vy("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new rM(rR,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};if(t.type=_O._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument())return t;let r=this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous");return t.bundle=_k(this._firestore,e,r,this.ref.path),t}}function _A(e,t,r){if(na(t,_O._jsonSchema)){if(t.bundle===_x)throw new rM(rS,"The provided JSON object was created in a client environment, which is not supported.");let n=pD(e._databaseId),i=yb(t.bundle,n),s=i.getElements(),a=new gY(i.getMetadata(),n);for(let e of s)a.addSizedElement(e);let o=a.documents;if(1!==o.length)throw new rM(rS,`Expected bundle data to contain 1 document, but it contains ${o.length} documents.`);let l=uE(n,o[0].document),u=new r5(r3.fromString(t.bundleName));return new _O(e,new _t(e),u,l,new _D(!1,!1),r||null)}}_O._jsonSchemaVersion="firestore/documentSnapshot/1.0",_O._jsonSchema={type:ns("string",_O._jsonSchemaVersion),bundleSource:ns("string","DocumentSnapshot"),bundleName:ns("string"),bundle:ns("string")};class _N extends _O{data(e={}){return super.data(e)}}class _P{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new _D(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new _N(this._firestore,this._userDataWriter,r.key,r,new _D(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new rM(rS,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=_L(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new rM(rR,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=_P._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=rK.newId();let t=this._firestore._databaseId.database,r=this._firestore._databaseId.projectId,n=`projects/${r}/databases/${t}/documents`,i=[],s=[],a=[];return this.docs.forEach(e=>{null!==e._document&&(i.push(e._document),s.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),a.push(e.ref.path))}),e.bundle=_I(this._firestore,this.query._query,e.bundleName,n,a,i,s),e}}function _M(e,t,r){if(na(t,_P._jsonSchema)){if(t.bundle===_x)throw new rM(rS,"The provided JSON object was created in a client environment, which is not supported.");let n=pD(e._databaseId),i=yb(t.bundle,n),s=i.getElements(),a=new gY(i.getMetadata(),n);for(let e of s)a.addSizedElement(e);if(1!==a.queries.length)throw new rM(rS,`Snapshot data expected 1 query but found ${a.queries.length} queries.`);let o=cO(a.queries[0].bundledQuery),l=a.documents,u=new gO;l.map(e=>{let t=uE(n,e.document);u=u.add(t)});let c=gN.fromInitialDocuments(o,u,o0(),!1,!1),h=new yj(e,r||null,o);return new _P(e,new _t(e),h,c)}}function _L(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new _N(e._firestore,e._userDataWriter,r.doc.key,r.doc,new _D(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new _N(e._firestore,e._userDataWriter,t.doc.key,t.doc,new _D(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:_F(t.type),doc:n,oldIndex:i,newIndex:s}})}}function _F(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return rp(61501,{type:e})}}function _B(e,t){return e instanceof _O&&t instanceof _O?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof _P&&t instanceof _P&&e._firestore===t._firestore&&yz(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}_P._jsonSchemaVersion="firestore/querySnapshot/1.0",_P._jsonSchema={type:ns("string",_P._jsonSchemaVersion),bundleSource:ns("string","QuerySnapshot"),bundleName:ns("string"),bundle:ns("string")};let _j={maxAttempts:5};function _q(e){if(e.maxAttempts<1)throw new rM(rS,"Max attempts must be at least 1")}class _U{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=vn(e)}set(e,t,r){this._verifyNotCommitted();let n=_V(e,this._firestore),i=_e(n.converter,t,r),s=vi(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,lp.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=_V(e,this._firestore);return i="string"==typeof(t=eU(t))||t instanceof y3?vo(this._dataReader,"WriteBatch.update",s._key,t,r,n):va(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,lp.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=_V(e,this._firestore);return this._mutations=this._mutations.concat(new lO(t._key,lp.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new rM(rR,"A write batch can no longer be used after commit() has been called.")}}function _V(e,t){if((e=eU(e)).firestore===t)return e;throw new rM(rS,"Provided document reference is from a different Firestore instance.")}class _z{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=vn(e)}get(e){let t=_V(e,this._firestore),r=new _t(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return rp(24041);let n=e[0];if(n.isFoundDocument())return new vx(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new vx(this._firestore,r,t._key,null,t.converter);throw rp(18433,{doc:n})})}set(e,t,r){let n=_V(e,this._firestore),i=_e(n.converter,t,r),s=vi(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=_V(e,this._firestore);return i="string"==typeof(t=eU(t))||t instanceof y3?vo(this._dataReader,"Transaction.update",s._key,t,r,n):va(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=_V(e,this._firestore);return this._transaction.delete(t._key),this}}class _H extends _z{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=_V(e,this._firestore),r=new vw(this._firestore);return super.get(e).then(e=>new _O(this._firestore,r,t._key,e._document,new _D(!1,!1),t.converter))}}function _W(e,t,r){e=nn(e,yG);let n={..._j,...r};return _q(n),yd(yY(e),r=>t(new _H(e,r)),n)}function _$(e){return _K(e,["next","error","complete"])}function _K(e,t){if("object"!=typeof e||null===e)return!1;let r=e;for(let e of t)if(e in r&&"function"==typeof r[e])return!0;return!1}function _G(e){e=nn(e,yq);let t=nn(e.firestore,yG);return ya(yY(t),e._key).then(r=>_9(t,e,r))}function _Q(e){e=nn(e,yq);let t=nn(e.firestore,yG),r=yY(t),n=new vw(t);return ys(r,e._key).then(r=>new _O(t,n,e._key,r,new _D(null!==r&&r.hasLocalMutations,!0),e.converter))}function _Y(e){e=nn(e,yq);let t=nn(e.firestore,yG);return ya(yY(t),e._key,{source:"server"}).then(r=>_9(t,e,r))}function _J(e){e=nn(e,yj);let t=nn(e.firestore,yG),r=yY(t),n=new vw(t);return vO(e._query),yl(r,e._query).then(r=>new _P(t,n,e,r))}function _X(e){e=nn(e,yj);let t=nn(e.firestore,yG),r=yY(t),n=new vw(t);return yo(r,e._query).then(r=>new _P(t,n,e,r))}function _Z(e){e=nn(e,yj);let t=nn(e.firestore,yG),r=yY(t),n=new vw(t);return yl(r,e._query,{source:"server"}).then(r=>new _P(t,n,e,r))}function _0(e,t,r){e=nn(e,yq);let n=nn(e.firestore,yG),i=_e(e.converter,t,r),s=vi(vn(n),"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,lp.none());return _8(n,[s])}function _1(e,t,r,...n){let i;e=nn(e,yq);let s=nn(e.firestore,yG),a=vn(s);return _8(s,[(i="string"==typeof(t=eU(t))||t instanceof y3?vo(a,"updateDoc",e._key,t,r,n):va(a,"updateDoc",e._key,t)).toMutation(e._key,lp.exists(!0))])}function _2(e){return _8(nn(e.firestore,yG),[new lO(e._key,lp.none())])}function _3(e,t){let r=nn(e.firestore,yG),n=yV(e),i=_e(e.converter,t);return _8(r,[vi(vn(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,lp.exists(!1))]).then(()=>n)}function _6(e,...t){let r,n,i;e=eU(e);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof t[0]||_$(t[a])||(s=t[a++]);let o={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(_$(t[a])){let e=t[a];t[a]=e.next?.bind(e),t[a+1]=e.error?.bind(e),t[a+2]=e.complete?.bind(e)}if(e instanceof yq)n=nn(e.firestore,yG),i=og(e._key.path),r={next:r=>{t[a]&&t[a](_9(n,e,r))},error:t[a+1],complete:t[a+2]};else{let s=nn(e,yj);n=nn(s.firestore,yG),i=s._query;let o=new vw(n);r={next:e=>{t[a]&&t[a](new _P(n,o,s,e))},error:t[a+1],complete:t[a+2]},vO(e._query)}return yi(yY(n),i,o,r)}function _4(e,t,...r){let n,i=eU(e),s=_7(t);if(s.error)throw new rM(rS,s.error);let a=0;if("object"!=typeof r[0]||_$(r[a])||(n=r[a++]),"QuerySnapshot"===s.bundleSource){let e=null;if("object"==typeof r[a]&&_$(r[a])){let t=r[a++];e={next:t.next,error:t.error,complete:t.complete}}else e={next:r[a++],error:r[a++],complete:r[a++]};return bt(i,s,n,e,r[a])}if("DocumentSnapshot"===s.bundleSource){let e=null;if("object"==typeof r[a]&&_$(r[a])){let t=r[a++];e={next:t.next,error:t.error,complete:t.complete}}else e={next:r[a++],error:r[a++],complete:r[a++]};return be(i,s,n,e,r[a])}throw new rM(rS,`unsupported bundle source: ${s.bundleSource}`)}function _5(e,t){return yh(yY(e=nn(e,yG)),_$(t)?t:{next:t})}function _8(e,t){return yc(yY(e),t)}function _9(e,t,r){let n=r.docs.get(t._key),i=new vw(e);return new _O(e,i,t._key,n,new _D(r.hasPendingWrites,r.fromCache),t.converter)}function _7(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}function be(e,t,r,n,i){let s,a=!1;return yZ(e,t.bundle).then(()=>{a||(s=_6(new yq(e,i||null,r5.fromPath(t.bundleName)),r||{},n))}).catch(e=>(n.error&&n.error(e),()=>{})),()=>{!a&&(a=!0,s&&s())}}function bt(e,t,r,n,i){let s,a=!1;return yZ(e,t.bundle).then(()=>y0(e,t.bundleName)).then(e=>{if(e&&!a){let t=e;i&&t.withConverter(i),s=_6(e,r||{},n)}}).catch(e=>(n.error&&n.error(e),()=>{})),()=>{!a&&(a=!0,s&&s())}}function br(e){return yY(e=nn(e,yG)),new _U(e,t=>_8(e,t))}function bn(e,t){let r=yY(e=nn(e,yG));return r._uninitializedComponentsProvider&&"memory"!==r._uninitializedComponentsProvider._offline.kind?yS(r,bi(t)):(rd("Cannot enable indexes when persistence is disabled"),Promise.resolve())}function bi(e){let t="string"==typeof e?bs(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=ba(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=v_("setIndexConfiguration",ba(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new n_(e,2)):"ASCENDING"===t.order?n.push(new n_(e,0)):"DESCENDING"===t.order&&n.push(new n_(e,1))}r.push(new nf(nf.UNKNOWN_ID,t,n,nS.empty()))}return r}function bs(e){try{return JSON.parse(e)}catch(e){throw new rM(rS,"Failed to parse JSON: "+e?.message)}}function ba(e,t){if("string"!=typeof e[t])throw new rM(rS,"Missing string value for: "+t);return e[t]}class bo{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function bl(e){e=nn(e,yG);let t=bf.get(e);if(t)return t;let r=yY(e);if(r._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;let n=new bo(e);return bf.set(e,n),n}function bu(e){bd(e,!0)}function bc(e){bd(e,!1)}function bh(e){yw(yY(e._firestore)).then(e=>rc("deleting all persistent cache indexes succeeded")).catch(e=>rd("deleting all persistent cache indexes failed",e))}function bd(e,t){yC(yY(e._firestore),t).then(e=>rc(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>rd(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let bf=new WeakMap;class bp{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return bg.instance.onExistenceFilterMismatch(e)}}class bg{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return bm||lH(bm=new bg),bm}notifyOnExistenceFilterMismatch(e){this.existenceFilterMismatchCallbacksById.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.existenceFilterMismatchCallbacksById;return r.set(t,e),()=>r.delete(t)}}let bm=null;vk("node"),e.s(["AggregateField",()=>vI,"AggregateQuerySnapshot",()=>vR,"DocumentSnapshot",()=>_O,"PersistentCacheIndexManager",()=>bo,"QueryCompositeFilterConstraint",()=>vF,"QueryConstraint",()=>vN,"QueryDocumentSnapshot",()=>_N,"QueryEndAtConstraint",()=>vG,"QueryFieldFilterConstraint",()=>vM,"QueryLimitConstraint",()=>vV,"QueryOrderByConstraint",()=>vq,"QuerySnapshot",()=>_P,"QueryStartAtConstraint",()=>vW,"SnapshotMetadata",()=>_D,"Transaction",()=>_H,"WriteBatch",()=>_U,"_TestingHooks",()=>bp,"addDoc",()=>_3,"aggregateFieldEqual",()=>_s,"aggregateQuerySnapshotEqual",()=>_a,"and",()=>vj,"average",()=>_n,"count",()=>_i,"deleteAllPersistentCacheIndexes",()=>bh,"deleteDoc",()=>_2,"disablePersistentCacheIndexAutoCreation",()=>bc,"documentSnapshotFromJSON",()=>_A,"enablePersistentCacheIndexAutoCreation",()=>bu,"endAt",()=>vY,"endBefore",()=>vQ,"executeWrite",()=>_8,"getAggregateFromServer",()=>_l,"getCountFromServer",()=>_o,"getDoc",()=>_G,"getDocFromCache",()=>_Q,"getDocFromServer",()=>_Y,"getDocs",()=>_J,"getDocsFromCache",()=>_X,"getDocsFromServer",()=>_Z,"getPersistentCacheIndexManager",()=>bl,"limit",()=>vz,"limitToLast",()=>vH,"memoryEagerGarbageCollector",()=>_p,"memoryLocalCache",()=>_m,"memoryLruGarbageCollector",()=>_g,"onSnapshot",()=>_6,"onSnapshotResume",()=>_4,"onSnapshotsInSync",()=>_5,"or",()=>vB,"orderBy",()=>vU,"persistentLocalCache",()=>_y,"persistentMultipleTabManager",()=>_S,"persistentSingleTabManager",()=>_b,"query",()=>vP,"querySnapshotFromJSON",()=>_M,"runTransaction",()=>_W,"setDoc",()=>_0,"setIndexConfiguration",()=>bn,"snapshotEqual",()=>_B,"startAfter",()=>vK,"startAt",()=>v$,"sum",()=>_r,"updateDoc",()=>_1,"where",()=>vL,"writeBatch",()=>br],14113),e.i(14113);var by=e.i(79508);let bv="5",b_="v",bb="s",bS="r",bC="f",bw=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,bT="ls",bE="p",bk="ac",bI="websocket",bR="long_polling";class bx{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return eD(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let bD=function(e){return new bx},bO=bD("localStorage"),bA=bD("sessionStorage"),bN=new eZ("@firebase/database"),bP=function(){let e=1;return function(){return e++}}(),bM=function(e){let t=ej(e),r=new eF;r.update(t);let n=r.digest();return V.encodeByteArray(n)},bL=function(...e){let t="";for(let r=0;r<e.length;r++){let n=e[r];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=bL.apply(null,n):"object"==typeof n?t+=ek(n):t+=n,t+=" "}return t},bF=null,bB=!0,bj=function(e,t){B(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(bN.logLevel=f.VERBOSE,bF=bN.log.bind(bN),t&&bA.set("logging_enabled",!0)):"function"==typeof e?bF=e:(bF=null,bA.remove("logging_enabled"))},bq=function(...e){if(!0===bB&&(bB=!1,null===bF&&!0===bA.get("logging_enabled")&&bj(!0)),bF){let t=bL.apply(null,e);bF(t)}},bU=function(e){return function(...t){bq(e,...t)}},bV=function(...e){let t="FIREBASE INTERNAL ERROR: "+bL(...e);bN.error(t)},bz=function(...e){let t=`FIREBASE FATAL ERROR: ${bL(...e)}`;throw bN.error(t),Error(t)},bH=function(...e){let t="FIREBASE WARNING: "+bL(...e);bN.warn(t)},bW=function(){},b$=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},bK=function(e){if(eg()||"complete"===document.readyState)e();else{let t=!1,r=function(){document.body?t||(t=!0,e()):setTimeout(r,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&r()}),window.attachEvent("onload",r))}},bG="[MIN_NAME]",bQ="[MAX_NAME]",bY=function(e,t){if(e===t)return 0;{if(e===bG||t===bQ)return -1;if(t===bG||e===bQ)return 1;let r=b9(e),n=b9(t);if(null!==r)if(null!==n)return r-n==0?e.length-t.length:r-n;else return -1;return null!==n?1:e<t?-1:1}},bJ=function(e,t){return e===t?0:e<t?-1:1},bX=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+ek(t))},bZ=function(e){if("object"!=typeof e||null===e)return ek(e);let t=[];for(let r in e)t.push(r);t.sort();let r="{";for(let n=0;n<t.length;n++)0!==n&&(r+=","),r+=ek(t[n]),r+=":",r+=bZ(e[t[n]]);return r+"}"},b0=function(e,t){let r=e.length;if(r<=t)return[e];let n=[];for(let i=0;i<r;i+=t)i+t>r?n.push(e.substring(i,r)):n.push(e.substring(i,i+t));return n};function b1(e,t){for(let r in e)e.hasOwnProperty(r)&&t(r,e[r])}let b2=function(e){let t,r,n,i,s;B(!b$(e),"Invalid JSON number");let a=11,o=52,l=1023;0===e?(r=0,n=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=Math.pow(2,1-l)?(r=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),l))+l,n=Math.round(e*Math.pow(2,o-i)-Math.pow(2,o))):(r=0,n=Math.round(e/Math.pow(2,1-l-o))));let u=[];for(s=o;s;s-=1)u.push(n%2?1:0),n=Math.floor(n/2);for(s=a;s;s-=1)u.push(r%2?1:0),r=Math.floor(r/2);u.push(+!!t),u.reverse();let c=u.join(""),h="";for(s=0;s<64;s+=8){let e=parseInt(c.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),h+=e}return h.toLowerCase()},b3=function(){return!1},b6=function(){return"object"==typeof Windows&&"object"==typeof Windows.UI},b4=RegExp("^-?(0*)\\d{1,10}$"),b5=-0x80000000,b8=0x7fffffff,b9=function(e){if(b4.test(e)){let t=Number(e);if(t>=b5&&t<=b8)return t}return null},b7=function(e){try{e()}catch(e){setTimeout(()=>{throw bH("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},Se=function(){return"".search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},St=function(e,t){let r=setTimeout(e,t);return"number"==typeof r&&"u">typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(r):"object"==typeof r&&r.unref&&r.unref(),r};class Sr{constructor(e,t,r,n,i=!1,s="",a=!1,o=!1,l=null){this.secure=t,this.namespace=r,this.webSocketOnly=n,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=o,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=bO.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&bO.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Sn(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function Si(e,t,r){let n;if(B("string"==typeof t,"typeof type must == string"),B("object"==typeof r,"typeof params must == object"),t===bI)n=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===bR)n=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);Sn(e)&&(r.ns=e.namespace);let i=[];return b1(r,(e,t)=>{i.push(e+"="+t)}),n+i.join("&")}class Ss{constructor(){this.counters_={}}incrementCounter(e,t=1){eD(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return K(this.counters_)}}let Sa={},So={};function Sl(e){let t=e.toString();return Sa[t]||(Sa[t]=new Ss),Sa[t]}function Su(e,t){let r=e.toString();return So[r]||(So[r]=t()),So[r]}let Sc="";function Sh(e){Sc=e}let Sd=16384,Sf=45e3,Sp=null;function Sg(e){Sp=e}"u">typeof MozWebSocket?Sp=MozWebSocket:"u">typeof WebSocket&&(Sp=WebSocket);class Sm{constructor(e,t,r,n,i,s,a){this.connId=e,this.applicationId=r,this.appCheckToken=n,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=bU(this.connId),this.stats_=Sl(t),this.connURL=Sm.connectionURL_(t,s,a,n,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,n,i){let s={};return s[b_]=bv,!eg()&&"u">typeof location&&location.hostname&&bw.test(location.hostname)&&(s[bS]=bC),t&&(s[bb]=t),r&&(s[bT]=r),n&&(s[bk]=n),i&&(s[bE]=i),Si(e,bI,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,bO.set("previous_websocket_failure",!0);try{let e;if(eg()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/${bv}/${Sc}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let r=process.env,n=0===this.connURL.indexOf("wss://")?r.HTTPS_PROXY||r.https_proxy:r.HTTP_PROXY||r.http_proxy;n&&(e.proxy={origin:n})}this.mySock=new Sp(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Sm.forceDisallow_=!0}static isAvailable(){let e=!1;if("u">typeof navigator&&navigator.userAgent){let t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&4.4>parseFloat(r[1])&&(e=!0)}return!e&&null!==Sp&&!Sm.forceDisallow_}static previouslyFailed(){return bO.isInMemoryStorage||!0===bO.get("previous_websocket_failure")}markConnectionHealthy(){bO.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=eE(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(B(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=ek(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=b0(t,Sd);r.length>1&&this.sendString_(String(r.length));for(let e=0;e<r.length;e++)this.sendString_(r[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Sf))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Sm.responsesRequiredToBeHealthy=2,Sm.healthyTimeout=3e4;let Sy="@firebase/database",Sv="1.1.0";class S_{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,tO(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){bH(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Sb{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(bq("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',bH(e)}}class SS{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}SS.OWNER="owner";class SC{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&b7(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let Sw="start",ST="close",SE="pLPCommand",Sk="pRTLPCB",SI="id",SR="pw",Sx="ser",SD="cb",SO="seg",SA="ts",SN="d",SP="dframe",SM=1870,SL=30,SF=1840,SB=25e3,Sj=3e4;class Sq{constructor(e,t,r,n,i,s,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=n,this.authToken=i,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=bU(e),this.stats_=Sl(t),this.urlFn=e=>(this.appCheckToken&&(e[bk]=this.appCheckToken),Si(t,bR,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new SC(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Sj)),bK(()=>{if(this.isClosed_)return;this.scriptTagHolder=new SU((...e)=>{let[t,r,n,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===Sw)this.id=r,this.password=n;else if(t===ST)r?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(r,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,r]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,r)},()=>{this.onClosed_()},this.urlFn);let e={};e[Sw]="t",e[Sx]=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e[SD]=this.scriptTagHolder.uniqueCallbackIdentifier),e[b_]=bv,this.transportSessionId&&(e[bb]=this.transportSessionId),this.lastSessionId&&(e[bT]=this.lastSessionId),this.applicationId&&(e[bE]=this.applicationId),this.appCheckToken&&(e[bk]=this.appCheckToken),"u">typeof location&&location.hostname&&bw.test(location.hostname)&&(e[bS]=bC);let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Sq.forceAllow_=!0}static forceDisallow(){Sq.forceDisallow_=!0}static isAvailable(){return!eg()&&(!!Sq.forceAllow_||!Sq.forceDisallow_&&"u">typeof document&&null!=document.createElement&&!b3()&&!b6())}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=ek(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=b0(H(t),SF);for(let e=0;e<r.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(eg())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[SP]="t",r[SI]=e,r[SR]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=ek(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class SU{constructor(e,t,r,n){if(this.onDisconnect=r,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,eg())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=bP(),window[SE+this.uniqueCallbackIdentifier]=e,window[Sk+this.uniqueCallbackIdentifier]=t,this.myIFrame=SU.createIFrame_();let r="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(r='<script>document.domain="'+document.domain+'";</script>');const n="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(e){bq("frame writing exception"),e.stack&&bq(e.stack),bq(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||bq("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e[SI]=this.myID,e[SR]=this.myPW,e[Sx]=this.currentSerial;let t=this.urlFn(e),r="",n=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+SL+r.length<=SM){let e=this.pendingSegs.shift();r=r+"&"+SO+n+"="+e.seg+"&"+SA+n+"="+e.ts+"&"+SN+n+"="+e.d,n++}else break;return t+=r,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},n=setTimeout(r,Math.floor(SB)),i=()=>{clearTimeout(n),r()};this.addTag(e,i)}addTag(e,t){eg()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{bq("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch(e){}},Math.floor(1))}}class SV{static get ALL_TRANSPORTS(){return[Sq,Sm]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=Sm&&Sm.isAvailable(),r=t&&!Sm.previouslyFailed();if(e.webSocketOnly&&(t||bH("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Sm];else{let e=this.transports_=[];for(let t of SV.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);SV.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}SV.globalTransportInitialized_=!1;let Sz=6e4,SH=5e3,SW=10240,S$=102400,SK="t",SG="d",SQ="s",SY="r",SJ="e",SX="o",SZ="a",S0="n",S1="p",S2="h";class S3{constructor(e,t,r,n,i,s,a,o,l,u){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=n,this.authToken_=i,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=o,this.onKill_=l,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=bU("c:"+this.id+":"),this.transportManager_=new SV(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=St(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>S$?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>SW?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(n)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(SK in e){let t=e[SK];t===SZ?this.upgradeIfSecondaryHealthy_():t===SY?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===SX&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=bX("t",e),r=bX("d",e);if("c"===t)this.onSecondaryControl_(r);else if("d"===t)this.pendingDataMessages.push(r);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:S1,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SZ,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:S0,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=bX("t",e),r=bX("d",e);"c"===t?this.onControl_(r):"d"===t&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=bX(SK,e);if(SG in e){let r=e[SG];if(t===S2){let e={...r};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if(t===S0){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===SQ?this.onConnectionShutdown_(r):t===SY?this.onReset_(r):t===SJ?bV("Server Error: "+r):t===SX?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):bV("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),bv!==r&&bH("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),St(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Sz))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):St(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(SH))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:S1,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(bO.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class S6{put(e,t,r,n){}merge(e,t,r,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}class S4{constructor(e){this.allowedEvents_=e,this.listeners_={},B(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let e=0;e<r.length;e++)r[e].callback.apply(r[e].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let n=this.getInitialEvent(e);n&&t.apply(r,n)}off(e,t,r){this.validateEventType_(e);let n=this.listeners_[e]||[];for(let e=0;e<n.length;e++)if(n[e].callback===t&&(!r||r===n[e].context))return void n.splice(e,1)}validateEventType_(e){B(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class S5 extends S4{static getInstance(){return new S5}constructor(){super(["online"]),this.online_=!0}getInitialEvent(e){return B("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}let S8=32,S9=768;class S7{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Ce(){return new S7("")}function Ct(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Cr(e){return e.pieces_.length-e.pieceNum_}function Cn(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new S7(e.pieces_,t)}function Ci(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Cs(e){let t="";for(let r=e.pieceNum_;r<e.pieces_.length;r++)""!==e.pieces_[r]&&(t+="/"+encodeURIComponent(String(e.pieces_[r])));return t||"/"}function Ca(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Co(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let r=e.pieceNum_;r<e.pieces_.length-1;r++)t.push(e.pieces_[r]);return new S7(t,0)}function Cl(e,t){let r=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)r.push(e.pieces_[t]);if(t instanceof S7)for(let e=t.pieceNum_;e<t.pieces_.length;e++)r.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&r.push(e[t])}return new S7(r,0)}function Cu(e){return e.pieceNum_>=e.pieces_.length}function Cc(e,t){let r=Ct(e),n=Ct(t);if(null===r)return t;if(r===n)return Cc(Cn(e),Cn(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Ch(e,t){let r=Ca(e,0),n=Ca(t,0);for(let e=0;e<r.length&&e<n.length;e++){let t=bY(r[e],n[e]);if(0!==t)return t}return r.length===n.length?0:r.length<n.length?-1:1}function Cd(e,t){if(Cr(e)!==Cr(t))return!1;for(let r=e.pieceNum_,n=t.pieceNum_;r<=e.pieces_.length;r++,n++)if(e.pieces_[r]!==t.pieces_[n])return!1;return!0}function Cf(e,t){let r=e.pieceNum_,n=t.pieceNum_;if(Cr(e)>Cr(t))return!1;for(;r<e.pieces_.length;){if(e.pieces_[r]!==t.pieces_[n])return!1;++r,++n}return!0}class Cp{constructor(e,t){this.errorPrefix_=t,this.parts_=Ca(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=eq(this.parts_[e]);Cy(this)}}function Cg(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=eq(t),Cy(e)}function Cm(e){let t=e.parts_.pop();e.byteLength_-=eq(t),e.parts_.length>0&&(e.byteLength_-=1)}function Cy(e){if(e.byteLength_>S9)throw Error(e.errorPrefix_+"has a key path longer than "+S9+" bytes ("+e.byteLength_+").");if(e.parts_.length>S8)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+S8+") or object contains a cycle "+Cv(e))}function Cv(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class C_ extends S4{static getInstance(){return new C_}constructor(){let e,t;super(["visible"]),"u">typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return B("visible"===e,"Unknown event type: "+e),[this.visible_]}}let Cb=1e3,CS=3e5,CC=3e4,Cw=1.3,CT=3e4,CE="server_kill",Ck=3;class CI extends S6{constructor(e,t,r,n,i,s,a,o){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=n,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=a,this.authOverride_=o,this.id=CI.nextPersistentConnectionId_++,this.log_=bU("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Cb,this.maxReconnectDelay_=CS,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,o&&!eg())throw Error("Auth override specified in options, but not supported on non Node.js platforms");C_.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&S5.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){let n=++this.requestNumber_,i={r:n,a:e,b:t};this.log_(ek(i)),B(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[n]=r)}get(e){this.initConnection_();let t=new ei,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{let r=e.d;"ok"===e.s?t.resolve(r):t.reject(r)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let n=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(n),t.promise}listen(e,t,r,n){this.initConnection_();let i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),B(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),B(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");let a={onComplete:n,hashFn:t,query:e,tag:r};this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){let t=e.query,r=t._path.toString(),n=t._queryIdentifier;this.log_("Listen on "+r+" for "+n);let i={p:r},s="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(s,i,i=>{let s=i.d,a=i.s;CI.warnOnListenWarnings_(s,t),(this.listens.get(r)&&this.listens.get(r).get(n))===e&&(this.log_("listen response",i),"ok"!==a&&this.removeListen_(r,n),e.onComplete&&e.onComplete(a,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&eD(e,"w")){let r=eO(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();bH(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||ex(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=CC)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=eR(e)?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(t,r,t=>{let r=t.s,n=t.d||"error";this.authToken_===e&&("ok"===r?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,r=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){let r=e._path.toString(),n=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+n),B(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,n)&&this.connected_&&this.sendUnlisten_(r,n,e._queryObject,t)}sendUnlisten_(e,t,r,n){this.log_("Unlisten on "+e+" for "+t);let i={p:e},s="n";n&&(i.q=r,i.t=n),this.sendRequest(s,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,n){let i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{n&&setTimeout(()=>{n(e.s,e.d)},Math.floor(0))})}put(e,t,r,n){this.putInternal("p",e,t,r,n)}merge(e,t,r,n){this.putInternal("m",e,t,r,n)}putInternal(e,t,r,n,i){this.initConnection_();let s={p:t,d:r};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:n}),this.outstandingPutCount_++;let a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),n&&n(r.s,r.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ek(e));let t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):bV("Unrecognized action received from server: "+ek(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){B(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Cb,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Cb,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>CT&&(this.reconnectDelay_=Cb),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Cw)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),n=this.id+":"+CI.nextConnectionId_++,i=this.lastSessionId,s=!1,a=null,o=function(){a?a.close():(s=!0,r())},l=function(e){B(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:o,sendRequest:l};let u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[o,l]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);s?bq("getToken() completed but was canceled"):(bq("getToken() completed. Creating connection."),this.authToken_=o&&o.accessToken,this.appCheckToken_=l&&l.token,a=new S3(n,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,e=>{bH(e+" ("+this.repoInfo_.toString()+")"),this.interrupt(CE)},i))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&bH(e),o())}}}interrupt(e){bq("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){bq("Resuming connection for reason: "+e),delete this.interruptReasons_[e],eA(this.interruptReasons_)&&(this.reconnectDelay_=Cb,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;r=t?t.map(e=>bZ(e)).join("$"):"default";let n=this.removeListen_(e,r);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){let r,n=new S7(e).toString();if(this.listens.has(n)){let e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){bq("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Ck&&(this.reconnectDelay_=CC,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){bq("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Ck&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";eg()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+Sc.replace(/\./g,"-")]=1,ec()?e["framework.cordova"]=1:ep()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=S5.getInstance().currentlyOnline();return eA(this.interruptReasons_)&&e}}CI.nextPersistentConnectionId_=0,CI.nextConnectionId_=0;class CR{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new CR(e,t)}}class Cx{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new CR(bG,e),n=new CR(bG,t);return 0!==this.compare(r,n)}minPost(){return CR.MIN}}class CD extends Cx{static get __EMPTY_NODE(){return n}static set __EMPTY_NODE(e){n=e}compare(e,t){return bY(e.name,t.name)}isDefinedOn(e){throw j("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return CR.MIN}maxPost(){return new CR(bQ,n)}makePost(e,t){return B("string"==typeof e,"KeyIndex indexValue must always be a string."),new CR(e,n)}toString(){return".key"}}let CO=new CD;class CA{constructor(e,t,r,n,i=null){this.isReverse_=n,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,n&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class CN{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:CN.RED,this.left=null!=n?n:CM.EMPTY_NODE,this.right=null!=i?i:CM.EMPTY_NODE}copy(e,t,r,n,i){return new CN(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp_()}removeMin_(){if(this.left.isEmpty())return CM.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let r,n;if(r=this,0>t(e,r.key))r.left.isEmpty()||r.left.isRed_()||r.left.left.isRed_()||(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),r.right.isEmpty()||r.right.isRed_()||r.right.left.isRed_()||(r=r.moveRedRight_()),0===t(e,r.key))if(r.right.isEmpty())return CM.EMPTY_NODE;else n=r.right.min_(),r=r.copy(n.key,n.value,null,null,r.right.removeMin_());r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,CN.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,CN.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}CN.RED=!0,CN.BLACK=!1;class CP{copy(e,t,r,n,i){return this}insert(e,t,r){return new CN(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class CM{constructor(e,t=CM.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new CM(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,CN.BLACK,null,null))}remove(e){return new CM(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,CN.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(0===(t=this.comparator_(e,r.key)))return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,n=null;for(;!r.isEmpty();){if(0===(t=this.comparator_(e,r.key)))if(r.left.isEmpty())if(n)return n.key;else return null;else{for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}t<0?r=r.left:t>0&&(n=r,r=r.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new CA(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new CA(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new CA(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new CA(this.root_,null,this.comparator_,!0,e)}}function CL(e,t){return bY(e.name,t.name)}function CF(e,t){return bY(e,t)}function CB(e){i=e}CM.EMPTY_NODE=new CP;let Cj=function(e){return"number"==typeof e?"number:"+b2(e):"string:"+e},Cq=function(e){if(e.isLeafNode()){let t=e.val();B("string"==typeof t||"number"==typeof t||"object"==typeof t&&eD(t,".sv"),"Priority must be a string or number.")}else B(e===i||e.isEmpty(),"priority of unexpected type.");B(e===i||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class CU{static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}constructor(e,t=CU.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,B(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Cq(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new CU(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:CU.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Cu(e)?this:".priority"===Ct(e)?this.priorityNode_:CU.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:CU.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let r=Ct(e);return null===r?t:t.isEmpty()&&".priority"!==r?this:(B(".priority"!==r||1===Cr(e),".priority must be the last token in a path"),this.updateImmediateChild(r,CU.__childrenNodeConstructor.EMPTY_NODE.updateChild(Cn(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Cj(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=b2(this.value_):e+=this.value_,this.lazyHash_=bM(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===CU.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof CU.__childrenNodeConstructor?-1:(B(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,r=typeof this.value_,n=CU.VALUE_TYPE_ORDER.indexOf(t),i=CU.VALUE_TYPE_ORDER.indexOf(r);return(B(n>=0,"Unknown leaf type: "+t),B(i>=0,"Unknown leaf type: "+r),n!==i)?i-n:"object"===r?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(!e.isLeafNode())return!1;{let t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}}}function CV(e){a=e}function Cz(e){o=e}CU.VALUE_TYPE_ORDER=["object","boolean","number","string"];class CH extends Cx{compare(e,t){let r=e.node.getPriority(),n=t.node.getPriority(),i=r.compareTo(n);return 0===i?bY(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return CR.MIN}maxPost(){return new CR(bQ,new CU("[PRIORITY-POST]",o))}makePost(e,t){return new CR(t,new CU("[PRIORITY-POST]",a(e)))}toString(){return".priority"}}let CW=new CH,C$=Math.log(2);class CK{constructor(e){const t=e=>parseInt(Math.log(e)/C$,10),r=e=>parseInt(Array(e+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const n=r(this.count);this.bits_=e+1&n}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let CG=function(e,t,r,n){e.sort(t);let i=function(t,n){let s,a,o=n-t;if(0===o)return null;if(1===o)return s=e[t],new CN(a=r?r(s):s,s.node,CN.BLACK,null,null);{let l=parseInt(o/2,10)+t,u=i(t,l),c=i(l+1,n);return s=e[l],new CN(a=r?r(s):s,s.node,CN.BLACK,u,c)}};return new CM(n||t,function(t){let n=null,s=null,a=e.length,o=function(t,n){let s=a-t,o=a;a-=t;let u=i(s+1,o),c=e[s];l(new CN(r?r(c):c,c.node,n,null,u))},l=function(e){n?n.left=e:s=e,n=e};for(let e=0;e<t.count;++e){let r=t.nextBitIsOne(),n=Math.pow(2,t.count-(e+1));r?o(n,CN.BLACK):(o(n,CN.BLACK),o(n,CN.RED))}return s}(new CK(e.length)))},CQ={};class CY{static get Default(){return B(CQ&&CW,"ChildrenNode.ts has not been loaded"),l=l||new CY({".priority":CQ},{".priority":CW})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=eO(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof CM?t:null}hasIndex(e){return eD(this.indexSet_,e.toString())}addIndex(e,t){let r;B(e!==CO,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let n=[],i=!1,s=t.getIterator(CR.Wrap),a=s.getNext();for(;a;)i=i||e.isDefinedOn(a.node),n.push(a),a=s.getNext();r=i?CG(n,e.getCompare()):CQ;let o=e.toString(),l={...this.indexSet_};l[o]=e;let u={...this.indexes_};return u[o]=r,new CY(u,l)}addToIndexes(e,t){return new CY(eN(this.indexes_,(r,n)=>{let i=eO(this.indexSet_,n);if(B(i,"Missing index implementation for "+n),r===CQ)if(!i.isDefinedOn(e.node))return CQ;else{let r=[],n=t.getIterator(CR.Wrap),s=n.getNext();for(;s;)s.name!==e.name&&r.push(s),s=n.getNext();return r.push(e),CG(r,i.getCompare())}{let n=t.get(e.name),i=r;return n&&(i=i.remove(new CR(e.name,n))),i.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new CY(eN(this.indexes_,r=>{if(r===CQ)return r;{let n=t.get(e.name);return n?r.remove(new CR(e.name,n)):r}}),this.indexSet_)}}class CJ{static get EMPTY_NODE(){return u||(u=new CJ(new CM(CF),null,CY.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Cq(this.priorityNode_),this.children_.isEmpty()&&B(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||u}updatePriority(e){return this.children_.isEmpty()?this:new CJ(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?u:t}}getChild(e){let t=Ct(e);return null===t?this:this.getImmediateChild(t).getChild(Cn(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(B(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let r,n,i=new CR(e,t);t.isEmpty()?(r=this.children_.remove(e),n=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(e,t),n=this.indexMap_.addToIndexes(i,this.children_));let s=r.isEmpty()?u:this.priorityNode_;return new CJ(r,s,n)}}updateChild(e,t){let r=Ct(e);if(null===r)return t;{B(".priority"!==Ct(e)||1===Cr(e),".priority must be the last token in a path");let n=this.getImmediateChild(r).updateChild(Cn(e),t);return this.updateImmediateChild(r,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},r=0,n=0,i=!0;if(this.forEachChild(CW,(s,a)=>{t[s]=a.val(e),r++,i&&CJ.INTEGER_REGEXP_.test(s)?n=Math.max(n,Number(s)):i=!1}),e||!i||!(n<2*r))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let r in t)e[r]=t[r];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Cj(this.getPriority().val())+":"),this.forEachChild(CW,(t,r)=>{let n=r.hash();""!==n&&(e+=":"+t+":"+n)}),this.lazyHash_=""===e?"":bM(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){let n=this.resolveIndex_(r);if(!n)return this.children_.getPredecessorKey(e);{let r=n.getPredecessorKey(new CR(e,t));return r?r.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new CR(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new CR(t,this.children_.get(t)):null}forEachChild(e,t){let r=this.resolveIndex_(e);return r?r.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,e=>e);{let r=this.children_.getIteratorFrom(e.name,CR.Wrap),n=r.peek();for(;null!=n&&0>t.compare(n,e);)r.getNext(),n=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,e=>e);{let r=this.children_.getReverseIteratorFrom(e.name,CR.Wrap),n=r.peek();for(;null!=n&&t.compare(n,e)>0;)r.getNext(),n=r.peek();return r}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===CZ?-1:0}withIndex(e){if(e===CO||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new CJ(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===CO||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;{if(e.isLeafNode())return!1;let t=e;if(!this.getPriority().equals(t.getPriority()))return!1;if(this.children_.count()!==t.children_.count())return!1;{let e=this.getIterator(CW),r=t.getIterator(CW),n=e.getNext(),i=r.getNext();for(;n&&i;){if(n.name!==i.name||!n.node.equals(i.node))return!1;n=e.getNext(),i=r.getNext()}return null===n&&null===i}}}resolveIndex_(e){return e===CO?null:this.indexMap_.get(e.toString())}}CJ.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class CX extends CJ{constructor(){super(new CM(CF),CJ.EMPTY_NODE,CY.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return CJ.EMPTY_NODE}isEmpty(){return!1}}let CZ=new CX;Object.defineProperties(CR,{MIN:{value:new CR(bG,CJ.EMPTY_NODE)},MAX:{value:new CR(bQ,CZ)}}),CD.__EMPTY_NODE=CJ.EMPTY_NODE,CU.__childrenNodeConstructor=CJ,CB(CZ),Cz(CZ);let C0=!0;function C1(e,t=null){if(null===e)return CJ.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),B(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new CU(e,C1(t));if(e instanceof Array||!C0){let r=CJ.EMPTY_NODE;return b1(e,(t,n)=>{if(eD(e,t)&&"."!==t.substring(0,1)){let e=C1(n);(e.isLeafNode()||!e.isEmpty())&&(r=r.updateImmediateChild(t,e))}}),r.updatePriority(C1(t))}{let r=[],n=!1;if(b1(e,(e,t)=>{if("."!==e.substring(0,1)){let i=C1(t);i.isEmpty()||(n=n||!i.getPriority().isEmpty(),r.push(new CR(e,i)))}}),0===r.length)return CJ.EMPTY_NODE;let i=CG(r,CL,e=>e.name,CF);if(!n)return new CJ(i,C1(t),CY.Default);{let e=CG(r,CW.getCompare());return new CJ(i,C1(t),new CY({".priority":e},{".priority":CW}))}}}CV(C1);class C2 extends Cx{constructor(e){super(),this.indexPath_=e,B(!Cu(e)&&".priority"!==Ct(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),n=this.extractChild(t.node),i=r.compareTo(n);return 0===i?bY(e.name,t.name):i}makePost(e,t){let r=C1(e);return new CR(t,CJ.EMPTY_NODE.updateChild(this.indexPath_,r))}maxPost(){return new CR(bQ,CJ.EMPTY_NODE.updateChild(this.indexPath_,CZ))}toString(){return Ca(this.indexPath_,0).join("/")}}class C3 extends Cx{compare(e,t){let r=e.node.compareTo(t.node);return 0===r?bY(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return CR.MIN}maxPost(){return CR.MAX}makePost(e,t){return new CR(t,C1(e))}toString(){return".value"}}let C6=new C3;function C4(e){return{type:"value",snapshotNode:e}}function C5(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function C8(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function C9(e,t,r){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:r}}function C7(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}class we{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=CW}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return B(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(B(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:bG}hasEnd(){return this.endSet_}getIndexEndValue(){return B(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(B(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:bQ}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return B(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===CW}copy(){let e=new we;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function wt(e){let t,r={};if(e.isDefault())return r;if(e.index_===CW?t="$priority":e.index_===C6?t="$value":e.index_===CO?t="$key":(B(e.index_ instanceof C2,"Unrecognized index type!"),t=e.index_.toString()),r.orderBy=ek(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";r[t]=ek(e.indexStartValue_),e.startNameSet_&&(r[t]+=","+ek(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";r[t]=ek(e.indexEndValue_),e.endNameSet_&&(r[t]+=","+ek(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?r.limitToFirst=e.limit_:r.limitToLast=e.limit_),r}function wr(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let r=e.viewFrom_;""===r&&(r=e.isViewFromLeft()?"l":"r"),t.vf=r}return e.index_!==CW&&(t.i=e.index_.toString()),t}class wn extends S6{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(B(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,n){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=n,this.log_=bU("p:rest:"),this.listens_={}}listen(e,t,r,n){let i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);let s=wn.getListenId_(e,r),a={};this.listens_[s]=a;let o=wt(e._queryParams);this.restRequest_(i+".json",o,(e,t)=>{let o=t;if(404===e&&(o=null,e=null),null===e&&this.onDataUpdate_(i,o,!1,r),eO(this.listens_,s)===a){let t;n(t=e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}})}unlisten(e,t){let r=wn.getListenId_(e,t);delete this.listens_[r]}get(e){let t=wt(e._queryParams),r=e._path.toString(),n=new ei;return this.restRequest_(r+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(r,i,!1,null),n.resolve(i)):n.reject(Error(i))}),n.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([n,i])=>{n&&n.accessToken&&(t.auth=n.accessToken),i&&i.token&&(t.ac=i.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+eL(t);this.log_("Sending REST request for "+s);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&4===a.readyState){this.log_("REST Response for "+s+" received. status:",a.status,"response:",a.responseText);let e=null;if(a.status>=200&&a.status<300){try{e=eE(a.responseText)}catch(e){bH("Failed to parse JSON response for "+s+": "+a.responseText)}r(null,e)}else 401!==a.status&&404!==a.status&&bH("Got unsuccessful REST response for "+s+" Status: "+a.status),r(a.status);r=null}},a.open("GET",s,!0),a.send()})}}class wi{constructor(){this.rootNode_=CJ.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function ws(){return{value:null,children:new Map}}function wa(e,t,r){if(Cu(t))e.value=r,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,r);else{let n=Ct(t);e.children.has(n)||e.children.set(n,ws()),wa(e.children.get(n),t=Cn(t),r)}}function wo(e,t,r){null!==e.value?r(t,e.value):wl(e,(e,n)=>{wo(n,new S7(t.toString()+"/"+e),r)})}function wl(e,t){e.children.forEach((e,r)=>{t(r,e)})}class wu{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t={...e};return this.last_&&b1(this.last_,(e,r)=>{t[e]=t[e]-r}),this.last_=e,t}}let wc=1e4,wh=3e4,wd=3e5;class wf{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new wu(e);const r=wc+(wh-wc)*Math.random();St(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;b1(e,(e,n)=>{n>0&&eD(this.statsToReport_,e)&&(t[e]=n,r=!0)}),r&&this.server_.reportStats(t),St(this.reportStats_.bind(this),Math.floor(2*Math.random()*wd))}}function wp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function wg(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function wm(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(v||(v={}));class wy{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=v.ACK_USER_WRITE,this.source=wp()}operationForChild(e){if(!Cu(this.path))return B(Ct(this.path)===e,"operationForChild called for unrelated child."),new wy(Cn(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return B(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new S7(e));return new wy(Ce(),t,this.revert)}}}class wv{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=v.OVERWRITE}operationForChild(e){return Cu(this.path)?new wv(this.source,Ce(),this.snap.getImmediateChild(e)):new wv(this.source,Cn(this.path),this.snap)}}class w_{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=v.MERGE}operationForChild(e){if(!Cu(this.path))return B(Ct(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new w_(this.source,Cn(this.path),this.children);{let t=this.children.subtree(new S7(e));return t.isEmpty()?null:t.value?new wv(this.source,Ce(),t.value):new w_(this.source,Ce(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class wb{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Cu(e))return this.isFullyInitialized()&&!this.filtered_;let t=Ct(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function wS(e,t,r,n){let i=[],s=[];return t.forEach(t=>{"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push(C7(t.childName,t.snapshotNode))}),wC(e,i,"child_removed",t,n,r),wC(e,i,"child_added",t,n,r),wC(e,i,"child_moved",s,n,r),wC(e,i,"child_changed",t,n,r),wC(e,i,"value",t,n,r),i}function wC(e,t,r,n,i,s){let a=n.filter(e=>e.type===r);a.sort((t,r)=>wT(e,t,r)),a.forEach(r=>{let n=ww(e,r,s);i.forEach(i=>{i.respondsTo(r.type)&&t.push(i.createEvent(n,e.query_))})})}function ww(e,t,r){return"value"===t.type||"child_removed"===t.type||(t.prevName=r.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}function wT(e,t,r){if(null==t.childName||null==r.childName)throw j("Should only compare child_ events.");let n=new CR(t.childName,t.snapshotNode),i=new CR(r.childName,r.snapshotNode);return e.index_.compare(n,i)}function wE(e,t){return{eventCache:e,serverCache:t}}function wk(e,t,r,n){return wE(new wb(t,r,n),e.serverCache)}function wI(e,t,r,n){return wE(e.eventCache,new wb(t,r,n))}function wR(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function wx(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let wD=()=>(c||(c=new CM(bJ)),c);class wO{static fromObject(e){let t=new wO(null);return b1(e,(e,r)=>{t=t.set(new S7(e),r)}),t}constructor(e,t=wD()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Ce(),value:this.value};{if(Cu(e))return null;let r=Ct(e),n=this.children.get(r);if(null===n)return null;{let i=n.findRootMostMatchingPathAndValue(Cn(e),t);return null!=i?{path:Cl(new S7(r),i.path),value:i.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Cu(e))return this;{let t=Ct(e),r=this.children.get(t);return null!==r?r.subtree(Cn(e)):new wO(null)}}set(e,t){if(Cu(e))return new wO(t,this.children);{let r=Ct(e),n=(this.children.get(r)||new wO(null)).set(Cn(e),t),i=this.children.insert(r,n);return new wO(this.value,i)}}remove(e){if(Cu(e))if(this.children.isEmpty())return new wO(null);else return new wO(null,this.children);{let t=Ct(e),r=this.children.get(t);if(!r)return this;{let n,i=r.remove(Cn(e));return(n=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&n.isEmpty())?new wO(null):new wO(this.value,n)}}}get(e){if(Cu(e))return this.value;{let t=Ct(e),r=this.children.get(t);return r?r.get(Cn(e)):null}}setTree(e,t){if(Cu(e))return t;{let r,n=Ct(e),i=(this.children.get(n)||new wO(null)).setTree(Cn(e),t);return r=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new wO(this.value,r)}}fold(e){return this.fold_(Ce(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((n,i)=>{r[n]=i.fold_(Cl(e,n),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Ce(),t)}findOnPath_(e,t,r){let n=!!this.value&&r(t,this.value);if(n)return n;{if(Cu(e))return null;let n=Ct(e),i=this.children.get(n);return i?i.findOnPath_(Cn(e),Cl(t,n),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ce(),t)}foreachOnPath_(e,t,r){if(Cu(e))return this;{this.value&&r(t,this.value);let n=Ct(e),i=this.children.get(n);return i?i.foreachOnPath_(Cn(e),Cl(t,n),r):new wO(null)}}foreach(e){this.foreach_(Ce(),e)}foreach_(e,t){this.children.inorderTraversal((r,n)=>{n.foreach_(Cl(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}class wA{constructor(e){this.writeTree_=e}static empty(){return new wA(new wO(null))}}function wN(e,t,r){if(Cu(t))return new wA(new wO(r));{let n=e.writeTree_.findRootMostValueAndPath(t);if(null!=n){let i=n.path,s=n.value,a=Cc(i,t);return s=s.updateChild(a,r),new wA(e.writeTree_.set(i,s))}{let n=new wO(r);return new wA(e.writeTree_.setTree(t,n))}}}function wP(e,t,r){let n=e;return b1(r,(e,r)=>{n=wN(n,Cl(t,e),r)}),n}function wM(e,t){return Cu(t)?wA.empty():new wA(e.writeTree_.setTree(t,new wO(null)))}function wL(e,t){return null!=wF(e,t)}function wF(e,t){let r=e.writeTree_.findRootMostValueAndPath(t);return null!=r?e.writeTree_.get(r.path).getChild(Cc(r.path,t)):null}function wB(e){let t=[],r=e.writeTree_.value;return null!=r?r.isLeafNode()||r.forEachChild(CW,(e,r)=>{t.push(new CR(e,r))}):e.writeTree_.children.inorderTraversal((e,r)=>{null!=r.value&&t.push(new CR(e,r.value))}),t}function wj(e,t){if(Cu(t))return e;{let r=wF(e,t);return new wA(null!=r?new wO(r):e.writeTree_.subtree(t))}}function wq(e){return e.writeTree_.isEmpty()}function wU(e,t){return wV(Ce(),e.writeTree_,t)}function wV(e,t,r){if(null!=t.value)return r.updateChild(e,t.value);{let n=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(B(null!==i.value,"Priority writes must always be leaf nodes"),n=i.value):r=wV(Cl(e,t),i,r)}),r.getChild(e).isEmpty()||null===n||(r=r.updateChild(Cl(e,".priority"),n)),r}}function wz(e,t){return Tr(t,e)}function wH(e,t,r,n,i){B(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:r,writeId:n,visible:i}),i&&(e.visibleWrites=wN(e.visibleWrites,t,r)),e.lastWriteId=n}function wW(e,t,r,n){B(n>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:r,writeId:n,visible:!0}),e.visibleWrites=wP(e.visibleWrites,t,r),e.lastWriteId=n}function w$(e,t){for(let r=0;r<e.allWrites.length;r++){let n=e.allWrites[r];if(n.writeId===t)return n}return null}function wK(e,t){let r=e.allWrites.findIndex(e=>e.writeId===t);B(r>=0,"removeWrite called with nonexistent writeId.");let n=e.allWrites[r];e.allWrites.splice(r,1);let i=n.visible,s=!1,a=e.allWrites.length-1;for(;i&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=r&&wG(t,n.path)?i=!1:Cf(n.path,t.path)&&(s=!0)),a--}return!!i&&(s?wQ(e):n.snap?e.visibleWrites=wM(e.visibleWrites,n.path):b1(n.children,t=>{e.visibleWrites=wM(e.visibleWrites,Cl(n.path,t))}),!0)}function wG(e,t){if(e.snap)return Cf(e.path,t);for(let r in e.children)if(e.children.hasOwnProperty(r)&&Cf(Cl(e.path,r),t))return!0;return!1}function wQ(e){e.visibleWrites=wJ(e.allWrites,wY,Ce()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function wY(e){return e.visible}function wJ(e,t,r){let n=wA.empty();for(let i=0;i<e.length;++i){let s=e[i];if(t(s)){let e,t=s.path;if(s.snap)Cf(r,t)?n=wN(n,e=Cc(r,t),s.snap):Cf(t,r)&&(e=Cc(t,r),n=wN(n,Ce(),s.snap.getChild(e)));else if(s.children){if(Cf(r,t))n=wP(n,e=Cc(r,t),s.children);else if(Cf(t,r))if(Cu(e=Cc(t,r)))n=wP(n,Ce(),s.children);else{let t=eO(s.children,Ct(e));if(t){let r=t.getChild(Cn(e));n=wN(n,Ce(),r)}}}else throw j("WriteRecord should have .snap or .children")}}return n}function wX(e,t,r,n,i){if(n||i){let s=wj(e.visibleWrites,t);if(!i&&wq(s))return r;{if(!i&&null==r&&!wL(s,Ce()))return null;let a=function(e){return(e.visible||i)&&(!n||!~n.indexOf(e.writeId))&&(Cf(e.path,t)||Cf(t,e.path))};return wU(wJ(e.allWrites,a,t),r||CJ.EMPTY_NODE)}}{let n=wF(e.visibleWrites,t);if(null!=n)return n;{let n=wj(e.visibleWrites,t);return wq(n)?r:null!=r||wL(n,Ce())?wU(n,r||CJ.EMPTY_NODE):null}}}function wZ(e,t,r){let n=CJ.EMPTY_NODE,i=wF(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(CW,(e,t)=>{n=n.updateImmediateChild(e,t)}),n;if(!r)return wB(wj(e.visibleWrites,t)).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n;{let i=wj(e.visibleWrites,t);return r.forEachChild(CW,(e,t)=>{let r=wU(wj(i,new S7(e)),t);n=n.updateImmediateChild(e,r)}),wB(i).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}}function w0(e,t,r,n,i){B(n||i,"Either existingEventSnap or existingServerSnap must exist");let s=Cl(t,r);if(wL(e.visibleWrites,s))return null;{let t=wj(e.visibleWrites,s);return wq(t)?i.getChild(r):wU(t,i.getChild(r))}}function w1(e,t,r,n){let i=Cl(t,r),s=wF(e.visibleWrites,i);return null!=s?s:n.isCompleteForChild(r)?wU(wj(e.visibleWrites,i),n.getNode().getImmediateChild(r)):null}function w2(e,t){return wF(e.visibleWrites,t)}function w3(e,t,r,n,i,s,a){let o,l=wj(e.visibleWrites,t),u=wF(l,Ce());if(null!=u)o=u;else{if(null==r)return[];o=wU(l,r)}if((o=o.withIndex(a)).isEmpty()||o.isLeafNode())return[];{let e=[],t=a.getCompare(),r=s?o.getReverseIteratorFrom(n,a):o.getIteratorFrom(n,a),l=r.getNext();for(;l&&e.length<i;)0!==t(l,n)&&e.push(l),l=r.getNext();return e}}function w6(){return{visibleWrites:wA.empty(),allWrites:[],lastWriteId:-1}}function w4(e,t,r,n){return wX(e.writeTree,e.treePath,t,r,n)}function w5(e,t){return wZ(e.writeTree,e.treePath,t)}function w8(e,t,r,n){return w0(e.writeTree,e.treePath,t,r,n)}function w9(e,t){return w2(e.writeTree,Cl(e.treePath,t))}function w7(e,t,r,n,i,s){return w3(e.writeTree,e.treePath,t,r,n,i,s)}function Te(e,t,r){return w1(e.writeTree,e.treePath,t,r)}function Tt(e,t){return Tr(Cl(e.treePath,t),e.writeTree)}function Tr(e,t){return{treePath:e,writeTree:t}}class Tn{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;B("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),B(".priority"!==r,"Only non-priority child changes can be tracked.");let n=this.changeMap.get(r);if(n){let i=n.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(r,C9(r,e.snapshotNode,n.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(r);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(r,C8(r,n.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(r,C5(r,e.snapshotNode));else if("child_changed"===t&&"child_changed"===i)this.changeMap.set(r,C9(r,e.snapshotNode,n.oldSnap));else throw j("Illegal combination of changes: "+e+" occurred after "+n)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}class Ti{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}let Ts=new Ti;class Ta{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new wb(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Te(this.writes_,e,t)}}getChildAfterChild(e,t,r){let n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:wx(this.viewCache_),i=w7(this.writes_,n,t,1,r,e);return 0===i.length?null:i[0]}}function To(e,t){B(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),B(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}function Tl(e,t,r,n,i){let s,a,o=new Tn;if(r.type===v.OVERWRITE){let l=r;l.source.fromUser?s=Td(e,t,l.path,l.snap,n,i,o):(B(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!Cu(l.path),s=Th(e,t,l.path,l.snap,n,i,a,o))}else if(r.type===v.MERGE){let l=r;l.source.fromUser?s=Tp(e,t,l.path,l.children,n,i,o):(B(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),s=Tm(e,t,l.path,l.children,n,i,a,o))}else if(r.type===v.ACK_USER_WRITE){let a=r;s=a.revert?T_(e,t,a.path,n,i,o):Ty(e,t,a.path,a.affectedTree,n,i,o)}else if(r.type===v.LISTEN_COMPLETE)s=Tv(e,t,r.path,n,o);else throw j("Unknown operation type: "+r.type);let l=o.getChanges();return Tu(t,s,l),{viewCache:s,changes:l}}function Tu(e,t,r){let n=t.eventCache;if(n.isFullyInitialized()){let i=n.getNode().isLeafNode()||n.getNode().isEmpty(),s=wR(e);!(r.length>0)&&e.eventCache.isFullyInitialized()&&(!i||n.getNode().equals(s))&&n.getNode().getPriority().equals(s.getPriority())||r.push(C4(wR(t)))}}function Tc(e,t,r,n,i,s){let a=t.eventCache;if(null!=w9(n,r))return t;{let o,l;if(Cu(r))if(B(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let r=wx(t),i=w5(n,r instanceof CJ?r:CJ.EMPTY_NODE);o=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{let r=w4(n,wx(t));o=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let u=Ct(r);if(".priority"===u){B(1===Cr(r),"Can't have a priority with additional path components");let i=a.getNode(),s=w8(n,r,i,l=t.serverCache.getNode());o=null!=s?e.filter.updatePriority(i,s):a.getNode()}else{let c,h=Cn(r);if(a.isCompleteForChild(u)){l=t.serverCache.getNode();let e=w8(n,r,a.getNode(),l);c=null!=e?a.getNode().getImmediateChild(u).updateChild(h,e):a.getNode().getImmediateChild(u)}else c=Te(n,u,t.serverCache);o=null!=c?e.filter.updateChild(a.getNode(),u,c,h,i,s):a.getNode()}}return wk(t,o,a.isFullyInitialized()||Cu(r),e.filter.filtersNodes())}}function Th(e,t,r,n,i,s,a,o){let l,u=t.serverCache,c=a?e.filter:e.filter.getIndexedFilter();if(Cu(r))l=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){let e=u.getNode().updateChild(r,n);l=c.updateFullNode(u.getNode(),e,null)}else{let e=Ct(r);if(!u.isCompleteForPath(r)&&Cr(r)>1)return t;let i=Cn(r),s=u.getNode().getImmediateChild(e).updateChild(i,n);l=".priority"===e?c.updatePriority(u.getNode(),s):c.updateChild(u.getNode(),e,s,i,Ts,null)}let h=wI(t,l,u.isFullyInitialized()||Cu(r),c.filtersNodes()),d=new Ta(i,h,s);return Tc(e,h,r,i,d,o)}function Td(e,t,r,n,i,s,a){let o,l,u=t.eventCache,c=new Ta(i,t,s);if(Cu(r))l=e.filter.updateFullNode(t.eventCache.getNode(),n,a),o=wk(t,l,!0,e.filter.filtersNodes());else{let i=Ct(r);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),n),o=wk(t,l,u.isFullyInitialized(),u.isFiltered());else{let s,l=Cn(r),h=u.getNode().getImmediateChild(i);if(Cu(l))s=n;else{let e=c.getCompleteChild(i);s=null!=e?".priority"===Ci(l)&&e.getChild(Co(l)).isEmpty()?e:e.updateChild(l,n):CJ.EMPTY_NODE}o=h.equals(s)?t:wk(t,e.filter.updateChild(u.getNode(),i,s,l,c,a),u.isFullyInitialized(),e.filter.filtersNodes())}}return o}function Tf(e,t){return e.eventCache.isCompleteForChild(t)}function Tp(e,t,r,n,i,s,a){let o=t;return n.foreach((n,l)=>{let u=Cl(r,n);Tf(t,Ct(u))&&(o=Td(e,o,u,l,i,s,a))}),n.foreach((n,l)=>{let u=Cl(r,n);Tf(t,Ct(u))||(o=Td(e,o,u,l,i,s,a))}),o}function Tg(e,t,r){return r.foreach((e,r)=>{t=t.updateChild(e,r)}),t}function Tm(e,t,r,n,i,s,a,o){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let u=t;l=Cu(r)?n:new wO(null).setTree(r,n);let c=t.serverCache.getNode();return l.children.inorderTraversal((r,n)=>{if(c.hasChild(r)){let l=Tg(e,t.serverCache.getNode().getImmediateChild(r),n);u=Th(e,u,new S7(r),l,i,s,a,o)}}),l.children.inorderTraversal((r,n)=>{let l=!t.serverCache.isCompleteForChild(r)&&null===n.value;if(!c.hasChild(r)&&!l){let l=Tg(e,t.serverCache.getNode().getImmediateChild(r),n);u=Th(e,u,new S7(r),l,i,s,a,o)}}),u}function Ty(e,t,r,n,i,s,a){if(null!=w9(i,r))return t;let o=t.serverCache.isFiltered(),l=t.serverCache;if(null!=n.value)if(Cu(r)&&l.isFullyInitialized()||l.isCompleteForPath(r))return Th(e,t,r,l.getNode().getChild(r),i,s,o,a);else{if(!Cu(r))return t;let n=new wO(null);return l.getNode().forEachChild(CO,(e,t)=>{n=n.set(new S7(e),t)}),Tm(e,t,r,n,i,s,o,a)}{let u=new wO(null);return n.foreach((e,t)=>{let n=Cl(r,e);l.isCompleteForPath(n)&&(u=u.set(e,l.getNode().getChild(n)))}),Tm(e,t,r,u,i,s,o,a)}}function Tv(e,t,r,n,i){let s=t.serverCache;return Tc(e,wI(t,s.getNode(),s.isFullyInitialized()||Cu(r),s.isFiltered()),r,n,Ts,i)}function T_(e,t,r,n,i,s){let a;if(null!=w9(n,r))return t;{let o,l=new Ta(n,t,i),u=t.eventCache.getNode();if(Cu(r)||".priority"===Ct(r)){let r;if(t.serverCache.isFullyInitialized())r=w4(n,wx(t));else{let e=t.serverCache.getNode();B(e instanceof CJ,"serverChildren would be complete if leaf node"),r=w5(n,e)}o=e.filter.updateFullNode(u,r,s)}else{let i=Ct(r),c=Te(n,i,t.serverCache);null==c&&t.serverCache.isCompleteForChild(i)&&(c=u.getImmediateChild(i)),(o=null!=c?e.filter.updateChild(u,i,c,Cn(r),l,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(u,i,CJ.EMPTY_NODE,Cn(r),l,s):u).isEmpty()&&t.serverCache.isFullyInitialized()&&(a=w4(n,wx(t))).isLeafNode()&&(o=e.filter.updateFullNode(o,a,s))}return a=t.serverCache.isFullyInitialized()||null!=w9(n,Ce()),wk(t,o,a,e.filter.filtersNodes())}}function Tb(e,t){let r=wx(e.viewCache_);return r&&(e.query._queryParams.loadsAllData()||!Cu(t)&&!r.getImmediateChild(Ct(t)).isEmpty())?r.getChild(t):null}function TS(e,t,r,n){t.type===v.MERGE&&null!==t.source.queryId&&(B(wx(e.viewCache_),"We should always have a full cache before handling merges"),B(wR(e.viewCache_),"Missing event cache, even though we have a server cache"));let i=e.viewCache_,s=Tl(e.processor_,i,t,r,n);return To(e.processor_,s.viewCache),B(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,TC(e,s.changes,s.viewCache.eventCache.getNode(),null)}function TC(e,t,r,n){let i=n?[n]:e.eventRegistrations_;return wS(e.eventGenerator_,t,r,i)}function Tw(e){B(!h,"__referenceConstructor has already been defined"),h=e}function TT(e,t,r,n){let i=t.source.queryId;if(null!==i){let s=e.views.get(i);return B(null!=s,"SyncTree gave us an op for an invalid query."),TS(s,t,r,n)}{let i=[];for(let s of e.views.values())i=i.concat(TS(s,t,r,n));return i}}function TE(e,t){let r=null;for(let n of e.views.values())r=r||Tb(n,t);return r}function Tk(e){B(!d,"__referenceConstructor has already been defined"),d=e}class TI{constructor(e){this.listenProvider_=e,this.syncPointTree_=new wO(null),this.pendingWriteTree_=w6(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function TR(e,t,r,n,i){return(wH(e.pendingWriteTree_,t,r,n,i),i)?TL(e,new wv(wp(),t,r)):[]}function Tx(e,t,r,n){wW(e.pendingWriteTree_,t,r,n);let i=wO.fromObject(r);return TL(e,new w_(wp(),t,i))}function TD(e,t,r=!1){let n=w$(e.pendingWriteTree_,t);if(!wK(e.pendingWriteTree_,t))return[];{let t=new wO(null);return null!=n.snap?t=t.set(Ce(),!0):b1(n.children,e=>{t=t.set(new S7(e),!0)}),TL(e,new wy(n.path,t,r))}}function TO(e,t,r){return TL(e,new wv(wg(),t,r))}function TA(e,t,r){let n=wO.fromObject(r);return TL(e,new w_(wg(),t,n))}function TN(e,t,r,n){let i=Tj(e,n);if(null==i)return[];{let n=Tq(i),s=n.path,a=n.queryId,o=Cc(s,t);return TU(e,s,new wv(wm(a),o,r))}}function TP(e,t,r,n){let i=Tj(e,n);if(!i)return[];{let n=Tq(i),s=n.path,a=n.queryId,o=Cc(s,t),l=wO.fromObject(r);return TU(e,s,new w_(wm(a),o,l))}}function TM(e,t,r){let n=!0,i=e.pendingWriteTree_,s=e.syncPointTree_.findOnPath(t,(e,r)=>{let n=TE(r,Cc(e,t));if(n)return n});return wX(i,t,s,r,n)}function TL(e,t){return TF(t,e.syncPointTree_,null,wz(e.pendingWriteTree_,Ce()))}function TF(e,t,r,n){if(Cu(e.path))return TB(e,t,r,n);{let i=t.get(Ce());null==r&&null!=i&&(r=TE(i,Ce()));let s=[],a=Ct(e.path),o=e.operationForChild(a),l=t.children.get(a);if(l&&o){let e=r?r.getImmediateChild(a):null,t=Tt(n,a);s=s.concat(TF(o,l,e,t))}return i&&(s=s.concat(TT(i,e,n,r))),s}}function TB(e,t,r,n){let i=t.get(Ce());null==r&&null!=i&&(r=TE(i,Ce()));let s=[];return t.children.inorderTraversal((t,i)=>{let a=r?r.getImmediateChild(t):null,o=Tt(n,t),l=e.operationForChild(t);l&&(s=s.concat(TB(l,i,a,o)))}),i&&(s=s.concat(TT(i,e,n,r))),s}function Tj(e,t){return e.tagToQueryMap.get(t)}function Tq(e){let t=e.indexOf("$");return B(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new S7(e.substr(0,t))}}function TU(e,t,r){let n=e.syncPointTree_.get(t);return B(n,"Missing sync point for query tag that we're tracking"),TT(n,r,wz(e.pendingWriteTree_,t),null)}class TV{constructor(e){this.node_=e}getImmediateChild(e){return new TV(this.node_.getImmediateChild(e))}node(){return this.node_}}class Tz{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=Cl(this.path_,e);return new Tz(this.syncTree_,t)}node(){return TM(this.syncTree_,this.path_)}}let TH=function(e){return(e=e||{}).timestamp=e.timestamp||new Date().getTime(),e},TW=function(e,t,r){return e&&"object"==typeof e?(B(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?T$(e[".sv"],t,r):"object"==typeof e[".sv"]?TK(e[".sv"],t):void B(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},T$=function(e,t,r){if("timestamp"===e)return r.timestamp;B(!1,"Unexpected server value: "+e)},TK=function(e,t,r){e.hasOwnProperty("increment")||B(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let n=e.increment;"number"!=typeof n&&B(!1,"Unexpected increment value: "+n);let i=t.node();if(B(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return n;let s=i.getValue();return"number"!=typeof s?n:s+n},TG=function(e,t,r,n){return TY(t,new Tz(r,e),n)},TQ=function(e,t,r){return TY(e,new TV(t),r)};function TY(e,t,r){let n,i=TW(e.getPriority().val(),t.getImmediateChild(".priority"),r);if(e.isLeafNode()){let n=e,s=TW(n.getValue(),t,r);return s!==n.getValue()||i!==n.getPriority().val()?new CU(s,C1(i)):e}{let s=e;return n=s,i!==s.getPriority().val()&&(n=n.updatePriority(new CU(i))),s.forEachChild(CW,(e,i)=>{let s=TY(i,t.getImmediateChild(e),r);s!==i&&(n=n.updateImmediateChild(e,s))}),n}}class TJ{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function TX(e,t){let r=t instanceof S7?t:new S7(t),n=e,i=Ct(r);for(;null!==i;){let e=eO(n.node.children,i)||{children:{},childCount:0};n=new TJ(i,n,e),i=Ct(r=Cn(r))}return n}function TZ(e){return e.node.value}function T0(e,t){e.node.value=t,T8(e)}function T1(e){return e.node.childCount>0}function T2(e){return void 0===TZ(e)&&!T1(e)}function T3(e,t){b1(e.node.children,(r,n)=>{t(new TJ(r,e,n))})}function T6(e,t,r,n){r&&!n&&t(e),T3(e,e=>{T6(e,t,!0,n)}),r&&n&&t(e)}function T4(e,t,r){let n=r?e:e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}return!1}function T5(e){return new S7(null===e.parent?e.name:T5(e.parent)+"/"+e.name)}function T8(e){null!==e.parent&&T9(e.parent,e.name,e)}function T9(e,t,r){let n=T2(r),i=eD(e.node.children,t);n&&i?(delete e.node.children[t],e.node.childCount--,T8(e)):n||i||(e.node.children[t]=r.node,e.node.childCount++,T8(e))}let T7=/[\[\].#$\/\u0000-\u001F\u007F]/,Ee=/[\[\].#$\u0000-\u001F\u007F]/,Et=0xa00000,Er=function(e){return"string"==typeof e&&0!==e.length&&!T7.test(e)},En=function(e){return"string"==typeof e&&0!==e.length&&!Ee.test(e)},Ei=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),En(e)},Es=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!b$(e)||e&&"object"==typeof e&&eD(e,".sv")},Ea=function(e,t,r){let n=r instanceof S7?new Cp(r,e):r;if(void 0===t)throw Error(e+"contains undefined "+Cv(n));if("function"==typeof t)throw Error(e+"contains a function "+Cv(n)+" with contents = "+t.toString());if(b$(t))throw Error(e+"contains "+t.toString()+" "+Cv(n));if("string"==typeof t&&t.length>Et/3&&eq(t)>Et)throw Error(e+"contains a string greater than "+Et+" utf8 bytes "+Cv(n)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let r=!1,i=!1;if(b1(t,(t,s)=>{if(".value"===t)r=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!Er(t)))throw Error(e+" contains an invalid key ("+t+") "+Cv(n)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');Cg(n,t),Ea(e,s,n),Cm(n)}),r&&i)throw Error(e+' contains ".value" child '+Cv(n)+" in addition to actual children.")}},Eo=function(e,t){let r,n;for(r=0;r<t.length;r++){let i=Ca(n=t[r]);for(let t=0;t<i.length;t++)if(".priority"===i[t]&&t===i.length-1);else if(!Er(i[t]))throw Error(e+"contains an invalid key ("+i[t]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(Ch);let i=null;for(r=0;r<t.length;r++){if(n=t[r],null!==i&&Cf(i,n))throw Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+n.toString());i=n}},El=function(e,t,r,n){if(n&&void 0===t)return;let i=eB(e,"values");if(!(t&&"object"==typeof t)||Array.isArray(t))throw Error(i+" must be an object containing the children to replace.");let s=[];b1(t,(e,t)=>{let n=new S7(e);if(Ea(i,t,Cl(r,n)),".priority"===Ci(n)&&!Es(t))throw Error(i+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),Eo(i,s)},Eu=function(e,t,r,n){if((!n||void 0!==r)&&!En(r))throw Error(eB(e,t)+'was an invalid path = "'+r+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Ec=function(e,t,r,n){r&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),Eu(e,t,r,n)},Eh=function(e,t){let r=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Er(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==r.length&&!Ei(r))throw Error(eB(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Ed{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ef(e,t){let r=null;for(let n=0;n<t.length;n++){let i=t[n],s=i.getPath();null===r||Cd(s,r.path)||(e.eventLists_.push(r),r=null),null===r&&(r={events:[],path:s}),r.events.push(i)}r&&e.eventLists_.push(r)}function Ep(e,t,r){Ef(e,r),Eg(e,e=>Cf(e,t)||Cf(t,e))}function Eg(e,t){e.recursionDepth_++;let r=!0;for(let n=0;n<e.eventLists_.length;n++){let i=e.eventLists_[n];i&&(t(i.path)?(Em(e.eventLists_[n]),e.eventLists_[n]=null):r=!1)}r&&(e.eventLists_=[]),e.recursionDepth_--}function Em(e){for(let t=0;t<e.events.length;t++){let r=e.events[t];if(null!==r){e.events[t]=null;let n=r.getEventRunner();bF&&bq("event: "+r.toString()),b7(n)}}}let Ey="repo_interrupt",Ev=25;class E_{constructor(e,t,r,n){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ed,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ws(),this.transactionQueueTree_=new TJ,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Eb(e,t,r){if(e.stats_=Sl(e.repoInfo_),e.forceRestClient_||Se())e.server_=new wn(e.repoInfo_,(t,r,n,i)=>{Ew(e,t,r,n,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>ET(e,!0),0);else{if(null!=r){if("object"!=typeof r)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{ek(r)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new CI(e.repoInfo_,t,(t,r,n,i)=>{Ew(e,t,r,n,i)},t=>{ET(e,t)},t=>{EE(e,t)},e.authTokenProvider_,e.appCheckProvider_,r),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=Su(e.repoInfo_,()=>new wf(e.stats_,e.server_)),e.infoData_=new wi,e.infoSyncTree_=new TI({startListening:(t,r,n,i)=>{let s=[],a=e.infoData_.getNode(t._path);return a.isEmpty()||(s=TO(e.infoSyncTree_,t._path,a),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),Ek(e,"connected",!1),e.serverSyncTree_=new TI({startListening:(t,r,n,i)=>(e.server_.listen(t,n,r,(r,n)=>{let s=i(r,n);Ep(e.eventQueue_,t._path,s)}),[]),stopListening:(t,r)=>{e.server_.unlisten(t,r)}})}function ES(e){let t=e.infoData_.getNode(new S7(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function EC(e){return TH({timestamp:ES(e)})}function Ew(e,t,r,n,i){e.dataUpdateCount++;let s=new S7(t);r=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,r):r;let a=[];if(i)if(n){let t=eN(r,e=>C1(e));a=TP(e.serverSyncTree_,s,t,i)}else{let t=C1(r);a=TN(e.serverSyncTree_,s,t,i)}else if(n){let t=eN(r,e=>C1(e));a=TA(e.serverSyncTree_,s,t)}else{let t=C1(r);a=TO(e.serverSyncTree_,s,t)}let o=s;a.length>0&&(o=EL(e,s)),Ep(e.eventQueue_,o,a)}function ET(e,t){Ek(e,"connected",t),!1===t&&Ex(e)}function EE(e,t){b1(t,(t,r)=>{Ek(e,t,r)})}function Ek(e,t,r){let n=new S7("/.info/"+t),i=C1(r);e.infoData_.updateSnapshot(n,i);let s=TO(e.infoSyncTree_,n,i);Ep(e.eventQueue_,n,s)}function EI(e){return e.nextWriteId_++}function ER(e,t,r,n){EO(e,"update",{path:t.toString(),value:r});let i=!0,s=EC(e),a={};if(b1(r,(r,n)=>{i=!1,a[r]=TG(Cl(t,r),C1(n),e.serverSyncTree_,s)}),i)bq("update() called with empty data.  Don't do anything."),EA(e,n,"ok",void 0);else{let i=EI(e),s=Tx(e.serverSyncTree_,t,a,i);Ef(e.eventQueue_,s),e.server_.merge(t.toString(),r,(r,s)=>{let a="ok"===r;a||bH("update at "+t+" failed: "+r);let o=TD(e.serverSyncTree_,i,!a),l=o.length>0?EL(e,t):t;Ep(e.eventQueue_,l,o),EA(e,n,r,s)}),b1(r,r=>{let n=EV(e,Cl(t,r));EL(e,n)}),Ep(e.eventQueue_,t,[])}}function Ex(e){EO(e,"onDisconnectEvents");let t=EC(e),r=ws();wo(e.onDisconnect_,Ce(),(n,i)=>{let s=TG(n,i,e.serverSyncTree_,t);wa(r,n,s)});let n=[];wo(r,Ce(),(t,r)=>{n=n.concat(TO(e.serverSyncTree_,t,r));let i=EV(e,t);EL(e,i)}),e.onDisconnect_=ws(),Ep(e.eventQueue_,Ce(),n)}function ED(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Ey)}function EO(e,...t){let r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),bq(r,...t)}function EA(e,t,r,n){t&&b7(()=>{if("ok"===r)t(null);else{let e=(r||"error").toUpperCase(),i=e;n&&(i+=": "+n);let s=Error(i);s.code=e,t(s)}})}function EN(e,t,r){return TM(e.serverSyncTree_,t,r)||CJ.EMPTY_NODE}function EP(e,t=e.transactionQueueTree_){if(t||EU(e,t),TZ(t)){let r=Ej(e,t);B(r.length>0,"Sending zero length transaction queue"),r.every(e=>0===e.status)&&EM(e,T5(t),r)}else T1(t)&&T3(t,t=>{EP(e,t)})}function EM(e,t,r){let n=EN(e,t,r.map(e=>e.currentWriteId)),i=n,s=n.hash();for(let e=0;e<r.length;e++){let n=r[e];B(0===n.status,"tryToSendTransactionQueue_: items in queue should all be run."),n.status=1,n.retryCount++;let s=Cc(t,n.path);i=i.updateChild(s,n.currentOutputSnapshotRaw)}let a=i.val(!0),o=t;e.server_.put(o.toString(),a,n=>{EO(e,"transaction put response",{path:o.toString(),status:n});let i=[];if("ok"===n){let n=[];for(let t=0;t<r.length;t++)r[t].status=2,i=i.concat(TD(e.serverSyncTree_,r[t].currentWriteId)),r[t].onComplete&&n.push(()=>r[t].onComplete(null,!0,r[t].currentOutputSnapshotResolved)),r[t].unwatcher();EU(e,TX(e.transactionQueueTree_,t)),EP(e,e.transactionQueueTree_),Ep(e.eventQueue_,t,i);for(let e=0;e<n.length;e++)b7(n[e])}else{if("datastale"===n)for(let e=0;e<r.length;e++)3===r[e].status?r[e].status=4:r[e].status=0;else{bH("transaction at "+o.toString()+" failed: "+n);for(let e=0;e<r.length;e++)r[e].status=4,r[e].abortReason=n}EL(e,t)}},s)}function EL(e,t){let r=EB(e,t),n=T5(r),i=Ej(e,r);return EF(e,i,n),n}function EF(e,t,r){if(0===t.length)return;let n=[],i=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let a=0;a<t.length;a++){let o=t[a],l=Cc(r,o.path),u=!1,c;if(B(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===o.status)u=!0,c=o.abortReason,i=i.concat(TD(e.serverSyncTree_,o.currentWriteId,!0));else if(0===o.status)if(o.retryCount>=Ev)u=!0,c="maxretry",i=i.concat(TD(e.serverSyncTree_,o.currentWriteId,!0));else{let r=EN(e,o.path,s);o.currentInputSnapshot=r;let n=t[a].update(r.val());if(void 0!==n){Ea("transaction failed: Data returned ",n,o.path);let t=C1(n);"object"==typeof n&&null!=n&&eD(n,".priority")||(t=t.updatePriority(r.getPriority()));let a=o.currentWriteId,l=TQ(t,r,EC(e));o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=l,o.currentWriteId=EI(e),s.splice(s.indexOf(a),1),i=(i=i.concat(TR(e.serverSyncTree_,o.path,l,o.currentWriteId,o.applyLocally))).concat(TD(e.serverSyncTree_,a,!0))}else u=!0,c="nodata",i=i.concat(TD(e.serverSyncTree_,o.currentWriteId,!0))}Ep(e.eventQueue_,r,i),i=[],u&&(t[a].status=2,function(e){setTimeout(e,Math.floor(0))}(t[a].unwatcher),t[a].onComplete&&("nodata"===c?n.push(()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot)):n.push(()=>t[a].onComplete(Error(c),!1,null))))}EU(e,e.transactionQueueTree_);for(let e=0;e<n.length;e++)b7(n[e]);EP(e,e.transactionQueueTree_)}function EB(e,t){let r,n=e.transactionQueueTree_;for(r=Ct(t);null!==r&&void 0===TZ(n);)n=TX(n,r),r=Ct(t=Cn(t));return n}function Ej(e,t){let r=[];return Eq(e,t,r),r.sort((e,t)=>e.order-t.order),r}function Eq(e,t,r){let n=TZ(t);if(n)for(let e=0;e<n.length;e++)r.push(n[e]);T3(t,t=>{Eq(e,t,r)})}function EU(e,t){let r=TZ(t);if(r){let e=0;for(let t=0;t<r.length;t++)2!==r[t].status&&(r[e]=r[t],e++);r.length=e,T0(t,r.length>0?r:void 0)}T3(t,t=>{EU(e,t)})}function EV(e,t){let r=T5(EB(e,t)),n=TX(e.transactionQueueTree_,t);return T4(n,t=>{Ez(e,t)}),Ez(e,n),T6(n,t=>{Ez(e,t)}),r}function Ez(e,t){let r=TZ(t);if(r){let n=[],i=[],s=-1;for(let t=0;t<r.length;t++)3===r[t].status||(1===r[t].status?(B(s===t-1,"All SENT items should be at beginning of queue."),s=t,r[t].status=3,r[t].abortReason="set"):(B(0===r[t].status,"Unexpected transaction status in abort"),r[t].unwatcher(),i=i.concat(TD(e.serverSyncTree_,r[t].currentWriteId,!0)),r[t].onComplete&&n.push(r[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?T0(t,void 0):r.length=s+1,Ep(e.eventQueue_,T5(t),i);for(let e=0;e<n.length;e++)b7(n[e])}}function EH(e){let t="",r=e.split("/");for(let e=0;e<r.length;e++)if(r[e].length>0){let n=r[e];try{n=decodeURIComponent(n.replace(/\+/g," "))}catch(e){}t+="/"+n}return t}function EW(e){let t={};for(let r of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===r.length)continue;let n=r.split("=");2===n.length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):bH(`Invalid query segment '${r}' in query '${e}'`)}return t}let E$=function(e,t){let r=EK(e),n=r.namespace;"firebase.com"===r.domain&&bz(r.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===r.domain||bz("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),r.secure||bW();let i="ws"===r.scheme||"wss"===r.scheme;return{repoInfo:new Sr(r.host,r.secure,n,i,t,"",n!==r.subdomain),path:new S7(r.pathString)}},EK=function(e){let t="",r="",n="",i="",s="",a=!0,o="https",l=443;if("string"==typeof e){let u=e.indexOf("//");u>=0&&(o=e.substring(0,u-1),e=e.substring(u+2));let c=e.indexOf("/");-1===c&&(c=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(c,h)),c<h&&(i=EH(e.substring(c,h)));let d=EW(e.substring(Math.min(e.length,h)));(u=t.indexOf(":"))>=0?(a="https"===o||"wss"===o,l=parseInt(t.substring(u+1),10)):u=t.length;let f=t.slice(0,u);if("localhost"===f.toLowerCase())r="localhost";else if(f.split(".").length<=2)r=f;else{let e=t.indexOf(".");n=t.substring(0,e).toLowerCase(),r=t.substring(e+1),s=n}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:r,subdomain:n,secure:a,scheme:o,pathString:i,namespace:s}};class EG{constructor(e,t,r,n){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=n}get key(){return Cu(this._path)?null:Ci(this._path)}get ref(){return new EQ(this._repo,this._path)}get _queryIdentifier(){let e=bZ(wr(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return wr(this._queryParams)}isEqual(e){if(!((e=eU(e))instanceof EG))return!1;let t=this._repo===e._repo,r=Cd(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier;return t&&r&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+Cs(this._path)}}class EQ extends EG{constructor(e,t){super(e,t,new we,!1)}get parent(){let e=Co(this._path);return null===e?null:new EQ(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}function EY(e,t){return(e=eU(e))._checkNotDeleted("ref"),void 0!==t?EJ(e._root,t):e._root}function EJ(e,t){return null===Ct((e=eU(e))._path)?Ec("child","path",t,!1):Eu("child","path",t,!1),new EQ(e._repo,Cl(e._path,t))}function EX(e,t){El("update",t,e._path,!1);let r=new ei;return ER(e._repo,e._path,t,r.wrapCallback(()=>{})),r.promise}Tw(EQ),Tk(EQ);let EZ="FIREBASE_DATABASE_EMULATOR_HOST",E0={},E1=!1;function E2(e,t,r,n){let i=t.lastIndexOf(":"),s=es(t.substring(0,i));e.repoInfo_=new Sr(t,s,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,r),n&&(e.authTokenProvider_=n)}function E3(e,t,r,n,i){let s,a,o=n||e.options.databaseURL;void 0===o&&(e.options.projectId||bz("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),bq("Using default host for project ",e.options.projectId),o=`${e.options.projectId}-default-rtdb.firebaseio.com`);let l=E$(o,i),u=l.repoInfo;"u">typeof process&&process.env&&(s=process.env[EZ]),s?(a=!0,u=(l=E$(o=`http://${s}?ns=${u.namespace}`,i)).repoInfo):a=!l.repoInfo.secure;let c=i&&a?new SS(SS.OWNER):new Sb(e.name,e.options,t);return Eh("Invalid Firebase Database URL",l),Cu(l.path)||bz("Database URL must point to the root of a Firebase Database (not including a child path)."),new E5(E4(u,e,c,new S_(e,r)),e)}function E6(e,t){let r=E0[t];r&&r[e.key]===e||bz(`Database ${t}(${e.repoInfo_}) has already been deleted.`),ED(e),delete r[e.key]}function E4(e,t,r,n){let i=E0[t.name];i||(i={},E0[t.name]=i);let s=i[e.toURLString()];return s&&bz("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new E_(e,E1,r,n),i[e.toURLString()]=s,s}class E5{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Eb(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new EQ(this._repo,Ce())),this._rootInternal}_delete(){return null!==this._rootInternal&&(E6(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&bz("Cannot call "+e+" on a deleted database.")}}function E8(e=tq(),t){let r=tI(e,"database").getImmediate({identifier:t});if(!r._instanceStarted){let e=er("database");e&&E9(r,...e)}return r}function E9(e,t,r,n={}){let i;(e=eU(e))._checkNotDeleted("useEmulator");let s=`${t}:${r}`,a=e._repoInternal;if(e._instanceStarted){if(s===e._repoInternal.repoInfo_.host&&eP(n,a.repoInfo_.emulatorOptions))return;bz("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}a.repoInfo_.nodeAdmin?(n.mockUserToken&&bz('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),i=new SS(SS.OWNER)):n.mockUserToken&&(i=new SS("string"==typeof n.mockUserToken?n.mockUserToken:eo(n.mockUserToken,e.app.options.projectId))),es(t)&&(ea(t),el("Database",!0)),E2(a,s,n,i)}function E7(e){Sh(tF),tk(new eV("database",(e,{instanceIdentifier:t})=>E3(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),tz(Sy,Sv,e),tz(Sy,Sv,"esm2020")}let ke={".sv":"timestamp"};function kt(){return ke}CI.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},CI.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Sg(by.default.Client),E7("node");let kr={apiKey:"AIzaSyDhwxaI0Bx_AGF1K1E342nY8bwOX_DImA8",authDomain:"gps-tracker-8376c.firebaseapp.com",projectId:"gps-tracker-8376c",storageBucket:"gps-tracker-8376c.firebasestorage.app",messagingSenderId:"650884354501",appId:"1:650884354501:web:92843965d0b7c4e241bbac",databaseURL:"https://gps-tracker-8376c-default-rtdb.asia-southeast1.firebasedatabase.app"},kn=0===tU().length?tB(kr):tU()[0];yQ(kn);let ki=E8(kn);var ks=e.i(5043);async function ka(e){try{let{deviceId:t,...r}=await e.json();if(!t)return ks.NextResponse.json({error:"Missing deviceId"},{status:400});let n=EY(ki,`devices/${t}`);return await EX(n,{deviceId:t,...r,lastUpdated:kt()}),ks.NextResponse.json({success:!0,message:"Data received"})}catch(e){return console.error("Error writing to RTDB:",e),ks.NextResponse.json({error:"Internal Server Error"},{status:500})}}e.s(["POST",()=>ka],80635);var ko=e.i(80635);let kl="",ku=new _.AppRouteRouteModule({definition:{kind:b.RouteKind.APP_ROUTE,page:"/api/track/route",pathname:"/api/track",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/Desktop/gps-tracker/app/api/track/route.js",nextConfigOutput:kl,userland:ko}),{workAsyncStorage:kc,workUnitAsyncStorage:kh,serverHooks:kd}=ku;function kf(){return(0,S.patchFetch)({workAsyncStorage:kc,workUnitAsyncStorage:kh})}async function kp(e,t,r){ku.isDev&&(0,C.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/track/route";n=n.replace(/\/index$/,"")||"/";let i=!1,s=await ku.prepare(e,t,{srcPage:n,multiZoneDraftMode:i});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:a,params:o,nextConfig:l,parsedUrl:u,isDraftMode:c,prerenderManifest:h,routerServerContext:d,isOnDemandRevalidate:f,revalidateOnlyGenerated:p,resolvedPathname:g,clientReferenceManifest:m,serverActionsManifest:y}=s,v=(0,E.normalizeAppPath)(n),_=!!(h.dynamicRoutes[v]||h.routes[g]),S=async()=>((null==d?void 0:d.render404)?await d.render404(e,t,u,!1):t.end("This page could not be found"),null);if(_&&!c){let e=!!h.routes[g],t=h.dynamicRoutes[v];if(t&&!1===t.fallback&&!e){if(l.experimental.adapterPath)return await S();throw new P.NoFallbackError}}let L=null;!_||ku.isDev||c||(L="/index"===(L=g)?"/":L);let F=!0===ku.isDev||!_,B=_&&!F;y&&m&&(0,T.setManifestsSingleton)({page:n,clientReferenceManifest:m,serverActionsManifest:y});let j=e.method||"GET",q=(0,w.getTracer)(),U=q.getActiveScopeSpan(),V={params:o,prerenderManifest:h,renderOpts:{experimental:{authInterrupts:!!l.experimental.authInterrupts},cacheComponents:!!l.cacheComponents,supportsDynamicResponse:F,incrementalCache:(0,C.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:l.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,i)=>ku.onRequestError(e,t,n,i,d)},sharedContext:{buildId:a}},z=new k.NodeNextRequest(e),H=new k.NodeNextResponse(t),W=I.NextRequestAdapter.fromNodeNextRequest(z,(0,I.signalFromNodeResponse)(t));try{let i=async e=>ku.handle(W,V).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=q.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==R.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${j} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${n}`)}),s=!!(0,C.getRequestMeta)(e,"minimalMode"),a=async a=>{var o,u;let g=async({previousCacheEntry:o})=>{try{if(!s&&f&&p&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(a);e.fetchMetrics=V.renderOpts.fetchMetrics;let l=V.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let u=V.renderOpts.collectedTags;if(!_)return await (0,D.sendResponse)(z,H,n,V.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,O.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[N.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==V.renderOpts.collectedRevalidate&&!(V.renderOpts.collectedRevalidate>=N.INFINITE_CACHE)&&V.renderOpts.collectedRevalidate,i=void 0===V.renderOpts.collectedExpire||V.renderOpts.collectedExpire>=N.INFINITE_CACHE?void 0:V.renderOpts.collectedExpire;return{value:{kind:M.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){if(null==o?void 0:o.isStale){let r=!1;await ku.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,x.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:f})},r,d)}throw t}},m=await ku.handleResponse({req:e,nextConfig:l,cacheKey:L,routeKind:b.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:h,isRoutePPREnabled:!1,isOnDemandRevalidate:f,revalidateOnlyGenerated:p,responseGenerator:g,waitUntil:r.waitUntil,isMinimalMode:s});if(!_)return null;if((null==m||null==(o=m.value)?void 0:o.kind)!==M.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==m||null==(u=m.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",f?"REVALIDATED":m.isMiss?"MISS":m.isStale?"STALE":"HIT"),c&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,O.fromNodeOutgoingHttpHeaders)(m.value.headers);return s&&_||y.delete(N.NEXT_CACHE_TAGS_HEADER),!m.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,A.getCacheControlHeader)(m.cacheControl)),await (0,D.sendResponse)(z,H,new Response(m.value.body,{headers:y,status:m.value.status||200})),null};U?await a(U):await q.withPropagatedContext(e.headers,()=>q.trace(R.BaseServerSpan.handleRequest,{spanName:`${j} ${n}`,kind:w.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},a))}catch(t){if(!(t instanceof P.NoFallbackError)){let r=!1;await ku.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,x.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:f})},r,d)}if(_)throw t;return await (0,D.sendResponse)(z,H,new Response(null,{status:500})),null}}e.s(["handler",()=>kp,"patchFetch",()=>kf,"routeModule",()=>ku,"serverHooks",()=>kd,"workAsyncStorage",()=>kc,"workUnitAsyncStorage",()=>kh],12366)}];

//# sourceMappingURL=6243d_a88d33ae._.js.map