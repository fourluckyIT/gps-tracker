(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,29328,(e,t,n)=>{var r={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return(n+r)*3/4-r},t.toByteArray=function(e){var t,n,s=l(e),o=s[0],a=s[1],h=new i((o+a)*3/4-a),u=0,c=a>0?o-4:o;for(n=0;n<c;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],h[u++]=t>>16&255,h[u++]=t>>8&255,h[u++]=255&t;return 2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,h[u++]=255&t),1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,h[u++]=t>>8&255,h[u++]=255&t),h},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],o=0,a=r-i;o<a;o+=16383)s.push(function(e,t,r){for(var i,s=[],o=t;o<r;o+=3)i=(e[o]<<16&0xff0000)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(n[i>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return s.join("")}(e,o,o+16383>a?a:o+16383));return 1===i?s.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&s.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")};for(var n=[],r=[],i="u">typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)n[o]=s[o],r[s.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}r[45]=62,r[95]=63},72:function(e,t,n){"use strict";var r=n(675),i=n(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function o(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,a.prototype),t}function a(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!a.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(r,i),l=o(s),h=l.write(r,i);return h!==s&&(l=l.slice(0,h)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(N(e,ArrayBuffer)||e&&N(e.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(N(e,SharedArrayBuffer)||e&&N(e.buffer,SharedArrayBuffer)))return function(e,t,n){var r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),a.prototype),r}(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var u=e.valueOf&&e.valueOf();if(null!=u&&u!==e)return a.from(u,t,n);var p=function(e){if(a.isBuffer(e)){var t=0|d(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?o(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return h(e),o(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),n=o(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}t.Buffer=a,t.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!a.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(e,t,n){return(h(e),e<=0)?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)},a.allocUnsafe=function(e){return u(e)},a.allocUnsafeSlow=function(e){return u(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||N(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return T(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return x(e).length;default:if(i)return r?-1:T(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,n){var i,s,o,a=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=A[e[s]];return i}(this,t,n);case"utf8":case"utf-8":return _(this,t,n);case"ascii":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":return i=this,s=t,o=n,0===s&&o===i.length?r.fromByteArray(i):r.fromByteArray(i.slice(s,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}(this,t,n);default:if(a)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){var s;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(i)return -1;else n=e.length-1;else if(n<0)if(!i)return -1;else n=0;if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return y(e,[t],n,r,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var s,o=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;o=2,a/=2,l/=2,n/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(s=n;s<a;s++)if(h(e,s)===h(t,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===l)return u*o}else -1!==u&&(s-=s-u),u=-1}else for(n+l>a&&(n=a-l),s=n;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(h(e,s+d)!==h(t,d)){c=!1;break}if(c)return s}return -1}a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if(N(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),N(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:+(r<n)},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,r=a.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(N(s,Uint8Array)&&(s=a.from(s)),!a.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},a.byteLength=f,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},a.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?_(this,0,e):p.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(e){if(!a.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(a.prototype[s]=a.prototype.inspect),a.prototype.compare=function(e,t,n,r,i){if(N(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var s=i-r,o=n-t,l=Math.min(s,o),h=this.slice(r,i),u=e.slice(t,n),c=0;c<l;++c)if(h[c]!==u[c]){s=h[c],o=u[c];break}return s<o?-1:+(o<s)},a.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)};function _(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,o,a,l,h=e[i],u=null,c=h>239?4:h>223?3:h>191?2:1;if(i+c<=n)switch(c){case 1:h<128&&(u=h);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&h)<<6|63&s)>127&&(u=l);break;case 3:s=e[i+1],o=e[i+2],(192&s)==128&&(192&o)==128&&(l=(15&h)<<12|(63&s)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:s=e[i+1],o=e[i+2],a=e[i+3],(192&s)==128&&(192&o)==128&&(192&a)==128&&(l=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,c=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=c}var d=r,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function v(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function w(e,t,n,r,i,s){if(!a.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function b(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function I(e,t,n,r,s){return t*=1,n>>>=0,s||b(e,t,n,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,n,r,23,4),n+4}function C(e,t,n,r,s){return t*=1,n>>>=0,s||b(e,t,n,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,n,r,52,8),n+8}a.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,o,a,l,h,u,c,d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var f=!1;;)switch(r){case"hex":return function(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a,l=parseInt(t.substr(2*o,2),16);if((a=l)!=a)break;e[n+o]=l}return o}(this,e,t,n);case"utf8":case"utf-8":return i=t,s=n,k(T(e,this.length-i),this,i,s);case"ascii":return o=t,a=n,k(S(e),this,o,a);case"latin1":case"binary":return function(e,t,n,r){return k(S(t),e,n,r)}(this,e,t,n);case"base64":return l=t,h=n,k(x(e),this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,c=n,k(function(e,t){for(var n,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}(e,this.length-u),this,u,c);default:if(f)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),f=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,a.prototype),r},a.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},a.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},a.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},a.prototype.readInt8=function(e,t){return(e>>>=0,t||v(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},a.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;w(this,e,t,n,i,0)}var s=1,o=0;for(this[t]=255&e;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;w(this,e,t,n,i,0)}var s=n-1,o=1;for(this[t+s]=255&e;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);w(this,e,t,n,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o|0)-a&255;return t+n},a.prototype.writeIntBE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);w(this,e,t,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o|0)-a&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,n){return I(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return I(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return C(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return C(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,r){if(!a.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var s=i-1;s>=0;--s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},a.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===r&&s<128||"latin1"===r)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var o=a.isBuffer(e)?e:a.from(e,r),l=o.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=o[i%l]}return this};var E=/[^+/0-9A-Za-z-_]/g;function T(e,t){t=t||1/0;for(var n,r=e.length,i=null,s=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319||o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function S(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function x(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(E,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function k(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function N(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var A=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}()},783:function(e,t){t.read=function(e,t,n,r,i){var s,o,a=8*i-r-1,l=(1<<a)-1,h=l>>1,u=-7,c=n?i-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+e[t+c],c+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+e[t+c],c+=d,u-=8);if(0===s)s=1-h;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=h}return(f?-1:1)*o*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var o,a,l,h=8*s-i-1,u=(1<<h)-1,c=u>>1,d=5960464477539062e-23*(23===i),f=r?0:s-1,p=r?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(a=+!!isNaN(t),o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(o++,l/=2),o+c>=u?(a=0,o=u):o+c>=1?(a=(t*l-1)*Math.pow(2,i),o+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;e[n+f]=255&o,f+=p,o/=256,h-=8);e[n+f-p]|=128*g}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}},o=!0;try{r[e](n,n.exports,s),o=!1}finally{o&&delete i[e]}return n.exports}s.ab="/ROOT/Desktop/gps-tracker/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},49852,e=>{"use strict";let t,n,r,i,s,o,a,l,h,u,c,d,f,p;var g,m,y,_,v,w,b,I,C,E,T,S,x,k,N,A,D,R,P=e.i(56964),O=e.i(27114),M=e.i(51864);let L=function(e,t){if(!e)throw F(t)},F=function(e){return Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},V=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},q=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")},U={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=i>>2,u=(3&i)<<4|o>>4,c=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(c=64)),r.push(n[h],n[u],n[c],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(V(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):q(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw new B;let l=i<<2|s>>4;if(r.push(l),64!==o){let e=s<<4&240|o>>2;if(r.push(e),64!==a){let e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class B extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let j=function(e){let t=V(e);return U.encodeByteArray(t,!0)},z=function(e){return j(e).replace(/\./g,"")},$=function(e){try{return U.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function K(){return"u">typeof self?self:"u">typeof window?window:e.g}let G=()=>{try{return K().__FIREBASE_DEFAULTS__||(()=>{if(void 0===M.default||void 0===M.default.env)return;let e=M.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&$(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},H=e=>{let t=G()?.emulatorHosts?.[e];if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},W=()=>G()?.config;class Q{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function Y(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function J(e){return(await fetch(e,{credentials:"include"})).ok}function X(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[z(JSON.stringify({alg:"none",type:"JWT"})),z(JSON.stringify(s)),""].join(".")}let Z={},ee=!1;function et(e,t){if("u"<typeof window||"u"<typeof document||!Y(window.location.host)||Z[e]===t||Z[e]||ee)return;function n(e){return`__firebase__banner__${e}`}Z[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(Z))Z[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),o=n("text"),a=document.getElementById(o)||document.createElement("span"),l=n("learnmore"),h=document.getElementById(l)||document.createElement("a"),u=n("preprendIcon"),c=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;ee=!0,(e=document.getElementById(r))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",u),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,a,h,n),document.body.appendChild(t)}i?(a.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText="Preview backend running in this workspace."),a.setAttribute("id",o)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function en(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function er(){return"u">typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(en())}function ei(){let t=G()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function es(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function eo(){return false}function ea(){return!ei()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function el(){return!ei()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function eh(){try{return"object"==typeof indexedDB}catch(e){return!1}}class eu extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,eu.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ec.prototype.create)}}class ec{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,r=i,n.replace(ed,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new eu(s,l,i)}}let ed=/\{\$([^}]+)}/g;function ef(e){return JSON.parse(e)}function ep(e){return JSON.stringify(e)}let eg=function(e){let t={},n={},r={},i="";try{let s=e.split(".");t=ef($(s[0])||""),n=ef($(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}},em=function(e){let t=eg(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},ey=function(e){let t=eg(e).claims;return"object"==typeof t&&!0===t.admin};function e_(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function ev(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function ew(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function eb(e,t,n){let r={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function eI(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(eC(n)&&eC(s)){if(!eI(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function eC(e){return null!==e&&"object"==typeof e}class eE{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,r;t||(t=0);let i=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)i[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)i[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=i[e-3]^i[e-8]^i[e-14]^i[e-16];i[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),r=0x5a827999):(n=o^a^l,r=0x6ed9eba1):e<60?(n=o&a|l&(o|a),r=0x8f1bbcdc):(n=o^a^l,r=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+r+i[e]|0;h=l,l=a,a=(o<<30|o>>>2)&0xffffffff,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}}function eT(e,t){return`${e} failed: ${t} argument `}let eS=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){let t=i-55296;L(++r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},ex=function(e){let t=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function ek(e){return e&&e._delegate?e._delegate:e}class eN{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let eA="[DEFAULT]";class eD{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new Q;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:eA})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=eA){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=eA){return this.instances.has(e)}getOptions(e=eA){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);let i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===eA?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=eA){return this.component?this.component.multipleInstances?e:eA:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eD(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let eP=[];(g=y||(y={}))[g.DEBUG=0]="DEBUG",g[g.VERBOSE=1]="VERBOSE",g[g.INFO=2]="INFO",g[g.WARN=3]="WARN",g[g.ERROR=4]="ERROR",g[g.SILENT=5]="SILENT";let eO={debug:y.DEBUG,verbose:y.VERBOSE,info:y.INFO,warn:y.WARN,error:y.ERROR,silent:y.SILENT},eM=y.INFO,eL={[y.DEBUG]:"log",[y.VERBOSE]:"log",[y.INFO]:"info",[y.WARN]:"warn",[y.ERROR]:"error"},eF=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=eL[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eV{constructor(e){this.name=e,this._logLevel=eM,this._logHandler=eF,this._userLogHandler=null,eP.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in y))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eO[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,y.DEBUG,...e),this._logHandler(this,y.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,y.VERBOSE,...e),this._logHandler(this,y.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,y.INFO,...e),this._logHandler(this,y.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,y.WARN,...e),this._logHandler(this,y.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,y.ERROR,...e),this._logHandler(this,y.ERROR,...e)}}let eq=new WeakMap,eU=new WeakMap,eB=new WeakMap,ej=new WeakMap,ez=new WeakMap,e$={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eU.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eB.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return eK(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eK(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eK(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&eq.set(t,e)}).catch(()=>{}),ez.set(t,e),t}if(ej.has(e))return ej.get(e);let r=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eG(this),t),eK(eq.get(this))}:function(...t){return eK(e.apply(eG(this),t))}:function(t,...n){let r=e.call(eG(this),t,...n);return eB.set(r,t.sort?t.sort():[t]),eK(r)};return e instanceof IDBTransaction&&function(e){if(eU.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eU.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,e$):e}(e);return r!==e&&(ej.set(e,r),ez.set(r,e)),r}let eG=e=>ez.get(e),eH=["get","getKey","getAll","getAllKeys","count"],eW=["put","add","delete","clear"],eQ=new Map;function eY(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eQ.get(t))return eQ.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=eW.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||eH.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return eQ.set(t,s),s}e$={...p=e$,get:(e,t,n)=>eY(e,t)||p.get(e,t,n),has:(e,t)=>!!eY(e,t)||p.has(e,t)};class eJ{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let eX="@firebase/app",eZ="0.14.7",e0=new eV("@firebase/app"),e1="[DEFAULT]",e2={[eX]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},e6=new Map,e3=new Map,e5=new Map;function e4(e,t){try{e.container.addComponent(t)}catch(n){e0.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function e8(e,t){e.container.addOrOverwriteComponent(t)}function e7(e){let t=e.name;if(e5.has(t))return e0.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(e5.set(t,e),e6.values()))e4(n,e);for(let t of e3.values())e4(t,e);return!0}function e9(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function te(e,t,n=e1){e9(e,t).clearInstance(n)}function tt(e){return void 0!==e.options}function tn(e){return!tt(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function tr(e){return null!=e&&void 0!==e.settings}function ti(){e5.clear()}let ts=new ec("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class to{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new eN("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ts.create("app-deleted",{appName:this._name})}}function ta(e,t){let n=$(e.split(".")[1]);null===n?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class tl extends to{constructor(e,t,n,r){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,r):super(e.options,s,r),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&ta(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&ta(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,tg(eX,eZ,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){tp(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw ts.create("server-app-deleted")}}let th="12.8.0";function tu(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r={name:e1,automaticDataCollectionEnabled:!0,...t},i=r.name;if("string"!=typeof i||!i)throw ts.create("bad-app-name",{appName:String(i)});if(n||(n=W()),!n)throw ts.create("no-options");let s=e6.get(i);if(s)if(eI(n,s.options)&&eI(r,s.config))return s;else throw ts.create("duplicate-app",{appName:i});let o=new eR(i);for(let e of e5.values())o.addComponent(e);let a=new to(n,r,o);return e6.set(i,a),a}function tc(e,t={}){let n;if(("u">typeof window||es())&&!es())throw ts.create("invalid-server-app-environment");let r=t||{};if(e&&(tt(e)?n=e.options:tn(e)?r=e:n=e),void 0===r.automaticDataCollectionEnabled&&(r.automaticDataCollectionEnabled=!0),n||(n=W()),!n)throw ts.create("no-options");let i={...r,...n};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==r.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw ts.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),o=e3.get(s);if(o)return o.incRefCount(r.releaseOnDeref),o;let a=new eR(s);for(let e of e5.values())a.addComponent(e);let l=new tl(n,r,s,a);return e3.set(s,l),l}function td(e=e1){let t=e6.get(e);if(!t&&e===e1&&W())return tu();if(!t)throw ts.create("no-app",{appName:e});return t}function tf(){return Array.from(e6.values())}async function tp(e){let t=!1,n=e.name;e6.has(n)?(t=!0,e6.delete(n)):e3.has(n)&&0>=e.decRefCount()&&(e3.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tg(e,t,n){let r=e2[e]??e;n&&(r+=`-${n}`);let i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${r}" with version "${t}":`];i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),e0.warn(e.join(" "));return}e7(new eN(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function tm(e,t){if(null!==e&&"function"!=typeof e)throw ts.create("invalid-log-argument");for(let n of eP){let r=null;t&&t.level&&(r=eO[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(r??t.logLevel)&&e({level:y[n].toLowerCase(),message:s,args:i,type:t.name})}}}function ty(e){eP.forEach(t=>{t.setLogLevel(e)})}let t_="firebase-heartbeat-store",tv=null;function tw(){return tv||(tv=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(e,1),a=eK(o);return r&&o.addEventListener("upgradeneeded",e=>{r(eK(o.result),e.oldVersion,e.newVersion,eK(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(t_)}catch(e){console.warn(e)}}}).catch(e=>{throw ts.create("idb-open",{originalErrorMessage:e.message})})),tv}async function tb(e){try{let t=(await tw()).transaction(t_),n=await t.objectStore(t_).get(tC(e));return await t.done,n}catch(e){if(e instanceof eu)e0.warn(e.message);else{let t=ts.create("idb-get",{originalErrorMessage:e?.message});e0.warn(t.message)}}}async function tI(e,t){try{let n=(await tw()).transaction(t_,"readwrite"),r=n.objectStore(t_);await r.put(t,tC(e)),await n.done}catch(e){if(e instanceof eu)e0.warn(e.message);else{let t=ts.create("idb-set",{originalErrorMessage:e?.message});e0.warn(t.message)}}}function tC(e){return`${e.name}!${e.options.appId}`}class tE{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tS(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tT();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){e0.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tT(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),tx(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),tx(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=z(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return e0.warn(e),""}}}function tT(){return new Date().toISOString().substring(0,10)}class tS{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!eh()&&new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tb(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tI(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tI(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tx(e){return z(JSON.stringify({version:2,heartbeats:e})).length}e7(new eN("platform-logger",e=>new eJ(e),"PRIVATE")),e7(new eN("heartbeat",e=>new tE(e),"PRIVATE")),tg(eX,eZ,""),tg(eX,eZ,"esm2020"),tg("fire-js",""),e.s(["SDK_VERSION",()=>th,"_DEFAULT_ENTRY_NAME",()=>e1,"_addComponent",()=>e4,"_addOrOverwriteComponent",()=>e8,"_apps",()=>e6,"_clearComponents",()=>ti,"_components",()=>e5,"_getProvider",()=>e9,"_isFirebaseApp",()=>tt,"_isFirebaseServerApp",()=>tr,"_isFirebaseServerAppSettings",()=>tn,"_registerComponent",()=>e7,"_removeServiceInstance",()=>te,"_serverApps",()=>e3,"deleteApp",()=>tp,"getApp",()=>td,"getApps",()=>tf,"initializeApp",()=>tu,"initializeServerApp",()=>tc,"onLog",()=>tm,"registerVersion",()=>tg,"setLogLevel",()=>ty],26449);let tk="@firebase/database",tN="1.1.0",tA="";class tD{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ep(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:ef(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class tR{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return e_(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let tP=function(e){try{if("u">typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new tD(t)}}catch(e){}return new tR},tO=tP("localStorage"),tM=tP("sessionStorage"),tL=new eV("@firebase/database"),tF=(f=1,function(){return f++}),tV=function(e){let t=eS(e),n=new eE;n.update(t);let r=n.digest();return U.encodeByteArray(r)},tq=function(...e){let t="";for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=tq.apply(null,r):"object"==typeof r?t+=ep(r):t+=r,t+=" "}return t},tU=null,tB=!0,tj=function(e,t){L(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(tL.logLevel=y.VERBOSE,tU=tL.log.bind(tL),t&&tM.set("logging_enabled",!0)):"function"==typeof e?tU=e:(tU=null,tM.remove("logging_enabled"))},tz=function(...e){if(!0===tB&&(tB=!1,null===tU&&!0===tM.get("logging_enabled")&&tj(!0)),tU){let t=tq.apply(null,e);tU(t)}},t$=function(e){return function(...t){tz(e,...t)}},tK=function(...e){let t="FIREBASE INTERNAL ERROR: "+tq(...e);tL.error(t)},tG=function(...e){let t=`FIREBASE FATAL ERROR: ${tq(...e)}`;throw tL.error(t),Error(t)},tH=function(...e){let t="FIREBASE WARNING: "+tq(...e);tL.warn(t)},tW=function(){"u">typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&tH("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},tQ=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},tY=function(e){if(eo()||"complete"===document.readyState)e();else{let t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},tJ="[MIN_NAME]",tX="[MAX_NAME]",tZ=function(e,t){if(e===t)return 0;{if(e===tJ||t===tX)return -1;if(t===tJ||e===tX)return 1;let n=t8(e),r=t8(t);if(null!==n)if(null!==r)return n-r==0?e.length-t.length:n-r;else return -1;return null!==r?1:e<t?-1:1}},t0=function(e,t){return e===t?0:e<t?-1:1},t1=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+ep(t))},t2=function(e){if("object"!=typeof e||null===e)return ep(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=ep(t[r]),n+=":",n+=t2(e[t[r]]);return n+"}"},t6=function(e,t){let n=e.length;if(n<=t)return[e];let r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function t3(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let t5=function(e){let t,n,r,i,s;L(!tQ(e),"Invalid JSON number");0===e?(n=0,r=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-0x10000000000000)):(n=0,r=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},t4=RegExp("^-?(0*)\\d{1,10}$"),t8=function(e){if(t4.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},t7=function(e){try{e()}catch(e){setTimeout(()=>{throw tH("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},t9=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"u">typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class ne{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,tr(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){tH(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class nt{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(tz("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',tH(e)}}class nn{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}nn.OWNER="owner";let nr=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ni="websocket",ns="long_polling";class no{constructor(e,t,n,r,i=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=tO.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&tO.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function na(e,t,n){let r;if(L("string"==typeof t,"typeof type must == string"),L("object"==typeof n,"typeof params must == object"),t===ni)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===ns)r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let i=[];return t3(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class nl{constructor(){this.counters_={}}incrementCounter(e,t=1){e_(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let r in n)n.hasOwnProperty(r)&&"__proto__"!==r&&(t[r]=e(t[r],n[r]));return t}(void 0,this.counters_)}}let nh={},nu={};function nc(e){let t=e.toString();return nh[t]||(nh[t]=new nl),nh[t]}class nd{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&t7(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let nf="start";class np{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=t$(e),this.stats_=nc(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),na(t,ns,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new nd(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),tY(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ng((...e)=>{let[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===nf)this.id=n,this.password=r;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[nf]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"u">typeof location&&location.hostname&&nr.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){np.forceAllow_=!0}static forceDisallow(){np.forceDisallow_=!0}static isAvailable(){return!eo()&&(!!np.forceAllow_||!np.forceDisallow_&&"u">typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=ep(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=t6(j(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(eo())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=ep(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class ng{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,eo())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=tF(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=ng.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(e){tz("frame writing exception"),e.stack&&tz(e.stack),tz(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||tz("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){eo()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{tz("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let nm=null;"u">typeof MozWebSocket?nm=MozWebSocket:"u">typeof WebSocket&&(nm=WebSocket);class ny{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=t$(this.connId),this.stats_=nc(t),this.connURL=ny.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){let s={};return s.v="5",!eo()&&"u">typeof location&&location.hostname&&nr.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),na(e,ni,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,tO.set("previous_websocket_failure",!0);try{let e;if(eo()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${tA}/${M.default.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=M.default.env,r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new nm(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){ny.forceDisallow_=!0}static isAvailable(){let e=!1;if("u">typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==nm&&!ny.forceDisallow_}static previouslyFailed(){return tO.isInMemoryStorage||!0===tO.get("previous_websocket_failure")}markConnectionHealthy(){tO.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=ef(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(L(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=ep(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=t6(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ny.responsesRequiredToBeHealthy=2,ny.healthyTimeout=3e4;class n_{static get ALL_TRANSPORTS(){return[np,ny]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=ny&&ny.isAvailable(),n=t&&!ny.previouslyFailed();if(e.webSocketOnly&&(t||tH("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ny];else{let e=this.transports_=[];for(let t of n_.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);n_.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n_.globalTransportInitialized_=!1;class nv{constructor(e,t,n,r,i,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=t$("c:"+this.id+":"),this.transportManager_=new n_(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=t9(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=t1("t",e),n=t1("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=t1("t",e),n=t1("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=t1("t",e);if("d"in e){let n=e.d;if("h"===t){let e={...n};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?tK("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):tK("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&tH("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),t9(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):t9(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(tO.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class nw{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class nb{constructor(e){this.allowedEvents_=e,this.listeners_={},L(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(e){L(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class nI extends nb{static getInstance(){return new nI}constructor(){super(["online"]),this.online_=!0,"u">typeof window&&void 0!==window.addEventListener&&!er()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return L("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class nC{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function nE(){return new nC("")}function nT(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function nS(e){return e.pieces_.length-e.pieceNum_}function nx(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new nC(e.pieces_,t)}function nk(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function nN(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function nA(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new nC(t,0)}function nD(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof nC)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new nC(n,0)}function nR(e){return e.pieceNum_>=e.pieces_.length}function nP(e,t){let n=nT(e),r=nT(t);if(null===n)return t;if(n===r)return nP(nx(e),nx(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function nO(e,t){if(nS(e)!==nS(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function nM(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(nS(e)>nS(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class nL{constructor(e,t){this.errorPrefix_=t,this.parts_=nN(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=ex(this.parts_[e]);nF(this)}}function nF(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+nV(e))}function nV(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class nq extends nb{static getInstance(){return new nq}constructor(){let e,t;super(["visible"]),"u">typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return L("visible"===e,"Unknown event type: "+e),[this.visible_]}}class nU extends nw{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=nU.nextPersistentConnectionId_++,this.log_=t$("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!eo())throw Error("Auth override specified in options, but not supported on non Node.js platforms");nq.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&nI.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(ep(i)),L(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();let t=new Q,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();let i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),L(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),L(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");let o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);let i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{let s=i.d,o=i.s;nU.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&e_(e,"w")){let n=ev(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();tH(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||ey(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=em(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),L(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);let i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){let i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();let s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ep(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):tK("Unrecognized action received from server: "+ep(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){L(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+nU.nextConnectionId_++,i=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){L(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?tz("getToken() completed but was canceled"):(tz("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new nv(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{tH(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},i))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&tH(e),a())}}}interrupt(e){tz("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){tz("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ew(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>t2(e)).join("$"):"default";let r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){let n,r=new nC(e).toString();if(this.listens.has(r)){let e=this.listens.get(r);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(r)}else n=void 0;return n}onAuthRevoked_(e,t){tz("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){tz("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";eo()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+tA.replace(/\./g,"-")]=1,er()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=nI.getInstance().currentlyOnline();return ew(this.interruptReasons_)&&e}}nU.nextPersistentConnectionId_=0,nU.nextConnectionId_=0;class nB{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new nB(e,t)}}class nj{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new nB(tJ,e),r=new nB(tJ,t);return 0!==this.compare(n,r)}minPost(){return nB.MIN}}class nz extends nj{static get __EMPTY_NODE(){return r}static set __EMPTY_NODE(e){r=e}compare(e,t){return tZ(e.name,t.name)}isDefinedOn(e){throw F("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return nB.MIN}maxPost(){return new nB(tX,r)}makePost(e,t){return L("string"==typeof e,"KeyIndex indexValue must always be a string."),new nB(e,r)}toString(){return".key"}}let n$=new nz;class nK{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class nG{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:nG.RED,this.left=null!=r?r:nH.EMPTY_NODE,this.right=null!=i?i:nH.EMPTY_NODE}copy(e,t,n,r,i){return new nG(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return nH.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,r;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return nH.EMPTY_NODE;else r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,nG.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,nG.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}nG.RED=!0,nG.BLACK=!1;class nH{constructor(e,t=nH.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new nH(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,nG.BLACK,null,null))}remove(e){return new nH(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,nG.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(r)return r.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new nK(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new nK(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new nK(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new nK(this.root_,null,this.comparator_,!0,e)}}function nW(e,t){return tZ(e.name,t.name)}function nQ(e,t){return tZ(e,t)}nH.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new nG(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let nY=function(e){return"number"==typeof e?"number:"+t5(e):"string:"+e},nJ=function(e){if(e.isLeafNode()){let t=e.val();L("string"==typeof t||"number"==typeof t||"object"==typeof t&&e_(t,".sv"),"Priority must be a string or number.")}else L(e===i||e.isEmpty(),"priority of unexpected type.");L(e===i||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class nX{static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}constructor(e,t=nX.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,L(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),nJ(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new nX(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:nX.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return nR(e)?this:".priority"===nT(e)?this.priorityNode_:nX.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:nX.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=nT(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(L(".priority"!==n||1===nS(e),".priority must be the last token in a path"),this.updateImmediateChild(n,nX.__childrenNodeConstructor.EMPTY_NODE.updateChild(nx(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+nY(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=t5(this.value_):e+=this.value_,this.lazyHash_=tV(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===nX.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof nX.__childrenNodeConstructor?-1:(L(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,r=nX.VALUE_TYPE_ORDER.indexOf(t),i=nX.VALUE_TYPE_ORDER.indexOf(n);return(L(r>=0,"Unknown leaf type: "+t),L(i>=0,"Unknown leaf type: "+n),r!==i)?i-r:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}nX.VALUE_TYPE_ORDER=["object","boolean","number","string"];let nZ=new class extends nj{compare(e,t){let n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?tZ(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return nB.MIN}maxPost(){return new nB(tX,new nX("[PRIORITY-POST]",a))}makePost(e,t){return new nB(t,new nX("[PRIORITY-POST]",o(e)))}toString(){return".priority"}},n0=Math.log(2);class n1{constructor(e){this.count=parseInt(Math.log(e+1)/n0,10),this.current_=this.count-1;const t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let n2=function(e,t,n,r){e.sort(t);let i=function(t,r){let s,o=r-t;if(0===o)return null;if(1===o)return s=e[t],new nG(n?n(s):s,s.node,nG.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=i(t,a),h=i(a+1,r);return s=e[a],new nG(n?n(s):s,s.node,nG.BLACK,l,h)}};return new nH(r||t,function(t){let r=null,s=null,o=e.length,a=function(t,r){let s=o-t,a=o;o-=t;let h=i(s+1,a),u=e[s];l(new nG(n?n(u):u,u.node,r,null,h))},l=function(e){r?r.left=e:s=e,r=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,nG.BLACK):(a(r,nG.BLACK),a(r,nG.RED))}return s}(new n1(e.length)))},n6={};class n3{static get Default(){return L(n6&&nZ,"ChildrenNode.ts has not been loaded"),l=l||new n3({".priority":n6},{".priority":nZ})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=ev(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof nH?t:null}hasIndex(e){return e_(this.indexSet_,e.toString())}addIndex(e,t){let n;L(e!==n$,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(nB.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();n=i?n2(r,e.getCompare()):n6;let a=e.toString(),l={...this.indexSet_};l[a]=e;let h={...this.indexes_};return h[a]=n,new n3(h,l)}addToIndexes(e,t){return new n3(eb(this.indexes_,(n,r)=>{let i=ev(this.indexSet_,r);if(L(i,"Missing index implementation for "+r),n===n6)if(!i.isDefinedOn(e.node))return n6;else{let n=[],r=t.getIterator(nB.Wrap),s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),n2(n,i.getCompare())}{let r=t.get(e.name),i=n;return r&&(i=i.remove(new nB(e.name,r))),i.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new n3(eb(this.indexes_,n=>{if(n===n6)return n;{let r=t.get(e.name);return r?n.remove(new nB(e.name,r)):n}}),this.indexSet_)}}class n5{static get EMPTY_NODE(){return h||(h=new n5(new nH(nQ),null,n3.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&nJ(this.priorityNode_),this.children_.isEmpty()&&L(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||h}updatePriority(e){return this.children_.isEmpty()?this:new n5(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?h:t}}getChild(e){let t=nT(e);return null===t?this:this.getImmediateChild(t).getChild(nx(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(L(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,r,i=new nB(e,t);t.isEmpty()?(n=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(n=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));let s=n.isEmpty()?h:this.priorityNode_;return new n5(n,s,r)}}updateChild(e,t){let n=nT(e);if(null===n)return t;{L(".priority"!==nT(e)||1===nS(e),".priority must be the last token in a path");let r=this.getImmediateChild(n).updateChild(nx(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,r=0,i=!0;if(this.forEachChild(nZ,(s,o)=>{t[s]=o.val(e),n++,i&&n5.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1}),e||!i||!(r<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+nY(this.getPriority().val())+":"),this.forEachChild(nZ,(t,n)=>{let r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":tV(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let r=this.resolveIndex_(n);if(!r)return this.children_.getPredecessorKey(e);{let n=r.getPredecessorKey(new nB(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new nB(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new nB(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,nB.Wrap),r=n.peek();for(;null!=r&&0>t.compare(r,e);)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,nB.Wrap),r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===n4?-1:0}withIndex(e){if(e===n$||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new n5(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===n$||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(nZ),n=e.getIterator(nZ),r=t.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i}}resolveIndex_(e){return e===n$?null:this.indexMap_.get(e.toString())}}n5.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let n4=new class extends n5{constructor(){super(new nH(nQ),n5.EMPTY_NODE,n3.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return n5.EMPTY_NODE}isEmpty(){return!1}};function n8(e,t=null){if(null===e)return n5.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),L(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new nX(e,n8(t));if(e instanceof Array){let n=n5.EMPTY_NODE;return t3(e,(t,r)=>{if(e_(e,t)&&"."!==t.substring(0,1)){let e=n8(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(n8(t))}{let n=[],r=!1;if(t3(e,(e,t)=>{if("."!==e.substring(0,1)){let i=n8(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new nB(e,i)))}}),0===n.length)return n5.EMPTY_NODE;let i=n2(n,nW,e=>e.name,nQ);if(!r)return new n5(i,n8(t),n3.Default);{let e=n2(n,nZ.getCompare());return new n5(i,n8(t),new n3({".priority":e},{".priority":nZ}))}}}Object.defineProperties(nB,{MIN:{value:new nB(tJ,n5.EMPTY_NODE)},MAX:{value:new nB(tX,n4)}}),nz.__EMPTY_NODE=n5.EMPTY_NODE,nX.__childrenNodeConstructor=n5,i=n4,a=n4,o=n8;class n7 extends nj{constructor(e){super(),this.indexPath_=e,L(!nR(e)&&".priority"!==nT(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?tZ(e.name,t.name):i}makePost(e,t){let n=n8(e);return new nB(t,n5.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new nB(tX,n5.EMPTY_NODE.updateChild(this.indexPath_,n4))}toString(){return nN(this.indexPath_,0).join("/")}}let n9=new class extends nj{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?tZ(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return nB.MIN}maxPost(){return nB.MAX}makePost(e,t){return new nB(t,n8(e))}toString(){return".value"}};function re(e){return{type:"value",snapshotNode:e}}function rt(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function rn(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function rr(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class ri{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){L(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()||(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(rn(t,o)):L(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(rt(t,n)):s.trackChildChange(rr(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(nZ,(e,r)=>{t.hasChild(e)||n.trackChildChange(rn(e,r))}),t.isLeafNode()||t.forEachChild(nZ,(t,r)=>{if(e.hasChild(t)){let i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(rr(t,r,i))}else n.trackChildChange(rt(t,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?n5.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class rs{constructor(e){this.indexedFilter_=new ri(e.getIndex()),this.index_=e.getIndex(),this.startPost_=rs.getStartPost_(e),this.endPost_=rs.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new nB(t,n))||(n=n5.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=n5.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(n5.EMPTY_NODE);let i=this;return t.forEachChild(nZ,(e,t)=>{i.matches(new nB(e,t))||(r=r.updateImmediateChild(e,n5.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class ro{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new rs(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return(this.rangedFilter_.matches(new nB(t,n))||(n=n5.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=n5.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=n5.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t))if(this.withinDirectionalEnd(t))r=r.updateImmediateChild(t.name,t.node),n++;else break}}else{let e;r=(r=t.withIndex(this.index_)).updatePriority(n5.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,n5.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();L(e.numChildren()===this.limit_,"");let o=new nB(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let h=e.getImmediateChild(t),u=r.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=u&&(u.name===t||e.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);let c=null==u?1:s(u,o);if(l&&!n.isEmpty()&&c>=0)return null!=i&&i.trackChildChange(rr(t,n,h)),e.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(rn(t,h));let n=e.updateImmediateChild(t,n5.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=i&&i.trackChildChange(rt(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:l?s(a,o)>=0?(null!=i&&(i.trackChildChange(rn(a.name,a.node)),i.trackChildChange(rt(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,n5.EMPTY_NODE)):e:e}}class ra{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=nZ}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return L(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(L(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:tJ}hasEnd(){return this.endSet_}getIndexEndValue(){return L(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(L(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:tX}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return L(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===nZ}copy(){let e=new ra;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function rl(e){let t,n={};if(e.isDefault())return n;if(e.index_===nZ?t="$priority":e.index_===n9?t="$value":e.index_===n$?t="$key":(L(e.index_ instanceof n7,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=ep(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=ep(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+ep(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=ep(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+ep(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function rh(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==nZ&&(t.i=e.index_.toString()),t}class ru extends nw{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(L(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=t$("p:rest:"),this.listens_={}}listen(e,t,n,r){let i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);let s=ru.getListenId_(e,n),o={};this.listens_[s]=o;let a=rl(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),ev(this.listens_,s)===o)&&r(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=ru.getListenId_(e,t);delete this.listens_[n]}get(e){let t=rl(e._queryParams),n=e._path.toString(),r=new Q;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=ef(o.responseText)}catch(e){tH("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&tH("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class rc{constructor(){this.rootNode_=n5.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function rd(){return{value:null,children:new Map}}function rf(e,t,n){var r,i;null!==e.value?n(t,e.value):(r=e,i=(e,r)=>{rf(r,new nC(t.toString()+"/"+e),n)},r.children.forEach((e,t)=>{i(t,e)}))}class rp{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t={...e};return this.last_&&t3(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class rg{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new rp(e);const n=1e4+2e4*Math.random();t9(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;t3(e,(e,r)=>{r>0&&e_(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),t9(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function rm(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function ry(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function r_(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(m=_||(_={}))[m.OVERWRITE=0]="OVERWRITE",m[m.MERGE=1]="MERGE",m[m.ACK_USER_WRITE=2]="ACK_USER_WRITE",m[m.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class rv{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=_.ACK_USER_WRITE,this.source=rm()}operationForChild(e){if(!nR(this.path))return L(nT(this.path)===e,"operationForChild called for unrelated child."),new rv(nx(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return L(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new nC(e));return new rv(nE(),t,this.revert)}}}class rw{constructor(e,t){this.source=e,this.path=t,this.type=_.LISTEN_COMPLETE}operationForChild(e){return nR(this.path)?new rw(this.source,nE()):new rw(this.source,nx(this.path))}}class rb{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=_.OVERWRITE}operationForChild(e){return nR(this.path)?new rb(this.source,nE(),this.snap.getImmediateChild(e)):new rb(this.source,nx(this.path),this.snap)}}class rI{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=_.MERGE}operationForChild(e){if(!nR(this.path))return L(nT(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new rI(this.source,nx(this.path),this.children);{let t=this.children.subtree(new nC(e));return t.isEmpty()?null:t.value?new rb(this.source,nE(),t.value):new rI(this.source,nE(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class rC{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(nR(e))return this.isFullyInitialized()&&!this.filtered_;let t=nT(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class rE{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function rT(e,t,n,r,i,s){let o=r.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw F("Should only compare child_ events.");let r=new nB(t.childName,t.snapshotNode),i=new nB(n.childName,n.snapshotNode);return e.index_.compare(r,i)})(e,t,n)),o.forEach(n=>{var r,o,a;let l=(r=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,r.index_)),o);i.forEach(r=>{r.respondsTo(n.type)&&t.push(r.createEvent(l,e.query_))})})}function rS(e,t){return{eventCache:e,serverCache:t}}function rx(e,t,n,r){return rS(new rC(t,n,r),e.serverCache)}function rk(e,t,n,r){return rS(e.eventCache,new rC(t,n,r))}function rN(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function rA(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}class rD{static fromObject(e){let t=new rD(null);return t3(e,(e,n)=>{t=t.set(new nC(e),n)}),t}constructor(e,t=(!u&&(u=new nH(t0)),u)){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:nE(),value:this.value};{if(nR(e))return null;let n=nT(e),r=this.children.get(n);if(null===r)return null;{let i=r.findRootMostMatchingPathAndValue(nx(e),t);return null!=i?{path:nD(new nC(n),i.path),value:i.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(nR(e))return this;{let t=nT(e),n=this.children.get(t);return null!==n?n.subtree(nx(e)):new rD(null)}}set(e,t){if(nR(e))return new rD(t,this.children);{let n=nT(e),r=(this.children.get(n)||new rD(null)).set(nx(e),t),i=this.children.insert(n,r);return new rD(this.value,i)}}remove(e){if(nR(e))if(this.children.isEmpty())return new rD(null);else return new rD(null,this.children);{let t=nT(e),n=this.children.get(t);if(!n)return this;{let r,i=n.remove(nx(e));return(r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty())?new rD(null):new rD(this.value,r)}}}get(e){if(nR(e))return this.value;{let t=nT(e),n=this.children.get(t);return n?n.get(nx(e)):null}}setTree(e,t){if(nR(e))return t;{let n,r=nT(e),i=(this.children.get(r)||new rD(null)).setTree(nx(e),t);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new rD(this.value,n)}}fold(e){return this.fold_(nE(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(nD(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,nE(),t)}findOnPath_(e,t,n){let r=!!this.value&&n(t,this.value);if(r)return r;{if(nR(e))return null;let r=nT(e),i=this.children.get(r);return i?i.findOnPath_(nx(e),nD(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,nE(),t)}foreachOnPath_(e,t,n){if(nR(e))return this;{this.value&&n(t,this.value);let r=nT(e),i=this.children.get(r);return i?i.foreachOnPath_(nx(e),nD(t,r),n):new rD(null)}}foreach(e){this.foreach_(nE(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(nD(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class rR{constructor(e){this.writeTree_=e}static empty(){return new rR(new rD(null))}}function rP(e,t,n){if(nR(t))return new rR(new rD(n));{let r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){let i=r.path,s=r.value,o=nP(i,t);return s=s.updateChild(o,n),new rR(e.writeTree_.set(i,s))}{let r=new rD(n);return new rR(e.writeTree_.setTree(t,r))}}}function rO(e,t,n){let r=e;return t3(n,(e,n)=>{r=rP(r,nD(t,e),n)}),r}function rM(e,t){return nR(t)?rR.empty():new rR(e.writeTree_.setTree(t,new rD(null)))}function rL(e,t){return null!=rF(e,t)}function rF(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(nP(n.path,t)):null}function rV(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(nZ,(e,n)=>{t.push(new nB(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new nB(e,n.value))}),t}function rq(e,t){if(nR(t))return e;{let n=rF(e,t);return new rR(null!=n?new rD(n):e.writeTree_.subtree(t))}}function rU(e){return e.writeTree_.isEmpty()}function rB(e,t){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);{let i=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(L(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):r=e(nD(t,n),s,r)}),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(nD(t,".priority"),i)),r}}(nE(),e.writeTree_,t)}function rj(e){return e.visible}function rz(e,t,n){let r=rR.empty();for(let i=0;i<e.length;++i){let s=e[i];if(t(s)){let e,t=s.path;if(s.snap)nM(n,t)?r=rP(r,e=nP(n,t),s.snap):nM(t,n)&&(e=nP(t,n),r=rP(r,nE(),s.snap.getChild(e)));else if(s.children){if(nM(n,t))r=rO(r,e=nP(n,t),s.children);else if(nM(t,n))if(nR(e=nP(t,n)))r=rO(r,nE(),s.children);else{let t=ev(s.children,nT(e));if(t){let n=t.getChild(nx(e));r=rP(r,nE(),n)}}}else throw F("WriteRecord should have .snap or .children")}}return r}function r$(e,t,n,r,i){if(r||i){let s=rq(e.visibleWrites,t);return!i&&rU(s)?n:i||null!=n||rL(s,nE())?rB(rz(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(nM(e.path,t)||nM(t,e.path))},t),n||n5.EMPTY_NODE):null}{let r=rF(e.visibleWrites,t);if(null!=r)return r;{let r=rq(e.visibleWrites,t);return rU(r)?n:null!=n||rL(r,nE())?rB(r,n||n5.EMPTY_NODE):null}}}function rK(e,t,n,r){return r$(e.writeTree,e.treePath,t,n,r)}function rG(e,t){return function(e,t,n){let r=n5.EMPTY_NODE,i=rF(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(nZ,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(!n)return rV(rq(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r;{let i=rq(e.visibleWrites,t);return n.forEachChild(nZ,(e,t)=>{let n=rB(rq(i,new nC(e)),t);r=r.updateImmediateChild(e,n)}),rV(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}}(e.writeTree,e.treePath,t)}function rH(e,t,n,r){return function(e,t,n,r,i){L(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=nD(t,n);if(rL(e.visibleWrites,s))return null;{let t=rq(e.visibleWrites,s);return rU(t)?i.getChild(n):rB(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function rW(e,t){var n,r;return n=e.writeTree,r=nD(e.treePath,t),rF(n.visibleWrites,r)}function rQ(e,t,n){var r,i;let s,o;return r=e.writeTree,i=e.treePath,s=nD(i,t),null!=(o=rF(r.visibleWrites,s))?o:n.isCompleteForChild(t)?rB(rq(r.visibleWrites,s),n.getNode().getImmediateChild(t)):null}function rY(e,t){return rJ(nD(e.treePath,t),e.writeTree)}function rJ(e,t){return{treePath:e,writeTree:t}}class rX{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;L("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),L(".priority"!==n,"Only non-priority child changes can be tracked.");let r=this.changeMap.get(n);if(r){let i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,rr(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,rn(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,rt(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===i)this.changeMap.set(n,rr(n,e.snapshotNode,r.oldSnap));else throw F("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}let rZ=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class r0{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new rC(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return rQ(this.writes_,e,t)}}getChildAfterChild(e,t,n){var r;let i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:rA(this.viewCache_),s=(r=this.writes_,function(e,t,n,r,i,s,o){let a,l=rq(e.visibleWrites,t),h=rF(l,nE());if(null!=h)a=h;else{if(null==n)return[];a=rB(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),i=n.getNext();for(;i&&e.length<1;)0!==t(i,r)&&e.push(i),i=n.getNext();return e}}(r.writeTree,r.treePath,i,t,1,n,e));return 0===s.length?null:s[0]}}function r1(e,t,n,r,i,s){let o=t.eventCache;if(null!=rW(r,n))return t;{let a,l;if(nR(n))if(L(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=rA(t),i=rG(r,n instanceof n5?n:n5.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{let n=rK(r,rA(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=nT(n);if(".priority"===h){L(1===nS(n),"Can't have a priority with additional path components");let i=o.getNode(),s=rH(r,n,i,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{let u,c=nx(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=rH(r,n,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(h).updateChild(c,e):o.getNode().getImmediateChild(h)}else u=rQ(r,h,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),h,u,c,i,s):o.getNode()}}return rx(t,a,o.isFullyInitialized()||nR(n),e.filter.filtersNodes())}}function r2(e,t,n,r,i,s,o,a){let l,h=t.serverCache,u=o?e.filter:e.filter.getIndexedFilter();if(nR(n))l=u.updateFullNode(h.getNode(),r,null);else if(u.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,r);l=u.updateFullNode(h.getNode(),e,null)}else{let e=nT(n);if(!h.isCompleteForPath(n)&&nS(n)>1)return t;let i=nx(n),s=h.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?u.updatePriority(h.getNode(),s):u.updateChild(h.getNode(),e,s,i,rZ,null)}let c=rk(t,l,h.isFullyInitialized()||nR(n),u.filtersNodes()),d=new r0(i,c,s);return r1(e,c,n,i,d,a)}function r6(e,t,n,r,i,s,o){let a,l,h=t.eventCache,u=new r0(i,t,s);if(nR(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),a=rx(t,l,!0,e.filter.filtersNodes());else{let i=nT(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),a=rx(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=nx(n),c=h.getNode().getImmediateChild(i);if(nR(l))s=r;else{let e=u.getCompleteChild(i);s=null!=e?".priority"===nk(l)&&e.getChild(nA(l)).isEmpty()?e:e.updateChild(l,r):n5.EMPTY_NODE}a=c.equals(s)?t:rx(t,e.filter.updateChild(h.getNode(),i,s,l,u,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function r3(e,t){return e.eventCache.isCompleteForChild(t)}function r5(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function r4(e,t,n,r,i,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=nR(n)?r:new rD(null).setTree(n,r);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){let l=r5(e,t.serverCache.getNode().getImmediateChild(n),r);h=r2(e,h,new nC(n),l,i,s,o,a)}}),l.children.inorderTraversal((n,r)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!u.hasChild(n)&&!l){let l=r5(e,t.serverCache.getNode().getImmediateChild(n),r);h=r2(e,h,new nC(n),l,i,s,o,a)}}),h}class r8{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new ri(n.getIndex()),i=function(e){return e.loadsAllData()?new ri(e.getIndex()):e.hasLimit()?new ro(e):new rs(e)}(n);this.processor_={filter:i};const s=t.serverCache,o=t.eventCache,a=r.updateFullNode(n5.EMPTY_NODE,s.getNode(),null),l=i.updateFullNode(n5.EMPTY_NODE,o.getNode(),null),h=new rC(a,s.isFullyInitialized(),r.filtersNodes()),u=new rC(l,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=rS(u,h),this.eventGenerator_=new rE(this.query_)}get query(){return this.query_}}function r7(e){return 0===e.eventRegistrations_.length}function r9(e,t,n){let r=[];if(n){L(null==t,"A cancel should cancel all event registrations.");let i=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,i);t&&r.push(t)})}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){let i=e.eventRegistrations_[r];if(i.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}else n.push(i)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function ie(e,t,n,r){var i,s;t.type===_.MERGE&&null!==t.source.queryId&&(L(rA(e.viewCache_),"We should always have a full cache before handling merges"),L(rN(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,r,i){var s,o,a,l,h,u,c,d,f,p,g,m;let y,v,w=new rX;if(n.type===_.OVERWRITE)n.source.fromUser?y=r6(e,t,n.path,n.snap,r,i,w):(L(n.source.fromServer,"Unknown source."),v=n.source.tagged||t.serverCache.isFiltered()&&!nR(n.path),y=r2(e,t,n.path,n.snap,r,i,v,w));else if(n.type===_.MERGE){let d;n.source.fromUser?(s=e,o=t,a=n.path,l=n.children,h=r,u=i,c=w,d=o,l.foreach((e,t)=>{let n=nD(a,e);r3(o,nT(n))&&(d=r6(s,d,n,t,h,u,c))}),l.foreach((e,t)=>{let n=nD(a,e);r3(o,nT(n))||(d=r6(s,d,n,t,h,u,c))}),y=d):(L(n.source.fromServer,"Unknown source."),v=n.source.tagged||t.serverCache.isFiltered(),y=r4(e,t,n.path,n.children,r,i,v,w))}else if(n.type===_.ACK_USER_WRITE)y=n.revert?function(e,t,n,r,i,s){let o;if(null!=rW(r,n))return t;{let a,l=new r0(r,t,i),h=t.eventCache.getNode();if(nR(n)||".priority"===nT(n)){let n;if(t.serverCache.isFullyInitialized())n=rK(r,rA(t));else{let e=t.serverCache.getNode();L(e instanceof n5,"serverChildren would be complete if leaf node"),n=rG(r,e)}a=e.filter.updateFullNode(h,n,s)}else{let i=nT(n),u=rQ(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=h.getImmediateChild(i)),(a=null!=u?e.filter.updateChild(h,i,u,nx(n),l,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(h,i,n5.EMPTY_NODE,nx(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=rK(r,rA(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=rW(r,nE()),rx(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,r,i,w):function(e,t,n,r,i,s,o){if(null!=rW(i,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value)if(nR(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return r2(e,t,n,l.getNode().getChild(n),i,s,a,o);else{if(!nR(n))return t;let r=new rD(null);return l.getNode().forEachChild(n$,(e,t)=>{r=r.set(new nC(e),t)}),r4(e,t,n,r,i,s,a,o)}{let h=new rD(null);return r.foreach((e,t)=>{let r=nD(n,e);l.isCompleteForPath(r)&&(h=h.set(e,l.getNode().getChild(r)))}),r4(e,t,n,h,i,s,a,o)}}(e,t,n.path,n.affectedTree,r,i,w);else if(n.type===_.LISTEN_COMPLETE){let i;d=e,f=t,p=n.path,g=r,m=w,i=f.serverCache,y=r1(d,rk(f,i.getNode(),i.isFullyInitialized()||nR(p),i.isFiltered()),p,g,rZ,m)}else throw F("Unknown operation type: "+n.type);let b=w.getChanges();return function(e,t,n){let r=t.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=rN(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!i||r.getNode().equals(s))&&r.getNode().getPriority().equals(s.getPriority())||n.push(re(rN(t)))}}(t,y,b),{viewCache:y,changes:b}}(e.processor_,o,t,n,r);return i=e.processor_,L((s=a.viewCache).eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),L(s.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),L(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,it(e,a.changes,a.viewCache.eventCache.getNode(),null)}function it(e,t,n,r){var i;let s,o,a=r?[r]:e.eventRegistrations_;return i=e.eventGenerator_,s=[],o=[],t.forEach(e=>{var t;"child_changed"===e.type&&i.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),rT(i,s,"child_removed",t,a,n),rT(i,s,"child_added",t,a,n),rT(i,s,"child_moved",o,a,n),rT(i,s,"child_changed",t,a,n),rT(i,s,"value",t,a,n),s}class ir{constructor(){this.views=new Map}}function ii(e,t,n,r){let i=t.source.queryId;if(null!==i){let s=e.views.get(i);return L(null!=s,"SyncTree gave us an op for an invalid query."),ie(s,t,n,r)}{let i=[];for(let s of e.views.values())i=i.concat(ie(s,t,n,r));return i}}function is(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function io(e,t){let n=null;for(let r of e.views.values())n=n||function(e,t){let n=rA(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!nR(t)&&!n.getImmediateChild(nT(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function ia(e,t){if(t._queryParams.loadsAllData())return ih(e);{let n=t._queryIdentifier;return e.views.get(n)}}function il(e){return null!=ih(e)}function ih(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let iu=1;class ic{constructor(e){this.listenProvider_=e,this.syncPointTree_=new rD(null),this.pendingWriteTree_={visibleWrites:rR.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function id(e,t,n=!1){let r=function(e,t){for(let n=0;n<e.allWrites.length;n++){let r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let r=e.allWrites.findIndex(e=>e.writeId===t);L(r>=0,"removeWrite called with nonexistent writeId.");let i=e.allWrites[r];e.allWrites.splice(r,1);let s=i.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=r&&function(e,t){if(e.snap)return nM(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&nM(nD(e.path,n),t))return!0;return!1}(t,i.path)?s=!1:nM(i.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=rz(n.allWrites,rj,nE()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):i.snap?e.visibleWrites=rM(e.visibleWrites,i.path):t3(i.children,t=>{e.visibleWrites=rM(e.visibleWrites,nD(i.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new rD(null);return null!=r.snap?t=t.set(nE(),!0):t3(r.children,e=>{t=t.set(new nC(e),!0)}),i_(e,new rv(r.path,t,n))}}function ip(e,t,n){return i_(e,new rb(ry(),t,n))}function ig(e,t,n,r,i=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=ia(o,t))){let u=function(e,t,n,r){let i=t._queryIdentifier,s=[],o=[],a=il(e);if("default"===i)for(let[t,i]of e.views.entries())o=o.concat(r9(i,n,r)),r7(i)&&(e.views.delete(t),i.query._queryParams.loadsAllData()||s.push(i.query));else{let t=e.views.get(i);t&&(o=o.concat(r9(t,n,r)),r7(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!il(e)&&s.push(new(L(c,"Reference.ts has not been loaded"),c)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let d=u.removed;if(a=u.events,!i){let n=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),i=e.syncPointTree_.findOnPath(s,(e,t)=>il(t));if(n&&!i){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&il(t))return[ih(t)];{let e=[];return t&&(e=is(t)),t3(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let r=n[t],i=r.query,s=iv(e,r);e.listenProvider_.startListening(iT(i),iw(e,i),s.hashFn,s.onComplete)}}}i||!(d.length>0)||r||(n?e.listenProvider_.stopListening(iT(t),null):d.forEach(t=>{let n=e.queryToTagMap.get(ib(t));e.listenProvider_.stopListening(iT(t),n)}))}var l=e,h=d;for(let e=0;e<h.length;++e){let t=h[e];if(!t._queryParams.loadsAllData()){let e=ib(t),n=l.queryToTagMap.get(e);l.queryToTagMap.delete(e),l.tagToQueryMap.delete(n)}}}return a}function im(e,t,n,r=!1){var i;let s,o,a,l,h=t._path,u=null,c=!1;e.syncPointTree_.foreachOnPath(h,(e,t)=>{let n=nP(e,h);u=u||io(t,n),c=c||il(t)});let d=e.syncPointTree_.get(h);d?(c=c||il(d),u=u||io(d,nE())):(d=new ir,e.syncPointTree_=e.syncPointTree_.set(h,d)),null!=u?s=!0:(s=!1,u=n5.EMPTY_NODE,e.syncPointTree_.subtree(h).foreachChild((e,t)=>{let n=io(t,nE());n&&(u=u.updateImmediateChild(e,n))}));let f=null!=ia(d,t);if(!f&&!t._queryParams.loadsAllData()){let n=ib(t);L(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let r=iu++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let p=rJ(h,e.pendingWriteTree_),g=(o=function(e,t,n,r,i){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=rK(n,i?r:null),s=!1;return e?s=!0:(e=r instanceof n5?rG(n,r):n5.EMPTY_NODE,s=!1),new r8(t,rS(new rC(e,s,!1),new rC(r,i,!1)))}return o}(i=d,t,p,u,s),i.views.has(t._queryIdentifier)||i.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),a=o.viewCache_.eventCache,l=[],a.getNode().isLeafNode()||a.getNode().forEachChild(nZ,(e,t)=>{l.push(rt(e,t))}),a.isFullyInitialized()&&l.push(re(a.getNode())),it(o,l,a.getNode(),n));if(!f&&!c&&!r){let n=ia(d,t);g=g.concat(function(e,t,n){let r=t._path,i=iw(e,t),s=iv(e,n),o=e.listenProvider_.startListening(iT(t),i,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(r);if(i)L(!il(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!nR(e)&&t&&il(t))return[ih(t).query];{let e=[];return t&&(e=e.concat(is(t).map(e=>e.query))),t3(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let r=t[n];e.listenProvider_.stopListening(iT(r),iw(e,r))}}return o}(e,t,n))}return g}function iy(e,t,n){let r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{let r=io(n,nP(e,t));if(r)return r});return r$(r,t,i,n,!0)}function i_(e,t){var n;return function e(t,n,r,i){if(nR(t.path))return function e(t,n,r,i){let s=n.get(nE());null==r&&null!=s&&(r=io(s,nE()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=r?r.getImmediateChild(n):null,l=rY(i,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(ii(s,t,i,r))),o}(t,n,r,i);{let s=n.get(nE());null==r&&null!=s&&(r=io(s,nE()));let o=[],a=nT(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=r?r.getImmediateChild(a):null,n=rY(i,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(ii(s,t,i,r))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,rJ(nE(),n)))}function iv(e,t){let n=t.query,r=iw(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||n5.EMPTY_NODE).hash(),onComplete:t=>{var i;if("ok"===t)if(r)return function(e,t,n){let r=iI(e,n);if(!r)return[];{let n=iC(r),i=n.path,s=n.queryId,o=nP(i,t);return iE(e,i,new rw(r_(s),o))}}(e,n._path,r);else return i=n._path,i_(e,new rw(ry(),i));{let r,i,s=(r="Unknown Error","too_big"===t?r="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?r="Client doesn't have permission to access the desired data.":"unavailable"===t&&(r="The service is unavailable"),(i=Error(t+" at "+n._path.toString()+": "+r)).code=t.toUpperCase(),i);return ig(e,n,null,s)}}}}function iw(e,t){let n=ib(t);return e.queryToTagMap.get(n)}function ib(e){return e._path.toString()+"$"+e._queryIdentifier}function iI(e,t){return e.tagToQueryMap.get(t)}function iC(e){let t=e.indexOf("$");return L(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new nC(e.substr(0,t))}}function iE(e,t,n){let r=e.syncPointTree_.get(t);return L(r,"Missing sync point for query tag that we're tracking"),ii(r,n,rJ(t,e.pendingWriteTree_),null)}function iT(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(L(d,"Reference.ts has not been loaded"),d)(e._repo,e._path):e}class iS{constructor(e){this.node_=e}getImmediateChild(e){return new iS(this.node_.getImmediateChild(e))}node(){return this.node_}}class ix{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=nD(this.path_,e);return new ix(this.syncTree_,t)}node(){return iy(this.syncTree_,this.path_)}}let ik=function(e,t,n){return e&&"object"==typeof e?(L(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?iN(e[".sv"],t,n):"object"==typeof e[".sv"]?iA(e[".sv"],t):void L(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},iN=function(e,t,n){if("timestamp"===e)return n.timestamp;L(!1,"Unexpected server value: "+e)},iA=function(e,t,n){e.hasOwnProperty("increment")||L(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let r=e.increment;"number"!=typeof r&&L(!1,"Unexpected increment value: "+r);let i=t.node();if(L(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let s=i.getValue();return"number"!=typeof s?r:s+r};function iD(e,t,n){let r,i=ik(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return r=e,i!==e.getPriority().val()&&(r=r.updatePriority(new nX(i))),e.forEachChild(nZ,(e,i)=>{let s=iD(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))}),r;{let r=ik(e.getValue(),t,n);return r!==e.getValue()||i!==e.getPriority().val()?new nX(r,n8(i)):e}}class iR{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function iP(e,t){let n=t instanceof nC?t:new nC(t),r=e,i=nT(n);for(;null!==i;){let e=ev(r.node.children,i)||{children:{},childCount:0};r=new iR(i,r,e),i=nT(n=nx(n))}return r}function iO(e){return e.node.value}function iM(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,r){let i=void 0===iO(r)&&!iL(r),s=e_(t.node.children,n);i&&s?(delete t.node.children[n],t.node.childCount--,e(t)):i||s||(t.node.children[n]=r.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function iL(e){return e.node.childCount>0}function iF(e,t){t3(e.node.children,(n,r)=>{t(new iR(n,e,r))})}function iV(e){return new nC(null===e.parent?e.name:iV(e.parent)+"/"+e.name)}let iq=/[\[\].#$\/\u0000-\u001F\u007F]/,iU=/[\[\].#$\u0000-\u001F\u007F]/,iB=function(e){return"string"==typeof e&&0!==e.length&&!iq.test(e)},ij=function(e){return"string"==typeof e&&0!==e.length&&!iU.test(e)},iz=function(e,t,n){let r=n instanceof nC?new nL(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+nV(r));if("function"==typeof t)throw Error(e+"contains a function "+nV(r)+" with contents = "+t.toString());if(tQ(t))throw Error(e+"contains "+t.toString()+" "+nV(r));if("string"==typeof t&&t.length>3495253.3333333335&&ex(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+nV(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(t3(t,(t,s)=>{let o;if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!iB(t)))throw Error(e+" contains an invalid key ("+t+") "+nV(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(t),r.byteLength_+=ex(t),nF(r),iz(e,s,r),o=r.parts_.pop(),r.byteLength_-=ex(o),r.parts_.length>0&&(r.byteLength_-=1)}),n&&i)throw Error(e+' contains ".value" child '+nV(r)+" in addition to actual children.")}},i$=function(e,t,n,r){if((!r||void 0!==n)&&!ij(n))throw Error(eT(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},iK=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),i$(e,t,n,r)},iG=function(e,t){var n;let r=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!iB(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==r.length&&((n=r)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!ij(n)))throw Error(eT(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class iH{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function iW(e,t){let n=null;for(let r=0;r<t.length;r++){let i=t[r],s=i.getPath();null===n||nO(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function iQ(e,t,n){iW(e,n),iJ(e,e=>nO(e,t))}function iY(e,t,n){iW(e,n),iJ(e,e=>nM(e,t)||nM(t,e))}function iJ(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){let i=e.eventLists_[r];i&&(t(i.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let r=n.getEventRunner();tU&&tz("event: "+n.toString()),t7(r)}}}(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}class iX{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new iH,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=rd(),this.transactionQueueTree_=new iR,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function iZ(e){var t;let n;return(t=t={timestamp:(n=e.infoData_.getNode(new nC(".info/serverTimeOffset")).val()||0,new Date().getTime()+n)}).timestamp=t.timestamp||new Date().getTime(),t}function i0(e,t,n,r,i){e.dataUpdateCount++;let s=new nC(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){let t=eb(n,e=>n8(e));o=function(e,t,n,r){let i=iI(e,r);if(!i)return[];{let r=iC(i),s=r.path,o=r.queryId,a=nP(s,t),l=rD.fromObject(n);return iE(e,s,new rI(r_(o),a,l))}}(e.serverSyncTree_,s,t,i)}else{let t=n8(n);o=function(e,t,n,r){let i=iI(e,r);if(null==i)return[];{let r=iC(i),s=r.path,o=r.queryId,a=nP(s,t);return iE(e,s,new rb(r_(o),a,n))}}(e.serverSyncTree_,s,t,i)}else if(r){var a;let t,r=eb(n,e=>n8(e));a=e.serverSyncTree_,t=rD.fromObject(r),o=i_(a,new rI(ry(),s,t))}else{let t=n8(n);o=ip(e.serverSyncTree_,s,t)}let l=s;o.length>0&&(l=i4(e,s)),iY(e.eventQueue_,l,o)}function i1(e,t){var n;let r,i,s;i2(e,"connected",t),!1===t&&(i3(n=e,"onDisconnectEvents"),r=iZ(n),i=rd(),rf(n.onDisconnect_,nE(),(e,t)=>{var s;let o=(s=n.serverSyncTree_,iD(t,new ix(s,e),r));!function e(t,n,r){if(nR(n))t.value=r,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(n,r);else{let i=nT(n);t.children.has(i)||t.children.set(i,rd()),e(t.children.get(i),n=nx(n),r)}}(i,e,o)}),s=[],rf(i,nE(),(e,t)=>{var r,i;let o,a;s=s.concat(ip(n.serverSyncTree_,e,t));let l=(o=iV(i8(r=n,i=e)),!function(e,t,n){let r=e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(a=iP(r.transactionQueueTree_,i),e=>{se(r,e)}),se(r,a),!function e(t,n,r,i){r&&!i&&n(t),iF(t,t=>{e(t,n,!0,i)}),r&&i&&n(t)}(a,e=>{se(r,e)}),o);i4(n,l)}),n.onDisconnect_=rd(),iY(n.eventQueue_,nE(),s))}function i2(e,t,n){let r=new nC("/.info/"+t),i=n8(n);e.infoData_.updateSnapshot(r,i);let s=ip(e.infoSyncTree_,r,i);iY(e.eventQueue_,r,s)}function i6(e,t,n){let r;r=".info"===nT(t._path)?ig(e.infoSyncTree_,t,n):ig(e.serverSyncTree_,t,n),iQ(e.eventQueue_,t._path,r)}function i3(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),tz(n,...t)}function i5(e,t,n){return iy(e.serverSyncTree_,t,n)||n5.EMPTY_NODE}function i4(e,t){let n=i8(e,t),r=iV(n),i=i7(e,n);return function(e,t,n){if(0===t.length)return;let r=[],i=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=nP(n,a.path),h=!1,u;if(L(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,u=a.abortReason,i=i.concat(id(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)h=!0,u="maxretry",i=i.concat(id(e.serverSyncTree_,a.currentWriteId,!0));else{let n=i5(e,a.path,s);a.currentInputSnapshot=n;let r=t[o].update(n.val());if(void 0!==r){iz("transaction failed: Data returned ",r,a.path);let t=n8(r);"object"==typeof r&&null!=r&&e_(r,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=iZ(e),h=iD(t,new iS(n),l);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=h,a.currentWriteId=e.nextWriteId_++,s.splice(s.indexOf(o),1),i=(i=i.concat(function(e,t,n,r,i){var s,o;return(s=e.pendingWriteTree_,o=i,L(r>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:r,visible:o}),o&&(s.visibleWrites=rP(s.visibleWrites,t,n)),s.lastWriteId=r,i)?i_(e,new rb(rm(),t,n)):[]}(e.serverSyncTree_,a.path,h,a.currentWriteId,a.applyLocally))).concat(id(e.serverSyncTree_,o,!0))}else h=!0,u="nodata",i=i.concat(id(e.serverSyncTree_,a.currentWriteId,!0))}iY(e.eventQueue_,n,i),i=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===u?r.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):r.push(()=>t[o].onComplete(Error(u),!1,null))))}i9(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)t7(r[e]);!function e(t,n=t.transactionQueueTree_){if(n||i9(t,n),iO(n)){let r=i7(t,n);L(r.length>0,"Sending zero length transaction queue"),r.every(e=>0===e.status)&&function(t,n,r){let i=i5(t,n,r.map(e=>e.currentWriteId)),s=i,o=i.hash();for(let e=0;e<r.length;e++){let t=r[e];L(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let i=nP(n,t.path);s=s.updateChild(i,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,i=>{i3(t,"transaction put response",{path:n.toString(),status:i});let s=[];if("ok"===i){let i=[];for(let e=0;e<r.length;e++)r[e].status=2,s=s.concat(id(t.serverSyncTree_,r[e].currentWriteId)),r[e].onComplete&&i.push(()=>r[e].onComplete(null,!0,r[e].currentOutputSnapshotResolved)),r[e].unwatcher();i9(t,iP(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),iY(t.eventQueue_,n,s);for(let e=0;e<i.length;e++)t7(i[e])}else{if("datastale"===i)for(let e=0;e<r.length;e++)3===r[e].status?r[e].status=4:r[e].status=0;else{tH("transaction at "+n.toString()+" failed: "+i);for(let e=0;e<r.length;e++)r[e].status=4,r[e].abortReason=i}i4(t,n)}},o)}(t,iV(n),r)}else iL(n)&&iF(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,i,r),r}function i8(e,t){let n,r=e.transactionQueueTree_;for(n=nT(t);null!==n&&void 0===iO(r);)r=iP(r,n),n=nT(t=nx(t));return r}function i7(e,t){let n=[];return function e(t,n,r){let i=iO(n);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);iF(n,n=>{e(t,n,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function i9(e,t){let n=iO(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,iM(t,n.length>0?n:void 0)}iF(t,t=>{i9(e,t)})}function se(e,t){let n=iO(t);if(n){let r=[],i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(L(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(L(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(id(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?iM(t,void 0):n.length=s+1,iY(e.eventQueue_,iV(t),i);for(let e=0;e<r.length;e++)t7(r[e])}}let st=function(e,t){let n=sn(e),r=n.namespace;"firebase.com"===n.domain&&tG(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||tG("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||tW();let i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new no(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new nC(n.pathString)}},sn=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let u=e.indexOf("/");-1===u&&(u=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(u,c)),u<c&&(i=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(u,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):tH(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let f=t.slice(0,h);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{let e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};class sr{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ep(this.snapshot.exportVal())}}class si{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class ss{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return L(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class so{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return nR(this._path)?null:nk(this._path)}get ref(){return new sa(this._repo,this._path)}get _queryIdentifier(){let e=t2(rh(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return rh(this._queryParams)}isEqual(e){if(!((e=ek(e))instanceof so))return!1;let t=this._repo===e._repo,n=nO(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class sa extends so{constructor(e,t){super(e,t,new ra,!1)}get parent(){let e=nA(this._path);return null===e?null:new sa(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class sl{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new nC(e),n=sh(this.ref,e);return new sl(this._node.getChild(t),n,nZ)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new sl(n,sh(this.ref,t),nZ)))}hasChild(e){let t=new nC(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function sh(e,t){return null===nT((e=ek(e))._path)?iK("child","path",t,!1):i$("child","path",t,!1),new sa(e._repo,nD(e._path,t))}class su{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new sr("value",this,new sl(e.snapshotNode,new sa(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new si(this,e,t):null}matches(e){return e instanceof su&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class sc{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new si(this,e,t):null}createEvent(e,t){L(null!=e.childName,"Child events should have a childName.");let n=sh(new sa(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new sr(e.type,this,new sl(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof sc&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}L(!c,"__referenceConstructor has already been defined"),c=sa,L(!d,"__referenceConstructor has already been defined"),d=sa;let sd={};class sf{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){var r;let i;if(e.stats_=nc(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new ru(e.repoInfo_,(t,n,r,i)=>{i0(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>i1(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{ep(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new nU(e.repoInfo_,t,(t,n,r,i)=>{i0(e,t,n,r,i)},t=>{i1(e,t)},t=>{var n;n=e,t3(t,(e,t)=>{i2(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),r=e.repoInfo_,nu[i=r.toString()]||(nu[i]=(()=>new rg(e.stats_,e.server_))()),e.statsReporter_=nu[i],e.infoData_=new rc,e.infoSyncTree_=new ic({startListening:(t,n,r,i)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=ip(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),i2(e,"connected",!1),e.serverSyncTree_=new ic({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{let s=i(n,r);iY(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new sa(this._repo,nE())),this._rootInternal}_delete(){if(null!==this._rootInternal){var e,t;let n;e=this._repo,(n=sd[t=this.app.name])&&n[e.key]===e||tG(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&tG("Cannot call "+e+" on a deleted database.")}}nU.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},nU.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},tA=th,e7(new eN("database",(e,{instanceIdentifier:t})=>{var n,r,i,s;let o,a,l,h,u,c,d,f=e.getProvider("app").getImmediate(),p=e.getProvider("auth-internal"),g=e.getProvider("app-check-internal");return void 0===(l=t||f.options.databaseURL)&&(f.options.projectId||tG("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),tz("Using default host for project ",f.options.projectId),l=`${f.options.projectId}-default-rtdb.firebaseio.com`),u=(h=st(l,void 0)).repoInfo,void 0!==M.default&&M.default.env&&(c=M.default.env.FIREBASE_DATABASE_EMULATOR_HOST),c?u=(h=st(l=`http://${c}?ns=${u.namespace}`,void 0)).repoInfo:!h.repoInfo.secure,d=new nt(f.name,f.options,p),iG("Invalid Firebase Database URL",h),nR(h.path)||tG("Database URL must point to the root of a Firebase Database (not including a child path)."),new sf((n=u,r=f,i=d,s=new ne(f,g),(o=sd[r.name])||(o={},sd[r.name]=o),(a=o[n.toURLString()])&&tG("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new iX(n,!1,i,s),o[n.toURLString()]=a,a),f)},"PUBLIC").setMultipleInstances(!0)),tg(tk,tN,void 0),tg(tk,tN,"esm2020"),tg("firebase","12.8.0","app"),e.i(26449);var sp=e.i(29328),sg="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,sm={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function n(){}function r(e,t,n){n||(n=0);let r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let s=e.g[3],o;o=t+(s^n&(i^s))+r[0]+0xd76aa478|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[1]+0xe8c7b756|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[2]+0x242070db|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[3]+0xc1bdceee|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[4]+0xf57c0faf|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[5]+0x4787c62a|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[6]+0xa8304613|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[7]+0xfd469501|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[8]+0x698098d8|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[9]+0x8b44f7af|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[10]+0xffff5bb1|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[11]+0x895cd7be|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[12]+0x6b901122|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[13]+0xfd987193|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[14]+0xa679438e|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(o<<22|o>>>10),o=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,o=t+((n=i+(o<<20|o>>>12))^i^s)+r[5]+0xfffa3942|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[8]+0x8771f681|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[11]+0x6d9d6122|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[14]+0xfde5380c|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[1]+0xa4beea44|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[4]+0x4bdecfa9|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[7]+0xf6bb4b60|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[10]+0xbebfbc70|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[13]+0x289b7ec6|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[0]+0xeaa127fa|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[3]+0xd4ef3085|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[6]+0x4881d05|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[9]+0xd9d4d039|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[12]+0xe6db99e5|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[15]+0x1fa27cf8|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(o<<23|o>>>9),o=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(o<<21|o>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let n=[],r=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let n=t-this.blockSize,i=this.C,s=this.h,o=0;for(;o<t;){if(0==s)for(;o<=n;)r(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){r(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var s,o={};function a(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(o,e)?o[e]:o[e]=t(e)):new i([0|e],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return h;if(e<0)return p(l(-e));let t=[],n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new i(t,0)}var h=a(0),u=a(1),c=a(0x1000000);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function p(e){let t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(u)}function g(e,t){return e.add(p(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function _(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(h,h);if(f(e))return t=_(p(e),t),new y(p(t.g),p(t.h));if(f(t))return t=_(e,p(t)),new y(p(t.g),t.h);if(e.g.length>30){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,r=t;0>=r.l(e);)n=b(n),r=b(r);var i=I(n,1),s=I(r,1);for(r=I(r,2),n=I(n,2);!d(r);){var o=s.add(r);0>=o.l(e)&&(i=i.add(n),s=o),r=I(r,1),n=I(n,1)}return t=g(e,i.j(t)),new y(i,t)}for(i=h;e.l(t)>=0;){for(r=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,r-48),o=(s=l(n)).j(t);f(o)||o.l(e)>0;)n-=r,o=(s=l(n)).j(t);d(s)&&(s=u),i=i.add(s),e=g(e,o)}return new y(i,e)}function b(e){let t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function I(e,t){let n=t>>5;t%=32;let r=e.g.length-n,s=[];for(let i=0;i<r;i++)s[i]=t>0?e.i(i+n)>>>t|e.i(i+n+1)<<32-t:e.i(i+n);return new i(s,e.h)}(s=i.prototype).m=function(){if(f(this))return-p(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){let r=this.i(n);e+=(r>=0?r:0x100000000+r)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+p(this).toString(e);let t=l(Math.pow(e,6));var n=this;let r="";for(;;){let i=_(n,t).g,s=(((n=g(n,i.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(d(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return f(e=g(this,e))?-1:+!d(e)},s.abs=function(){return f(this)?p(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),n=[],r=0;for(let i=0;i<=t;i++){let t=r+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=s>>>16,t&=65535,s&=65535,n[i]=s<<16|t}return new i(n,-0x80000000&n[n.length-1]?-1:0)},s.j=function(e){if(d(this)||d(e))return h;if(f(this))return f(e)?p(this).j(p(e)):p(p(this).j(e));if(f(e))return p(this.j(p(e)));if(0>this.l(c)&&0>e.l(c))return l(this.m()*e.m());let t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){let i=this.i(r)>>>16,s=65535&this.i(r),o=e.i(t)>>>16,a=65535&e.i(t);n[2*r+2*t]+=s*a,m(n,2*r+2*t),n[2*r+2*t+1]+=i*a,m(n,2*r+2*t+1),n[2*r+2*t+1]+=s*o,m(n,2*r+2*t+1),n[2*r+2*t+2]+=i*o,m(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new i(n,0)},s.B=function(e){return _(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,w=sm.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=l,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return p(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=l(Math.pow(n,8)),i=h;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let o=parseInt(t.substring(e,e+s),n);s<8?(s=l(Math.pow(n,s)),i=i.j(s).add(l(o))):i=(i=i.j(r)).add(l(o))}return i},v=sm.Integer=i}).apply(void 0!==sg?sg:"u">typeof self?self:"u">typeof window?window:{});var sy="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,s_={};(function(){var e,t,n=Object.defineProperty,r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof sy&&sy];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=r;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in i))break e;i=i[o]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&n(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},o=this||self;function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,n){return e.call.apply(e.bind,arguments)}function h(e,t,n){return(h=l).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function c(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}var d="u">typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function f(e){let t=e.length;if(t>0){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function p(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];var n=typeof r;if("array"==(n="object"!=n?n:r?Array.isArray(r)?"array":n:"null")||"object"==n&&"number"==typeof r.length){n=e.length||0;let t=r.length||0;e.length=n+t;for(let i=0;i<t;i++)e[n+i]=r[i]}else e.push(r)}}var g=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new m,e=>e.reset());class m{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let y,_=!1,v=new class{constructor(){this.h=this.g=null}add(e,t){let n=g.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},w=()=>{let e=Promise.resolve(void 0);y=()=>{e.then(N)}};function N(){let e;for(var t;e=null,v.g&&(e=v.g,v.g=v.g.next,v.g||(v.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){o.setTimeout(()=>{throw e},0)}(e)}g.j(t),g.h<100&&(g.h++,t.next=g.g,g.g=t)}_=!1}function A(){this.u=this.u,this.C=this.C}function D(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}A.prototype.u=!1,A.prototype.dispose=function(){this.u||(this.u=!0,this.N())},A.prototype[Symbol.dispose]=function(){this.dispose()},A.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},D.prototype.h=function(){this.defaultPrevented=!0};var R=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};o.addEventListener("test",e,t),o.removeEventListener("test",e,t)}catch(e){}return e}();function P(e){return/^[\s\xa0]*$/.test(e)}function O(e,t){D.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}c(O,D),O.prototype.init=function(e,t){let n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&O.Z.h.call(this)},O.prototype.h=function(){O.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var M="closure_listenable_"+(1e6*Math.random()|0),L=0;function F(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++L,this.da=this.fa=!1}function V(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function q(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function U(e){let t={};for(let n in e)t[n]=e[n];return t}let B="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<B.length;t++)n=B[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function z(e){this.src=e,this.g={},this.h=0}function $(e,t){let n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(V(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function K(e,t,n,r){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}z.prototype.add=function(e,t,n,r,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let o=K(e,t,r,i);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new F(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var G="closure_lm_"+(1e6*Math.random()|0),H={};function W(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");let o=a(i)?!!i.capture:!!i,l=X(e);if(l||(e[G]=l=new z(e)),(n=l.add(t,n,r,o,s)).proxy)return n;if(r=function e(t){return J.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)R||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Y(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[M])$(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Y(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=X(t))?($(n,e),0==n.h&&(n.src=null,t[G]=null)):V(e)}}}function Y(e){return e in H?H[e]:H[e]="on"+e}function J(e,t){if(e.da)e=!0;else{t=new O(t,this);let n=e.listener,r=e.ha||e.src;e.fa&&Q(e),e=n.call(r,t)}return e}function X(e){return(e=e[G])instanceof z?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){A.call(this),this.i=new z(this),this.M=this,this.G=null}function en(e,t){let n,r;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new D(t,e);else if(t instanceof D)t.target=t.target||e;else{var o=t;j(t=new D(s,e),o)}if(o=!0,i)for(r=i.length-1;r>=0;r--)o=er(n=t.g=i[r],s,!0,t)&&o;if(o=er(n=t.g=e,s,!0,t)&&o,o=er(n,s,!1,t)&&o,i)for(r=0;r<i.length;r++)o=er(n=t.g=i[r],s,!1,t)&&o}function er(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let o=t[s];if(o&&!o.da&&o.capture==n){let t=o.listener,n=o.ha||o.src;o.fa&&$(e.i,o),i=!1!==t.call(n,r)&&i}}return i&&!r.defaultPrevented}c(et,A),et.prototype[M]=!0,et.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else(i=a(i)?!!i.capture:!!i,r=ee(r),t&&t[M])?(t=t.i,(o=String(n).toString())in t.g&&(r=K(n=t.g[o],r,i,s))>-1&&(V(n[r]),Array.prototype.splice.call(n,r,1),0==n.length&&(delete t.g[o],t.h--))):t&&(t=X(t))&&(n=t.g[n.toString()],t=-1,n&&(t=K(n,r,i,s)),(r=t>-1?n[t]:null)&&Q(r))}(this,e,t,n,r)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let n=e.g[t];for(let e=0;e<n.length;e++)V(n[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},et.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ei extends A{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=h(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:o.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){A.call(this),this.h=e,this.g={}}c(es,A);var eo=[];function ea(e){q(e.g,function(e,t){this.g.hasOwnProperty(t)&&Q(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),ea(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=o.JSON.stringify,eh=o.JSON.parse,eu=class{stringify(e){return o.JSON.stringify(e,void 0)}parse(e){return o.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){D.call(this,"d")}function eg(){D.call(this,"c")}c(ep,D),c(eg,D);var em={},ey=null;function e_(){return ey=ey||new et}function ev(e){D.call(this,em.Ia,e)}function ew(e){let t=e_();en(t,new ev(t))}function eb(e,t){D.call(this,em.STAT_EVENT,e),this.stat=t}function eI(e){let t=e_();en(t,new eb(t,e))}function eC(e,t){D.call(this,em.Ja,e),this.size=t}function eE(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){e()},t)}function eT(){this.g=!0}function eS(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<r.length;e++)r[e]=""}}}}return el(s)}catch(e){return t}}(e,n)+(r?" "+r:"")})}em.Ia="serverreachability",c(ev,D),em.STAT_EVENT="statevent",c(eb,D),em.Ja="timingevent",c(eC,D),eT.prototype.ua=function(){this.g=!1},eT.prototype.info=function(){};var ex={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ek={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eN(){}function eA(e){return encodeURIComponent(String(e))}function eD(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eR}function eR(){this.i=null,this.g="",this.h=!1}c(eN,ec),eN.prototype.g=function(){return new XMLHttpRequest},e=new eN;var eP={},eO={};function eM(e,t,n){e.M=1,e.A=e5(e0(t)),e.u=n,e.R=!0,eL(e,null)}function eL(e,t){e.F=Date.now(),eV(e),e.B=e0(e.A);var n,r,i,s,o,l,u=e.B,c=e.S;Array.isArray(c)||(c=[String(c)]),th(u.i,"t",c),e.C=0,u=e.j.L,e.h=new eR,e.g=tQ(e.j,u?t:null,!e.u),e.P>0&&(e.O=new ei(h(e.Y,e,e.g),e.P)),t=e.V,u=e.g,c=e.ba;var d="readystatechange";Array.isArray(d)||(d&&(eo[0]=d.toString()),d=eo);for(let e=0;e<d.length;e++){let n=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(let o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=ee(r),t&&t[M]?t.K(n,r,a(i)?!!i.capture:!!i,s):W(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(let o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=ee(r),t&&t[M]?t.J(n,r,a(i)?!!i.capture:!!i,s):W(t,n,r,!1,i,s)}(u,d[e],c||t.handleEvent,!1,t.h||t);if(!n)break;t.g[n.key]=n}t=e.J?U(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ew(),n=e.i,r=e.v,i=e.B,s=e.l,o=e.S,l=e.u,n.info(function(){if(n.g)if(l){var e="",t=l.split("&");for(let n=0;n<t.length;n++){var a=t[n].split("=");if(a.length>1){let t=a[0];a=a[1];let n=t.split("_");e=n.length>=2&&"type"==n[1]?e+(t+"=")+a+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+o+"]: "+r+"\n"+i+"\n"+e})}function eF(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eV(e){e.T=Date.now()+e.H,eq(e,e.H)}function eq(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eE(h(e.aa,e),t)}function eU(e){e.D&&(o.clearTimeout(e.D),e.D=null)}function eB(e){0==e.j.I||e.K||t$(e.j,e)}function ej(e){eU(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,ea(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ez(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||eW(n.h,e))){if(!e.L&&eW(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.v){if(n.g)if(n.g.F+3e3<e.F)tz(n),tP(n);else break e;tU(n),eI(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=eE(h(n.Va,n),6e3));1>=eH(n.h)&&n.ta&&(n.ta=void 0)}else tG(n,11)}else if((e.L||n.g==e)&&tz(n),!P(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let a=i[t],l=a[0];if(!(l<=n.K))if(n.K=l,a=a[1],2==n.I)if("c"==a[0]){n.M=a[1],n.ba=a[2];let t=a[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));let i=a[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));let l=a[5];null!=l&&"number"==typeof l&&l>0&&(n.O=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eQ(s,s.h),s.h=null))}if(r.G){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,e3(r.J,r.G,e))}}if(n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms")),(r=n).na=tW(r,r.L?r.ba:null,r.W),e.L){eY(r.h,e);var o=r.O;o&&(e.H=o),e.D&&(eU(e),eV(e)),r.g=e}else tq(r);n.i.length>0&&tM(n)}else"stop"!=a[0]&&"close"!=a[0]||tG(n,7);else 3==n.I&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?tG(n,7):tR(n):"noop"!=a[0]&&n.l&&n.l.qa(a),n.A=0)}}ew(4)}catch(e){}}eD.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tk(e)?t.j():this.Y(e)},eD.prototype.Y=function(e){try{if(e==this.g)e:{let f=tk(this.g),p=this.g.ya(),g=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tN(this.g)))){this.K||4!=f||7==p||(8==p||g<=0?ew(3):ew(2)),eU(this);var t=this.g.ca();this.X=t;var n=function(e){if(!eF(e))return e.g.la();let t=tN(e.g);if(""===t)return"";let n="",r=t.length,i=4==tk(e.g);if(!e.h.i){if("u"<typeof TextDecoder)return ej(e),eB(e),"";e.h.i=new o.TextDecoder}for(let s=0;s<r;s++)e.h.h=!0,n+=e.h.i.decode(t[s],{stream:!(i&&s==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,r=this.i,i=this.v,s=this.B,a=this.l,l=this.S,r.info(function(){return"XMLHTTP RESP ("+a+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var r,i,s,a,l,h,u=this.g;if((h=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(h)){var c=h;break t}}c=null}if(e=c)eS(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ez(this,e);else{this.o=!1,this.m=3,eI(12),ej(this),eB(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;)if((t=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?eO:isNaN(n=Number(t.substring(n,r)))?eP:(r+=1)+n>t.length?eO:(t=t.slice(r,r+n),e.C=r+n,t)}(this,n))==eO){4==f&&(this.m=4,eI(14),e=!1),eS(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eP){this.m=4,eI(15),eS(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}else eS(this.i,this.l,t,null),ez(this,t);if(eF(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=n.length||this.h.h||(this.m=1,eI(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),tB(d),d.P=!0,eI(11))}}else eS(this.i,this.l,n,"[Invalid Chunked Response]"),ej(this),eB(this)}else eS(this.i,this.l,n,null),ez(this,n);4==f&&ej(this),this.o&&!this.K&&(4==f?t$(this.j,this):(this.o=!1,eV(this)))}else(function(e){let t={};e=(e.g&&tk(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(P(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,eI(12)):(this.m=0,eI(13)),ej(this),eB(this)}}}catch(e){}finally{}},eD.prototype.cancel=function(){this.K=!0,ej(this)},eD.prototype.aa=function(){var e,t;this.D=null;let n=Date.now();n-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(ew(),eI(17)),ej(this),this.m=2,eB(this)):eq(this,this.T-n)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eK(e){this.l=e||10,e=o.PerformanceNavigationTiming?(e=o.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eG(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eH(e){return e.h?1:e.g?e.g.size:0}function eW(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eQ(e,t){e.g?e.g.add(t):e.h=t}function eY(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eJ(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.G);return t}return f(e.i)}eK.prototype.cancel=function(){if(this.i=eJ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eX=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e6(this,tu(e.i)),this.m=e.m):e&&(t=String(e).match(eX))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e4(t[2]||""),this.g=e4(t[3]||"",!0),e2(this,t[4]),this.h=e4(t[5]||"",!0),e6(this,t[6]||"",!0),this.m=e4(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,n){e.j=n?e4(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e6(e,t,n){var r,i;t instanceof ti?(e.i=t,r=e.i,(i=e.l)&&!r.j&&(ts(r),r.i=null,r.g.forEach(function(e,t){let n=t.toLowerCase();t!=n&&(to(this,t),th(this,n,e))},r)),r.j=i):(n||(t=e8(t,tn)),e.i=new ti(t,e.l))}function e3(e,t,n){e.i.set(t,n)}function e5(e){return e3(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e4(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e9,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e9,!0),"@"),e.push(eA(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(e8(n,"/"==n.charAt(0)?tt:te,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",e8(n,tr)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),n=!!e.j;n?e1(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)e2(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=t.h.lastIndexOf("/");-1!=i&&(r=t.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let n=i[t++];"."==n?r&&t==i.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==i.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=i}return n?t.h=r:n=""!==e.i.toString(),n?e6(t,tu(e.i)):n=!!e.m,n&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tn=/[#\?@]/g,tr=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){let r=e[n].indexOf("="),i,s=null;r>=0?(i=e[n].substring(0,r),s=e[n].substring(r+1)):i=e[n],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function to(e,t){ts(e),t=tc(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function ta(e,t){return ts(e),t=tc(e,t),e.g.has(t)}function tl(e,t){ts(e);let n=[];if("string"==typeof t)ta(e,t)&&(n=n.concat(e.g.get(tc(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function th(e,t,n){to(e,t),n.length>0&&(e.i=null,e.g.set(tc(e,t),f(n)),e.h+=n.length)}function tu(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tf(){this.g=new eu}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function tg(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tm(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,t_(e)}function t_(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tv(e){let t="";return q(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tw(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tv(n),"string"==typeof e?null!=n&&eA(n):e3(e,t,n))}function tb(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=tc(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,ta(this,e=tc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];let i=eA(n);n=tl(this,n);for(let t=0;t<n.length;t++){let r=i;""!==n[t]&&(r+="="+eA(n[t])),e.push(r)}}return this.i=e.join("&")},c(tp,ec),tp.prototype.g=function(){return new tg(this.i,this.h)},c(tg,et),(t=tg.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,t_(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||o).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,t_(this)),this.g&&(this.readyState=3,t_(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==o.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tm(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):t_(this),3==this.readyState&&tm(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tg.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),c(tb,et);var tI=/^https?$/i,tC=["POST","PUT"];function tE(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tT(e),tx(e)}function tT(e){e.A||(e.A=!0,en(e,"complete"),en(e,"error"))}function tS(e){if(e.h&&void 0!==s){if(e.v&&4==tk(e))setTimeout(e.Ca.bind(e),0);else if(en(e,"readystatechange"),4==tk(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){let t=String(e.D).match(eX)[1]||null;!t&&o.self&&o.self.location&&(t=o.self.location.protocol.slice(0,-1)),n=!tI.test(t?t.toLowerCase():"")}t=n}if(t)en(e,"complete"),en(e,"success");else{e.o=6;try{var i=tk(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tT(e)}}finally{tx(e)}}}}function tx(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let n=e.g;e.g=null,t||en(e,"ready");try{n.onreadystatechange=null}catch(e){}}}function tk(e){return e.g?e.g.readyState:0}function tN(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tA(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tD(e){this.za=0,this.i=[],this.j=new eT,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tA("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tA("baseRetryDelayMs",5e3,e),this.Za=tA("retryDelaySeedMs",1e4,e),this.Ta=tA("forwardChannelMaxRetries",2,e),this.va=tA("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eK(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tR(e){if(tO(e),3==e.I){var t=e.V++,n=e0(e.J);if(e3(n,"SID",e.M),e3(n,"RID",t),e3(n,"TYPE","terminate"),tF(e,n),(t=new eD(e,e.j,t)).M=2,t.A=e5(e0(n)),n=!1,o.navigator&&o.navigator.sendBeacon)try{n=o.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&o.Image&&((new Image).src=t.A,n=!0),n||(t.g=tQ(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eV(t)}tH(e)}function tP(e){e.g&&(tB(e),e.g.cancel(),e.g=null)}function tO(e){tP(e),e.v&&(o.clearTimeout(e.v),e.v=null),tz(e),e.h.cancel(),e.m&&("number"==typeof e.m&&o.clearTimeout(e.m),e.m=null)}function tM(e){if(!eG(e.h)&&!e.m){e.m=!0;var t=e.Ea;y||w(),_||(y(),_=!0),v.add(t,e),e.D=0}}function tL(e,t){var n;n=t?t.l:e.V++;let r=e0(e.J);e3(r,"SID",e.M),e3(r,"RID",n),e3(r,"AID",e.K),tF(e,r),e.u&&e.o&&tw(r,e.u,e.o),n=new eD(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tV(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eQ(e.h,n),eM(n,r,t)}function tF(e,t){e.H&&q(e.H,function(e,n){e3(t,n,e)}),e.l&&q({},function(e,n){e3(t,n,e)})}function tV(e,t,n){n=Math.min(e.i.length,n);let r=e.l?h(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?n>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let h=0;h<n;h++){var s=i[h].g;let n=i[h].map;if((s-=t)<0)t=Math.max(0,i[h].g-100),l=!1;else try{s="req"+s+"_";try{var o=n instanceof Map?n:Object.entries(n);for(let[t,n]of o){let r=n;a(n)&&(r=el(n)),e.push(s+t+"="+encodeURIComponent(r))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){r&&r(n)}}if(l){o=e.join("&");break e}}o=void 0}return t.G=e=e.i.splice(0,n),o}function tq(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;y||w(),_||(y(),_=!0),v.add(t,e),e.A=0}}function tU(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eE(h(e.Da,e),tK(e,e.A)),e.A++,!0)}function tB(e){null!=e.B&&(o.clearTimeout(e.B),e.B=null)}function tj(e){e.g=new eD(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e3(t,"RID","rpc"),e3(t,"SID",e.M),e3(t,"AID",e.K),e3(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e3(t,"TO",e.ia),e3(t,"TYPE","xmlhttp"),tF(e,t),e.u&&e.o&&tw(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=e5(e0(t)),n.u=null,n.R=!0,eL(n,e)}function tz(e){null!=e.C&&(o.clearTimeout(e.C),e.C=null)}function t$(e,t){var n,r=null;if(e.g==t){tz(e),tB(e),e.g=null;var i=2}else{if(!eW(e.h,t))return;r=t.G,eY(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){r=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;en(i=e_(),new eC(i,r)),tM(e)}else tq(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(n=t,!(eH(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=n.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eE(h(e.Ea,e,n),tK(e,e.D)),e.D++,!0)))||2==i&&tU(e)))switch(r&&r.length>0&&((t=e.h).i=t.i.concat(r)),s){case 1:tG(e,5);break;case 4:tG(e,10);break;case 3:tG(e,6);break;default:tG(e,2)}}}function tK(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function tG(e,t){if(e.j.info("Error code "+t),2==t){let t,s,a;var n,r=h(e.bb,e),i=e.Ua;let l=!i;i=new eZ(i||"//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||e1(i,"https"),e5(i),l?function(e,t){let n=new eT;if(o.Image){let r=new Image;r.onload=u(td,n,"TestLoadImage: loaded",!0,t,r),r.onerror=u(td,n,"TestLoadImage: error",!1,t,r),r.onabort=u(td,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=u(td,n,"TestLoadImage: timeout",!1,t,r),o.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(i.toString(),r):(n=i.toString(),t=new eT,s=new AbortController,a=setTimeout(()=>{s.abort(),td(t,"TestPingServer: timeout",!1,r)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(a),e.ok?td(t,"TestPingServer: ok",!0,r):td(t,"TestPingServer: server error",!1,r)}).catch(()=>{clearTimeout(a),td(t,"TestPingServer: error",!1,r)}))}else eI(2);e.I=0,e.l&&e.l.pa(t),tH(e),tO(e)}function tH(e){if(e.I=0,e.ja=[],e.l){let t=eJ(e.h);(0!=t.length||0!=e.i.length)&&(p(e.ja,t),p(e.ja,e.i),e.h.i.length=0,f(e.i),e.i.length=0),e.l.oa()}}function tW(e,t,n){var r=n instanceof eZ?e0(n):new eZ(n);if(""!=r.g)t&&(r.g=t+"."+r.g),e2(r,r.u);else{var i=o.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eZ(null);r&&e1(e,r),t&&(e.g=t),i&&e2(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&e3(r,n,t),e3(r,"VER",e.ka),tF(e,r),r}function tQ(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tb(e.Aa&&!e.ma?new tp({ab:n}):e.ma)).Fa(e.L),t}function tY(){}function tJ(){}function tX(e,t){et.call(this),this.g=new tD(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!P(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!P(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t1(this)}function tZ(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t0(){eg.call(this),this.status=1}function t1(e){this.g=e}(t=tb.prototype).Fa=function(e){this.H=e},t.ea=function(t,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);n=n?n.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=d(h(this.Ca,this));try{this.B=!0,this.g.open(n,String(t),!0),this.B=!1}catch(e){tE(this,e);return}if(t=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,a]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=o.FormData&&t instanceof o.FormData,!(Array.prototype.indexOf.call(tC,n,void 0)>=0)||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(e,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tE(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,en(this,"complete"),en(this,"abort"),tx(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tx(this,!0)),tb.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tS(this):this.Xa())},t.Xa=function(){tS(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tk(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eh(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tD.prototype).ka=8,t.I=1,t.connect=function(e,t,n,r){eI(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=tW(this,null,this.W),tM(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eD(this,this.j,e),s=this.o;if(this.U&&(s?j(s=U(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tV(this,i,t),e3(n=e0(this.J),"RID",e),e3(n,"CVER",22),this.G&&e3(n,"X-HTTP-Session-Id",this.G),tF(this,n),s&&(this.R?t="headers="+eA(tv(s))+"&"+t:this.u&&tw(n,this.u,s)),eQ(this.h,i),this.Ra&&e3(n,"TYPE","init"),this.S?(e3(n,"$req",t),e3(n,"SID","null"),i.U=!0,eM(i,n,null)):eM(i,n,t),this.I=2}}else 3==this.I&&(e?tL(this,e):0==this.i.length||eG(this.h)||tL(this))},t.Da=function(){if(this.v=null,tj(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eE(h(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eI(10),tP(this),tj(this))},t.Va=function(){null!=this.C&&(this.C=null,tP(this),tU(this),eI(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eI(2)):(this.j.info("Failed to ping google.com"),eI(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tY.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tJ.prototype.g=function(e,t){return new tX(e,t)},c(tX,et),tX.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tX.prototype.close=function(){tR(this.g)},tX.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=el(e),e=n);t.i.push(new e$(t.Ya++,e)),3==t.I&&tM(t)},tX.prototype.N=function(){this.g.l=null,delete this.j,tR(this.g),delete this.g,tX.Z.N.call(this)},c(tZ,ep),c(t0,eg),c(t1,tY),t1.prototype.ra=function(){en(this.g,"a")},t1.prototype.qa=function(e){en(this.g,new tZ(e))},t1.prototype.pa=function(e){en(this.g,new t0)},t1.prototype.oa=function(){en(this.g,"b")},tJ.prototype.createWebChannel=tJ.prototype.g,tX.prototype.send=tX.prototype.o,tX.prototype.open=tX.prototype.m,tX.prototype.close=tX.prototype.close,k=s_.createWebChannelTransport=function(){return new tJ},x=s_.getStatEventTarget=function(){return e_()},S=s_.Event=em,T=s_.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ex.NO_ERROR=0,ex.TIMEOUT=8,ex.HTTP_ERROR=6,E=s_.ErrorCode=ex,ek.COMPLETE="complete",C=s_.EventType=ek,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,I=s_.WebChannel=ed,s_.FetchXmlHttpFactory=tp,tb.prototype.listenOnce=tb.prototype.K,tb.prototype.getLastError=tb.prototype.Ha,tb.prototype.getLastErrorCode=tb.prototype.ya,tb.prototype.getStatus=tb.prototype.ca,tb.prototype.getResponseJson=tb.prototype.La,tb.prototype.getResponseText=tb.prototype.la,tb.prototype.send=tb.prototype.ea,tb.prototype.setWithCredentials=tb.prototype.Fa,b=s_.XhrIo=tb}).apply(void 0!==sy?sy:"u">typeof self?self:"u">typeof window?window:{});class sv{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}sv.UNAUTHENTICATED=new sv(null),sv.GOOGLE_CREDENTIALS=new sv("google-credentials-uid"),sv.FIRST_PARTY=new sv("first-party-uid"),sv.MOCK_USER=new sv("mock-user");let sw="12.8.0",sb=new eV("@firebase/firestore");function sI(){return sb.logLevel}function sC(e,...t){if(sb.logLevel<=y.DEBUG){let n=t.map(sS);sb.debug(`Firestore (${sw}): ${e}`,...n)}}function sE(e,...t){if(sb.logLevel<=y.ERROR){let n=t.map(sS);sb.error(`Firestore (${sw}): ${e}`,...n)}}function sT(e,...t){if(sb.logLevel<=y.WARN){let n=t.map(sS);sb.warn(`Firestore (${sw}): ${e}`,...n)}}function sS(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function sx(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,sk(e,r,n)}function sk(e,t,n){let r=`FIRESTORE (${sw}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw sE(r),Error(r)}function sN(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||sk(t,i,r)}let sA={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class sD extends eu{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class sR{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class sP{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class sO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(sv.UNAUTHENTICATED))}shutdown(){}}class sM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class sL{constructor(e){this.t=e,this.currentUser=sv.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){sN(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new sR;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new sR,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{sC("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?o(e):(sC("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new sR)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(sC("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(sN("string"==typeof t.accessToken,31837,{l:t}),new sP(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return sN(null===e||"string"==typeof e,2055,{h:e}),new sv(e)}}class sF{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=sv.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class sV{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new sF(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(sv.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class sq{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class sU{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,tr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){sN(void 0===this.o,3512);let n=e=>{null!=e.error&&sC("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,sC("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{sC("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):sC("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new sq(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(sN("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new sq(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class sB{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="u">typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function sj(e,t){return e<t?-1:+(e>t)}function sz(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.charAt(r),i=t.charAt(r);if(n!==i)return s$(n)===s$(i)?sj(n,i):s$(n)?1:-1}return sj(e.length,t.length)}function s$(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function sK(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}let sG="__name__";class sH{constructor(e,t,n){void 0===t?t=0:t>e.length&&sx(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&sx(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===sH.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof sH?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=sH.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return sj(e.length,t.length)}static compareSegments(e,t){let n=sH.isNumericId(e),r=sH.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?sH.extractNumericId(e).compare(sH.extractNumericId(t)):sz(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return v.fromString(e.substring(4,e.length-2))}}class sW extends sH{construct(e,t,n){return new sW(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new sD(sA.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new sW(t)}static emptyPath(){return new sW([])}}let sQ=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class sY extends sH{construct(e,t,n){return new sY(e,t,n)}static isValidIdentifier(e){return sQ.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),sY.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===sG}static keyField(){return new sY([sG])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new sD(sA.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new sD(sA.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new sD(sA.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new sD(sA.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new sY(t)}static emptyPath(){return new sY([])}}class sJ{constructor(e){this.path=e}static fromPath(e){return new sJ(sW.fromString(e))}static fromName(e){return new sJ(sW.fromString(e).popFirst(5))}static empty(){return new sJ(sW.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===sW.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return sW.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new sJ(new sW(e.slice()))}}function sX(e){if(!sJ.isDocumentKey(e))throw new sD(sA.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function sZ(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function s0(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":sx(12329,{type:typeof e})}function s1(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new sD(sA.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=s0(e);throw new sD(sA.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function s2(e,t){if(t<=0)throw new sD(sA.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function s6(e,t){let n={typeString:e};return t&&(n.value=t),n}function s3(e,t){let n;if(!sZ(e))throw new sD(sA.INVALID_ARGUMENT,"JSON must be an object");for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let o=e[r];if(i&&typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&o!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new sD(sA.INVALID_ARGUMENT,n);return!0}class s5{static now(){return s5.fromMillis(Date.now())}static fromDate(e){return s5.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new s5(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new sD(sA.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new sD(sA.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?sj(this.nanoseconds,e.nanoseconds):sj(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:s5._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(s3(e,s5._jsonSchema))return new s5(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}s5._jsonSchemaVersion="firestore/timestamp/1.0",s5._jsonSchema={type:s6("string",s5._jsonSchemaVersion),seconds:s6("number"),nanoseconds:s6("number")};class s4{static fromTimestamp(e){return new s4(e)}static min(){return new s4(new s5(0,0))}static max(){return new s4(new s5(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class s8{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function s7(e){return e.fields.find(e=>2===e.kind)}function s9(e){return e.fields.filter(e=>2!==e.kind)}function oe(e,t){let n=sj(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=function(e,t){let n=sY.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:sj(e.kind,t.kind)}(e.fields[r],t.fields[r])))return n;return sj(e.fields.length,t.fields.length)}s8.UNKNOWN_ID=-1;class ot{constructor(e,t){this.fieldPath=e,this.kind=t}}class on{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new on(0,os.min())}}function or(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new os(s4.fromTimestamp(1e9===r?new s5(n+1,0):new s5(n,r)),sJ.empty(),t)}function oi(e){return new os(e.readTime,e.key,-1)}class os{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new os(s4.min(),sJ.empty(),-1)}static max(){return new os(s4.max(),sJ.empty(),-1)}}function oo(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=sJ.comparator(e.documentKey,t.documentKey))?n:sj(e.largestBatchId,t.largestBatchId)}let oa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ol{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function oh(e){if(e.code!==sA.FAILED_PRECONDITION||e.message!==oa)throw e;sC("LocalStore","Unexpectedly lost primary lease")}class ou{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&sx(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ou((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof ou?t:ou.resolve(t)}catch(e){return ou.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ou.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ou.reject(t)}static resolve(e){return new ou((t,n)=>{t(e)})}static reject(e){return new ou((t,n)=>{n(e)})}static waitFor(e){return new ou((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=ou.resolve(!1);for(let n of e)t=t.next(e=>e?ou.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new ou((n,r)=>{let i=e.length,s=Array(i),o=0;for(let a=0;a<i;a++){let l=a;t(e[l]).next(e=>{s[l]=e,++o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new ou((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}let oc="SimpleDb";class od{static open(e,t,n,r){try{return new od(t,e.transaction(r,n))}catch(e){throw new om(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new sR,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new om(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let n=ob(t.target.error);this.S.reject(new om(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(sC(oc,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new o_(this.transaction.objectStore(e))}}class of{static delete(e){return sC(oc,"Removing database:",e),ov(K().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!eh())return!1;if(of.F())return!0;let e=en(),t=of.M(e),n=op(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static F(){return void 0!==M.default&&"YES"===M.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,12.2===of.M(en())&&sE("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(sC(oc,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new om(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new sD(sA.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new sD(sA.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new om(e,r))},r.onupgradeneeded=e=>{sC(oc,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,r.transaction,e.oldVersion,this.version).next(()=>{sC(oc,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=od.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),ou.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(sC(oc,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function op(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class og{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return ov(this.U.delete())}}class om extends sD{constructor(e,t){super(sA.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function oy(e){return"IndexedDbTransactionError"===e.name}class o_{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(sC(oc,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(sC(oc,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ov(n)}add(e){return sC(oc,"ADD",this.store.name,e,e),ov(this.store.add(e))}get(e){return ov(this.store.get(e)).next(t=>(void 0===t&&(t=null),sC(oc,"GET",this.store.name,e,t),t))}delete(e){return sC(oc,"DELETE",this.store.name,e),ov(this.store.delete(e))}count(){return sC(oc,"COUNT",this.store.name),ov(this.store.count())}H(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new ou((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.J(e,(e,n)=>{t.push(n)}).next(()=>t)}}Z(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new ou((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}X(e,t){sC(oc,"DELETE ALL",this.store.name);let n=this.options(e,t);n.Y=!1;let r=this.cursor(n);return this.J(r,(e,t,n)=>n.delete())}ee(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.J(r,t)}te(e){let t=this.cursor({});return new ou((n,r)=>{t.onerror=e=>{r(ob(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}J(e,t){let n=[];return new ou((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new og(i),o=t(i.primaryKey,i.value,s);if(o instanceof ou){let e=o.catch(e=>(s.done(),ou.reject(e)));n.push(e)}s.isDone?r():null===s.G?i.continue():i.continue(s.G)}}).next(()=>ou.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ov(e){return new ou((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(ob(e.target.error))}})}let ow=!1;function ob(e){let t=of.M(en());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new sD("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ow||(ow=!0,setTimeout(()=>{throw e},0)),e}}return e}let oI="IndexBackfiller";class oC{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){sC(oI,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();sC(oI,`Documents written: ${e}`)}catch(e){oy(e)?sC(oI,"Ignoring IndexedDB error during index backfill: ",e):await oh(e)}await this.re(6e4)})}}class oE{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let n=new Set,r=t,i=!0;return ou.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return sC(oI,`Processing collection: ${t}`),this.oe(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(r,n)).next(n=>(sC(oI,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}_e(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=oi(t);oo(r,n)>0&&(n=r)}),new os(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class oT{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function oS(e){return null==e}function ox(e){return 0===e&&1/e==-1/0}function ok(e){return"number"==typeof e&&Number.isInteger(e)&&!ox(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function oN(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}oT.ce=-1;function oA(e){let t=e.length;if(sN(t>=2,64408,{path:e}),2===t)return sN("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),sW.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&sx(50515,{path:e}),e.charAt(t+1)){case"\x01":let o,a=e.substring(s,t);0===i.length?o=a:(i+=a,o=i,i=""),r.push(o);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:sx(61167,{path:e})}s=t+2}return new sW(r)}let oD="remoteDocuments",oR="owner",oP="owner",oO="mutationQueues",oM="mutations",oL="batchId",oF="userMutationsIndex",oV=["userId","batchId"],oq={},oU="documentMutations",oB="remoteDocumentsV14",oj=["prefixPath","collectionGroup","readTime","documentId"],oz="documentKeyIndex",o$=["prefixPath","collectionGroup","documentId"],oK="collectionGroupIndex",oG=["collectionGroup","readTime","prefixPath","documentId"],oH="remoteDocumentGlobal",oW="remoteDocumentGlobalKey",oQ="targets",oY="queryTargetsIndex",oJ=["canonicalId","targetId"],oX="targetDocuments",oZ=["targetId","path"],o0="documentTargetsIndex",o1=["path","targetId"],o2="targetGlobalKey",o6="targetGlobal",o3="collectionParents",o5=["collectionId","parent"],o4="clientMetadata",o8="bundles",o7="namedQueries",o9="indexConfiguration",ae="collectionGroupIndex",at="indexState",an=["indexId","uid"],ar="sequenceNumberIndex",ai=["uid","sequenceNumber"],as="indexEntries",ao=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],aa="documentKeyIndex",al=["indexId","uid","orderedDocumentKey"],ah="documentOverlays",au=["userId","collectionPath","documentId"],ac="collectionPathOverlayIndex",ad=["userId","collectionPath","largestBatchId"],af="collectionGroupOverlayIndex",ap=["userId","collectionGroup","largestBatchId"],ag="globals",am=[oO,oM,oU,oD,oQ,oR,o6,oX,o4,oH,o3,o8,o7],ay=[...am,ah],a_=[oO,oM,oU,oB,oQ,oR,o6,oX,o4,oH,o3,o8,o7,ah],av=[...a_,o9,at,as],aw=[...av,ag];class ab extends ol{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function aI(e,t){return of.O(e.le,t)}function aC(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function aE(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function aT(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class aS{constructor(e,t){this.comparator=e,this.root=t||ak.EMPTY}insert(e,t){return new aS(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ak.BLACK,null,null))}remove(e){return new aS(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ak.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ax(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ax(this.root,e,this.comparator,!1)}getReverseIterator(){return new ax(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ax(this.root,e,this.comparator,!0)}}class ax{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ak{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ak.RED,this.left=null!=r?r:ak.EMPTY,this.right=null!=i?i:ak.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new ak(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return ak.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ak.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,ak.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,ak.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw sx(43730,{key:this.key,value:this.value});if(this.right.isRed())throw sx(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw sx(27949);return e+ +!this.isRed()}}ak.EMPTY=null,ak.RED=!0,ak.BLACK=!1,ak.EMPTY=new class{constructor(){this.size=0}get key(){throw sx(57766)}get value(){throw sx(16141)}get color(){throw sx(16727)}get left(){throw sx(29726)}get right(){throw sx(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new ak(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class aN{constructor(e){this.comparator=e,this.data=new aS(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new aA(this.data.getIterator())}getIteratorFrom(e){return new aA(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof aN)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new aN(this.comparator);return t.data=e,t}}class aA{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function aD(e){return e.hasNext()?e.getNext():void 0}class aR{constructor(e){this.fields=e,e.sort(sY.comparator)}static empty(){return new aR([])}unionWith(e){let t=new aN(sY.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new aR(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return sK(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class aP extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class aO{constructor(e){this.binaryString=e}static fromBase64String(e){return new aO(function(e){try{return atob(e)}catch(e){throw"u">typeof DOMException&&e instanceof DOMException?new aP("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new aO(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return sj(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}aO.EMPTY_BYTE_STRING=new aO("");let aM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function aL(e){if(sN(!!e,39018),"string"==typeof e){let t=0,n=aM.exec(e);if(sN(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:aF(e.seconds),nanos:aF(e.nanos)}}function aF(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function aV(e){return"string"==typeof e?aO.fromBase64String(e):aO.fromUint8Array(e)}let aq="server_timestamp",aU="__type__",aB="__previous_value__",aj="__local_write_time__";function az(e){return(e?.mapValue?.fields||{})[aU]?.stringValue===aq}function a$(e){let t=e.mapValue.fields[aB];return az(t)?a$(t):t}function aK(e){let t=aL(e.mapValue.fields[aj].timestampValue);return new s5(t.seconds,t.nanos)}class aG{constructor(e,t,n,r,i,s,o,a,l,h,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l,this.isUsingEmulator=h,this.apiKey=u}}let aH="(default)";class aW{constructor(e,t){this.projectId=e,this.database=t||aH}static empty(){return new aW("","")}get isDefaultDatabase(){return this.database===aH}isEqual(e){return e instanceof aW&&e.projectId===this.projectId&&e.database===this.database}}let aQ="__type__",aY="__max__",aJ={mapValue:{fields:{__type__:{stringValue:aY}}}},aX="__vector__",aZ="value",a0={nullValue:"NULL_VALUE"};function a1(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?az(e)?4:lo(e)?0x1fffffffffffff:li(e)?10:11:sx(28295,{value:e})}function a2(e,t){if(e===t)return!0;let n=a1(e);if(n!==a1(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return aK(e).isEqual(aK(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=aL(e.timestampValue),i=aL(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return aV(e.bytesValue).isEqual(aV(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return aF(e.geoPointValue.latitude)===aF(t.geoPointValue.latitude)&&aF(e.geoPointValue.longitude)===aF(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return aF(e.integerValue)===aF(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=aF(e.doubleValue),r=aF(t.doubleValue);return n===r?ox(n)===ox(r):isNaN(n)&&isNaN(r)}return!1;case 9:return sK(e.arrayValue.values||[],t.arrayValue.values||[],a2);case 10:case 11:let s=e.mapValue.fields||{},o=t.mapValue.fields||{};if(aC(s)!==aC(o))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===o[e]||!a2(s[e],o[e])))return!1;return!0;default:return sx(52216,{left:e})}}function a6(e,t){return void 0!==(e.values||[]).find(e=>a2(e,t))}function a3(e,t){var n,r,i,s,o,a;if(e===t)return 0;let l=a1(e),h=a1(t);if(l!==h)return sj(l,h);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return sj(e.booleanValue,t.booleanValue);case 2:let u,c;return u=aF(e.integerValue||e.doubleValue),u<(c=aF(t.integerValue||t.doubleValue))?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1;case 3:return a5(e.timestampValue,t.timestampValue);case 4:return a5(aK(e),aK(t));case 5:return sz(e.stringValue,t.stringValue);case 6:let d,f;return n=e.bytesValue,r=t.bytesValue,d=aV(n),f=aV(r),d.compareTo(f);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=sj(n[e],r[e]);if(0!==t)return t}return sj(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:let p;return i=e.geoPointValue,s=t.geoPointValue,0!==(p=sj(aF(i.latitude),aF(s.latitude)))?p:sj(aF(i.longitude),aF(s.longitude));case 9:return a4(e.arrayValue,t.arrayValue);case 10:let g,m,y,_,v;return o=e.mapValue,a=t.mapValue,g=o.fields||{},m=a.fields||{},y=g[aZ]?.arrayValue,_=m[aZ]?.arrayValue,0!==(v=sj(y?.values?.length||0,_?.values?.length||0))?v:a4(y,_);case 11:return function(e,t){if(e===aJ.mapValue&&t===aJ.mapValue)return 0;if(e===aJ.mapValue)return 1;if(t===aJ.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=sz(r[e],s[e]);if(0!==t)return t;let o=a3(n[r[e]],i[s[e]]);if(0!==o)return o}return sj(r.length,s.length)}(e.mapValue,t.mapValue);default:throw sx(23264,{he:l})}}function a5(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return sj(e,t);let n=aL(e),r=aL(t),i=sj(n.seconds,r.seconds);return 0!==i?i:sj(n.nanos,r.nanos)}function a4(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=a3(n[e],r[e]);if(t)return t}return sj(n.length,r.length)}function a8(e){var t,n;let r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(r=aL(e.timestampValue),`time(${r.seconds},${r.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?aV(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,sJ.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=a8(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${a8(e.fields[i])}`;return n+"}"}(e.mapValue):sx(61005,{value:e})}function a7(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function a9(e){return!!e&&"integerValue"in e}function le(e){return!!e&&"arrayValue"in e}function lt(e){return!!e&&"nullValue"in e}function ln(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function lr(e){return!!e&&"mapValue"in e}function li(e){return(e?.mapValue?.fields||{})[aQ]?.stringValue===aX}function ls(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return aE(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=ls(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ls(e.arrayValue.values[n]);return t}return{...e}}function lo(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===aY}let la={mapValue:{fields:{[aQ]:{stringValue:aX},[aZ]:{arrayValue:{}}}}};function ll(e,t){let n=a3(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function lh(e,t){let n=a3(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class lu{constructor(e){this.value=e}static empty(){return new lu({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!lr(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ls(t)}setAll(e){let t=sY.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=ls(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());lr(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return a2(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];lr(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(aE(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new lu(ls(this.value))}}class lc{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new lc(e,0,s4.min(),s4.min(),s4.min(),lu.empty(),0)}static newFoundDocument(e,t,n,r){return new lc(e,1,t,s4.min(),n,r,0)}static newNoDocument(e,t){return new lc(e,2,t,s4.min(),s4.min(),lu.empty(),0)}static newUnknownDocument(e,t){return new lc(e,3,t,s4.min(),s4.min(),lu.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(s4.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=lu.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=lu.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=s4.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof lc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new lc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ld{constructor(e,t){this.position=e,this.inclusive=t}}function lf(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],o=e.position[i];if(r=s.field.isKeyField()?sJ.comparator(sJ.fromName(o.referenceValue),n.key):a3(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function lp(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!a2(e.position[n],t.position[n]))return!1;return!0}class lg{constructor(e,t="asc"){this.field=e,this.dir=t}}class lm{}class ly extends lm{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new lE(e,t,n):"array-contains"===t?new lk(e,n):"in"===t?new lN(e,n):"not-in"===t?new lA(e,n):"array-contains-any"===t?new lD(e,n):new ly(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new lT(e,n):new lS(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(a3(t,this.value)):null!==t&&a1(this.value)===a1(t)&&this.matchesComparison(a3(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return sx(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class l_ extends lm{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new l_(e,t)}matches(e){return lv(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function lv(e){return"and"===e.op}function lw(e){return"or"===e.op}function lb(e){return lI(e)&&lv(e)}function lI(e){for(let t of e.filters)if(t instanceof l_)return!1;return!0}function lC(e,t){let n=e.filters.concat(t);return l_.create(n,e.op)}class lE extends ly{constructor(e,t,n){super(e,t,n),this.key=sJ.fromName(n.referenceValue)}matches(e){let t=sJ.comparator(e.key,this.key);return this.matchesComparison(t)}}class lT extends ly{constructor(e,t){super(e,"in",t),this.keys=lx("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class lS extends ly{constructor(e,t){super(e,"not-in",t),this.keys=lx("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function lx(e,t){return(t.arrayValue?.values||[]).map(e=>sJ.fromName(e.referenceValue))}class lk extends ly{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return le(t)&&a6(t.arrayValue,this.value)}}class lN extends ly{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&a6(this.value.arrayValue,t)}}class lA extends ly{constructor(e,t){super(e,"not-in",t)}matches(e){if(a6(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!a6(this.value.arrayValue,t)}}class lD extends ly{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!le(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>a6(this.value.arrayValue,e))}}class lR{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Te=null}}function lP(e,t=null,n=[],r=[],i=null,s=null,o=null){return new lR(e,t,n,r,i,s,o)}function lO(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof ly)return t.field.canonicalString()+t.op.toString()+a8(t.value);if(lb(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),oS(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>a8(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>a8(e)).join(",")),e.Te=t}return e.Te}function lM(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof ly?n instanceof ly&&t.op===n.op&&t.field.isEqual(n.field)&&a2(t.value,n.value):t instanceof l_?n instanceof l_&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void sx(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!lp(e.startAt,t.startAt)&&lp(e.endAt,t.endAt)}function lL(e){return sJ.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function lF(e,t){return e.filters.filter(e=>e instanceof ly&&e.field.isEqual(t))}function lV(e,t,n){let r=a0,i=!0;for(let n of lF(e,t)){let e=a0,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?a0:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?a7(aW.empty(),sJ.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?li(s)?la:{mapValue:{}}:sx(35942,{value:s});break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=a0}0>ll({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>ll({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function lq(e,t,n){let r=aJ,i=!0;for(let n of lF(e,t)){let e=aJ,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?a7(aW.empty(),sJ.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?la:"mapValue"in s?li(s)?{mapValue:{}}:aJ:sx(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=aJ}lh({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];lh({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class lU{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function lB(e){return new lU(e)}function lj(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function lz(e){return null!==e.collectionGroup}function l$(e){if(null===e.Ie){let t;e.Ie=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new aN(sY.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new lg(t,r))}),n.has(sY.keyField().canonicalString())||e.Ie.push(new lg(sY.keyField(),r))}return e.Ie}function lK(e){return e.Ee||(e.Ee=lG(e,l$(e))),e.Ee}function lG(e,t){if("F"===e.limitType)return lP(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new lg(e.field,t)});let n=e.endAt?new ld(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new ld(e.startAt.position,e.startAt.inclusive):null;return lP(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function lH(e,t){let n=e.filters.concat([t]);return new lU(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function lW(e,t,n){return new lU(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function lQ(e,t){return lM(lK(e),lK(t))&&e.limitType===t.limitType}function lY(e){return`${lO(lK(e))}|lt:${e.limitType}`}function lJ(e){var t;let n;return`Query(target=${n=(t=lK(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof ly?`${t.field.canonicalString()} ${t.op} ${a8(t.value)}`:t instanceof l_?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),oS(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>a8(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>a8(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function lX(e,t){var n,r,i,s;let o,a,l;return t.isFoundDocument()&&(o=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(o):sJ.isDocumentKey(e.path)?e.path.isEqual(o):e.path.isImmediateParentOf(o))&&function(e,t){for(let n of l$(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,r=t,(!n.startAt||(i=n.startAt,a=lf(i,l$(n),r),i.inclusive?!!(a<=0):!!(a<0)))&&(!n.endAt||(s=n.endAt,l=lf(s,l$(n),r),s.inclusive?!!(l>=0):!!(l>0))))}function lZ(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function l0(e){return(t,n)=>{let r=!1;for(let i of l$(e)){let e=function(e,t,n){var r;let i,s,o=e.field.isKeyField()?sJ.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),s=n.data.field(r),null!==i&&null!==s?a3(i,s):sx(42886));switch(e.dir){case"asc":return o;case"desc":return -1*o;default:return sx(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class l1{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){aE(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return aT(this.inner)}size(){return this.innerSize}}let l2=new aS(sJ.comparator),l6=new aS(sJ.comparator);function l3(...e){let t=l6;for(let n of e)t=t.insert(n.key,n);return t}function l5(e){let t=l6;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function l4(){return new l1(e=>e.toString(),(e,t)=>e.isEqual(t))}let l8=new aS(sJ.comparator),l7=new aN(sJ.comparator);function l9(...e){let t=l7;for(let n of e)t=t.add(n);return t}let he=new aN(sj);function ht(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ox(t)?"-0":t}}function hn(e){return{integerValue:""+e}}class hr{constructor(){this._=void 0}}function hi(e,t){return e instanceof hu?a9(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class hs extends hr{}class ho extends hr{constructor(e){super(),this.elements=e}}function ha(e,t){let n=hd(t);for(let t of e.elements)n.some(e=>a2(e,t))||n.push(t);return{arrayValue:{values:n}}}class hl extends hr{constructor(e){super(),this.elements=e}}function hh(e,t){let n=hd(t);for(let t of e.elements)n=n.filter(e=>!a2(e,t));return{arrayValue:{values:n}}}class hu extends hr{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function hc(e){return aF(e.integerValue||e.doubleValue)}function hd(e){return le(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class hf{constructor(e,t){this.field=e,this.transform=t}}class hp{constructor(e,t){this.version=e,this.transformResults=t}}class hg{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new hg}static exists(e){return new hg(void 0,e)}static updateTime(e){return new hg(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function hm(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class hy{}function h_(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new hS(e.key,hg.none()):new hb(e.key,e.data,hg.none());{let n=e.data,r=lu.empty(),i=new aN(sY.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new hI(e.key,r,new aR(i.toArray()),hg.none())}}function hv(e,t,n,r){return e instanceof hb?function(e,t,n,r){if(!hm(e.precondition,t))return n;let i=e.value.clone(),s=hT(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof hI?function(e,t,n,r){if(!hm(e.precondition,t))return n;let i=hT(e.fieldTransforms,r,t),s=t.data;return(s.setAll(hC(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):hm(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function hw(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&sK(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof ho&&r instanceof ho||n instanceof hl&&r instanceof hl?sK(n.elements,r.elements,a2):n instanceof hu&&r instanceof hu?a2(n.Ae,r.Ae):n instanceof hs&&r instanceof hs)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class hb extends hy{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class hI extends hy{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function hC(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function hE(e,t,n){let r=new Map;sN(e.length===n.length,32656,{Ve:n.length,de:e.length});for(let s=0;s<n.length;s++){var i;let o=e[s],a=o.transform,l=t.data.field(o.field);r.set(o.field,(i=n[s],a instanceof ho?ha(a,l):a instanceof hl?hh(a,l):i))}return r}function hT(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,function(e,t,n){var r;let i,s,o;return e instanceof hs?(r=t,i={fields:{[aU]:{stringValue:aq},[aj]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&az(r)&&(r=a$(r)),r&&(i.fields[aB]=r),{mapValue:i}):e instanceof ho?ha(e,t):e instanceof hl?hh(e,t):(o=hc(s=hi(e,t))+hc(e.Ae),a9(s)&&a9(e.Ae)?hn(o):ht(e.serializer,o))}(e,s,t))}return r}class hS extends hy{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class hx extends hy{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class hk{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){let r,i;e instanceof hb?(r=e.value.clone(),i=hE(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof hI?function(e,t,n){if(!hm(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=hE(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(hC(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=hv(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=hv(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=l4();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,o=this.applyToLocalView(s,i.mutatedFields),a=h_(s,o=t.has(r.key)?null:o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(s4.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),l9())}isEqual(e){return this.batchId===e.batchId&&sK(this.mutations,e.mutations,(e,t)=>hw(e,t))&&sK(this.baseMutations,e.baseMutations,(e,t)=>hw(e,t))}}class hN{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){sN(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=l8,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new hN(e,t,n,r)}}class hA{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class hD{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class hR{constructor(e,t){this.count=e,this.unchangedNames=t}}function hP(e){switch(e){case sA.OK:return sx(64938);case sA.CANCELLED:case sA.UNKNOWN:case sA.DEADLINE_EXCEEDED:case sA.RESOURCE_EXHAUSTED:case sA.INTERNAL:case sA.UNAVAILABLE:case sA.UNAUTHENTICATED:return!1;case sA.INVALID_ARGUMENT:case sA.NOT_FOUND:case sA.ALREADY_EXISTS:case sA.PERMISSION_DENIED:case sA.FAILED_PRECONDITION:case sA.ABORTED:case sA.OUT_OF_RANGE:case sA.UNIMPLEMENTED:case sA.DATA_LOSS:return!0;default:return sx(15467,{code:e})}}function hO(e){if(void 0===e)return sE("GRPC error has no .code"),sA.UNKNOWN;switch(e){case N.OK:return sA.OK;case N.CANCELLED:return sA.CANCELLED;case N.UNKNOWN:return sA.UNKNOWN;case N.DEADLINE_EXCEEDED:return sA.DEADLINE_EXCEEDED;case N.RESOURCE_EXHAUSTED:return sA.RESOURCE_EXHAUSTED;case N.INTERNAL:return sA.INTERNAL;case N.UNAVAILABLE:return sA.UNAVAILABLE;case N.UNAUTHENTICATED:return sA.UNAUTHENTICATED;case N.INVALID_ARGUMENT:return sA.INVALID_ARGUMENT;case N.NOT_FOUND:return sA.NOT_FOUND;case N.ALREADY_EXISTS:return sA.ALREADY_EXISTS;case N.PERMISSION_DENIED:return sA.PERMISSION_DENIED;case N.FAILED_PRECONDITION:return sA.FAILED_PRECONDITION;case N.ABORTED:return sA.ABORTED;case N.OUT_OF_RANGE:return sA.OUT_OF_RANGE;case N.UNIMPLEMENTED:return sA.UNIMPLEMENTED;case N.DATA_LOSS:return sA.DATA_LOSS;default:return sx(39323,{code:e})}}(A=N||(N={}))[A.OK=0]="OK",A[A.CANCELLED=1]="CANCELLED",A[A.UNKNOWN=2]="UNKNOWN",A[A.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",A[A.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",A[A.NOT_FOUND=5]="NOT_FOUND",A[A.ALREADY_EXISTS=6]="ALREADY_EXISTS",A[A.PERMISSION_DENIED=7]="PERMISSION_DENIED",A[A.UNAUTHENTICATED=16]="UNAUTHENTICATED",A[A.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",A[A.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",A[A.ABORTED=10]="ABORTED",A[A.OUT_OF_RANGE=11]="OUT_OF_RANGE",A[A.UNIMPLEMENTED=12]="UNIMPLEMENTED",A[A.INTERNAL=13]="INTERNAL",A[A.UNAVAILABLE=14]="UNAVAILABLE",A[A.DATA_LOSS=15]="DATA_LOSS";let hM=null;function hL(){return new TextEncoder}let hF=new v([0xffffffff,0xffffffff],0);function hV(e){let t=hL().encode(e),n=new w;return n.update(t),new Uint8Array(n.digest())}function hq(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new v([n,r],0),new v([i,s],0)]}class hU{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new hB(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new hB(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new hB(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=v.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(v.fromNumber(n)));return 1===r.compare(hF)&&(r=new v([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,n]=hq(hV(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);if(!this.we(r))return!1}return!0}static create(e,t,n){let r=new hU(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.ge)return;let[t,n]=hq(hV(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);this.be(r)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class hB extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class hj{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,hz.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new hj(s4.min(),r,new aS(sj),l2,l9())}}class hz{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new hz(n,t,l9(),l9(),l9())}}class h${constructor(e,t,n,r){this.Se=e,this.removedTargetIds=t,this.key=n,this.De=r}}class hK{constructor(e,t){this.targetId=e,this.Ce=t}}class hG{constructor(e,t,n=aO.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class hH{constructor(){this.ve=0,this.Fe=hY(),this.Me=aO.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=l9(),t=l9(),n=l9();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:sx(38017,{changeType:i})}}),new hz(this.Me,this.xe,e,t,n)}Ke(){this.Oe=!1,this.Fe=hY()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,sN(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class hW{constructor(e){this.Ge=e,this.ze=new Map,this.je=l2,this.He=hQ(),this.Je=hQ(),this.Ze=new aS(sj)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.We(),n.Ne||n.Ke(),n.Le(e.resumeToken);break;case 2:n.We(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.Qe(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:sx(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){let t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){let o=r.target;if(lL(o))if(0===n){let e=new sJ(o.path);this.et(t,e,lc.newNoDocument(e,s4.min()))}else sN(1===n,20013,{expectedCount:n});else{let r=this._t(t);if(r!==n){var i,s;let n,o,a=this.ut(e),l=a?this.ct(a,e,r):1;0!==l&&(this.it(t),this.Ze=this.Ze.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),hM?.lt((i=e.Ce,s=this.Ge.ht(),n={localCacheCount:r,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(o=i.unchangedNames)&&(n.bloomFilter={applied:0===l,hashCount:o?.hashCount??0,bitmapLength:o?.bits?.bitmap?.length??0,padding:o?.bits?.padding??0,mightContain:e=>a?.mightContain(e)??!1}),n))}}}}ut(e){let t,n,r=e.Ce.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:o=0}=r;try{t=aV(i).toUint8Array()}catch(e){if(e instanceof aP)return sT("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new hU(t,s,o)}catch(e){return sT(e instanceof hB?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.ge?null:n}ct(e,t,n){return 2*(t.Ce.count!==n-this.Pt(e,t.targetId))}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){let t=new Map;this.ze.forEach((n,r)=>{let i=this.ot(r);if(i){if(n.current&&lL(i.target)){let t=new sJ(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,lc.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.Ke())}});let n=l9();this.Je.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));let r=new hj(e,t,this.Ze,this.je,n);return this.je=l2,this.He=hQ(),this.Je=hQ(),this.Ze=new aS(sj),r}Ye(e,t){if(!this.rt(e))return;let n=2*!!this.Et(e,t.key);this.nt(e).qe(t.key,n),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let r=this.nt(e);this.Et(e,t)?r.qe(t,1):r.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new hH,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new aN(sj),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new aN(sj),this.He=this.He.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||sC("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new hH),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function hQ(){return new aS(sJ.comparator)}function hY(){return new aS(sJ.comparator)}let hJ={asc:"ASCENDING",desc:"DESCENDING"},hX={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hZ={and:"AND",or:"OR"};class h0{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function h1(e,t){return e.useProto3Json||oS(t)?t:{value:t}}function h2(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function h6(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function h3(e){let t;return sN(!!e,49232),s4.fromTimestamp(new s5((t=aL(e)).seconds,t.nanos))}function h5(e,t){return h4(e,t).canonicalString()}function h4(e,t){let n=new sW(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function h8(e){let t=sW.fromString(e);return sN(uf(t),10190,{key:t.toString()}),t}function h7(e,t){return h5(e.databaseId,t.path)}function h9(e,t){let n=h8(t);if(n.get(1)!==e.databaseId.projectId)throw new sD(sA.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new sD(sA.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new sJ(ur(n))}function ue(e,t){return h5(e.databaseId,t)}function ut(e){let t=h8(e);return 4===t.length?sW.emptyPath():ur(t)}function un(e){return new sW(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ur(e){return sN(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function ui(e,t,n){return{name:h7(e,t),fields:n.value.mapValue.fields}}function us(e,t,n){let r=h9(e,t.name),i=h3(t.updateTime),s=t.createTime?h3(t.createTime):s4.min(),o=new lu({mapValue:{fields:t.fields}}),a=lc.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function uo(e,t){var n,r;let i;if(t instanceof hb)i={update:ui(e,t.key,t.value)};else if(t instanceof hS)i={delete:h7(e,t.key)};else if(t instanceof hI){let n;i={update:ui(e,t.key,t.data),updateMask:(r=t.fieldMask,n=[],r.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof hx))return sx(16599,{dt:t.type});i={verify:h7(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof hs)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ho)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof hl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof hu)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw sx(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:h2(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:sx(27497)),i}function ua(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?hg.updateTime(h3(n.updateTime)):void 0!==n.exists?hg.exists(n.exists):hg.none():hg.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let n;return n=null,"setToServerValue"in t?(sN("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new hs):"appendMissingElements"in t?n=new ho(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new hl(t.removeAllFromArray.values||[]):"increment"in t?n=new hu(e,t.increment):sx(16584,{proto:t}),new hf(sY.fromServerFormat(t.fieldPath),n)}):[];if(t.update){t.update.name;let n=h9(e,t.update.name),s=new lu({mapValue:{fields:t.update.fields}});return t.updateMask?new hI(n,s,new aR((t.updateMask.fieldPaths||[]).map(e=>sY.fromServerFormat(e))),r,i):new hb(n,s,r,i)}return t.delete?new hS(h9(e,t.delete),r):t.verify?new hx(h9(e,t.verify),r):sx(1463,{proto:t})}function ul(e,t){return{documents:[ue(e,t.path)]}}function uh(e,t){var n,r;let i,s={structuredQuery:{}},o=t.path;null!==t.collectionGroup?(i=o,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=o.popLast(),s.structuredQuery.from=[{collectionId:o.lastSegment()}]),s.parent=ue(e,i);let a=function(e){if(0!==e.length)return function e(t){var n;let r;return t instanceof ly?function(e){if("=="===e.op){if(ln(e.value))return{unaryFilter:{field:uc(e.field),op:"IS_NAN"}};if(lt(e.value))return{unaryFilter:{field:uc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ln(e.value))return{unaryFilter:{field:uc(e.field),op:"IS_NOT_NAN"}};if(lt(e.value))return{unaryFilter:{field:uc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:uc(e.field),op:hX[e.op],value:e.value}}}(t):t instanceof l_?1===(r=(n=t).getFilters().map(t=>e(t))).length?r[0]:{compositeFilter:{op:hZ[n.op],filters:r}}:sx(54877,{filter:t})}(l_.create(e,"and"))}(t.filters);a&&(s.structuredQuery.where=a);let l=function(e){if(0!==e.length)return e.map(e=>({field:uc(e.field),direction:hJ[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let h=h1(e,t.limit);return null!==h&&(s.structuredQuery.limit=h),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{ft:s,parent:i}}function uu(e){var t,n,r;let i,s,o,a,l=ut(e.parent),h=e.structuredQuery,u=h.from?h.from.length:0,c=null;if(u>0){sN(1===u,65062);let e=h.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];h.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=ud(e.unaryFilter.field);return ly.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=ud(e.unaryFilter.field);return ly.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=ud(e.unaryFilter.field);return ly.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=ud(e.unaryFilter.field);return ly.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return sx(61313);default:return sx(60726)}}(t):void 0!==t.fieldFilter?ly.create(ud(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return sx(58110);default:return sx(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?l_.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return sx(1026)}}(t.compositeFilter.op)):sx(30097,{filter:t})}(h.where))instanceof l_&&lb(i)?i.getFilters():[i]);let f=[];h.orderBy&&(f=h.orderBy.map(e=>new lg(ud(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let p=null;h.limit&&(p=oS(s="object"==typeof(t=h.limit)?t.value:t)?null:s);let g=null;h.startAt&&(o=!!(n=h.startAt).before,g=new ld(n.values||[],o));let m=null;return h.endAt&&(a=!(r=h.endAt).before,m=new ld(r.values||[],a)),new lU(l,c,f,d,p,"F",g,m)}function uc(e){return{fieldPath:e.canonicalString()}}function ud(e){return sY.fromServerFormat(e.fieldPath)}function uf(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function up(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class ug{constructor(e,t,n,r,i=s4.min(),s=s4.min(),o=aO.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new ug(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ug(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ug(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ug(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class um{constructor(e){this.yt=e}}function uy(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:u_(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:h7(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:h2(i,t.version.toTimestamp()),createTime:h2(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:uv(t.version)};else{if(!t.isUnknownDocument())return sx(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:uv(t.version)}}return r}function u_(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function uv(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function uw(e){let t=new s5(e.seconds,e.nanoseconds);return s4.fromTimestamp(t)}function ub(e,t){let n=(t.baseMutations||[]).map(t=>ua(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>ua(e.yt,t)),i=s5.fromMillis(t.localWriteTimeMs);return new hk(t.batchId,i,n,r)}function uI(e){var t;let n,r=uw(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?uw(e.lastLimboFreeSnapshotVersion):s4.min();return new ug(void 0!==e.query.documents?(sN(1===(n=(t=e.query).documents.length),1966,{count:n}),lK(lB(ut(t.documents[0])))):lK(uu(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,i,aO.fromBase64String(e.resumeToken))}function uC(e,t){let n,r=uv(t.snapshotVersion),i=uv(t.lastLimboFreeSnapshotVersion);n=lL(t.target)?ul(e.yt,t.target):uh(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:lO(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function uE(e){let t=uu({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?lW(t,t.limit,"L"):t}function uT(e,t){return new hA(t.largestBatchId,ua(e.yt,t.overlayMutation))}function uS(e,t){let n=t.path.lastSegment();return[e,oN(t.path.popLast()),n]}function ux(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:uv(r.readTime),documentKey:oN(r.documentKey.path),largestBatchId:r.largestBatchId}}class uk{getBundleMetadata(e,t){return aI(e,o8).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:uw(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return aI(e,o8).put({bundleId:t.id,createTime:uv(h3(t.createTime)),version:t.version})}getNamedQuery(e,t){return aI(e,o7).get(t).next(e=>{if(e)return{name:e.name,query:uE(e.bundledQuery),readTime:uw(e.readTime)}})}saveNamedQuery(e,t){return aI(e,o7).put({name:t.name,readTime:uv(h3(t.readTime)),bundledQuery:t.bundledQuery})}}class uN{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new uN(e,t.uid||"")}getOverlay(e,t){return aI(e,ah).get(uS(this.userId,t)).next(e=>e?uT(this.serializer,e):null)}getOverlays(e,t){let n=l4();return ou.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new hA(t,i);r.push(this.bt(e,s))}),ou.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(oN(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(aI(e,ah).X(ac,r))}),ou.waitFor(i)}getOverlaysForCollection(e,t,n){let r=l4(),i=oN(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,1/0],!0);return aI(e,ah).H(ac,s).next(e=>{for(let t of e){let e=uT(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i,s=l4(),o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,1/0],!0);return aI(e,ah).ee({index:af,range:o},(e,t,n)=>{let o=uT(this.serializer,t);s.size()<r||o.largestBatchId===i?(s.set(o.getKey(),o),i=o.largestBatchId):n.done()}).next(()=>s)}bt(e,t){return aI(e,ah).put(function(e,t,n){let[r,i,s]=uS(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:uo(e.yt,n.mutation)}}(this.serializer,this.userId,t))}}class uA{St(e){return aI(e,ag)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=e?.value;return t?aO.fromUint8Array(t):aO.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class uD{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(aF(e.integerValue));else if("doubleValue"in e){let n=aF(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),ox(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=aL(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(aV(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?lo(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):li(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):sx(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let n=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(n)))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let r=n[aZ].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(aF(r)),this.Ot(aZ,t),this.Ct(n[aZ],t)}qt(e,t){let n=e.values||[];for(let e of(this.Ft(t,50),n))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),sJ.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function uR(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}uD.Wt=new uD;class uP{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ht(n.value),n=t.next();this.Jt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{let e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){let t=this.en(e),n=uR(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),n=uR(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,n=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),r=!!(128&n[0]);n[0]^=r?255:128;for(let e=1;e<n.length;++e)n[e]^=255*!!r;return n}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Ht(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class uO{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class uM{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class uL{constructor(){this.cn=new uP,this.ascending=new uO(this.cn),this.descending=new uM(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class uF{constructor(e,t,n,r){this.hn=e,this.Pn=t,this.Tn=n,this.In=r}En(){let e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.In,0),t!==e?n.set([0],this.In.length):++n[n.length-1],new uF(this.hn,this.Pn,this.Tn,n)}Rn(e,t,n){return{indexId:this.hn,uid:e,arrayValue:uU(this.Tn),directionalValue:uU(this.In),orderedDocumentKey:uU(t),documentKey:n.path.toArray()}}An(e,t,n){let r=this.Rn(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function uV(e,t){let n=e.hn-t.hn;return 0!==n||0!==(n=uq(e.Tn,t.Tn))||0!==(n=uq(e.In,t.In))?n:sJ.comparator(e.Pn,t.Pn)}function uq(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}function uU(e){return el()?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):e}function uB(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)}class uj{constructor(e){for(const t of(this.Vn=new aN((e,t)=>sY.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.mn.push(t)}get fn(){return this.Vn.size>1}gn(e){if(sN(e.collectionGroup===this.collectionId,49279),this.fn)return!1;let t=s7(e);if(void 0!==t&&!this.pn(t))return!1;let n=s9(e),r=new Set,i=0,s=0;for(;i<n.length&&this.pn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.yn(e,t)||!this.wn(this.dn[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.dn.length||!this.wn(this.dn[s++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new aN(sY.comparator),t=[];for(let n of this.mn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new ot(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new ot(n.field,0))}for(let n of this.dn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new ot(n.field,+("asc"!==n.dir))));return new s8(s8.UNKNOWN_ID,this.collectionId,t,on.empty())}pn(e){for(let t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function uz(e){return e instanceof ly}function u$(e){return e instanceof l_&&lb(e)}function uK(e){return uz(e)||u$(e)||function(e){if(e instanceof l_&&lw(e)){for(let t of e.getFilters())if(!uz(t)&&!u$(t))return!1;return!0}return!1}(e)}function uG(e,t){return sN(e instanceof ly||e instanceof l_,38388),sN(t instanceof ly||t instanceof l_,25473),uW(e instanceof ly?t instanceof ly?l_.create([e,t],"and"):uH(e,t):t instanceof ly?uH(t,e):function(e,t){if(sN(e.filters.length>0&&t.filters.length>0,48005),lv(e)&&lv(t))return lC(e,t.getFilters());let n=lw(e)?e:t,r=lw(e)?t:e,i=n.filters.map(e=>uG(e,r));return l_.create(i,"or")}(e,t))}function uH(e,t){if(lv(t))return lC(t,e.getFilters());{let n=t.filters.map(t=>uG(e,t));return l_.create(n,"or")}}function uW(e){if(sN(e instanceof ly||e instanceof l_,11850),e instanceof ly)return e;let t=e.getFilters();if(1===t.length)return uW(t[0]);if(lI(e))return e;let n=t.map(e=>uW(e)),r=[];return n.forEach(t=>{t instanceof ly?r.push(t):t instanceof l_&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:l_.create(r,e.op)}class uQ{constructor(){this.Sn=new uY}addToCollectionParentIndex(e,t){return this.Sn.add(t),ou.resolve()}getCollectionParents(e,t){return ou.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return ou.resolve()}deleteFieldIndex(e,t){return ou.resolve()}deleteAllFieldIndexes(e){return ou.resolve()}createTargetIndexes(e,t){return ou.resolve()}getDocumentsMatchingTarget(e,t){return ou.resolve(null)}getIndexType(e,t){return ou.resolve(0)}getFieldIndexes(e,t){return ou.resolve([])}getNextCollectionGroupToUpdate(e){return ou.resolve(null)}getMinOffset(e,t){return ou.resolve(os.min())}getMinOffsetFromCollectionGroup(e,t){return ou.resolve(os.min())}updateCollectionGroup(e,t,n){return ou.resolve()}updateIndexEntries(e,t){return ou.resolve()}}class uY{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new aN(sW.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new aN(sW.comparator)).toArray()}}let uJ="IndexedDbIndexManager",uX=new Uint8Array(0);class uZ{constructor(e,t){this.databaseId=t,this.Dn=new uY,this.Cn=new l1(e=>lO(e),(e,t)=>lM(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});let i={collectionId:n,parent:oN(r)};return aI(e,o3).put(i)}return ou.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return aI(e,o3).H(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(oA(r.parent))}return n})}addFieldIndex(e,t){let n=aI(e,o9),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=aI(e,at);return i.next(e=>{n.put(ux(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=aI(e,o9),r=aI(e,at),i=aI(e,as);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=aI(e,o9),n=aI(e,as),r=aI(e,at);return t.X().next(()=>n.X()).next(()=>r.X())}createTargetIndexes(e,t){return ou.forEach(this.vn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new uj(t).bn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=aI(e,as),r=!0,i=new Map;return ou.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=l9(),r=[];return ou.forEach(i,(i,s)=>{sC(uJ,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${lO(t)}`);let o=function(e,t){let n=s7(t);if(void 0===n)return null;for(let t of lF(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),a=function(e,t){let n=new Map;for(let r of s9(t))for(let t of lF(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of s9(t)){let t=0===i.kind?lV(e,i.fieldPath,e.startAt):lq(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new ld(n,r)}(s,i),h=function(e,t){let n=[],r=!0;for(let i of s9(t)){let t=0===i.kind?lq(e,i.fieldPath,e.endAt):lV(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new ld(n,r)}(s,i),u=this.Mn(i,s,l),c=this.Mn(i,s,h),d=this.xn(i,s,a),f=this.On(i.indexId,o,u,l.inclusive,c,h.inclusive,d);return ou.forEach(f,i=>n.Z(i,t.limit).next(t=>{t.forEach(t=>{let n=sJ.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return ou.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(sN(t instanceof ly||t instanceof l_,34018),t instanceof ly)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=l_.create(n,t.op);return uK(r=uW(r))?r:(sN(r instanceof l_,64498),sN(lv(r),40251),sN(r.filters.length>1,57927),r.filters.reduce((e,t)=>uG(e,t)))}(function e(t){if(sN(t instanceof ly||t instanceof l_,20012),t instanceof ly){if(t instanceof lN){let e=t.value.arrayValue?.values?.map(e=>ly.create(t.field,"==",e))||[];return l_.create(e,"or")}return t}let n=t.filters.map(t=>e(t));return l_.create(n,t.op)}(e));return sN(uK(t),7391),uz(t)||u$(t)?[t]:t.getFilters()})(l_.create(e.filters,"and")).map(t=>lP(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}On(e,t,n,r,i,s,o){let a=(null!=t?t.length:1)*Math.max(n.length,i.length),l=a/(null!=t?t.length:1),h=[];for(let u=0;u<a;++u){let a=t?this.Nn(t[u/l]):uX,c=this.Bn(e,a,n[u%l],r),d=this.Ln(e,a,i[u%l],s),f=o.map(t=>this.Bn(e,a,t,!0));h.push(...this.createRange(c,d,f))}return h}Bn(e,t,n,r){let i=new uF(e,sJ.empty(),t,n);return r?i:i.En()}Ln(e,t,n,r){let i=new uF(e,sJ.empty(),t,n);return r?i.En():i}Fn(e,t){let n=new uj(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.gn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.vn(t);return ou.forEach(r,t=>this.Fn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new aN(sY.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}kn(e,t){let n=new uL;for(let r of s9(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.ln(r.kind);uD.Wt.Dt(e,i)}return n.un()}Nn(e){let t=new uL;return uD.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){let n,r=new uL;return uD.Wt.Dt(a7(this.databaseId,t),r.ln(0===(n=s9(e)).length?0:n[n.length-1].kind)),r.un()}xn(e,t,n){if(null===n)return[];let r=[];r.push(new uL);let i=0;for(let s of s9(e)){let e=n[i++];for(let n of r)if(this.qn(t,s.fieldPath)&&le(e))r=this.Un(r,s,e);else{let t=n.ln(s.kind);uD.Wt.Dt(e,t)}}return this.$n(r)}Mn(e,t,n){return this.xn(e,t,n.position)}$n(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Un(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new uL;r.seed(n.un()),uD.Wt.Dt(e,r.ln(t.kind)),i.push(r)}return i}qn(e,t){return!!e.filters.find(e=>e instanceof ly&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=aI(e,o9),r=aI(e,at);return(t?n.H(ae,IDBKeyRange.bound(t,t)):n.H()).next(e=>{let t=[];return ou.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{let r,i;t.push((r=n?new on(n.sequenceNumber,new os(uw(n.readTime),new sJ(oA(n.documentKey)),n.largestBatchId)):on.empty(),i=e.fields.map(([e,t])=>new ot(sY.fromServerFormat(e),t)),new s8(e.indexId,e.collectionGroup,i,r)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:sj(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=aI(e,o9),i=aI(e,at);return this.Wn(e).next(e=>r.H(ae,IDBKeyRange.bound(t,t)).next(t=>ou.forEach(t,t=>i.put(ux(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return ou.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?ou.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),ou.forEach(i,n=>this.Qn(e,t,n).next(t=>{let i=this.Gn(r,n);return t.isEqual(i)?ou.resolve():this.zn(e,r,n,t,i)}))))})}jn(e,t,n,r){return aI(e,as).put(r.Rn(this.uid,this.Kn(n,t.key),t.key))}Hn(e,t,n,r){return aI(e,as).delete(r.An(this.uid,this.Kn(n,t.key),t.key))}Qn(e,t,n){let r=aI(e,as),i=new aN(uV);return r.ee({index:aa,range:IDBKeyRange.only([n.indexId,this.uid,uU(this.Kn(n,t))])},(e,r)=>{i=i.add(new uF(n.indexId,t,uB(r.arrayValue),uB(r.directionalValue)))}).next(()=>i)}Gn(e,t){let n=new aN(uV),r=this.kn(t,e);if(null==r)return n;let i=s7(t);if(null!=i){let s=e.data.field(i.fieldPath);if(le(s))for(let i of s.arrayValue.values||[])n=n.add(new uF(t.indexId,e.key,this.Nn(i),r))}else n=n.add(new uF(t.indexId,e.key,uX,r));return n}zn(e,t,n,r,i){sC(uJ,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),o=t.getIterator(),a=aD(s),l=aD(o);for(;a||l;){let e=!1,t=!1;if(a&&l){let r=n(a,l);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(l),l=aD(o)):t?(i(a),a=aD(s)):(a=aD(s),l=aD(o))}}(r,i,uV,r=>{s.push(this.jn(e,t,n,r))},r=>{s.push(this.Hn(e,t,n,r))}),ou.waitFor(s)}Wn(e){let t=1;return aI(e,at).ee({index:ar,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>uV(e,t)).filter((e,t,n)=>!t||0!==uV(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=uV(i,e),s=uV(i,t);if(0===n)r[0]=e.En();else if(n>0&&s<0)r.push(i),r.push(i.En());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.Jn(r[e],r[e+1]))return[];let t=r[e].An(this.uid,uX,sJ.empty()),n=r[e+1].An(this.uid,uX,sJ.empty());i.push(IDBKeyRange.bound(t,n))}return i}Jn(e,t){return uV(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(u0)}getMinOffset(e,t){return ou.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||sx(44426))).next(u0)}}function u0(e){sN(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>oo(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new os(t.readTime,t.documentKey,n)}let u1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class u2{static withCacheSize(e){return new u2(e,u2.DEFAULT_COLLECTION_PERCENTILE,u2.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function u6(e,t,n){let r=e.store(oM),i=e.store(oU),s=[],o=IDBKeyRange.only(n.batchId),a=0,l=r.ee({range:o},(e,t,n)=>(a++,n.delete()));s.push(l.next(()=>{sN(1===a,47070,{batchId:n.batchId})}));let h=[];for(let e of n.mutations){var u,c;let r=(u=e.key.path,c=n.batchId,[t,oN(u),c]);s.push(i.delete(r)),h.push(e.key)}return ou.waitFor(s).next(()=>h)}function u3(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw sx(14731);t=e.noDocument}return JSON.stringify(t).length}u2.DEFAULT_COLLECTION_PERCENTILE=10,u2.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,u2.DEFAULT=new u2(0x2800000,u2.DEFAULT_COLLECTION_PERCENTILE,u2.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),u2.DISABLED=new u2(-1,0,0);class u5{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Zn={}}static wt(e,t,n,r){return sN(""!==e.uid,64387),new u5(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return u8(e).ee({index:oF,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=aI(e,oU),s=u8(e);return s.add({}).next(o=>{var a,l,h,u;let c,d;sN("number"==typeof o,49019);let f=new hk(o,t,n,r),p=(a=this.serializer,l=this.userId,c=f.baseMutations.map(e=>uo(a.yt,e)),d=f.mutations.map(e=>uo(a.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),g=[],m=new aN((e,t)=>sj(e.canonicalString(),t.canonicalString()));for(let e of r){let t=(h=this.userId,u=e.key.path,[h,oN(u),o]);m=m.add(e.key.path.popLast()),g.push(s.put(p)),g.push(i.put(t,oq))}return m.forEach(t=>{g.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[o]=f.keys()}),ou.waitFor(g).next(()=>f)})}lookupMutationBatch(e,t){return u8(e).get(t).next(e=>e?(sN(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),ub(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?ou.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.Zn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return u8(e).ee({index:oF,range:r},(e,t,r)=>{t.userId===this.userId&&(sN(t.batchId>=n,47524,{Yn:n}),i=ub(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),n=-1;return u8(e).ee({index:oF,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return u8(e).H(oF,t).next(e=>e.map(e=>ub(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,oN(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return aI(e,oU).ee({range:r},(n,r,s)=>{let[o,a,l]=n,h=oA(a);if(o===this.userId&&t.path.isEqual(h))return u8(e).get(l).next(e=>{if(!e)throw sx(61480,{er:n,batchId:l});sN(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(ub(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new aN(sj),r=[];return t.forEach(t=>{let i=[this.userId,oN(t.path)],s=IDBKeyRange.lowerBound(i),o=aI(e,oU).ee({range:s},(e,r,i)=>{let[s,o,a]=e,l=oA(o);s===this.userId&&t.path.isEqual(l)?n=n.add(a):i.done()});r.push(o)}),ou.waitFor(r).next(()=>this.tr(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,oN(n)],s=IDBKeyRange.lowerBound(i),o=new aN(sj);return aI(e,oU).ee({range:s},(e,t,i)=>{let[s,a,l]=e,h=oA(a);s===this.userId&&n.isPrefixOf(h)?h.length===r&&(o=o.add(l)):i.done()}).next(()=>this.tr(e,o))}tr(e,t){let n=[],r=[];return t.forEach(t=>{r.push(u8(e).get(t).next(e=>{if(null===e)throw sx(35274,{batchId:t});sN(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(ub(this.serializer,e))}))}),ou.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return u6(e.le,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),ou.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return ou.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return aI(e,oU).ee({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=oA(e[1]);r.push(t)}else n.done()}).next(()=>{sN(0===r.length,56720,{rr:r.map(e=>e.canonicalString())})})})}containsKey(e,t){return u4(e,this.userId,t)}ir(e){return aI(e,oO).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function u4(e,t,n){let r=[t,oN(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return aI(e,oU).ee({range:s,Y:!0},(e,n,r)=>{let[s,a,l]=e;s===t&&a===i&&(o=!0),r.done()}).next(()=>o)}function u8(e){return aI(e,oM)}class u7{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new u7(0)}static ar(){return new u7(-1)}}class u9{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{let n=new u7(t.highestTargetId);return t.highestTargetId=n.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>s4.fromTimestamp(new s5(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.ur(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.cr(e,r)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(n=>(n.targetCount+=1,this.hr(t,n),this.cr(e,n))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>aI(e,oQ).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(sN(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,n){let r=0,i=[];return aI(e,oQ).ee((s,o)=>{let a=uI(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))}).next(()=>ou.waitFor(i)).next(()=>r)}forEachTarget(e,t){return aI(e,oQ).ee((e,n)=>{t(uI(n))})}ur(e){return aI(e,o6).get(o2).next(e=>(sN(null!==e,2888),e))}cr(e,t){return aI(e,o6).put(o2,t)}lr(e,t){return aI(e,oQ).put(uC(this.serializer,t))}hr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){let n=lO(t),r=IDBKeyRange.bound([n,-1/0],[n,1/0]),i=null;return aI(e,oQ).ee({range:r,index:oY},(e,n,r)=>{let s=uI(n);lM(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=ce(e);return t.forEach(t=>{let s=oN(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),ou.waitFor(r)}removeMatchingKeys(e,t,n){let r=ce(e);return ou.forEach(t,t=>{let i=oN(t.path);return ou.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=ce(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=ce(e),i=l9();return r.ee({range:n,Y:!0},(e,t,n)=>{let r=new sJ(oA(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=oN(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return ce(e).ee({index:o0,Y:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}At(e,t){return aI(e,oQ).get(t).next(e=>e?uI(e):null)}}function ce(e){return aI(e,oX)}let ct="LruGarbageCollector";function cn([e,t],[n,r]){let i=sj(e,n);return 0===i?sj(t,r):i}class cr{constructor(e){this.Pr=e,this.buffer=new aN(cn),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>cn(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ci{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){sC(ct,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){oy(e)?sC(ct,"Ignoring IndexedDB error during garbage collection: ",e):await oh(e)}await this.Ar(3e5)})}}class cs{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ou.resolve(oT.ce);let n=new cr(t);return this.Vr.forEachTarget(e,e=>n.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>n.Er(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(sC("LruGarbageCollector","Garbage collection skipped; disabled"),ou.resolve(u1)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(sC("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),u1):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let n,r,i,s,o,a,l,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(sC("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),sI()<=y.DEBUG&&sC("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${r} in `+(o-s)+"ms\n"+`	Removed ${i} targets in `+(a-o)+"ms\n"+`	Removed ${e} documents in `+(l-a)+"ms\n"+`Total Duration: ${l-h}ms`),ou.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class co{constructor(e,t){this.db=e,this.garbageCollector=new cs(this,t)}dr(e){let t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,n)=>t(n))}addReference(e,t,n){return ca(e,n)}removeReference(e,t,n){return ca(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return ca(e,t)}wr(e,t){let n;return n=!1,aI(e,oO).te(r=>u4(e,r,t).next(e=>(e&&(n=!0),ou.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.yr(e,(s,o)=>{if(o<=t){let t=this.wr(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,s4.min()),ce(e).delete([0,oN(s.path)])))});r.push(t)}}).next(()=>ou.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return ca(e,t)}yr(e,t){let n=ce(e),r,i=oT.ce;return n.ee({index:o0},([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==oT.ce&&t(new sJ(oA(r)),i),i=o,r=s):i=oT.ce}).next(()=>{i!==oT.ce&&t(new sJ(oA(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ca(e,t){var n;return ce(e).put((n=e.currentSequenceNumber,{targetId:0,path:oN(t.path),sequenceNumber:n}))}class cl{constructor(){this.changes=new l1(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,lc.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?ou.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ch{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return aI(e,oB).put(n)}removeEntry(e,t,n){let r;return aI(e,oB).delete([(r=t.path.toArray()).slice(0,r.length-2),r[r.length-2],u_(n),r[r.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.br(e,n)))}getEntry(e,t){let n=lc.newInvalidDocument(t);return aI(e,oB).ee({index:oz,range:IDBKeyRange.only(cc(t))},(e,r)=>{n=this.Sr(t,r)}).next(()=>n)}Dr(e,t){let n={size:0,document:lc.newInvalidDocument(t)};return aI(e,oB).ee({index:oz,range:IDBKeyRange.only(cc(t))},(e,r)=>{n={document:this.Sr(t,r),size:u3(r)}}).next(()=>n)}getEntries(e,t){let n=l2;return this.Cr(e,t,(e,t)=>{let r=this.Sr(e,t);n=n.insert(e,r)}).next(()=>n)}vr(e,t){let n=l2,r=new aS(sJ.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Sr(e,t);n=n.insert(e,i),r=r.insert(e,u3(t))}).next(()=>({documents:n,Fr:r}))}Cr(e,t,n){if(t.isEmpty())return ou.resolve();let r=new aN(cf);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(cc(r.first()),cc(r.last())),s=r.getIterator(),o=s.getNext();return aI(e,oB).ee({index:oz,range:i},(e,t,r)=>{let i=sJ.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&0>cf(o,i);)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.j(cc(o)):r.done()}).next(()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,o=[s.popLast().toArray(),s.lastSegment(),u_(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return aI(e,oB).H(IDBKeyRange.bound(o,a,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let n=l2;for(let i of e){let e=this.Sr(sJ.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(lX(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=l2,s=cd(t,n),o=cd(t,os.max());return aI(e,oB).ee({index:oK,range:IDBKeyRange.bound(s,o,!0)},(e,t,n)=>{let s=this.Sr(sJ.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new cu(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return aI(e,oH).get(oW).next(e=>(sN(!!e,20021),e))}br(e,t){return aI(e,oH).put(oW,t)}Sr(e,t){if(t){let e=function(e,t){var n;let r,i;if(t.document)r=us(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=sJ.fromSegments(t.noDocument.path),n=uw(t.noDocument.readTime);r=lc.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return sx(56709);{let e=sJ.fromSegments(t.unknownDocument.path),n=uw(t.unknownDocument.version);r=lc.newUnknownDocument(e,n)}}return t.readTime&&r.setReadTime((i=new s5((n=t.readTime)[0],n[1]),s4.fromTimestamp(i))),r}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(s4.min())))return e}return lc.newInvalidDocument(e)}}class cu extends cl{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new l1(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new aN((e,t)=>sj(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let o=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,o.readTime)),s.isValidDocument()){let a=uy(this.Mr.serializer,s);r=r.add(i.path.popLast());let l=u3(a);n+=l-o.size,t.push(this.Mr.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){let n=uy(this.Mr.serializer,s.convertToNoDocument(s4.min()));t.push(this.Mr.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Mr.updateMetadata(e,n)),ou.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(({documents:e,Fr:t})=>(t.forEach((t,n)=>{this.Or.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function cc(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function cd(e,t){let n=t.documentKey.path.toArray();return[e,u_(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function cf(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=sj(n[e],r[e]))return i;return(i=sj(n.length,r.length))||(i=sj(n[n.length-2],r[r.length-2]))||sj(n[n.length-1],r[r.length-1])}class cp{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class cg{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&hv(n.mutation,e,aR.empty(),s5.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,l9()).next(()=>t))}getLocalViewOfDocuments(e,t,n=l9()){let r=l4();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=l3();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=l4();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,l9()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=l2,s=l4(),o=l4();return t.forEach((e,t)=>{let o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof hI)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),hv(o.mutation,t,o.mutation.getFieldMask(),s5.now())):s.set(t.key,aR.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>o.set(e,new cp(t,s.get(e)??null))),o))}recalculateAndSaveOverlays(e,t){let n=l4(),r=new aS((e,t)=>e-t),i=l9();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let o=n.get(e)||aR.empty();o=i.applyToLocalView(s,o),n.set(e,o);let a=(r.get(i.batchId)||l9()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{let s=[],o=r.getReverseIterator();for(;o.hasNext();){let r=o.getNext(),a=r.key,l=r.value,h=l4();l.forEach(e=>{if(!i.has(e)){let r=h_(t.get(e),n.get(e));null!==r&&h.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,h))}return ou.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return sJ.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):lz(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ou.resolve(l4()),o=-1,a=i;return s.next(t=>ou.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?ou.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,l9())).next(e=>({batchId:o,changes:l5(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new sJ(t)).next(e=>{let t=l3();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=l3();return this.indexManager.getCollectionParents(e,i).next(o=>ou.forEach(o,o=>{let a=new lU(o.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,lc.newInvalidDocument(r)))});let n=l3();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&hv(s.mutation,r,aR.empty(),s5.now()),lX(t,r)&&(n=n.insert(e,r))}),n})}}class cm{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return ou.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,{id:t.id,version:t.version,createTime:h3(t.createTime)}),ou.resolve()}getNamedQuery(e,t){return ou.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,{name:t.name,query:uE(t.bundledQuery),readTime:h3(t.readTime)}),ou.resolve()}}class cy{constructor(){this.overlays=new aS(sJ.comparator),this.Lr=new Map}getOverlay(e,t){return ou.resolve(this.overlays.get(t))}getOverlays(e,t){let n=l4();return ou.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.bt(e,t,r)}),ou.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.Lr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(n)),ou.resolve()}getOverlaysForCollection(e,t,n){let r=l4(),i=t.length+1,s=new sJ(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){let e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ou.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new aS((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=l4(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=l4(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return ou.resolve(o)}bt(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.Lr.get(r.largestBatchId).delete(n.key);this.Lr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new hA(t,n));let i=this.Lr.get(t);void 0===i&&(i=l9(),this.Lr.set(t,i)),this.Lr.set(t,i.add(n.key))}}class c_{constructor(){this.sessionToken=aO.EMPTY_BYTE_STRING}getSessionToken(e){return ou.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ou.resolve()}}class cv{constructor(){this.kr=new aN(cw.Kr),this.qr=new aN(cw.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let n=new cw(e,t);this.kr=this.kr.add(n),this.qr=this.qr.add(n)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new cw(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){let t=new sJ(new sW([])),n=new cw(t,e),r=new cw(t,e+1),i=[];return this.qr.forEachInRange([n,r],e=>{this.Wr(e),i.push(e.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new sJ(new sW([])),n=new cw(t,e),r=new cw(t,e+1),i=l9();return this.qr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new cw(e,0),n=this.kr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class cw{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return sJ.comparator(e.key,t.key)||sj(e.Hr,t.Hr)}static Ur(e,t){return sj(e.Hr,t.Hr)||sJ.comparator(e.key,t.key)}}class cb{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new aN(cw.Kr)}checkEmpty(e){return ou.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new hk(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Jr=this.Jr.add(new cw(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ou.resolve(s)}lookupMutationBatch(e,t){return ou.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.Xr(t+1),r=n<0?0:n;return ou.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return ou.resolve(0===this.mutationQueue.length?-1:this.Yn-1)}getAllMutationBatches(e){return ou.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new cw(t,0),r=new cw(t,1/0),i=[];return this.Jr.forEachInRange([n,r],e=>{let t=this.Zr(e.Hr);i.push(t)}),ou.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new aN(sj);return t.forEach(e=>{let t=new cw(e,0),r=new cw(e,1/0);this.Jr.forEachInRange([t,r],e=>{n=n.add(e.Hr)})}),ou.resolve(this.Yr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;sJ.isDocumentKey(i)||(i=i.child(""));let s=new cw(new sJ(i),0),o=new aN(sj);return this.Jr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Hr)),!0)},s),ou.resolve(this.Yr(o))}Yr(e){let t=[];return e.forEach(e=>{let n=this.Zr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){sN(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Jr;return ou.forEach(t.mutations,r=>{let i=new cw(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Jr=n})}nr(e){}containsKey(e,t){let n=new cw(t,0),r=this.Jr.firstAfterOrEqual(n);return ou.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ou.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class cI{constructor(e){this.ti=e,this.docs=new aS(sJ.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ti(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return ou.resolve(n?n.document.mutableCopy():lc.newInvalidDocument(t))}getEntries(e,t){let n=l2;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():lc.newInvalidDocument(e))}),ou.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=l2,s=t.path,o=new sJ(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){let{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=oo(oi(o),n)||(r.has(o.key)||lX(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ou.resolve(i)}getAllFromCollectionGroup(e,t,n,r){sx(9500)}ni(e,t){return ou.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new cC(this)}getSize(e){return ou.resolve(this.size)}}class cC extends cl{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(n)}),ou.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class cE{constructor(e){this.persistence=e,this.ri=new l1(e=>lO(e),lM),this.lastRemoteSnapshotVersion=s4.min(),this.highestTargetId=0,this.ii=0,this.si=new cv,this.targetCount=0,this.oi=u7._r()}forEachTarget(e,t){return this.ri.forEach((e,n)=>t(n)),ou.resolve()}getLastRemoteSnapshotVersion(e){return ou.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ou.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),ou.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ii&&(this.ii=t),ou.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new u7(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,ou.resolve()}updateTargetData(e,t){return this.lr(t),ou.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,ou.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.ri.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.ri.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),ou.waitFor(i).next(()=>r)}getTargetCount(e){return ou.resolve(this.targetCount)}getTargetData(e,t){let n=this.ri.get(t)||null;return ou.resolve(n)}addMatchingKeys(e,t,n){return this.si.$r(t,n),ou.resolve()}removeMatchingKeys(e,t,n){this.si.Qr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),ou.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),ou.resolve()}getMatchingKeysForTargetId(e,t){let n=this.si.jr(t);return ou.resolve(n)}containsKey(e,t){return ou.resolve(this.si.containsKey(t))}}class cT{constructor(e,t){this._i={},this.overlays={},this.ai=new oT(0),this.ui=!1,this.ui=!0,this.ci=new c_,this.referenceDelegate=e(this),this.li=new cE(this),this.indexManager=new uQ,this.remoteDocumentCache=new cI(e=>this.referenceDelegate.hi(e)),this.serializer=new um(t),this.Pi=new cm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new cy,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this._i[e.toKey()];return n||(n=new cb(t,this.referenceDelegate),this._i[e.toKey()]=n),n}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,n){sC("MemoryPersistence","Starting transaction:",e);let r=new cS(this.ai.next());return this.referenceDelegate.Ti(),n(r).next(e=>this.referenceDelegate.Ii(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ei(e,t){return ou.or(Object.values(this._i).map(n=>()=>n.containsKey(e,t)))}}class cS extends ol{constructor(e){super(),this.currentSequenceNumber=e}}class cx{constructor(e){this.persistence=e,this.Ri=new cv,this.Ai=null}static Vi(e){return new cx(e)}get di(){if(this.Ai)return this.Ai;throw sx(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.di.delete(n.toString()),ou.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.di.add(n.toString()),ou.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),ou.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ou.forEach(this.di,n=>{let r=sJ.fromPath(n);return this.mi(e,r).next(e=>{e||t.removeEntry(r,s4.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return ou.or([()=>ou.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class ck{constructor(e,t){this.persistence=e,this.fi=new l1(e=>oN(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new cs(this,t)}static Vi(e,t){return new ck(e,t)}Ti(){}Ii(e){return ou.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return ou.forEach(this.fi,(n,r)=>this.wr(e,n,r).next(e=>e?ou.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ni(e,r=>this.wr(e,r,t).next(e=>{e||(n++,i.removeEntry(r,s4.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),ou.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),ou.resolve()}removeReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),ou.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),ou.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(a1(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=a$(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return aV(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,aE(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw sx(13486,{value:t})}}(e.data.value)),t}wr(e,t,n){return ou.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return ou.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class cN{constructor(e){this.serializer=e}k(e,t,n,r){let i=new od("createOrUpgrade",t);n<1&&r>=1&&(e.createObjectStore(oR),e.createObjectStore(oO,{keyPath:"userId"}),e.createObjectStore(oM,{keyPath:oL,autoIncrement:!0}).createIndex(oF,oV,{unique:!0}),e.createObjectStore(oU),cA(e),e.createObjectStore(oD));let s=ou.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore(oX),e.deleteObjectStore(oQ),e.deleteObjectStore(o6),cA(e)),s=s.next(()=>{let e,t;return e=i.store(o6),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:s4.min().toTimestamp(),targetCount:0},e.put(o2,t)})),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store(oM).H().next(t=>{e.deleteObjectStore(oM),e.createObjectStore(oM,{keyPath:oL,autoIncrement:!0}).createIndex(oF,oV,{unique:!0});let n=i.store(oM),r=t.map(e=>n.put(e));return ou.waitFor(r)}))),s=s.next(()=>{e.createObjectStore(o4,{keyPath:"clientId"})})),n<5&&r>=5&&(s=s.next(()=>this.gi(i))),n<6&&r>=6&&(s=s.next(()=>(e.createObjectStore(oH),this.pi(i)))),n<7&&r>=7&&(s=s.next(()=>this.yi(i))),n<8&&r>=8&&(s=s.next(()=>this.wi(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.bi(i))),n<11&&r>=11&&(s=s.next(()=>{e.createObjectStore(o8,{keyPath:"bundleId"}),e.createObjectStore(o7,{keyPath:"name"})})),n<12&&r>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(ah,{keyPath:au})).createIndex(ac,ad,{unique:!1}),t.createIndex(af,ap,{unique:!1})})),n<13&&r>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(oB,{keyPath:oj})).createIndex(oz,o$),t.createIndex(oK,oG)}).next(()=>this.Si(e,i)).next(()=>e.deleteObjectStore(oD))),n<14&&r>=14&&(s=s.next(()=>this.Di(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore(o9,{keyPath:"indexId",autoIncrement:!0}).createIndex(ae,"collectionGroup",{unique:!1}),e.createObjectStore(at,{keyPath:an}).createIndex(ar,ai,{unique:!1}),e.createObjectStore(as,{keyPath:ao}).createIndex(aa,al,{unique:!1})})),n<16&&r>=16&&(s=s.next(()=>{t.objectStore(at).clear()}).next(()=>{t.objectStore(as).clear()})),n<17&&r>=17&&(s=s.next(()=>{e.createObjectStore(ag,{keyPath:"name"})})),n<18&&r>=18&&el()&&(s=s.next(()=>{t.objectStore(at).clear()}).next(()=>{t.objectStore(as).clear()})),s}pi(e){let t=0;return e.store(oD).ee((e,n)=>{t+=u3(n)}).next(()=>{let n={byteSize:t};return e.store(oH).put(oW,n)})}gi(e){let t=e.store(oO),n=e.store(oM);return t.H().next(t=>ou.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.H(oF,r).next(n=>ou.forEach(n,n=>{sN(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});let r=ub(this.serializer,n);return u6(e,t.userId,r).next(()=>{})}))}))}yi(e){let t=e.store(oX),n=e.store(oD);return e.store(o6).get(o2).next(e=>{let r=[];return n.ee((n,i)=>{let s=new sW(n),o=[0,oN(s)];r.push(t.get(o).next(n=>n?ou.resolve():t.put({targetId:0,path:oN(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>ou.waitFor(r))})}wi(e,t){e.createObjectStore(o3,{keyPath:o5});let n=t.store(o3),r=new uY,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:oN(r)})}};return t.store(oD).ee({Y:!0},(e,t)=>i(new sW(e).popLast())).next(()=>t.store(oU).ee({Y:!0},([e,t,n],r)=>i(oA(t).popLast())))}bi(e){let t=e.store(oQ);return t.ee((e,n)=>{let r=uI(n),i=uC(this.serializer,r);return t.put(i)})}Si(e,t){let n=t.store(oD),r=[];return n.ee((e,n)=>{let i=t.store(oB),s=(n.document?new sJ(sW.fromString(n.document.name).popFirst(5)):n.noDocument?sJ.fromSegments(n.noDocument.path):n.unknownDocument?sJ.fromSegments(n.unknownDocument.path):sx(36783)).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))}).next(()=>ou.waitFor(r))}Di(e,t){let n=t.store(oM),r=new ch(this.serializer),i=new cT(cx.Vi,this.serializer.yt);return n.H().next(e=>{let n=new Map;return e.forEach(e=>{let t=n.get(e.userId)??l9();ub(this.serializer,e).keys().forEach(e=>t=t.add(e)),n.set(e.userId,t)}),ou.forEach(n,(e,n)=>{let s=new sv(n),o=uN.wt(this.serializer,s),a=i.getIndexManager(s);return new cg(r,u5.wt(s,this.serializer,a,i.referenceDelegate),o,a).recalculateAndSaveOverlaysForDocumentKeys(new ab(t,oT.ce),e).next()})})}}function cA(e){e.createObjectStore(oX,{keyPath:oZ}).createIndex(o0,o1,{unique:!0}),e.createObjectStore(oQ,{keyPath:"targetId"}).createIndex(oY,oJ,{unique:!0}),e.createObjectStore(o6)}let cD="IndexedDbPersistence",cR="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class cP{constructor(e,t,n,r,i,s,o,a,l,h,u=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Ci=i,this.window=s,this.document=o,this.Fi=l,this.Mi=h,this.xi=u,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=-1/0,this.ki=e=>Promise.resolve(),!cP.v())throw new sD(sA.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new co(this,r),this.Ki=t+"main",this.serializer=new um(a),this.qi=new of(this.Ki,this.xi,new cN(this.serializer)),this.ci=new uA,this.li=new u9(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new ch(this.serializer),this.Pi=new uk,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===h&&sE(cD,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new sD(sA.FAILED_PRECONDITION,cR);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new oT(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>aI(e,o4).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(oy(e))return sC(cD,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return sC(cD,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return aI(e,oR).get(oP).next(e=>ou.resolve(this.Xi(e)))}Yi(e){return aI(e,o4).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,18e5)){this.Li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=aI(e,o4);return t.H().next(e=>{let n=this.ns(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return ou.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?ou.resolve(!0):aI(e,oR).get(oP).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,5e3)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new sD(sA.FAILED_PRECONDITION,cR);return!1}}return!(!this.networkEnabled||!this.inForeground)||aI(e,o4).H().next(e=>void 0===this.ns(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&sC(cD,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[oR,o4],e=>{let t=new ab(e,oT.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>aI(e,o4).H().next(e=>this.ns(e,18e5).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return u5.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new uZ(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return uN.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,n){var r;let i;sC(cD,"Starting transaction:",e);let s=18===(r=this.xi)||17===r?aw:16===r||15===r?av:14===r||13===r?a_:12===r?ay:11===r?am:void sx(60245);return this.qi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new ab(r,this.ai?this.ai.next():oT.ce),"readwrite-primary"===t?this.ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw sE(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new sD(sA.FAILED_PRECONDITION,oa);return n(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ps(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ps(e){return aI(e,oR).get(oP).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,5e3)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new sD(sA.FAILED_PRECONDITION,cR)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return aI(e,oR).put(oP,t)}static v(){return of.v()}Ji(e){let t=aI(e,oR);return t.get(oP).next(e=>this.Xi(e)?(sC(cD,"Releasing primary lease."),t.delete(oP)):ou.resolve())}ts(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(sE(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){"function"==typeof this.window?.addEventListener&&(this.Oi=()=>{this._s();let e=/(?:Version|Mobile)\/1[456]/;ea()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{let t=null!==this.Ui?.getItem(this.rs(e));return sC(cD,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return sE(cD,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){sE("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function cO(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class cM{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Ts=n,this.Is=r}static Es(e,t){let n=l9(),r=l9();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new cM(e,t.fromCache,n,r)}}class cL{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class cF{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=ea()?8:op(en())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.gs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ps(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new cL;return this.ys(e,t,n).next(r=>{if(i.result=r,this.As)return this.ws(e,t,n,r.size)})}).next(()=>i.result)}ws(e,t,n,r){return n.documentReadCount<this.Vs?(sI()<=y.DEBUG&&sC("QueryEngine","SDK will not create cache indexes for query:",lJ(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),ou.resolve()):(sI()<=y.DEBUG&&sC("QueryEngine","Query:",lJ(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ds*r?(sI()<=y.DEBUG&&sC("QueryEngine","The SDK decides to create cache indexes for query:",lJ(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,lK(t))):ou.resolve())}gs(e,t){if(lj(t))return ou.resolve(null);let n=lK(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=lK(t=lW(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=l9(...r);return this.fs.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.bs(t,r);return this.Ss(t,s,i,n.readTime)?this.gs(e,lW(t,null,"F")):this.Ds(e,s,t,n)}))})))}ps(e,t,n,r){return lj(t)||r.isEqual(s4.min())?ou.resolve(null):this.fs.getDocuments(e,n).next(i=>{let s=this.bs(t,i);return this.Ss(t,s,n,r)?ou.resolve(null):(sI()<=y.DEBUG&&sC("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),lJ(t)),this.Ds(e,s,t,or(r,-1)).next(e=>e))})}bs(e,t){let n=new aN(l0(e));return t.forEach((t,r)=>{lX(e,r)&&(n=n.add(r))}),n}Ss(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}ys(e,t,n){return sI()<=y.DEBUG&&sC("QueryEngine","Using full collection scan to execute query:",lJ(t)),this.fs.getDocumentsMatchingQuery(e,t,os.min(),n)}Ds(e,t,n,r){return this.fs.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let cV="LocalStore";class cq{constructor(e,t,n,r){this.persistence=e,this.Cs=t,this.serializer=r,this.vs=new aS(sj),this.Fs=new l1(e=>lO(e),lM),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(n)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cg(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}async function cU(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Os(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],o=l9();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))o=o.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))o=o.add(t.key);return e.localDocuments.getDocuments(n,o).next(e=>({Ns:e,removedBatchIds:i,addedBatchIds:s}))})})}function cB(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function cj(e,t,n){let r=l9(),i=l9();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=l2;return n.forEach((n,s)=>{let o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(s4.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):sC(cV,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{Bs:r,Ls:i}})}function cz(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.li.getTargetData(n,t).next(i=>i?(r=i,ou.resolve(r)):e.li.allocateTargetId(n).next(i=>(r=new ug(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.li.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.vs.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.vs=e.vs.insert(n.targetId,n),e.Fs.set(t,n.targetId)),n})}async function c$(e,t,n){let r=e.vs.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!oy(e))throw e;sC(cV,`Failed to update sequence numbers for target ${t}: ${e}`)}e.vs=e.vs.remove(t),e.Fs.delete(r.target)}function cK(e,t,n){let r=s4.min(),i=l9();return e.persistence.runTransaction("Execute query","readwrite",s=>{var o;let a;return(o=lK(t),void 0!==(a=e.Fs.get(o))?ou.resolve(e.vs.get(a)):e.li.getTargetData(s,o)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.li.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,n?r:s4.min(),n?i:l9())).next(n=>(cW(e,lZ(t),n),{documents:n,ks:i}))})}function cG(e,t){let n=e.li,r=e.vs.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n.At(e,t).next(e=>e?e.target:null))}function cH(e,t){let n=e.Ms.get(t)||s4.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.xs.getAllFromCollectionGroup(r,t,or(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(cW(e,t,n),n))}function cW(e,t,n){let r=e.Ms.get(t)||s4.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Ms.set(t,r)}async function cQ(e,t,n,r){let i=l9(),s=l2;for(let e of n){let n=t.Ks(e.metadata.name);e.document&&(i=i.add(n));let r=t.qs(e);r.setReadTime(t.Us(e.metadata.readTime)),s=s.insert(n,r)}let o=e.xs.newChangeBuffer({trackRemovals:!0}),a=await cz(e,lK(lB(sW.fromString(`__bundle__/docs/${r}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>cj(t,o,s).next(e=>(o.apply(t),e)).next(n=>e.li.removeMatchingKeysForTargetId(t,a.targetId).next(()=>e.li.addMatchingKeys(t,i,a.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.Bs,n.Ls)).next(()=>n.Bs)))}async function cY(e,t,n=l9()){let r=await cz(e,lK(uE(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=h3(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.Pi.saveNamedQuery(i,t);let o=r.withResumeToken(aO.EMPTY_BYTE_STRING,s);return e.vs=e.vs.insert(o.targetId,o),e.li.updateTargetData(i,o).next(()=>e.li.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.li.addMatchingKeys(i,n,r.targetId)).next(()=>e.Pi.saveNamedQuery(i,t))})}let cJ="firestore_clients";function cX(e,t){return`${cJ}_${e}_${t}`}let cZ="firestore_mutations";function c0(e,t,n){let r=`${cZ}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}let c1="firestore_targets";function c2(e,t){return`${c1}_${e}_${t}`}let c6="SharedClientState";class c3{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static $s(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new sD(r.error.code,r.error.message)),s?new c3(e,t,r.state,i):(sE(c6,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class c5{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static $s(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new sD(n.error.code,n.error.message)),i?new c5(e,n.state,r):(sE(c6,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class c4{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=he;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=ok(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new c4(e,i):(sE(c6,`Failed to parse client data for instance '${e}': ${t}`),null)}}class c8{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new c8(t.clientId,t.onlineState):(sE(c6,`Failed to parse online state: ${e}`),null)}}class c7{constructor(){this.activeTargetIds=he}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class c9{constructor(e,t,n,r,i){var s,o,a;this.window=e,this.Ci=t,this.persistenceKey=n,this.zs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new aS(sj),this.started=!1,this.Zs=[];const l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=cX(this.persistenceKey,this.zs),this.Ys=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Js=this.Js.insert(this.zs,new c7),this.eo=RegExp(`^${cJ}_${l}_([^_]*)$`),this.no=RegExp(`^${cZ}_${l}_(\\d+)(?:_(.*))?$`),this.ro=RegExp(`^${c1}_${l}_(\\d+)$`),this.io=(o=this.persistenceKey,`firestore_online_state_${o}`),this.so=(a=this.persistenceKey,`firestore_bundle_loaded_v2_${a}`),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.hs())){if(e===this.zs)continue;let t=this.getItem(cX(this.persistenceKey,e));if(t){let n=c4.$s(e,t);n&&(this.Js=this.Js.insert(n.clientId,n))}}this.oo();let e=this.storage.getItem(this.io);if(e){let t=this._o(e);t&&this.ao(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,n){this.co(e,t,n),this.lo(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(c2(this.persistenceKey,e));if(t){let r=c5.$s(e,t);r&&(n=r.state)}}return t&&this.ho.Qs(e),this.oo(),n}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(c2(this.persistenceKey,e))}updateQueryState(e,t,n){this.Po(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.lo(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return sC(c6,"READ",e,t),t}setItem(e,t){sC(c6,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){sC(c6,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(sC(c6,"EVENT",e.key,e.newValue),e.key===this.Xs)return void sE("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.eo.test(e.key)){if(null==e.newValue){let t=this.Eo(e.key);return this.Ro(t,null)}{let t=this.Ao(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.no.test(e.key)){if(null!==e.newValue){let t=this.Vo(e.key,e.newValue);if(t)return this.mo(t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(e.key===this.io){if(null!==e.newValue){let t=this._o(e.newValue);if(t)return this.ao(t)}}else if(e.key===this.Ys){let t=function(e){let t=oT.ce;if(null!=e)try{let n=JSON.parse(e);sN("number"==typeof n,30636,{yo:e}),t=n}catch(e){sE(c6,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==oT.ce&&this.sequenceNumberHandler(t)}else if(e.key===this.so){let t=this.wo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,n){let r=new c3(this.currentUser,e,t,n),i=c0(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ws())}lo(e){let t=c0(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){let t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,n){let r=c2(this.persistenceKey,e),i=new c5(e,t,n);this.setItem(r,i.Ws())}Io(e){let t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){let t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){let n=this.Eo(e);return c4.$s(n,t)}Vo(e,t){let n=this.no.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return c3.$s(new sv(i),r,t)}fo(e,t){let n=Number(this.ro.exec(e)[1]);return c5.$s(n,t)}_o(e){return c8.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);sC(c6,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){let n=t?this.Js.insert(e,t):this.Js.remove(e),r=this.uo(this.Js),i=this.uo(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.Co(s,o).then(()=>{this.Js=n})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=he;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class de{constructor(){this.vo=new c7,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,n){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new c7,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class dt{Mo(e){}shutdown(){}}let dn="ConnectivityMonitor";class dr{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){for(let e of(sC(dn,"Network connectivity changed: AVAILABLE"),this.Lo))e(0)}Bo(){for(let e of(sC(dn,"Network connectivity changed: UNAVAILABLE"),this.Lo))e(1)}static v(){return"u">typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let di=null;function ds(){return null===di?di=0x10000000+Math.round(0x80000000*Math.random()):di++,"0x"+di.toString(16)}let da="RestConnection",dl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class dh{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${n}/databases/${r}`,this.$o=this.databaseId.database===aH?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Wo(e,t,n,r,i){let s=ds(),o=this.Qo(e,t.toUriEncodedString());sC(da,`Sending RPC '${e}' ${s}:`,o,n);let a={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(a,r,i);let{host:l}=new URL(o),h=Y(l);return this.zo(e,o,a,n,h).then(t=>(sC(da,`Received RPC '${e}' ${s}: `,t),t),t=>{throw sT(da,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}jo(e,t,n,r,i,s){return this.Wo(e,t,n,r,i)}Go(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+sw,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Qo(e,t){let n=dl[e],r=`${this.qo}/v1/${t}:${n}`;return this.databaseInfo.apiKey&&(r=`${r}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),r}terminate(){}}class du{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}let dc="WebChannelConnection",dd=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};class df extends dh{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){df.c_||(dd(x(),S.STAT_EVENT,e=>{e.stat===T.PROXY?sC(dc,"STAT_EVENT: detected buffering proxy"):e.stat===T.NOPROXY&&sC(dc,"STAT_EVENT: detected no buffering proxy")}),df.c_=!0)}zo(e,t,n,r,i){let s=ds();return new Promise((i,o)=>{let a=new b;a.setWithCredentials(!0),a.listenOnce(C.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case E.NO_ERROR:let t=a.getResponseJson();sC(dc,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case E.TIMEOUT:sC(dc,`RPC '${e}' ${s} timed out`),o(new sD(sA.DEADLINE_EXCEEDED,"Request time out"));break;case E.HTTP_ERROR:let n=a.getStatus();if(sC(dc,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(sA).indexOf(e)>=0?e:sA.UNKNOWN);o(new sD(n,t.message))}else o(new sD(sA.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new sD(sA.UNAVAILABLE,"Connection failed."));break;default:sx(9055,{l_:e,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{sC(dc,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(r);sC(dc,`RPC '${e}' ${s} sending request:`,r),a.send(t,"POST",l,n,15)})}T_(e,t,n){let r=ds(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=this.createWebChannelTransport(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},a=this.longPollingOptions.timeoutSeconds;void 0!==a&&(o.longPollingTimeout=Math.round(1e3*a)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Go(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;let l=i.join("");sC(dc,`Creating RPC '${e}' stream ${r}: ${l}`,o);let h=s.createWebChannel(l,o);this.I_(h);let u=!1,c=!1,d=new du({Ho:t=>{c?sC(dc,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(u||(sC(dc,`Opening RPC '${e}' stream ${r} transport.`),h.open(),u=!0),sC(dc,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},Jo:()=>h.close()});return dd(h,I.EventType.OPEN,()=>{c||(sC(dc,`RPC '${e}' stream ${r} transport opened.`),d.i_())}),dd(h,I.EventType.CLOSE,()=>{c||(c=!0,sC(dc,`RPC '${e}' stream ${r} transport closed`),d.o_(),this.E_(h))}),dd(h,I.EventType.ERROR,t=>{c||(c=!0,sT(dc,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),d.o_(new sD(sA.UNAVAILABLE,"The operation could not be completed")))}),dd(h,I.EventType.MESSAGE,t=>{if(!c){let n=t.data[0];sN(!!n,16349);let i=n?.error||n[0]?.error;if(i){sC(dc,`RPC '${e}' stream ${r} received error:`,i);let t=i.status,n=function(e){let t=N[e];if(void 0!==t)return hO(t)}(t),s=i.message;void 0===n&&(n=sA.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),c=!0,d.o_(new sD(n,s)),h.close()}else sC(dc,`RPC '${e}' stream ${r} received:`,n),d.__(n)}}),df.u_(),setTimeout(()=>{d.s_()},0),d}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,n){super.Go(e,t,n),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return k()}}function dp(){return"u">typeof window?window:null}function dg(){return"u">typeof document?document:null}function dm(e){return new h0(e,!0)}df.c_=!1;class dy{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=n,this.A_=r,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&sC("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}let d_="PersistentStream";class dv{constructor(e,t,n,r,i,s,o,a){this.Ci=e,this.b_=n,this.S_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new dy(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===sA.RESOURCE_EXHAUSTED?(sE(t.toString()),sE("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===sA.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{let e=new sD(sA.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let n=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.Yo(()=>{n(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return sC(d_,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(sC(d_,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class dw extends dv{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:sx(39313,{state:r}),o=t.targetChange.targetIds||[],a=(i=t.targetChange.resumeToken,e.useProto3Json?(sN(void 0===i||"string"==typeof i,58123),aO.fromBase64String(i||"")):(sN(void 0===i||i instanceof sp.Buffer||i instanceof Uint8Array,16193),aO.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new hG(s,o,a,l&&new sD(void 0===l.code?sA.UNKNOWN:hO(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=h9(e,r.document.name),s=h3(r.document.updateTime),o=r.document.createTime?h3(r.document.createTime):s4.min(),a=new lu({mapValue:{fields:r.document.fields}}),l=lc.newFoundDocument(i,s,o,a);n=new h$(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=h9(e,r.document),s=r.readTime?h3(r.readTime):s4.min(),o=lc.newNoDocument(i,s);n=new h$([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=h9(e,r.document);n=new h$([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return sx(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new hR(r,i);n=new hK(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return s4.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?s4.min():t.readTime?h3(t.readTime):s4.min()}(e);return this.listener.J_(t,n)}Z_(e){let t,n={};n.database=un(this.serializer),n.addTarget=function(e,t){let n,r=t.target;if((n=lL(r)?{documents:ul(e,r)}:{query:uh(e,r).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=h6(e,t.resumeToken);let r=h1(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(s4.min())>0){n.readTime=h2(e,t.snapshotVersion.toTimestamp());let r=h1(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return sx(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.K_(n)}X_(e){let t={};t.database=un(this.serializer),t.removeTarget=e,this.K_(t)}}class db extends dv{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return sN(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,sN(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,n;sN(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(sN(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?h3(e.updateTime):h3(n)).isEqual(s4.min())&&(t=h3(n)),new hp(t,e.transformResults||[])})):[]),i=h3(e.commitTime);return this.listener.na(i,r)}ra(){let e={};e.database=un(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>uo(this.serializer,e))};this.K_(t)}}class dI{}class dC extends dI{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new sD(sA.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,h4(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===sA.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new sD(sA.UNKNOWN,e.toString())})}jo(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.jo(e,h4(t,n),r,s,o,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===sA.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new sD(sA.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class dE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(sE(t),this.aa=!1):sC("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let dT="RemoteStore";class dS{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(e=>{n.enqueueAndForget(async()=>{dM(this)&&(sC(dT,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await dk(e),e.Va.set("Unknown"),e.Ea.delete(4),await dx(e)}(this))})}),this.Va=new dE(n,r)}}async function dx(e){if(dM(e))for(let t of e.Ra)await t(!0)}async function dk(e){for(let t of e.Ra)await t(!1)}function dN(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),dO(e)?dP(e):dJ(e).O_()&&dD(e,t))}function dA(e,t){let n=dJ(e);e.Ia.delete(t),n.O_()&&dR(e,t),0===e.Ia.size&&(n.O_()?n.L_():dM(e)&&e.Va.set("Unknown"))}function dD(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(s4.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}dJ(e).Z_(t)}function dR(e,t){e.da.$e(t),dJ(e).X_(t)}function dP(e){e.da=new hW({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),dJ(e).start(),e.Va.ua()}function dO(e){return dM(e)&&!dJ(e).x_()&&e.Ia.size>0}function dM(e){return 0===e.Ea.size}async function dL(e){e.Va.set("Online")}async function dF(e){e.Ia.forEach((t,n)=>{dD(e,t)})}async function dV(e,t){e.da=void 0,dO(e)?(e.Va.ha(t),dP(e)):e.Va.set("Unknown")}async function dq(e,t,n){if(e.Va.set("Online"),t instanceof hG&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.da.removeTarget(r))}(e,t)}catch(n){sC(dT,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await dU(e,n)}else if(t instanceof h$?e.da.Xe(t):t instanceof hK?e.da.st(t):e.da.tt(t),!n.isEqual(s4.min()))try{let t,r=await cB(e.localStore);n.compareTo(r)>=0&&await ((t=e.da.Tt(n)).targetChanges.forEach((t,r)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(aO.EMPTY_BYTE_STRING,r.snapshotVersion)),dR(e,t);let i=new ug(r.target,t,n,r.sequenceNumber);dD(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){sC(dT,"Failed to raise snapshot:",t),await dU(e,t)}}async function dU(e,t,n){if(!oy(t))throw t;e.Ea.add(1),await dk(e),e.Va.set("Offline"),n||(n=()=>cB(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{sC(dT,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await dx(e)})}function dB(e,t){return t().catch(n=>dU(e,n,t))}async function dj(e){var t;let n=dX(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;dM(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,function(e,t){e.Ta.push(t);let n=dX(e);n.O_()&&n.Y_&&n.ea(t.mutations)}(e,t)}catch(t){await dU(e,t)}dz(e)&&d$(e)}function dz(e){return dM(e)&&!dX(e).x_()&&e.Ta.length>0}function d$(e){dX(e).start()}async function dK(e){dX(e).ra()}async function dG(e){let t=dX(e);for(let n of e.Ta)t.ea(n.mutations)}async function dH(e,t,n){let r=e.Ta.shift(),i=hN.from(r,t,n);await dB(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await dj(e)}async function dW(e,t){t&&dX(e).Y_&&await async function(e,t){var n;if(hP(n=t.code)&&n!==sA.ABORTED){let n=e.Ta.shift();dX(e).B_(),await dB(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await dj(e)}}(e,t),dz(e)&&d$(e)}async function dQ(e,t){e.asyncQueue.verifyOperationInProgress(),sC(dT,"RemoteStore received new credentials");let n=dM(e);e.Ea.add(3),await dk(e),n&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await dx(e)}async function dY(e,t){t?(e.Ea.delete(2),await dx(e)):t||(e.Ea.add(2),await dk(e),e.Va.set("Unknown"))}function dJ(e){var t,n,r;return e.ma||(t=e.datastore,n=e.asyncQueue,r={Zo:dL.bind(null,e),Yo:dF.bind(null,e),t_:dV.bind(null,e),J_:dq.bind(null,e)},t.sa(),e.ma=new dw(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.Ra.push(async t=>{t?(e.ma.B_(),dO(e)?dP(e):e.Va.set("Unknown")):(await e.ma.stop(),e.da=void 0)})),e.ma}function dX(e){var t,n,r;return e.fa||(t=e.datastore,n=e.asyncQueue,r={Zo:()=>Promise.resolve(),Yo:dK.bind(null,e),t_:dW.bind(null,e),ta:dG.bind(null,e),na:dH.bind(null,e)},t.sa(),e.fa=new db(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.Ra.push(async t=>{t?(e.fa.B_(),await dj(e)):(await e.fa.stop(),e.Ta.length>0&&(sC(dT,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class dZ{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new sR,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new dZ(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new sD(sA.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function d0(e,t){if(sE("AsyncQueue",`${t}: ${e}`),oy(e))return new sD(sA.UNAVAILABLE,`${t}: ${e}`);throw e}class d1{static emptySet(e){return new d1(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||sJ.comparator(t.key,n.key):(e,t)=>sJ.comparator(e.key,t.key),this.keyedMap=l3(),this.sortedSet=new aS(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof d1)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new d1;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class d2{constructor(){this.ga=new aS(sJ.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):sx(63341,{Vt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class d6{constructor(e,t,n,r,i,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new d6(e,t,d1.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&lQ(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class d3{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class d5{constructor(){this.queries=d4(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new sD(sA.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=d4(),t.forEach((t,n)=>{for(let t of n.ba)t.onError(e)})}}function d4(){return new l1(e=>lY(e),lQ)}async function d8(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.Sa()&&t.Da()&&(n=2):(i=new d3,n=+!t.Da());try{switch(n){case 0:i.wa=await e.onListen(r,!0);break;case 1:i.wa=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=d0(n,`Initialization of query '${lJ(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&ft(e)}async function d7(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.ba.indexOf(t);e>=0&&(i.ba.splice(e,1),0===i.ba.length?r=+!t.Da():!i.Sa()&&t.Da()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function d9(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.ba)e.Fa(r)&&(n=!0);i.wa=r}}n&&ft(e)}function fe(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.ba)e.onError(n);e.queries.delete(t)}function ft(e){e.Ca.forEach(e=>{e.next()})}(R=D||(D={})).Ma="default",R.Cache="cache";class fn{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new d6(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.Ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=d6.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==D.Cache}}class fr{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class fi{constructor(e){this.serializer=e}Ks(e){return h9(this.serializer,e)}qs(e){return e.metadata.exists?us(this.serializer,e.document,!1):lc.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return h3(e)}}class fs{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=fo(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let n=sW.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,n=new fi(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.Ks(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||l9()).add(e);t.set(n,r)}}return t}async ja(e){let t=await cQ(e,new fi(this.serializer),this.Qa,this.$a.id),n=this.za(this.documents);for(let t of this.Wa)await cY(e,t,n.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function fo(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class fa{constructor(e){this.key=e}}class fl{constructor(e){this.key=e}}class fh{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=l9(),this.mutatedKeys=l9(),this.eu=l0(e),this.tu=new d1(this.eu)}get nu(){return this.Za}ru(e,t){let n=t?t.iu:new d2,r=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1,a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let h=r.get(e),u=lX(this.query,t)?t:null,c=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;h&&u?h.data.isEqual(u.data)?c!==d&&(n.track({type:3,doc:u}),f=!0):this.su(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.eu(u,a)>0||l&&0>this.eu(u,l))&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||l)&&(o=!0)),f&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Ss:o,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var n,r;let i;return n=e.type,r=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return sx(20277,{Vt:e})}})(n)-i(r)||this.eu(e.doc,t.doc)}),this.ou(n),r=r??!1;let o=t&&!r?this._u():[],a=0===this.Ya.size&&this.current&&!r?1:0,l=a!==this.Xa;return(this.Xa=a,0!==s.length||l)?{snapshot:new d6(this.query,e.tu,i,s,e.mutatedKeys,0===a,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new d2,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=l9(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new fl(e))}),this.Ya.forEach(n=>{e.has(n)||t.push(new fa(n))}),t}cu(e){this.Za=e.ks,this.Ya=l9();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return d6.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}let fu="SyncEngine";class fc{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class fd{constructor(e){this.key=e,this.hu=!1}}class ff{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new l1(e=>lY(e),lQ),this.Iu=new Map,this.Eu=new Set,this.Ru=new aS(sJ.comparator),this.Au=new Map,this.Vu=new cv,this.du={},this.mu=new Map,this.fu=u7.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function fp(e,t,n=!0){let r,i=f$(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await fm(i,t,n,!0),r}async function fg(e,t){let n=f$(e);await fm(n,t,!0,!1)}async function fm(e,t,n,r){let i,s=await cz(e.localStore,lK(t)),o=s.targetId,a=e.sharedClientState.addLocalQueryTarget(o,n);return r&&(i=await fy(e,t,o,"current"===a,s.resumeToken)),e.isPrimaryClient&&n&&dN(e.remoteStore,s),i}async function fy(e,t,n,r,i){e.pu=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ru(n);i.Ss&&(i=await cK(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return fA(e,t.targetId,a.au),a.snapshot})(e,t,n,r);let s=await cK(e.localStore,t,!0),o=new fh(t,s.ks),a=o.ru(s.documents),l=hz.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),h=o.applyChanges(a,e.isPrimaryClient,l);fA(e,n,h.au);let u=new fc(t,n,o);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),h.snapshot}async function f_(e,t,n){let r=e.Tu.get(t),i=e.Iu.get(r.targetId);i.length>1?(e.Iu.set(r.targetId,i.filter(e=>!lQ(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await c$(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&dA(e.remoteStore,r.targetId),fk(e,r.targetId)}).catch(oh)):(fk(e,r.targetId),await c$(e.localStore,r.targetId,!0))}async function fv(e,t){let n=e.Tu.get(t),r=e.Iu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),dA(e.remoteStore,n.targetId))}async function fw(e,t,n){let r=fK(e);try{var i,s;let e,o,a,l,h,u=await (i=r.localStore,a=s5.now(),l=t.reduce((e,t)=>e.add(t.key),l9()),i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let r=l2,s=l9();return i.xs.getEntries(n,l).next(e=>{(r=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,r)).next(r=>{e=r;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=hi(r.transform,e||null);null!=i&&(null===n&&(n=lu.empty()),n.set(r.field,i))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new hI(n.key,t,function e(t){let n=[];return aE(t.fields,(t,r)=>{let i=new sY([t]);if(lr(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new aR(n)}(t.value.mapValue),hg.exists(!0)))}return i.mutationQueue.addMutationBatch(n,a,s,t)}).next(t=>{o=t;let r=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(n,t.batchId,r)})}).then(()=>({batchId:o.batchId,changes:l5(e)})));r.sharedClientState.addPendingMutation(u.batchId),s=u.batchId,(h=r.du[r.currentUser.toKey()])||(h=new aS(sj)),h=h.insert(s,n),r.du[r.currentUser.toKey()]=h,await fR(r,u.changes),await dj(r.remoteStore)}catch(t){let e=d0(t,"Failed to persist write");n.reject(e)}}async function fb(e,t){var n;try{let r,i,s=await (n=e.localStore,r=t.snapshotVersion,i=n.vs,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.xs.newChangeBuffer({trackRemovals:!0});i=n.vs;let o=[];t.targetChanges.forEach((s,a)=>{var l;let h=i.get(a);if(!h)return;o.push(n.li.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.li.addMatchingKeys(e,s.addedDocuments,a)));let u=h.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(aO.EMPTY_BYTE_STRING,s4.min()).withLastLimboFreeSnapshotVersion(s4.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),l=u,(0===h.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-h.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&o.push(n.li.updateTargetData(e,u))});let a=l2,l=l9();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(cj(e,s,t.documentUpdates).next(e=>{a=e.Bs,l=e.Ls})),!r.isEqual(s4.min())){let t=n.li.getLastRemoteSnapshotVersion(e).next(t=>n.li.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return ou.waitFor(o).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,l)).next(()=>a)}).then(e=>(n.vs=i,e)));t.targetChanges.forEach((t,n)=>{let r=e.Au.get(n);r&&(sN(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?sN(r.hu,14607):t.removedDocuments.size>0&&(sN(r.hu,42227),r.hu=!1))}),await fR(e,s,t)}catch(e){await oh(e)}}function fI(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.Tu.forEach((e,n)=>{let r=n.view.va(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.ba)e.va(t)&&(n=!0)}),n&&ft(r),i.length&&e.Pu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function fC(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Au.get(t),i=r&&r.key;if(i){let n=new aS(sJ.comparator);n=n.insert(i,lc.newNoDocument(i,s4.min()));let r=l9().add(i),s=new hj(s4.min(),new Map,new aS(sj),n,r);await fb(e,s),e.Ru=e.Ru.remove(i),e.Au.delete(t),fD(e)}else await c$(e.localStore,t,!1).then(()=>fk(e,t,n)).catch(oh)}async function fE(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r,i,s,o=t.batch.keys(),a=n.xs.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),s=ou.resolve(),i.forEach(n=>{s=s.next(()=>a.getEntry(e,n)).next(e=>{let i=t.docVersions.get(n);sN(null!==i,48541),0>e.version.compareTo(i)&&(r.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),a.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,r))).next(()=>a.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,o,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=l9();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,o))}));fx(e,r,null),fS(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await fR(e,i)}catch(e){await oh(e)}}async function fT(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(sN(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));fx(e,t,n),fS(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await fR(e,i)}catch(e){await oh(e)}}function fS(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function fx(e,t,n){let r=e.du[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.du[e.currentUser.toKey()]=r}}function fk(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||fN(e,t)})}function fN(e,t){e.Eu.delete(t.path.canonicalString());let n=e.Ru.get(t);null!==n&&(dA(e.remoteStore,n),e.Ru=e.Ru.remove(t),e.Au.delete(n),fD(e))}function fA(e,t,n){for(let r of n)r instanceof fa?(e.Vu.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.Ru.get(n)||e.Eu.has(r)||(sC(fu,"New document in limbo: "+n),e.Eu.add(r),fD(e))}(e,r)):r instanceof fl?(sC(fu,"Document no longer in limbo: "+r.key),e.Vu.removeReference(r.key,t),e.Vu.containsKey(r.key)||fN(e,r.key)):sx(19791,{wu:r})}function fD(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new sJ(sW.fromString(t)),r=e.fu.next();e.Au.set(r,new fd(n)),e.Ru=e.Ru.insert(n,r),dN(e.remoteStore,new ug(lK(lB(n.path)),r,"TargetPurposeLimboResolution",oT.ce))}}async function fR(e,t,n){let r=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((o,a)=>{s.push(e.pu(a,t,n).then(t=>{if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:n?.targetChanges.get(a.targetId)?.current;e.sharedClientState.updateQueryState(a.targetId,r?"current":"not-current")}if(t){r.push(t);let e=cM.Es(a.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.J_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>ou.forEach(t,t=>ou.forEach(t.Ts,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>ou.forEach(t.Is,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!oy(e))throw e;sC(cV,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.vs.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.vs=e.vs.insert(t,i)}}}(e.localStore,i))}async function fP(e,t){if(!e.currentUser.isEqual(t)){sC(fu,"User change. New user:",t.toKey());let n=await cU(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new sD(sA.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await fR(e,n.Ns)}}function fO(e,t){let n=e.Au.get(t);if(n&&n.hu)return l9().add(n.key);{let n=l9(),r=e.Iu.get(t);if(!r)return n;for(let t of r){let r=e.Tu.get(t);n=n.unionWith(r.view.nu)}return n}}async function fM(e,t){let n=await cK(e.localStore,t.query,!0),r=t.view.cu(n);return e.isPrimaryClient&&fA(e,t.targetId,r.au),r}async function fL(e,t){return cH(e.localStore,t).then(t=>fR(e,t))}async function fF(e,t,n,r){var i,s;let o,a=await (i=e.localStore,o=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>o.Xn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):ou.resolve(null))));null!==a?("pending"===n?await dj(e.remoteStore):"acknowledged"===n||"rejected"===n?(fx(e,t,r||null),fS(e,t),s=e.localStore,s.mutationQueue.nr(t)):sx(6720,"Unknown batchState",{bu:n}),await fR(e,a)):sC(fu,"Cannot apply mutation batch with id: "+t)}async function fV(e,t){if(f$(e),fK(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await fq(e,t.toArray());for(let t of(e.gu=!0,await dY(e.remoteStore,!0),n))dN(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],n=Promise.resolve();e.Iu.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(fk(e,i),c$(e.localStore,i,!0))),dA(e.remoteStore,i)}),await n,await fq(e,t),e.Au.forEach((t,n)=>{dA(e.remoteStore,n)}),e.Vu.zr(),e.Au=new Map,e.Ru=new aS(sJ.comparator),e.gu=!1,await dY(e.remoteStore,!1)}}async function fq(e,t,n){let r=[],i=[];for(let n of t){let t,s=e.Iu.get(n);if(s&&0!==s.length)for(let n of(t=await cz(e.localStore,lK(s[0])),s)){let t=e.Tu.get(n),r=await fM(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await cG(e.localStore,n);t=await cz(e.localStore,r),await fy(e,fU(r),n,!1,t.resumeToken)}r.push(t)}return e.Pu.J_(i),r}function fU(e){var t,n,r,i,s;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,s=e.limit,new lU(t,n,r,i,s,"F",e.startAt,e.endAt)}function fB(e){return e.localStore.persistence.hs()}async function fj(e,t,n,r){if(e.gu)return void sC(fu,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await cH(e.localStore,lZ(i[0])),s=hj.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,aO.EMPTY_BYTE_STRING);await fR(e,r,s);break}case"rejected":await c$(e.localStore,t,!0),fk(e,t,r);break;default:sx(64155,n)}}async function fz(e,t,n){let r=f$(e);if(r.gu){for(let e of t){if(r.Iu.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){sC(fu,"Adding an already active target "+e);continue}let t=await cG(r.localStore,e),n=await cz(r.localStore,t);await fy(r,fU(t),n.targetId,!1,n.resumeToken),dN(r.remoteStore,n)}for(let e of n)r.Iu.has(e)&&await c$(r.localStore,e,!1).then(()=>{dA(r.remoteStore,e),fk(r,e)}).catch(oh)}}function f$(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=fb.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=fC.bind(null,e),e.Pu.J_=d9.bind(null,e.eventManager),e.Pu.yu=fe.bind(null,e.eventManager),e}function fK(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=fE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=fT.bind(null,e),e}class fG{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=dm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new cF,new cq(t,n,e.initialUser,this.serializer)}Cu(e){return new cT(cx.Vi,this.serializer)}Du(e){return new de}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fG.provider={build:()=>new fG};class fH extends fG{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return sN(this.persistence.referenceDelegate instanceof ck,46915),new ci(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?u2.withCacheSize(this.cacheSizeBytes):u2.DEFAULT;return new cT(e=>ck.Vi(e,t),this.serializer)}}class fW extends fG{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await fK(this.xu.syncEngine),await dj(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,n;return t=this.persistence,n=new cF,new cq(t,n,e.initialUser,this.serializer)}Fu(e,t){return new ci(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let n=new oE(t,this.persistence);return new oC(e.asyncQueue,n)}Cu(e){let t=cO(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?u2.withCacheSize(this.cacheSizeBytes):u2.DEFAULT;return new cP(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,dp(),dg(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new de}}class fQ extends fW{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof c9&&(this.sharedClientState.syncEngine={So:fF.bind(null,t),Do:fj.bind(null,t),Co:fz.bind(null,t),hs:fB.bind(null,t),bo:fL.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await fV(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=dp();if(!c9.v(t))throw new sD(sA.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=cO(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new c9(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class fY{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>fI(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=fP.bind(null,this.syncEngine),await dY(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new d5}createDatastore(e){var t;let n=dm(e.databaseInfo.databaseId),r=new df(e.databaseInfo);return t=e.authCredentials,new dC(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new dS(t,n,e.asyncQueue,e=>fI(this.syncEngine,e,0),dr.v()?new dr:new dt)}createSyncEngine(e,t){var n,r,i,s,o,a;let l;return n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,o=e.initialUser,a=e.maxConcurrentLimboResolutions,l=new ff(n,r,i,s,o,a),t&&(l.gu=!0),l}async terminate(){await async function(e){sC(dT,"RemoteStore shutting down."),e.Ea.add(5),await dk(e),e.Aa.shutdown(),e.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function fJ(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}fY.provider={build:()=>new fY};class fX{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):sE("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class fZ{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new sR,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.Ku();if(null===e)return null;let t=this.Lu.decode(e),n=Number(t);return isNaN(n)&&this.qu(`length string (${t}) is not valid number`),new fr(JSON.parse(await this.Uu(n)),e.length+n)}$u(){return this.buffer.findIndex(e=>123===e)}async Ku(){for(;0>this.$u()&&!await this.Wu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Wu(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class f0{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let n=this.Su();if(!n||!n.Ua())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(n?.qa)}`);this.metadata=n;do null!==(n=this.Su())&&this.elements.push(n);while(null!==n)}getMetadata(){return this.metadata}Qu(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.Ku();return new fr(JSON.parse(this.Uu(e)),e)}Uu(e){if(this.cursor+e>this.bundleData.length)throw new sD(sA.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}Ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class f1{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new sD(sA.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let n={documents:t.map(t=>h7(e.serializer,t))},r=await e.jo("BatchGetDocuments",e.serializer.databaseId,sW.emptyPath(),n,t.length),i=new Map;r.forEach(t=>{var n;let r,s,o,a,l,h,u=(n=e.serializer,"found"in t?(sN(!!t.found,43571),t.found.name,t.found.updateTime,r=h9(n,t.found.name),s=h3(t.found.updateTime),o=t.found.createTime?h3(t.found.createTime):s4.min(),a=new lu({mapValue:{fields:t.found.fields}}),lc.newFoundDocument(r,s,o,a)):"missing"in t?(sN(!!t.missing,3894),sN(!!t.readTime,22933),l=h9(n,t.missing),h=h3(t.readTime),lc.newNoDocument(l,h)):sx(7234,{result:t}));i.set(u.key.toString(),u)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());sN(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new hS(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=sJ.fromPath(t);this.mutations.push(new hx(n,this.precondition(n)))}),await async function(e,t){let n={writes:t.map(t=>uo(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,sW.emptyPath(),n)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw sx(50498,{Gu:e.constructor.name});t=s4.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new sD(sA.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(s4.min())?hg.exists(!1):hg.updateTime(t):hg.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(s4.min()))throw new sD(sA.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return hg.updateTime(t)}return hg.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class f2{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.zu=n.maxAttempts,this.M_=new dy(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{let e=new f1(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!oS(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!hP(t)}return!1}}let f6="FirestoreClient";class f3{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this._databaseInfo=r,this.user=sv.UNAUTHENTICATED,this.clientId=sB.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{sC(f6,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(sC(f6,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new sR;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=d0(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function f5(e,t){e.asyncQueue.verifyOperationInProgress(),sC(f6,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await cU(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function f4(e,t){e.asyncQueue.verifyOperationInProgress();let n=await f8(e);sC(f6,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>dQ(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>dQ(t.remoteStore,n)),e._onlineComponents=t}async function f8(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){sC(f6,"Using user provided OfflineComponentProvider");try{await f5(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===sA.FAILED_PRECONDITION||t.code===sA.UNIMPLEMENTED:!("u">typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;sT("Error using user provided cache. Falling back to memory cache: "+t),await f5(e,new fG)}}else sC(f6,"Using default OfflineComponentProvider"),await f5(e,new fH(void 0));return e._offlineComponents}async function f7(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(sC(f6,"Using user provided OnlineComponentProvider"),await f4(e,e._uninitializedComponentsProvider._online)):(sC(f6,"Using default OnlineComponentProvider"),await f4(e,new fY))),e._onlineComponents}function f9(e){return f8(e).then(e=>e.localStore)}function pe(e){return f7(e).then(e=>e.syncEngine)}function pt(e){return f7(e).then(e=>e.datastore)}async function pn(e){let t=await f7(e),n=t.eventManager;return n.onListen=fp.bind(null,t.syncEngine),n.onUnlisten=f_.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=fg.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=fv.bind(null,t.syncEngine),n}function pr(e,t,n={}){let r=new sR;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let o,a;return i=await pn(e),s=e.asyncQueue,o=new fX({next:e=>{o.Nu(),s.enqueueAndForget(()=>d7(i,a));let l=e.docs.has(t);!l&&e.fromCache?r.reject(new sD(sA.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&n&&"server"===n.source?r.reject(new sD(sA.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(e)},error:e=>r.reject(e)}),d8(i,a=new fn(lB(t.path),o,{includeMetadataChanges:!0,Ka:!0}))}),r.promise}function pi(e,t,n={}){let r=new sR;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let o,a;return i=await pn(e),s=e.asyncQueue,a=new fn(t,o=new fX({next:e=>{o.Nu(),s.enqueueAndForget(()=>d7(i,a)),e.fromCache&&"server"===n.source?r.reject(new sD(sA.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(e)},error:e=>r.reject(e)}),{includeMetadataChanges:!0,Ka:!0}),d8(i,a)}),r.promise}function ps(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let po=new Map,pa="firestore.googleapis.com";class pl{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new sD(sA.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=pa,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new sD(sA.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new sD(sA.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ps(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new sD(sA.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new sD(sA.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new sD(sA.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ph{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new sD(sA.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new sD(sA.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pl(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new sO;switch(e.type){case"firstParty":return new sV(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new sD(sA.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=po.get(this))&&(sC("ComponentProvider","Removing Datastore"),po.delete(this),e.terminate()),Promise.resolve()}}class pu{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new pu(this.firestore,e,this._query)}}class pc{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new pc(this.firestore,e,this._key)}toJSON(){return{type:pc._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(s3(t,pc._jsonSchema))return new pc(e,n||null,new sJ(sW.fromString(t.referencePath)))}}pc._jsonSchemaVersion="firestore/documentReference/1.0",pc._jsonSchema={type:s6("string",pc._jsonSchemaVersion),referencePath:s6("string")};class pd extends pu{constructor(e,t,n){super(e,t,lB(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new pc(this.firestore,null,new sJ(e))}withConverter(e){return new pd(this.firestore,e,this._path)}}function pf(e,t){return e=ek(e),t=ek(t),e instanceof pu&&t instanceof pu&&e.firestore===t.firestore&&lQ(e._query,t._query)&&e.converter===t.converter}let pp="AsyncQueue";class pg{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new dy(this,"async_queue_retry"),this._c=()=>{let e=dg();e&&sC(pp,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=dg();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=dg();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new sR;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!oy(e))throw e;sC(pp,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,sE("INTERNAL UNHANDLED ERROR: ",pm(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let r=dZ.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&sx(47125,{Pc:pm(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function pm(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class py{constructor(){this._progressObserver={},this._taskCompletionResolver=new sR,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class p_ extends ph{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new pg,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new pg(e),this._firestoreClient=void 0,await e}}}function pv(e){if(e._terminated)throw new sD(sA.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r,i,s;let o,a=e._freezeSettings(),l=(t=e._databaseId,n=e._app?.options.appId||"",r=e._persistenceKey,i=e._app?.options.apiKey,new aG(t,n,r,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,ps(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator,i));e._componentsProvider||a.localCache?._offlineComponentProvider&&a.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),e._firestoreClient=new f3(e._authCredentials,e._appCheckCredentials,e._queue,l,e._componentsProvider&&(s=e._componentsProvider,o=s?._online.build(),{_offline:s?._offline.build(o),_online:o}))}(e),e._firestoreClient}function pw(e,t){let n=pv(e=s1(e,p_)),r=new py;return function(e,t,n,r){var i;let s=(i=dm(t),new fZ(function(e,t){if(e instanceof Uint8Array)return fJ(e,void 0);if(e instanceof ArrayBuffer)return fJ(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?hL().encode(n):n),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,n){try{var r,i;let s,o=await t.getMetadata();if(await (r=e.localStore,s=h3(o.createTime),r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.Pi.getBundleMetadata(e,o.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:o.totalDocuments,bytesLoaded:o.totalBytes,totalDocuments:o.totalDocuments,totalBytes:o.totalBytes}),Promise.resolve(new Set);n._updateProgress(fo(o));let a=new fs(o,t.serializer),l=await t.Su();for(;l;){let e=await a.Ga(l);e&&n._updateProgress(e),l=await t.Su()}let h=await a.ja(e.localStore);return await fR(e,h.Ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Pi.saveBundleMetadata(e,o))),n._completeWith(h.progress),Promise.resolve(h.Ha)}catch(e){return sT(fu,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(t=await pe(e),s,r).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(n,e._databaseId,t,r),r}class pb{constructor(e){this._byteString=e}static fromBase64String(e){try{return new pb(aO.fromBase64String(e))}catch(e){throw new sD(sA.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new pb(aO.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:pb._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(s3(e,pb._jsonSchema))return pb.fromBase64String(e.bytes)}}pb._jsonSchemaVersion="firestore/bytes/1.0",pb._jsonSchema={type:s6("string",pb._jsonSchemaVersion),bytes:s6("string")};class pI{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new sD(sA.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new sY(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class pC{constructor(e){this._methodName=e}}class pE{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new sD(sA.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new sD(sA.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return sj(this._lat,e._lat)||sj(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:pE._jsonSchemaVersion}}static fromJSON(e){if(s3(e,pE._jsonSchema))return new pE(e.latitude,e.longitude)}}pE._jsonSchemaVersion="firestore/geoPoint/1.0",pE._jsonSchema={type:s6("string",pE._jsonSchemaVersion),latitude:s6("number"),longitude:s6("number")};class pT{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:pT._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(s3(e,pT._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new pT(e.vectorValues);throw new sD(sA.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}pT._jsonSchemaVersion="firestore/vectorValue/1.0",pT._jsonSchema={type:s6("string",pT._jsonSchemaVersion),vectorValues:s6("object")};let pS=/^__.*__$/;class px{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new hI(e,this.data,this.fieldMask,t,this.fieldTransforms):new hb(e,this.data,t,this.fieldTransforms)}}class pk{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new hI(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function pN(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw sx(40011,{dataSource:e})}}class pA{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new pA({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePathSegment(e),n}childContextForFieldPath(e){let t=this.path?.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePath(),n}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return pK(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(pN(this.dataSource)&&pS.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class pD{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||dm(e)}createContext(e,t,n,r=!1){return new pA({dataSource:e,methodName:t,targetDoc:n,path:sY.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function pR(e){let t=e._freezeSettings(),n=dm(e._databaseId);return new pD(e._databaseId,!!t.ignoreUndefinedProperties,n)}function pP(e,t,n,r,i,s={}){let o,a,l=e.createContext(s.merge||s.mergeFields?2:0,t,n,i);pB("Data must be an object, but it was:",l,r);let h=pq(r,l);if(s.merge)o=new aR(l.fieldMask),a=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=pj(t,r,n);if(!l.contains(i))throw new sD(sA.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);pG(e,i)||e.push(i)}o=new aR(e),a=l.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,a=l.fieldTransforms;return new px(new lu(h),o,a)}class pO extends pC{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof pO}}function pM(e,t,n,r){let i=e.createContext(1,t,n);pB("Data must be an object, but it was:",i,r);let s=[],o=lu.empty();return aE(r,(e,r)=>{let a=p$(t,e,n);r=ek(r);let l=i.childContextForFieldPath(a);if(r instanceof pO)s.push(a);else{let e=pV(r,l);null!=e&&(s.push(a),o.set(a,e))}}),new pk(o,new aR(s),i.fieldTransforms)}function pL(e,t,n,r,i,s){let o=e.createContext(1,t,n),a=[pj(t,r,n)],l=[i];if(s.length%2!=0)throw new sD(sA.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(pj(t,s[e])),l.push(s[e+1]);let h=[],u=lu.empty();for(let e=a.length-1;e>=0;--e)if(!pG(h,a[e])){let t=a[e],n=l[e];n=ek(n);let r=o.childContextForFieldPath(t);if(n instanceof pO)h.push(t);else{let e=pV(n,r);null!=e&&(h.push(t),u.set(t,e))}}return new pk(u,new aR(h),o.fieldTransforms)}function pF(e,t,n,r=!1){return pV(n,e.createContext(r?4:3,t))}function pV(e,t){if(pU(e=ek(e)))return pB("Unsupported field value:",t,e),pq(e,t);if(e instanceof pC)return function(e,t){if(!pN(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=pV(i,t.childContextForArray(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){var n,r,i;if(null===(e=ek(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n=t.serializer,ok(r=e)?hn(r):ht(n,r);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=s5.fromDate(e);return{timestampValue:h2(t.serializer,n)}}if(e instanceof s5){let n=new s5(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:h2(t.serializer,n)}}if(e instanceof pE)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof pb)return{bytesValue:h6(t.serializer,e._byteString)};if(e instanceof pc){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:h5(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof pT)return{mapValue:{fields:{[aQ]:{stringValue:aX},[aZ]:{arrayValue:{values:((i=e)instanceof pT?i.toArray():i).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return ht(t.serializer,e)})}}}}};if(up(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${s0(e)}`)}(e,t)}function pq(e,t){let n={};return aT(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):aE(e,(e,r)=>{let i=pV(r,t.childContextForField(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function pU(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof s5||e instanceof pE||e instanceof pb||e instanceof pc||e instanceof pC||e instanceof pT||up(e))}function pB(e,t,n){if(!pU(n)||!sZ(n)){let r=s0(n);throw"an object"===r?t.createError(e+" a custom object"):t.createError(e+" "+r)}}function pj(e,t,n){if((t=ek(t))instanceof pI)return t._internalPath;if("string"==typeof t)return p$(e,t);throw pK("Field path arguments must be of type string or ",e,!1,void 0,n)}let pz=RegExp("[~\\*/\\[\\]]");function p$(e,t,n){if(t.search(pz)>=0)throw pK(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new pI(...t.split("."))._internalPath}catch(r){throw pK(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function pK(e,t,n,r,i){let s=r&&!r.isEmpty(),o=void 0!==i,a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new sD(sA.INVALID_ARGUMENT,a+e+l)}function pG(e,t){return e.some(e=>e.isEqual(t))}class pH{convertValue(e,t="none"){switch(a1(e)){case 0:return null;case 1:return e.booleanValue;case 2:return aF(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(aV(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw sx(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return aE(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){return new pT(e.fields?.[aZ].arrayValue?.values?.map(e=>aF(e.doubleValue)))}convertGeoPoint(e){return new pE(aF(e.latitude),aF(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=a$(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(aK(e));default:return null}}convertTimestamp(e){let t=aL(e);return new s5(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=sW.fromString(e);sN(uf(n),9688,{name:e});let r=new aW(n.get(1),n.get(3)),i=new sJ(n.popFirst(5));return r.isEqual(t)||sE(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class pW extends pH{constructor(e){super(),this.firestore=e}convertBytes(e){return new pb(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new pc(this.firestore,null,t)}}let pQ="@firebase/firestore",pY="4.10.0";function pJ(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class pX{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class pZ{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new lu({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class p0{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new pc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new p1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(pj("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class p1 extends p0{data(){return super.data()}}function p2(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new sD(sA.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class p6{}class p3 extends p6{}function p5(e,t,...n){let r=[];for(let i of(t instanceof p6&&r.push(t),function(e){let t=e.filter(e=>e instanceof p7).length,n=e.filter(e=>e instanceof p4).length;if(t>1||t>0&&n>0)throw new sD(sA.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class p4 extends p3{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new p4(e,t,n)}_apply(e){let t=this._parse(e);return gg(e._query,t),new pu(e.firestore,e.converter,lH(e._query,t))}_parse(e){let t=pR(e.firestore);return function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new sD(sA.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){gp(o,s);let t=[];for(let n of o)t.push(gf(r,e,n));a={arrayValue:{values:t}}}else a=gf(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||gp(o,s),a=pF(n,t,o,"in"===s||"not-in"===s);return ly.create(i,s,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function p8(e,t,n){let r=pj("where",e);return p4._create(r,t,n)}class p7 extends p6{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new p7(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:l_.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())gg(n,e),n=lH(n,e)}(e._query,t),new pu(e.firestore,e.converter,lH(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function p9(...e){return e.forEach(e=>gm("or",e)),p7._create("or",e)}function ge(...e){return e.forEach(e=>gm("and",e)),p7._create("and",e)}class gt extends p3{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new gt(e,t)}_apply(e){var t;let n,r=function(e,t,n){if(null!==e.startAt)throw new sD(sA.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new sD(sA.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new lg(t,n)}(e._query,this._field,this._direction);return new pu(e.firestore,e.converter,(t=e._query,n=t.explicitOrderBy.concat([r]),new lU(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function gn(e,t="asc"){let n=pj("orderBy",e);return gt._create(n,t)}class gr extends p3{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new gr(e,t,n)}_apply(e){return new pu(e.firestore,e.converter,lW(e._query,this._limit,this._limitType))}}function gi(e){return s2("limit",e),gr._create("limit",e,"F")}function gs(e){return s2("limitToLast",e),gr._create("limitToLast",e,"L")}class go extends p3{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new go(e,t,n)}_apply(e){var t;let n=gd(e,this.type,this._docOrFields,this._inclusive);return new pu(e.firestore,e.converter,(t=e._query,new lU(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt)))}}function ga(...e){return go._create("startAt",e,!0)}function gl(...e){return go._create("startAfter",e,!1)}class gh extends p3{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new gh(e,t,n)}_apply(e){var t;let n=gd(e,this.type,this._docOrFields,this._inclusive);return new pu(e.firestore,e.converter,(t=e._query,new lU(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n)))}}function gu(...e){return gh._create("endBefore",e,!1)}function gc(...e){return gh._create("endAt",e,!0)}function gd(e,t,n,r){if(n[0]=ek(n[0]),n[0]instanceof p0)return function(e,t,n,r,i){if(!r)throw new sD(sA.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of l$(e))if(n.field.isKeyField())s.push(a7(t,r.key));else{let e=r.data.field(n.field);if(az(e))throw new sD(sA.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new sD(sA.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new ld(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=pR(e.firestore);return function(e,t,n,r,i,s){let o=e.explicitOrderBy;if(i.length>o.length)throw new sD(sA.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let s=0;s<i.length;s++){let l=i[s];if(o[s].field.isKeyField()){if("string"!=typeof l)throw new sD(sA.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!lz(e)&&-1!==l.indexOf("/"))throw new sD(sA.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(sW.fromString(l));if(!sJ.isDocumentKey(n))throw new sD(sA.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new sJ(n);a.push(a7(t,i))}else{let e=pF(n,r,l);a.push(e)}}return new ld(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function gf(e,t,n){if("string"==typeof(n=ek(n))){if(""===n)throw new sD(sA.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!lz(t)&&-1!==n.indexOf("/"))throw new sD(sA.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(sW.fromString(n));if(!sJ.isDocumentKey(r))throw new sD(sA.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return a7(e,new sJ(r))}if(n instanceof pc)return a7(e,n._key);throw new sD(sA.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${s0(n)}.`)}function gp(e,t){if(!Array.isArray(e)||0===e.length)throw new sD(sA.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function gg(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new sD(sA.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new sD(sA.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function gm(e,t){if(!(t instanceof p4||t instanceof p7))throw new sD(sA.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function gy(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class g_ extends pH{constructor(e){super(),this.firestore=e}convertBytes(e){return new pb(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new pc(this.firestore,null,t)}}function gv(e){return new pX("sum",pj("sum",e))}function gw(e){return new pX("avg",pj("average",e))}function gb(){return new pX("count")}function gI(e,t){return e instanceof pX&&t instanceof pX&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function gC(e,t){return pf(e.query,t.query)&&eI(e.data(),t.data())}function gE(e){return gT(e,{count:gb()})}function gT(e,t){var n;let r,i=s1(e.firestore,p_),s=pv(i),o=function(e,t){let n=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}(t,(e,t)=>new hD(t,e.aggregateType,e._internalFieldPath));return(n=e._query,r=new sR,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await pt(s);r.resolve(async function(e,t,n){let{request:r,gt:i,parent:s}=function(e,t,n,r){let{ft:i,parent:s}=uh(e,t),o={},a=[],l=0;return n.forEach(e=>{let t="aggregate_"+l++;o[t]=e.alias,"count"===e.aggregateType?a.push({alias:t,count:{}}):"avg"===e.aggregateType?a.push({alias:t,avg:{field:uc(e.fieldPath)}}):"sum"===e.aggregateType&&a.push({alias:t,sum:{field:uc(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:i.structuredQuery},parent:i.parent},gt:o,parent:s}}(e.serializer,(t.Re||(t.Re=lG(t,t.explicitOrderBy)),t.Re),n);e.connection.Ko||delete r.parent;let o=(await e.jo("RunAggregationQuery",e.serializer.databaseId,s,r,1)).filter(e=>!!e.result);sN(1===o.length,64727);let a=o[0].result?.aggregateFields;return Object.keys(a).reduce((e,t)=>(e[i[t]]=a[t],e),{})}(e,n,o))}catch(e){r.reject(e)}}),r.promise).then(t=>new pZ(e,new pW(i),t))}class gS{constructor(e){this.kind="memory",this._onlineComponentProvider=fY.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new fH(void 0)}}toJSON(){return{kind:this.kind}}}class gx{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=gL(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class gk{constructor(){this.kind="memoryEager",this._offlineComponentProvider=fG.provider}toJSON(){return{kind:this.kind}}}class gN{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new fH(e)}}toJSON(){return{kind:this.kind}}}function gA(){return new gk}function gD(e){return new gN(e?.cacheSizeBytes)}function gR(e){return new gS(e)}function gP(e){return new gx(e)}class gO{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=fY.provider,this._offlineComponentProvider={build:t=>new fW(t,e?.cacheSizeBytes,this.forceOwnership)}}}class gM{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=fY.provider,this._offlineComponentProvider={build:t=>new fQ(t,e?.cacheSizeBytes)}}}function gL(e){return new gO(e?.forceOwnership)}function gF(){return new gM}let gV="NOT SUPPORTED";class gq{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class gU extends p0{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new gj(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(pj("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new sD(sA.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=gU._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function gB(e,t,n){if(s3(t,gU._jsonSchema)){var r;if(t.bundle===gV)throw new sD(sA.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=dm(e._databaseId),s=(r=t.bundle,new f0(r,i)),o=s.t(),a=new fs(s.getMetadata(),i);for(let e of o)a.o(e);let l=a.documents;if(1!==l.length)throw new sD(sA.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let h=us(i,l[0].document),u=new sJ(sW.fromString(t.bundleName));return new gU(e,new g_(e),u,h,new gq(!1,!1),n||null)}}gU._jsonSchemaVersion="firestore/documentSnapshot/1.0",gU._jsonSchema={type:s6("string",gU._jsonSchemaVersion),bundleSource:s6("string","DocumentSnapshot"),bundleName:s6("string"),bundle:s6("string")};class gj extends gU{data(e={}){return super.data(e)}}class gz{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new gq(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new gj(this._firestore,this._userDataWriter,n.key,n,new gq(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new sD(sA.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new gj(e._firestore,e._userDataWriter,n.doc.key,n.doc,new gq(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new gj(e._firestore,e._userDataWriter,t.doc.key,t.doc,new gq(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return sx(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new sD(sA.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=gz._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=sB.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function g$(e,t,n){if(s3(t,gz._jsonSchema)){var r;if(t.bundle===gV)throw new sD(sA.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=dm(e._databaseId),s=(r=t.bundle,new f0(r,i)),o=s.t(),a=new fs(s.getMetadata(),i);for(let e of o)a.o(e);if(1!==a.queries.length)throw new sD(sA.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${a.queries.length} queries.`);let l=uE(a.queries[0].bundledQuery),h=a.documents,u=new d1;h.map(e=>{let t=us(i,e.document);u=u.add(t)});let c=d6.fromInitialDocuments(l,u,l9(),!1,!1),d=new pu(e,n||null,l);return new gz(e,new g_(e),d,c)}}function gK(e,t){return e instanceof gU&&t instanceof gU?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof gz&&t instanceof gz&&e._firestore===t._firestore&&pf(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}gz._jsonSchemaVersion="firestore/querySnapshot/1.0",gz._jsonSchema={type:s6("string",gz._jsonSchemaVersion),bundleSource:s6("string","QuerySnapshot"),bundleName:s6("string"),bundle:s6("string")};let gG={maxAttempts:5};class gH{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=pR(e)}set(e,t,n){this._verifyNotCommitted();let r=gW(e,this._firestore),i=gy(r.converter,t,n),s=pP(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,hg.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=gW(e,this._firestore);return i="string"==typeof(t=ek(t))||t instanceof pI?pL(this._dataReader,"WriteBatch.update",s._key,t,n,r):pM(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,hg.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=gW(e,this._firestore);return this._mutations=this._mutations.concat(new hS(t._key,hg.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new sD(sA.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function gW(e,t){if((e=ek(e)).firestore!==t)throw new sD(sA.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class gQ{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=pR(e)}get(e){let t=gW(e,this._firestore),n=new g_(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return sx(24041);let r=e[0];if(r.isFoundDocument())return new p0(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new p0(this._firestore,n,t._key,null,t.converter);throw sx(18433,{doc:r})})}set(e,t,n){let r=gW(e,this._firestore),i=gy(r.converter,t,n),s=pP(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i,s=gW(e,this._firestore);return i="string"==typeof(t=ek(t))||t instanceof pI?pL(this._dataReader,"Transaction.update",s._key,t,n,r):pM(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=gW(e,this._firestore);return this._transaction.delete(t._key),this}}class gY extends gQ{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=gW(e,this._firestore),n=new pW(this._firestore);return super.get(e).then(e=>new gU(this._firestore,n,t._key,e._document,new gq(!1,!1),t.converter))}}function gJ(e,t,n){var r,i;let s;e=s1(e,p_);let o={...gG,...n};if(o.maxAttempts<1)throw new sD(sA.INVALID_ARGUMENT,"Max attempts must be at least 1");return r=pv(e),i=n=>t(new gY(e,n)),s=new sR,r.asyncQueue.enqueueAndForget(async()=>{let e=await pt(r);new f2(r.asyncQueue,e,o,i,s).ju()}),s.promise}function gX(e){e=s1(e,pc);let t=s1(e.firestore,p_);return pr(pv(t),e._key).then(n=>mn(t,e,n))}function gZ(e){var t;let n;e=s1(e,pc);let r=s1(e.firestore,p_),i=pv(r),s=new pW(r);return(t=e._key,n=new sR,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await e.persistence.runTransaction("read document","readonly",n=>e.localDocuments.getDocument(n,t));r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new sD(sA.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=d0(r,`Failed to get document '${t} from cache`);n.reject(e)}})(await f9(i),t,n)),n.promise).then(t=>new gU(r,s,e._key,t,new gq(null!==t&&t.hasLocalMutations,!0),e.converter))}function g0(e){e=s1(e,pc);let t=s1(e.firestore,p_);return pr(pv(t),e._key,{source:"server"}).then(n=>mn(t,e,n))}function g1(e){e=s1(e,pu);let t=s1(e.firestore,p_),n=pv(t),r=new pW(t);return p2(e._query),pi(n,e._query).then(n=>new gz(t,r,e,n))}function g2(e){var t;let n;e=s1(e,pu);let r=s1(e.firestore,p_),i=pv(r),s=new pW(r);return(t=e._query,n=new sR,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await cK(e,t,!0),i=new fh(t,r.ks),s=i.ru(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(r){let e=d0(r,`Failed to execute query '${t} against cache`);n.reject(e)}})(await f9(i),t,n)),n.promise).then(t=>new gz(r,s,e,t))}function g6(e){e=s1(e,pu);let t=s1(e.firestore,p_),n=pv(t),r=new pW(t);return pi(n,e._query,{source:"server"}).then(n=>new gz(t,r,e,n))}function g3(e,t,n){e=s1(e,pc);let r=s1(e.firestore,p_),i=gy(e.converter,t,n),s=pR(r);return mt(r,[pP(s,"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,hg.none())])}function g5(e,t,n,...r){e=s1(e,pc);let i=s1(e.firestore,p_),s=pR(i);return mt(i,[("string"==typeof(t=ek(t))||t instanceof pI?pL(s,"updateDoc",e._key,t,n,r):pM(s,"updateDoc",e._key,t)).toMutation(e._key,hg.exists(!0))])}function g4(e){return mt(s1(e.firestore,p_),[new hS(e._key,hg.none())])}function g8(e,t){let n=s1(e.firestore,p_),r=function(e,t,...n){if(e=ek(e),1==arguments.length&&(t=sB.newId()),function(e,t,n){if(!n)throw new sD(sA.INVALID_ARGUMENT,`Function doc() cannot be called with an empty ${t}.`)}(0,"path",t),e instanceof ph){let r=sW.fromString(t,...n);return sX(r),new pc(e,null,new sJ(r))}{if(!(e instanceof pc||e instanceof pd))throw new sD(sA.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(sW.fromString(t,...n));return sX(r),new pc(e.firestore,e instanceof pd?e.converter:null,new sJ(r))}}(e),i=gy(e.converter,t);return mt(n,[pP(pR(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,hg.exists(!1))]).then(()=>r)}function g7(e,...t){var n;let r,i,s,o,a;e=ek(e);let l={includeMetadataChanges:!1,source:"default"},h=0;"object"!=typeof t[0]||pJ(t[h])||(l=t[h++]);let u={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(pJ(t[h])){let e=t[h];t[h]=e.next?.bind(e),t[h+1]=e.error?.bind(e),t[h+2]=e.complete?.bind(e)}if(e instanceof pc)i=s1(e.firestore,p_),s=lB(e._key.path),r={next:n=>{t[h]&&t[h](mn(i,e,n))},error:t[h+1],complete:t[h+2]};else{let n=s1(e,pu);i=s1(n.firestore,p_),s=n._query;let o=new pW(i);r={next:e=>{t[h]&&t[h](new gz(i,o,n,e))},error:t[h+1],complete:t[h+2]},p2(e._query)}return n=pv(i),a=new fn(s,o=new fX(r),u),n.asyncQueue.enqueueAndForget(async()=>d8(await pn(n),a)),()=>{o.Nu(),n.asyncQueue.enqueueAndForget(async()=>d7(await pn(n),a))}}function g9(e,t,...n){var r,i,s,o,a,l;let h=ek(e),u=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let n of["bundle","bundleName","bundleSource"]){if(!(n in e)){t.error=`snapshotJson missing required field: ${n}`;break}let r=e[n];if("string"!=typeof r){t.error=`snapshotJson field '${n}' must be a string.`;break}if(0===r.length){t.error=`snapshotJson field '${n}' cannot be an empty string.`;break}"bundle"===n?t.bundle=r:"bundleName"===n?t.bundleName=r:"bundleSource"===n&&(t.bundleSource=r)}return t}(t);if(u.error)throw new sD(sA.INVALID_ARGUMENT,u.error);let c,d=0;if("object"!=typeof n[0]||pJ(n[d])||(c=n[d++]),"QuerySnapshot"===u.bundleSource){let e,t,o=null;if("object"==typeof n[d]&&pJ(n[d])){let e=n[d++];o={next:e.next,error:e.error,complete:e.complete}}else o={next:n[d++],error:n[d++],complete:n[d++]};return r=c,i=o,s=n[d],t=!1,pw(h,u.bundle).then(()=>{var e,t,n;return e=h,t=u.bundleName,(n=pv(e=s1(e,p_)),n.asyncQueue.enqueue(async()=>{var e;return e=await f9(n),e.persistence.runTransaction("Get named query","readonly",n=>e.Pi.getNamedQuery(n,t))})).then(t=>t?new pu(e,null,t.query):null)}).then(n=>{n&&!t&&(s&&n.withConverter(s),e=g7(n,r||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===u.bundleSource){let e,t,r=null;if("object"==typeof n[d]&&pJ(n[d])){let e=n[d++];r={next:e.next,error:e.error,complete:e.complete}}else r={next:n[d++],error:n[d++],complete:n[d++]};return o=c,a=r,l=n[d],t=!1,pw(h,u.bundle).then(()=>{t||(e=g7(new pc(h,l||null,sJ.fromPath(u.bundleName)),o||{},a))}).catch(e=>(a.error&&a.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new sD(sA.INVALID_ARGUMENT,`unsupported bundle source: ${u.bundleSource}`)}function me(e,t){let n,r=pv(e=s1(e,p_));return n=new fX(pJ(t)?t:{next:t}),r.asyncQueue.enqueueAndForget(async()=>{var e;return e=await pn(r),void(e.Ca.add(n),n.next())}),()=>{n.Nu(),r.asyncQueue.enqueueAndForget(async()=>{var e;return e=await pn(r),void e.Ca.delete(n)})}}function mt(e,t){var n;let r;return n=pv(e),r=new sR,n.asyncQueue.enqueueAndForget(async()=>fw(await pe(n),t,r)),r.promise}function mn(e,t,n){let r=n.docs.get(t._key),i=new pW(e);return new gU(e,i,t._key,r,new gq(n.hasPendingWrites,n.fromCache),t.converter)}function mr(e){return pv(e=s1(e,p_)),new gH(e,t=>mt(e,t))}function mi(e,t){let n=pv(e=s1(e,p_));if(!n._uninitializedComponentsProvider||"memory"===n._uninitializedComponentsProvider._offline.kind)return sT("Cannot enable indexes when persistence is disabled"),Promise.resolve();let r=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new sD(sA.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,n=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=ms(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=p$("setIndexConfiguration",ms(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new ot(e,2)):"ASCENDING"===t.order?r.push(new ot(e,0)):"DESCENDING"===t.order&&r.push(new ot(e,1))}n.push(new s8(s8.UNKNOWN_ID,t,r,on.empty()))}return n}(t);return n.asyncQueue.enqueue(async()=>(async function(e,t){let n=e.indexManager,r=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(i=>(function(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,o=t.length,a=0,l=0;for(;a<o&&l<s;){let s=n(e[l],t[a]);s<0?i(e[l++]):s>0?r(t[a++]):(a++,l++)}for(;a<o;)r(t[a++]);for(;l<s;)i(e[l++])})(i,t,oe,t=>{r.push(n.addFieldIndex(e,t))},t=>{r.push(n.deleteFieldIndex(e,t))})).next(()=>ou.waitFor(r)))})(await f9(n),r))}function ms(e,t){if("string"!=typeof e[t])throw new sD(sA.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class mo{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function ma(e){e=s1(e,p_);let t=md.get(e);if(t)return t;let n=pv(e);if("persistent"!==n._uninitializedComponentsProvider?._offline.kind)return null;let r=new mo(e);return md.set(e,r),r}function ml(e){mc(e,!0)}function mh(e){mc(e,!1)}function mu(e){var t;(t=pv(e._firestore)).asyncQueue.enqueue(async()=>{var e;let n;return n=(e=await f9(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>n.deleteAllFieldIndexes(e))}).then(e=>sC("deleting all persistent cache indexes succeeded")).catch(e=>sT("deleting all persistent cache indexes failed",e))}function mc(e,t){var n;(n=pv(e._firestore),n.asyncQueue.enqueue(async()=>{var e;return e=await f9(n),void(e.Cs.As=t)})).then(e=>sC(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>sT(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let md=new WeakMap;class mf{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return mp.instance.onExistenceFilterMismatch(e)}}class mp{constructor(){this.i=new Map}static get instance(){return mg||function(e){if(hM)throw Error("a TestingHooksSpi instance is already set");hM=e}(mg=new mp),mg}u(e){this.i.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),n=this.i;return n.set(t,e),()=>n.delete(t)}}let mg=null;!function(e=!0){sw=th,e7(new eN("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new p_(new sL(t.getProvider("auth-internal")),new sU(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new sD(sA.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new aW(e.options.projectId,t)}(i,n),i);return r={useFetchStreams:e,...r},s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),tg(pQ,pY,void 0),tg(pQ,pY,"esm2020")}(),e.s(["AggregateField",()=>pX,"AggregateQuerySnapshot",()=>pZ,"DocumentSnapshot",()=>gU,"PersistentCacheIndexManager",()=>mo,"QueryCompositeFilterConstraint",()=>p7,"QueryConstraint",()=>p3,"QueryDocumentSnapshot",()=>gj,"QueryEndAtConstraint",()=>gh,"QueryFieldFilterConstraint",()=>p4,"QueryLimitConstraint",()=>gr,"QueryOrderByConstraint",()=>gt,"QuerySnapshot",()=>gz,"QueryStartAtConstraint",()=>go,"SnapshotMetadata",()=>gq,"Transaction",()=>gY,"WriteBatch",()=>gH,"_TestingHooks",()=>mf,"addDoc",()=>g8,"aggregateFieldEqual",()=>gI,"aggregateQuerySnapshotEqual",()=>gC,"and",()=>ge,"average",()=>gw,"count",()=>gb,"deleteAllPersistentCacheIndexes",()=>mu,"deleteDoc",()=>g4,"disablePersistentCacheIndexAutoCreation",()=>mh,"documentSnapshotFromJSON",()=>gB,"enablePersistentCacheIndexAutoCreation",()=>ml,"endAt",()=>gc,"endBefore",()=>gu,"executeWrite",()=>mt,"getAggregateFromServer",()=>gT,"getCountFromServer",()=>gE,"getDoc",()=>gX,"getDocFromCache",()=>gZ,"getDocFromServer",()=>g0,"getDocs",()=>g1,"getDocsFromCache",()=>g2,"getDocsFromServer",()=>g6,"getPersistentCacheIndexManager",()=>ma,"limit",()=>gi,"limitToLast",()=>gs,"memoryEagerGarbageCollector",()=>gA,"memoryLocalCache",()=>gR,"memoryLruGarbageCollector",()=>gD,"onSnapshot",()=>g7,"onSnapshotResume",()=>g9,"onSnapshotsInSync",()=>me,"or",()=>p9,"orderBy",()=>gn,"persistentLocalCache",()=>gP,"persistentMultipleTabManager",()=>gF,"persistentSingleTabManager",()=>gL,"query",()=>p5,"querySnapshotFromJSON",()=>g$,"runTransaction",()=>gJ,"setDoc",()=>g3,"setIndexConfiguration",()=>mi,"snapshotEqual",()=>gK,"startAfter",()=>gl,"startAt",()=>ga,"sum",()=>gv,"updateDoc",()=>g5,"where",()=>p8,"writeBatch",()=>mr],98190),e.i(98190);let mm=0===tf().length?tu({apiKey:"AIzaSyDhwxaI0Bx_AGF1K1E342nY8bwOX_DImA8",authDomain:"gps-tracker-8376c.firebaseapp.com",projectId:"gps-tracker-8376c",storageBucket:"gps-tracker-8376c.firebasestorage.app",messagingSenderId:"650884354501",appId:"1:650884354501:web:92843965d0b7c4e241bbac",databaseURL:"https://gps-tracker-8376c-default-rtdb.asia-southeast1.firebasedatabase.app"}):tf()[0];var my=mm;let m_=e9("object"==typeof my?my:td(),"firestore").getImmediate({identifier:"string"==typeof my?my:aH});if(!m_._initialized){let e=H("firestore");e&&function(e,t,n,r={}){e=s1(e,ph);let i=Y(t),s=e._getSettings(),o={...s,emulatorOptions:e._getEmulatorOptions()},a=`${t}:${n}`;i&&(J(`https://${a}`),et("Firestore",!0)),s.host!==pa&&s.host!==a&&sT("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:a,ssl:i,emulatorOptions:r};if(!eI(l,o)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=sv.MOCK_USER;else{t=X(r.mockUserToken,e._app?.options.projectId);let i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new sD(sA.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new sv(i)}e._authCredentials=new sM(new sP(t,n))}}(m_,...e)}let mv=function(e=td(),t){let n=e9(e,"database").getImmediate({identifier:void 0});if(!n._instanceStarted){let e=H("database");e&&function(e,t,n,r={}){var i;let s,o,a;(e=ek(e))._checkNotDeleted("useEmulator");let l=`${t}:${n}`,h=e._repoInternal;if(e._instanceStarted){if(l===e._repoInternal.repoInfo_.host&&eI(r,h.repoInfo_.emulatorOptions))return;tG("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}h.repoInfo_.nodeAdmin?(r.mockUserToken&&tG('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new nn(nn.OWNER)):r.mockUserToken&&(s=new nn("string"==typeof r.mockUserToken?r.mockUserToken:X(r.mockUserToken,e.app.options.projectId))),Y(t)&&(J(t),et("Database",!0)),i=s,o=l.lastIndexOf(":"),a=Y(l.substring(0,o)),h.repoInfo_=new no(l,a,h.repoInfo_.namespace,h.repoInfo_.webSocketOnly,h.repoInfo_.nodeAdmin,h.repoInfo_.persistenceKey,h.repoInfo_.includeNamespaceInQueryParams,!0,r),i&&(h.authTokenProvider_=i)}(n,...e)}return n}(mm);function mw(){let[e,t]=(0,O.useState)([]),[n,r]=(0,O.useState)(!0);return(0,O.useEffect)(()=>{var e,n;let i=function(e,t,n,r,i){var s;let o,a;if("object"==typeof r&&(o=void 0,i=r),"function"==typeof r&&(o=r),i&&i.onlyOnce){let t=n,r=(n,r)=>{i6(e._repo,e,h),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}let l=new ss(n,o||void 0),h="value"===t?new su(l):new sc(t,l);return s=e._repo,a=".info"===nT(e._path)?im(s.infoSyncTree_,e,h):im(s.serverSyncTree_,e,h),iQ(s.eventQueue_,e._path,a),()=>i6(e._repo,e,h)}((n="devices",(e=ek(e=mv))._checkNotDeleted("ref"),void 0!==n?sh(e._root,n):e._root),"value",e=>{let n=e.val();if(n){let e=Object.values(n);e.sort((e,t)=>(t.lastUpdated||0)-(e.lastUpdated||0)),t(e)}else t([]);r(!1)},void 0,void 0);return()=>i()},[]),(0,P.jsxs)("main",{className:"container",children:[(0,P.jsx)("h1",{children:"ESP32 Tracker Grid"}),(0,P.jsx)("div",{className:"dashboard-card",children:n?(0,P.jsx)("div",{className:"loading",children:"Connecting to Satellite..."}):(0,P.jsx)("div",{style:{overflowX:"auto"},children:(0,P.jsxs)("table",{className:"device-table",children:[(0,P.jsx)("thead",{children:(0,P.jsxs)("tr",{children:[(0,P.jsx)("th",{children:"Device ID"}),(0,P.jsx)("th",{children:"Last Seen"}),(0,P.jsx)("th",{children:"Coordinates"}),(0,P.jsx)("th",{children:"Status"}),(0,P.jsx)("th",{children:"Data Payload"})]})}),(0,P.jsxs)("tbody",{children:[e.map(e=>(0,P.jsxs)("tr",{children:[(0,P.jsx)("td",{style:{fontWeight:600,color:"var(--foreground)"},children:e.deviceId}),(0,P.jsx)("td",{style:{color:"#a1a1aa"},children:e.lastUpdated?new Date(e.lastUpdated).toLocaleTimeString():"Just now"}),(0,P.jsx)("td",{style:{fontFamily:"monospace"},children:e.lat&&e.lng?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("span",{style:{color:"var(--primary)"},children:Number(e.lat).toFixed(4)}),(0,P.jsx)("span",{style:{margin:"0 0.5rem",opacity:.3},children:"|"}),(0,P.jsx)("span",{style:{color:"var(--secondary)"},children:Number(e.lng).toFixed(4)})]}):(0,P.jsx)("span",{style:{opacity:.3},children:"N/A"})}),(0,P.jsx)("td",{children:(0,P.jsxs)("span",{className:"status-badge active",children:[(0,P.jsx)("span",{className:"animate-pulse",style:{marginRight:"6px",width:"6px",height:"6px",borderRadius:"50%",background:"currentColor"}}),"ONLINE"]})}),(0,P.jsx)("td",{style:{maxWidth:"300px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",opacity:.7,fontSize:"0.85rem"},children:JSON.stringify(Object.fromEntries(Object.entries(e).filter(([e])=>!["deviceId","lastUpdated","lat","lng"].includes(e))))})]},e.deviceId)),0===e.length&&(0,P.jsx)("tr",{children:(0,P.jsxs)("td",{colSpan:5,style:{textAlign:"center",padding:"4rem",color:"#52525b"},children:["No devices detected.",(0,P.jsx)("br",{}),(0,P.jsx)("small",{children:"Send a POST request to /api/track to start."})]})})]})]})})})]})}e.s(["default",()=>mw],49852)}]);